(self.webpackChunk=self.webpackChunk||[]).push([[274],{89449:(e,t,i)=>{i.d(t,{w:()=>p});var r=i(90023),n=i(35547),a=i(20154),s=i(25077),o=i(90572),l=i(59179),d=i(31603),c=i(58303),u=i(67177),h=i(46189),g=i(68822),m=i(40594);class p{constructor(e){this._checkingService=e,this._handlers=[],this._log=m.Y.create("AgentsCapiClient"),this._subscription=this._checkingService.pipe(o.h(c.pC),l.U((e=>e.value.capiMessages)),d.J(),o.h((e=>(0,n.rE)(e)||(0,a.eJ)(e)||(0,s.Xl)(e)||(0,s.Dl)(e)||(0,s.oy)(e)||(0,s.ps)(e))),l.U((e=>e))).subscribe((e=>{this._handlers.forEach((t=>(this._log.debug("Handling CAPI Message",e),t(e),h._.Result.STOP_HANDLING)))}))}enqueueExternalCommand(e){this._log.debug("Enqueueing External Command",e);const t=(0,r.zG)(this._checkingService.get(),c.g_((()=>""),(e=>e.sessionUuid||""))),{action:i,...n}=e({sessionId:t,id:1,currentRevision:0,nextRevision:()=>1});return(0,r.zG)(this._checkingService.get(),u.Yo((()=>new g.YG("Checking service is not available"))),u.tS((e=>e.sendMessage(i,n,!0))))}registerExternalMessageHandler(e){this._handlers.includes(e)||this._handlers.push(e)}unregisterExternalMessageHandler(e){this._handlers=this._handlers.filter((t=>t!==e))}dispose(){this._subscription.unsubscribe(),this._handlers=[]}}},10269:(e,t,i)=>{i.d(t,{q:()=>a});var r=i(92379),n=i(49652);function a(){const[e,t]=r.useState(void 0);return r.useEffect((()=>{(0,n.kA)().then((e=>{t(e)}))}),[]),{isGoEnabledForInstitution:e,isInstitutionManaged:void 0!==e}}},78370:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(6824),n=i(36661),a=i(37323);function s(e,t){const i=a.Sy((e=>e.struct({kind:e.literal(t)}))),s=a.Sy((t=>t.intersect(i(t))(e(t))));return{ResultMessage:s,isResultMessage:n.n(a.l7(r.Schemable)({sensitiveString:r.string}))(s).is}}},1413:(e,t,i)=>{i.r(t),i.d(t,{G2FeatureImpl:()=>Yi});var r=i(58303),n=i(90023),a=i(92379),s=i(13391),o=i(88012),l=i(99887),d=i(20161),c=i(90572),u=i(84178),h=i(24666),g=i(2187),m=i(78129),p=i(10444),v=i(86211);const f=["ai-editor-promotion","multilingual-onboarding"];var S=i(40594);class w{constructor(){this._logger=S.Y.create("GenericBannerServiceImpl"),this._serviceSubs=new Map,this._registeredBannerServices=new Map,this._servicePriorityOrder=f}registerBannerService(e){if(!this._servicePriorityOrder.includes(e.bannerPriorityId))return void this._logger.error(`The service bannerPriorityId ${e.bannerPriorityId} is missing in the priority order list.`);if(this._registeredBannerServices.has(e.bannerPriorityId))return void this._logger.warn(`The service with bannerPriorityId ${e.bannerPriorityId} has already been registered.`);this._registeredBannerServices.set(e.bannerPriorityId,e);const t=e.shouldBeShown.subscribe((()=>{this._updatePrioritizedToggles()}));this._serviceSubs.set(e.bannerPriorityId,t)}unregisterBannerService(e){const t=this._serviceSubs.get(e);t&&(t.unsubscribe(),this._serviceSubs.delete(e)),this._registeredBannerServices.delete(e),this._updatePrioritizedToggles()}_updatePrioritizedToggles(){this._resetPrioritizedToggles();for(const e of this._servicePriorityOrder){const t=this._registeredBannerServices.get(e);if(t&&t.shouldBeShown.get())return void t.shouldBeShownPrioritized.set(!0)}}_resetPrioritizedToggles(){for(const e of this._registeredBannerServices.values())e.shouldBeShownPrioritized.set(!1)}dispose(){this._resetPrioritizedToggles();for(const e of this._serviceSubs.values())e.unsubscribe();this._registeredBannerServices.clear(),this._serviceSubs.clear()}}const b={acceptCount:0,completedSteps:[],hasSeenSelectionPulsating:!1,hasSeenIdlePulsating:!1,revertPresentedCount:0},C={hasBeenSeen:!1},_={showsCount:0};class y{constructor(e){this._params=e,this._logger=S.Y.create("TranslateOnboardingServiceImpl"),this.shouldOnboardingBeShown=s.h.combine(this._params.csPageState.view("g2Settings"),this._params.currentUser.view("id"),((e,t)=>{const i=function(e,t){var i;return(null===(i=null==e?void 0:e.translateOnboarding)||void 0===i?void 0:i[t])||C}(e,t);return!i.hasBeenSeen})),this._params.hasGeneralOnboardingBeenSeen||this.markOnboardingAsSeen()}markOnboardingAsSeen(){this._params.csToBgActions.markTranslateOnboardingAsSeen({userId:this._params.currentUser.get().id}).catch((e=>{this._logger.warn('Error while marking "Translate" (tab) onboarding as seen.',e)}))}}class k{constructor(){this.shouldOnboardingBeShown=s.h.create(!1).view()}markOnboardingAsSeen(){}}var B=i(32073),x=i(59179),E=i(75224),R=i(98587);class I{constructor(e){this._params=e,this._logger=S.Y.create("TranslationServiceImpl"),this._subs=new B.w0,this._textHashToLanguageTag=new Map,this._userLanguageTag=this._determineUserLanguageTag(),this._subs.add(this._createDetermineActiveSidelineTextLanguageSubscription())}getTranslationDirection(e){var t;const i=(0,E.Wu)(e),r=null!==(t=this._textHashToLanguageTag.get(i))&&void 0!==t?t:R.yI;return{sourceLanguageTag:r,targetLanguageTag:this._determineTargetLanguageTag(r)}}recordTranslationLanguages(e){this._params.csToBgActions.recordTranslationLanguages({userId:this._params.currentUser.get().id,...e}).catch((t=>{this._logger.warn("Error while recording translation languages.",t,{translationDirection:e})}))}dispose(){this._subs.unsubscribe()}_determineTargetLanguageTag(e){var t,i,r,n,a;const{currentUser:s,csPageState:o}=this._params,l=s.get().id,d=[...null!==(r=null===(i=null===(t=o.view("g2Settings").get())||void 0===t?void 0:t.translationLanguages)||void 0===i?void 0:i[l])&&void 0!==r?r:[]].sort(((e,t)=>t.lastChangeTimestamp-e.lastChangeTimestamp)),c=null===(n=d.find((t=>t.sourceLanguageTag===e)))||void 0===n?void 0:n.targetLanguageTag;if(c){const e=R.Ro.findMatch(c);if(e)return e}const u=null===(a=d.find((t=>t.targetLanguageTag===e)))||void 0===a?void 0:a.sourceLanguageTag;if(u){const e=R.Ro.findMatch(u);if(e)return e}if(e===R.yI)return"en-US";if(this._userLanguageTag!==R.yI&&!(0,R.T0)(e,this._userLanguageTag)){const e=R.Ro.findMatch(this._userLanguageTag);if(e)return e}return(0,R.T0)(e,"en")?"es-ES":"en-US"}_determineUserLanguageTag(){try{return this._params.i18nApi.getUILanguage()}catch(e){return R.yI}}_createDetermineActiveSidelineTextLanguageSubscription(){return this._params.sidelineCollectionViewModel.activeSideline.pipe(x.U(r.WG),c.h(Boolean),x.U((e=>e.text)),h.x()).pipe(d.w((async e=>{try{const t=await this._params.i18nApi.detectLanguage(e);if(!t.isReliable)return this._logger.debug("Could not reliably detect text language.",{originalText:e,detectedLanguageResult:t}),{originalText:e,detectedLanguageTag:R.yI};return{originalText:e,detectedLanguageTag:t.languages.sort(((e,t)=>t.percentage-e.percentage))[0].language}}catch(t){return this._logger.warn("Error while detecting language.",t,{originalText:e}),{originalText:e,detectedLanguageTag:R.yI}}}))).subscribe((({originalText:e,detectedLanguageTag:t})=>{this._logger.debug("Active sideline's (original) text's language determined.",{originalText:e,detectedLanguageTag:t}),this._textHashToLanguageTag.clear();const i=(0,E.Wu)(e);this._textHashToLanguageTag.set(i,t)}))}}class T{getTranslationDirection(e){return R.jk.undetermined}recordTranslationLanguages(e){}dispose(){}}var P=i(35614),F=i(90189),M=i(67385),D=i(7865),L=i(5388),A=i(96312),O=i(56817),U=i(5759),z=(i(57758),i(44071)),H=i(29416),G=i(29479),V=i(26155),q=i(78335),N=i(90245);function j(e){let t=N.PA+N.gK/2;const i=e.scrollMirrorRectInViewport.left+t;return e.textStartPositionInViewport-i>3*N.l7?t=e.textStartPositionInViewport-e.scrollMirrorRectInViewport.left-N.l7:e.scrollMirrorRectInViewport.left+t+N.TM+N.gK>e.textStartPositionInViewport&&(t=N.PA/2),e.scrollMirrorRectInViewport.left+t<0&&(e.textStartPositionInViewport>=N.l7?t=-e.scrollMirrorRectInViewport.left+N.PA/2:e.textStartPositionInViewport>=N.t&&(t=-e.scrollMirrorRectInViewport.left-N.PA/2)),{top:e.vBarTextRectInMirror.top,left:t,width:e.scrollMirrorRectInViewport.width-t,height:e.vBarTextRectInMirror.height}}function $(e){let t=N.PA+N.gK/2;return t+N.TM+N.gK>e.vBarTextRectInMirror.left&&(t=N.PA),{top:e.vBarTextRectInMirror.top,left:t,width:e.scrollMirrorRectInViewport.width-t,height:e.vBarTextRectInMirror.height}}function W(e){return{kind:"sessionText",rev:Number.MIN_SAFE_INTEGER,range:e}}var Y=i(954),K=i(81933),J=i(43389),Q=i(93865);function Z(e,t){return e.pipe(Y.O(null),x.U((()=>(0,n.zG)(t.getCurrentSelection(!0),Q.Ls,r.ij,r.hX((0,n.ff)(J.SV.isCollapsed))))),K.skipBy(r.Eh(J.SV.eq)))}function X(e){const t=e.mirrorElement.getBoundingClientRect(),i=e.boundariesElement.getBoundingClientRect(),r=t.left-i.left;return{top:e.originalOffset.top,left:e.originalOffset.left-r}}function ee(e){return{width:e.boundariesElement.getBoundingClientRect().width,height:e.originalSize.height}}var te=i(13374),ie=i(59833),re=i(18647),ne=i(47557);function ae(e){var t,i;const r=(0,re.o)(e),n=null!==(t=(0,ne.a2)(r.paddingLeft))&&void 0!==t?t:0,a=null!==(i=(0,ne.a2)(r.borderLeftWidth))&&void 0!==i?i:0;return e.getBoundingClientRect().left+n+a}function se(e){return"TEXTAREA"===e.tagName||"INPUT"===e.tagName?ae(e):function(e){const t=[...e.querySelectorAll("p, h1, h2, h3")].filter((e=>e.getBoundingClientRect().height>0));return(0,n.zG)(t,ie.YM,r.g_((()=>ae(e)),(e=>e.getBoundingClientRect().left)))}(e)}function oe(e){return function(e){const{textFieldElement:t,isIFrameTextField:i,positionedAncestor:r,getSize:n,getOffset:a,adjustSizeBeforeRendering:o,adjustOffsetBeforeRendering:l}=e,d=(0,te.hI)(t,r),c=s.h.create({width:0,height:0}),u=s.h.create({top:0,left:0});let h={};return 0===d.length&&(h={getFieldSize:n,getPaddingRectSize:n,getFieldOffset:a}),{textField:(0,te.Iy)(t,d[0]||r,i,h),scrollables:d.map(((e,t,i)=>(0,te.fR)(e,i[t+1]||r,!1,void 0,t===i.length-1?n:void 0,t===i.length-1?a:void 0))),rect:s.h.combine(c,u,((e,t)=>{const i=r.getBoundingClientRect();return{top:i.top+t.top,left:i.left+t.left,width:e.width,height:e.height}})),adjustSizeBeforeRendering:e=>{const t=o(e);return c.set(t),t},adjustOffsetBeforeRendering:e=>{const t=l(e);return u.set(t),t},textStartPosition:s.h.combine(c,u,(()=>se(t)))}}({textFieldElement:e.textFieldElement,isIFrameTextField:e.integrationInfo.isInsideIFrame,positionedAncestor:e.injectionPlace,getSize:(t,i)=>{var r,n;return null!==(n=null===(r=e.getSize)||void 0===r?void 0:r.call(e,t,i))&&void 0!==n?n:i},getOffset:(t,i)=>{var r,n;return null!==(n=null===(r=e.getOffset)||void 0===r?void 0:r.call(e,t,i))&&void 0!==n?n:i},adjustSizeBeforeRendering:e=>({width:e.width+N.l7,height:e.height}),adjustOffsetBeforeRendering:e=>({top:e.top,left:e.left-N.l7})})}var le=i(32103);function de(e){var t;switch(e.integrationInfo.kind){case"jiraProseMirror":case"redditContentEditable":case"outlook":case"salesforce":return e.textFieldElement;case"whatsapp":case"confluenceEditor":{const i=null===(t=e.mirrorElement.parentElement)||void 0===t?void 0:t.parentElement;return i||e.mirrorElement}case"contentEditable":case"gmail":case"googleChat":case"googleDocsComments":case"iframe":case"textarea":case"twitterDraftJS":case"hubspot":case"zendesk":case"freshdesk":case"slack":return e.mirrorElement;default:(0,le.L0)(e.integrationInfo)}}function ce(e){switch(e.integrationInfo.kind){case"gmail":return r.G({visibility:"visible",zIndex:1e3});case"googleChat":return r.G({zIndex:10});case"twitterDraftJS":return r.G({zIndex:1});case"hubspot":return r.G({zIndex:4});case"zendesk":return r.G({left:"-16px",zIndex:100});case"salesforce":return r.G({left:"-15px"});case"freshdesk":return r.G({left:"-9px"});case"slack":return r.G({zIndex:2});case"outlook":case"contentEditable":case"googleDocsComments":case"iframe":case"textarea":case"jiraProseMirror":case"redditContentEditable":case"whatsapp":case"confluenceEditor":return r.YP;default:(0,le.L0)(e.integrationInfo)}}class ue{constructor(e){this._params=e,this._logger=(0,U.h)(ue.name),this._subs=new B.w0,this._selectionRange=s.h.create(r.YP),this._vBarsInjectionPlace=function(e){const t=se(e.textFieldElement)-N.l7;return(0,re.E6)(e.textFieldElement,(e=>!!(0,re.XQ)(e)&&e.getBoundingClientRect().left<=t))}({textFieldElement:this._params.highlightsLayoutInfo.textFieldElement}),this._vBarsScrollMirrorLayout=oe({textFieldElement:this._params.highlightsLayoutInfo.textFieldElement,injectionPlace:this._vBarsInjectionPlace,integrationInfo:this._params.integrationInfo,getSize:(e,t)=>ee({boundariesElement:de({integrationInfo:this._params.integrationInfo,textFieldElement:this._params.highlightsLayoutInfo.textFieldElement,mirrorElement:e}),originalSize:t}),getOffset:(e,t)=>X({mirrorElement:e,boundariesElement:de({integrationInfo:this._params.integrationInfo,textFieldElement:this._params.highlightsLayoutInfo.textFieldElement,mirrorElement:e}),originalOffset:t})}),this._documentElement=(0,q.cL)(this._params.highlightsLayoutInfo.textFieldElement)&&this._params.highlightsLayoutInfo.textFieldElement.contentDocument?this._params.highlightsLayoutInfo.textFieldElement.contentDocument:this._params.highlightsLayoutInfo.textFieldElement.ownerDocument,this.info=this._params.integrationInfo,this.highlightGeometryFilter=V.qH.everything,this.highlightGeometryInvalidator=(0,V.WF)(this._params.highlightsLayoutInfo.textFieldLayout),this.selectionRange=this._selectionRange.view(),this.isEnabled=s.h.create(!0),this.textRangeFilter=n.W8,this.additionalGlobalEventSource={scroll:(0,q.cL)(this._params.highlightsLayoutInfo.textFieldElement)&&this._params.highlightsLayoutInfo.textFieldElement.contentWindow?this._params.highlightsLayoutInfo.textFieldElement.contentWindow:void 0,click:this._documentElement},this.highlightsLayoutInfo=this._params.highlightsLayoutInfo,this.vBarsLayoutInfo={injectionPlace:this._vBarsInjectionPlace,scrollMirrorContainerStyleOverrides:r.FS(ce({integrationInfo:this._params.integrationInfo})),scrollMirrorLayout:this._vBarsScrollMirrorLayout},this.selectionOrCaretPosition=this._params.selectionOrCaretPosition,this.getVBarHighlightRect=j,this._subs.add(Z(z.R(this._documentElement,"selectionchange").pipe(H.b(100),G.h(void 0)),this._params.selectionService).subscribe(g.wW(this._selectionRange)))}getRewriteScope(e){return W(e.vBar.textRange)}dispose(){this._subs.unsubscribe()}getKeyboardEventsTarget(){return document.body}}var he=i(61179),ge=i(84308),me=i(5588),pe=i(64271),ve=i(25009),fe=i(83675),Se=i(43881),we=i(63951),be=i(4271),Ce=i(38317);var _e=i(7833);const ye=".kix-scrollareadocumentplugin";function ke(e){const t=e.mirrorElement.querySelector(_e.yw)||(i=e.mirrorElement,Array.from(i.ownerDocument.documentElement.querySelectorAll(ye)).filter((e=>e.getBoundingClientRect().width>0))[0]||null);var i;return t||(e.telemetryService.error({message:"Failed to retrieve proper vBars scroll mirror boundaries element on Google Docs."}),e.mirrorElement)}class Be{constructor(e){this._params=e,this._subs=new B.w0,this._logger=(0,U.h)(Be.name),this._highlightCollectionFilterSource=new fe.b(this._params.textObserver),this._selectionRange=s.h.create(r.YP),this._vBarsInjectionPlace=function(e){const t=e.textFieldElement.ownerDocument;return t.getElementById("kix-appview")||(e.telemetryService.error({message:"Failed to retrieve proper injection place for vBars in Google Docs; will inject in the root of the HTML."}),t.documentElement)}({textFieldElement:this._params.highlightsLayoutInfo.textFieldElement,telemetryService:this._params.telemetryService}),this._vBarsScrollMirrorLayout=oe({textFieldElement:this._params.highlightsLayoutInfo.textFieldElement,injectionPlace:this._vBarsInjectionPlace,integrationInfo:this._params.integrationInfo,getSize:(e,t)=>ee({boundariesElement:ke({mirrorElement:e,telemetryService:this._params.telemetryService}),originalSize:t}),getOffset:(e,t)=>X({mirrorElement:e,boundariesElement:ke({mirrorElement:e,telemetryService:this._params.telemetryService}),originalOffset:t})}),this.info=this._params.integrationInfo,this.highlightGeometryFilter=this._highlightCollectionFilterSource.highlightsFilterFactory(),this.highlightGeometryInvalidator=ge.a([this._params.highlightsLayoutInfo.textFieldLayout.rect.changes.pipe(Y.O(this._params.highlightsLayoutInfo.textFieldLayout.rect.getCurrent())),this._params.highlightsLayoutInfo.textFieldLayout.scroll.changes.pipe(Y.O(this._params.highlightsLayoutInfo.textFieldLayout.scroll.getCurrent()))]).pipe(me.D((()=>this._params.textObserver.textMapChanged))),this.selectionRange=this._selectionRange.view(),this.isEnabled=this._params.integrationInfo.integrationMode.view((e=>e===ve.yj.write)),this.textRangeFilter=(0,he.ff)(Ce.$),this.highlightsLayoutInfo=this._params.highlightsLayoutInfo,this.vBarsLayoutInfo={injectionPlace:this._vBarsInjectionPlace,scrollMirrorContainerStyleOverrides:{zIndex:100},scrollMirrorLayout:this._vBarsScrollMirrorLayout},this.selectionOrCaretPosition=this._params.selectionOrCaretPosition,this.getVBarHighlightRect=$,this._subs.add(Z(pe.T(this._params.selectionSource.data.behavior,this._params.textObserver.contentChanges.immediate).pipe(G.h(void 0)),this._params.selectionService).subscribe(g.wW(this._selectionRange))),this._subs.add(this._selectionRange.subscribe((e=>this._logger.debug("Selection range updated.",e))))}getRewriteScope(e){if(e.vBar.text.includes(we.o2)){const t=this._params.textObserver.getCurrentTextMap().getPlainText(),i=t.slice(e.vBar.textRange.start,e.vBar.textRange.end);let r=i;for(let t=0;t<i.length;t++)if(i.charAt(t)===we.o2){const i=this._params.textObserver.getCurrentTextMap().getFragmentAtOffset(e.vBar.textRange.start+t),n=i instanceof Se.I?i.getParsedFragment().fragment.text:we.o2;r=r.replace(we.o2,n)}return i!==r?(this._logger.debug('Found "smart chips" and converted them into plain text.',{originalText:i,augmentedText:r}),this._params.telemetryService.infoOncePerMessage({message:"Converted Google Docs smart chips into plain text."})):(this._logger.warn('Found "smart chips" but could not convert them into plain text.',{originalText:i,augmentedText:r}),this._params.telemetryService.warn({message:"Could not convert Google Docs smart chips into plain text."})),{kind:"otherText",text:t.slice(0,e.vBar.textRange.start)+r+t.slice(e.vBar.textRange.start+r.length),range:{start:e.vBar.textRange.start,end:e.vBar.textRange.start+r.length}}}return W(e.vBar.textRange)}dispose(){this._subs.unsubscribe()}getKeyboardEventsTarget(){const e=(0,be.CI)(document);return e||(this._params.telemetryService.error({message:"Could not find the target element for text events in GDocs"}),this._logger.error("Could not find the target element for text events"),document.body)}}var xe=i(30105);class Ee{setCallToAction(e){this.callToAction.set(e)}constructor(e){this._params=e,this.callToAction=s.h.create(void 0),this.bannerPriorityId="ai-editor-promotion",this.shouldBeShownPrioritized=s.h.create(!1),this.shouldBeShown=s.h.combine(this.callToAction,this._params.shouldTranslateOnboardingBeShown,this._params.shouldInitialOnboardingBeShown,((e,t,i)=>void 0!==e&&!(t||i)))}}class Re{constructor(e){this._params=e,this._subs=new B.w0,this._inlineAlertsFilter=s.h.create(n.W8),this.inlineAlertsFilter=this._inlineAlertsFilter.view(),this._subs.add(this._params.alertClassification.visibleInlineAlertsFilter.pipe(x.U((e=>t=>e(t)&&!0))).subscribe(g.wW(this._inlineAlertsFilter)))}dispose(){this._subs.unsubscribe()}}var Ie=i(36344),Te=i(18519),Pe=i(66878),Fe=i(84714),Me=i(63532),De=i(27982),Le=i(89921);class Ae{constructor(e){this._params=e,this._logger=(0,U.h)(Ae.name),this._subs=new o.w.Keeper,this._isActive=s.h.create(!1),this._isAutoFocusEnabled=this._params.experimentClient.isGateEnabled(De.K.PushedContentAutoFocus),this.isActive=this._isActive.view(),this._sortedSidelines=this._params.sidelines.view((e=>e.sort(((e,t)=>e.textRange.start-t.textRange.start)))),this._isAutoFocusEnabled?this._listenForAutoFocusBehavior():this._logger.debug("Auto-focus gate is not enabled, skipping initialization.")}_listenForAutoFocusBehavior(){this._subs.push(ge.a([this._params.isAutoFocusAllowed,this.isActive]).pipe(d.w((([e,t])=>e&&t?(this._logger.trace("Auto-focus behavior is enabled."),this._sortedSidelines.pipe(c.h((e=>e.length>0)),x.U((e=>e[0])),h.x(((e,t)=>e.id===t.id)),x.U((e=>[e,(0,Le.sK)(e.highlightRect,this._params.textFieldLayout)])),d.w((([e,t])=>0!==t?pe.T(...this._params.scrollEventTargets.map((e=>z.R(e,"scrollend",{capture:!0})))).pipe(u.q(1),Te.V(this._params.afterScrollCardPinTimeoutMs),Pe.K((()=>Fe.of(null))),x.U((()=>e))):Fe.of(e))),Me.b((e=>this._params.pinSideline(e))))):(this._logger.trace("Auto-focus behavior is disabled.",{isAutoFocusAllowed:e,isActive:t}),Ie.E)))).subscribe())}activate(){this._isActive.set(!0)}deactivate(){this._isActive.set(!1)}dispose(){this._subs.dispose()}}var Oe=i(74822),Ue=i(31603),ze=i(12518),He=i(37855),Ge=i(6824),Ve=i(36661),qe=i(3516);const Ne=Ve.n(Ge.Schemable)(qe.k7).is;var je=i(22586),$e=i(6003);const We=(e,t,i,r,n)=>{const a=(0,$e.e6)(e,t),s=(0,$e.pE)(i);r.csToBgActions.openSubscriptionPage({utmCampaign:`%appName%_blurredSuggestion_${a}_${s}`,utmSource:"upHook",overrideUrl:n})};class Ye{constructor(e){this._params=e,this._logger=S.Y.create("MonetizationServiceImpl"),this._subs=new o.w.Keeper,this._disposed=new Oe.x,this.vBarsQuotaInfo=s.h.create(r.YP),this.vBarsUphookConfigs=s.h.create(r.YP),this.unlock=e=>{const t=e.surface.availableActions.find((e=>"actionId"in e&&"lockedUI:unlock"===e.actionId));t?(this._params.trackingService.vBarCardLockedUIUnlock({vBar:{kind:"pushed_content",id:e.contentId,pushedContentId:e.contentId,pushedContentVBarType:e.surface.kind,surface:e.surface}}),this._params.pushedContentService.sendExecuteActionMessage(e.contentId,{},t)):this._logger.warn("Unlock action not found",{pushedContentId:e.contentId,type:e.surface.kind,agent:e.surface.sourceAgent})},this._capiBalance=(0,n.zG)(Fe.of(this._params.capiStartAckMessage.pipe(c.h(r.pC),x.U(p.MH),x.U((e=>{var t,i;return(0,n.zG)(null===(i=null===(t=e.serverConfigs)||void 0===t?void 0:t.VBARS_LOCKEDUI)||void 0===i?void 0:i.freeUnlocks,r.ij)}))),e.checkingService.pipe(c.h(r.pC),x.U(p.MH),x.U((e=>e.capiMessages)),Ue.J(),c.h(Ne),x.U((e=>r.G(e.freeUnlocks))))),Ue.J()),this._uphookConfigs=(0,n.zG)(Fe.of(this._params.capiStartAckMessage.pipe(c.h(r.pC),x.U(p.MH),x.U((e=>{var t,i;return(0,n.zG)(null===(i=null===(t=e.serverConfigs)||void 0===t?void 0:t.VBARS_LOCKEDUI)||void 0===i?void 0:i.uphookConfigs,r.ij)}))),e.checkingService.pipe(c.h(r.pC),x.U(p.MH),x.U((e=>e.capiMessages)),Ue.J(),c.h(Ne),x.U((e=>r.G(e.uphookConfigs))))),Ue.J()),this._subs.push((0,n.zG)(ge.a([this._capiBalance,this._params.csPageState.view("g2Settings"),this._params.user.view("id"),this._params.user.view("premium")]),x.U((([e,t,i,a])=>a?r.YP:(0,n.zG)(e,r.UI((e=>{var r;let n=[];const a=null===(r=null==t?void 0:t.monetization)||void 0===r?void 0:r[i];return(null==a?void 0:a.date)===(0,He.u4)()&&(n=a.displayedVBarTextHashList),{quota:e,usedVBarsTextHashList:n}})))))).subscribe((e=>this.vBarsQuotaInfo.set(e)))),this._subs.push(this._uphookConfigs.subscribe((e=>{this.vBarsUphookConfigs.set(e)})))}markVBarUsed(e){return((e,t,i,a)=>{const s=(0,n.zG)(i,r.UI((({usedVBarsTextHashList:t})=>t.includes(e.textHash))),r.fS((()=>!1))),o=(0,n.zG)(i,r.UI((({quota:e})=>e)),r.fS((()=>-1)));return!s&&o>0?(a.debug("Updating monetization info.",{vBarTextHash:e.textHash,userId:t.user.get().id}),t.csToBgActions.markVBarUsed({vBarTextHash:e.textHash,userId:t.user.get().id}).then((()=>!0)).catch((i=>{const r="Failed to update monetization info.",n={vBarTextHash:e.textHash,userId:t.user.get().id};return a.error(r,i,n),t.telemetry.error({message:r,error:i,data:n}),!1}))):Promise.resolve(!1)})(e,this._params,this.vBarsQuotaInfo.get(),this._logger).then((e=>{if(!e)return;this.vBarsQuotaInfo.modify(r.UI((({quota:e,usedVBarsTextHashList:t})=>({quota:Math.max(e-1,0),usedVBarsTextHashList:t}))));const t={action:"vbars_lockedui:freeLookEvent"};return(0,n.zG)(this._params.checkingService.get(),r.g_((()=>Promise.reject("Checking service not available.")),(async e=>{const i=await e.sendMessage("vbars_lockedui:freeLookEvent",t,!1)();if(ze.nM(i))throw i.left;return i.right}))).then((()=>{})).catch((e=>{this._logger.error("Could not record a free look event.",e)}))}))}sendUphookEvent(e,t,i,a,s,o){const l=(0,$e.My)(e.kind,this.vBarsUphookConfigs,a);let d=null!=s?s:i.kind;o&&(d=`${d}_${o}`);const c={contentType:d};return(0,n.zG)(l,r.UI((e=>this._params.uphookHubActions.trackConfiguration(t,{upgradeHookSlot:e.uphookMetaData.upgradeHookSlot,upgradeHookName:e.uphookMetaData.upgradeHookName,upgradeHookVariant:e.uphookMetaData.upgradeHookVariant,upgradeHookSubVariant:e.uphookMetaData.upgradeHookSubVariant},c).catch((e=>{this._logger.error("Could not record UphookHub event.",e)})).then((()=>{})))),r.fS((()=>Promise.resolve(void 0))))}executeUphook(e,t,i,a){if(a)We(e,t,i,this._params,a);else{const a=(0,je.$U)(this._params.experimentClient),s=(0,$e.V7)(e.kind),o=a?(0,n.zG)(this.vBarsUphookConfigs.get(),r.UI((e=>{var t;return null===(t=e[s])||void 0===t?void 0:t.uphookContent.ctaUrl})),r.FS):void 0;We(e,t,i,this._params,o)}}dispose(){this._subs.dispose(),this._disposed.next(void 0)}}function Ke(e,t){var i;return(null===(i=null==e?void 0:e.multilingualOnboarding)||void 0===i?void 0:i[t])||_}class Je{constructor(e){this._params=e,this._logger=S.Y.create("MultilingualOnboardingServiceImpl"),this.bannerPriorityId="multilingual-onboarding",this.shouldBeShownPrioritized=s.h.create(!1),this.shouldBeShown=s.h.combine(this._params.csPageState.view("g2Settings"),this._params.user.view("id"),this._params.shouldTranslateOnboardingBeShown,this._params.shouldInitialOnboardingBeShown,((e,t,i,r)=>{if(i||r)return!1;return Ke(e,t).showsCount<5})),this._onboardingShowsCount=s.h.combine(this._params.csPageState.view("g2Settings"),this._params.user.view("id"),((e,t)=>Ke(e,t).showsCount))}incrementOnboardingShowsCount(){if(!this.shouldBeShown.get())return;const e=this._params.user.get(),t=this._onboardingShowsCount.get();this._params.csToBgActions.setMultilingualOnboardingShowsCount({userId:e.id,showsCount:t+1}).catch((t=>this._logger.warn("Error while incrementing multilingual onboarding count.",t,{userId:e.id})))}onOnboardingDismiss(){if(!this.shouldBeShown.get())return;const e=this._params.user.get();this._params.csToBgActions.setMultilingualOnboardingShowsCount({userId:e.id,showsCount:5}).catch((t=>this._logger.error("Error while dismissing the multilingual onboarding.",t,{userId:e.id})))}}class Qe{constructor(){this.bannerPriorityId="multilingual-onboarding",this.shouldBeShownPrioritized=s.h.create(!1),this.shouldBeShown=s.h.create(!1)}incrementOnboardingShowsCount(){}onOnboardingDismiss(){}}var Ze=i(22110);function Xe(e,t){var i;return(null===(i=null==e?void 0:e.onboarding)||void 0===i?void 0:i[t])||b}class et{constructor(e){this._params=e,this.shouldShowTooltip=s.h.combine(this._params.csPageState.view("g2Settings"),this._params.user.view("id"),((e,t)=>{const i=Xe(e,t);return!(i.completedSteps.length>=Ze._.size)&&i.acceptCount<3})),this.shouldShowPulsating=s.h.combine(this._params.csPageState.view("g2Settings"),this._params.user.view("id"),((e,t)=>{const i=Xe(e,t);return{shouldShowIdlePulsating:!i.hasSeenIdlePulsating,shouldShowSelectionPulsating:!i.hasSeenSelectionPulsating,shouldShowPushedContentPulsating:!1}})),this.currentStep=s.h.combine(this._params.csPageState.view("g2Settings"),this._params.user.view("id"),((e,t)=>{const i=Xe(e,t).completedSteps;return function(e){var t;return null!==(t=Array.from(Ze._.values()).find((t=>!e.has(t))))&&void 0!==t?t:null}(new Set(i))})),this.acceptCount=s.h.combine(this._params.csPageState.view("g2Settings"),this._params.user.view("id"),((e,t)=>Xe(e,t).acceptCount))}incrementAcceptCount(){var e,t,i,r;if(!this.shouldShowTooltip.get())return;const n=this._params.user.get(),a=null!==(r=null===(i=null===(t=null===(e=this._params.csPageState.get().g2Settings)||void 0===e?void 0:e.onboarding)||void 0===t?void 0:t[n.id])||void 0===i?void 0:i.acceptCount)&&void 0!==r?r:0;this._params.csToBgActions.setOnboardingAcceptCount({userId:n.id,acceptCount:a+1}).catch((e=>this._params.telemetryService.error({message:"Failed to increment the vBar onboarding accept count.",error:e})))}incrementRevertPresentedCount(){var e,t,i;if(this.currentStep.get()!==Ze.X.revert)return;const r=this._params.user.get(),n=null!==(i=null===(t=null===(e=this._params.csPageState.get().g2Settings)||void 0===e?void 0:e.onboarding)||void 0===t?void 0:t[r.id].revertPresentedCount)&&void 0!==i?i:0;this._params.csToBgActions.setOnboardingRevertPresentedCount({userId:r.id,revertPresentedCount:n+1}).catch((e=>this._params.telemetryService.error({message:"Failed to increment the vBar onboarding revert presented count.",error:e})))}onHide(e){e?this._params.trackingService.vBarOnboardingClose({vBar:e}):this._params.telemetryService.error({message:"vBar is null when onboarding tooltip onHide is called"});const t=this._params.user.get();this._params.csToBgActions.setOnboardingDismissed({userId:t.id}).catch((e=>{this._params.telemetryService.error({message:"Failed to set the onboarding as dismissed.",error:e})}))}onNextStep(e){const t=this.currentStep.get();if(!this.shouldShowTooltip.get()||null===t)return;e?this._params.trackingService.vBarOnboardingNext({vBar:e}):this._params.telemetryService.error({message:"vBar is null when onboarding tooltip onNextStep is called"});const i=this._params.user.get();this._params.csToBgActions.setOnboardingCompletedStep({userId:i.id,completedStep:t}).catch((e=>this._params.telemetryService.error({message:"Failed to increment the vBar onboarding current step.",error:e})))}notifyPulsatingSeen(e){if("pushed_content"===e.kind)return;const t=this._params.user.get();this._params.trackingService.vBarOnboardingShow({vBar:e}),this._params.csToBgActions.setOnboardingPulsatingSeen({userId:t.id,vBarType:e.kind}).catch((e=>this._params.telemetryService.error({message:"Failed to set the onboarding pulsating seen.",error:e})))}notifyPulsatingShown(e){this._params.trackingService.vBarOnboardingPulse({vBar:e})}}var tt=i(948);function it(e){let t=0,i=0;const r=[];for(;i<=e.length;)"\n"!==e.charAt(i)&&""!==e.charAt(i)||(t!==i&&r.push({start:t,end:i}),t=i+1),i++;return r}class rt{constructor(e){this._params=e,this._subs=new B.w0,this._logger=(0,U.h)(rt.name),this._paragraphs=s.h.create([]),this._paragraphById=new Map,this.paragraphs=this._paragraphs.view(),this._editingParagraphIndex=s.h.create(-1),this.editingParagraphIndex=this._editingParagraphIndex.view(),this._subs.add(this._params.textObserver.contentChanges.async.pipe(c.h((e=>!e.deltaChange.isEmpty)),H.b(1e3),Y.O(null),x.U((()=>{const e=this._params.textObserver.getCurrentTextMap().getPlainText();return{paragraphTextRanges:it(e),fullText:e}})),x.U((({paragraphTextRanges:e,fullText:t})=>{const i=e.map(((e,i)=>function(e,t,i){return{id:`g2-paragraph-${t.start}-${t.end}`,sequentialId:e,textRange:t,text:i.slice(t.start,t.end),fullTextLength:i.length}}(i,e,t)));return i.filter((e=>this._params.integration.textRangeFilter({textRange:e.textRange,fullText:t})))}))).subscribe(g.wW(this._paragraphs))),this._subs.add(this._editingParagraphIndex.pipe(c.h((e=>-1===e)),(0,d.w)((()=>this._params.textObserver.contentChanges.async.pipe(c.h((e=>!e.deltaChange.isEmpty&&e.changes.length>0)),u.q(1),x.U((({changes:e})=>{const[t]=e,i=tt.q.isIns(t)?t.pos:t.pos-t.text.length;return this._paragraphs.get().findIndex((({textRange:e})=>{if(!(e.end<i))return!0}))})))))).subscribe((e=>{this._editingParagraphIndex.set(e)}))),this._subs.add(this._paragraphs.subscribe((e=>{this._paragraphById.clear();for(const t of e)this._paragraphById.set(t.id,t)}))),this._subs.add(this._paragraphs.subscribe((e=>this._logger.debug("Paragraphs updated.",e))))}resetEditingParagraphIndex(){this._editingParagraphIndex.set(-1)}getParagraphById(e){return r.ij(this._paragraphById.get(e))}dispose(){this._subs.unsubscribe()}}var nt=i(92054),at=i(42203),st=i(84908),ot=i(62552),lt=i(98189),dt=i(70930),ct=i(11633);const ut=ct.OT(ct.i0("text_actions")),ht=ct.OT(ct.dt({action:ut,id:ct.OT(ct.pk)}));function gt(e){return ht.is(e)}var mt=i(37323);const pt=Ve.n(mt.l7(Ge.Schemable)({sensitiveString:Ge.string}))(mt.a9).is;var vt=i(78370);const{isResultMessage:ft,ResultMessage:St}=(0,vt.A)(mt.WV,dt.PU.Final),wt=ft,{isResultMessage:bt,ResultMessage:Ct}=(0,vt.A)(mt.WV,dt.PU.Partial),_t=bt;var yt=i(20905),kt=i(972);function Bt(e,t){const i=(e=>{switch(e.kind){case"improve":return{kind:"default"};case"rephrase":return{kind:"rephrase"};case"translate":return{kind:"other",actionId:{id:"rewrite:translate"}};case"shorten":return{kind:"other",actionId:{id:"rewrite:shorten"}};case"friendly":return{kind:"other",actionId:{id:"rewrite:friendly"}};case"formal":return{kind:"other",actionId:{id:"rewrite:formal"}};case"customPrompt":return{kind:"userPrompt",prompt:e.prompt};case"other":return{kind:"other",actionId:{id:e.textActionId}};default:(0,le.L0)(e)}})(e.type),r="translate"===e.type.kind?{targetLanguage:{json:e.type.translationDirection.targetLanguageTag}}:{};return{correlationId:e.id,kind:{...i},entrypoint:{family:"g2",name:dt.K0.VbarCard,request_tag:`${e.vBar.kind}${t?"_preloading":""}`},args:r,metadata:{}}}var xt=i(9699),Et=i(70558);const Rt=yt.m9(3),It=yt.m9(1),Tt=yt.m9(10);function Pt(e){return`rewrite-requested-${e}`}function Ft(e){return`rewrite-request-sent-${e}`}function Mt(e){return"ready"===e.kind?{...e,source:{kind:"cache"}}:e}class Dt{constructor(e){this._params=e,this._subs=new B.w0,this._logger=(0,U.h)(Dt.name),this._relevantCapiMessages=this._params.checkingService.pipe(l.oA,d.w((e=>e.capiMessages)),c.h((0,at.Kg)(gt,wt,pt))),this._rewritePartialMessages=this._params.checkingService.pipe(l.oA,d.w((e=>e.capiMessages)),c.h(_t),st.p(300)),this._cachedRewriteIdMap=new Map,this._cachedRewriteMap=new Map,this._ackMessageIds=new ot.X(new Set),this._waitForCAPITextRevisionSync=async e=>{var t,i;await e.checkingRevisionInfo.pipe(H.b(100),u.q(1),Te.V(null!==(i=null===(t=this._params.dynamicConfig.view("vBars").get())||void 0===t?void 0:t.waitForLatestCheckingRevisionTimeoutMs)&&void 0!==i?i:It)).toPromise()},this._subs.add(this._relevantCapiMessages.subscribe((e=>this._handleServerMessage(e)))),this._subs.add(this._rewritePartialMessages.subscribe((e=>this._handleServerMessage(e)))),this._subs.add(this._params.checkingService.subscribe((e=>{r.pC(e)?this._logger.debug("Checking service available."):this._logger.debug("Checking service not available.")})))}_getDurationSincePerformanceMark(e,t,i,r){const n=e(t),a=`${i}-${t}`,s=function(e,t){const i=performance.getEntriesByName(e).length>0?performance.measure(t,e).duration:void 0;return performance.clearMarks(e),i}(n,a);if(void 0===s){const e={performanceMarkName:n,measureName:a};this._logger.error(r,e),this._params.telemetryService.error({message:r,data:e})}return null!=s?s:0}_getDurationSinceRewriteRequestSent(e,t){return this._getDurationSincePerformanceMark(Ft,e,t,"Failed to get duration since rewrite request sent.")}_getDurationSinceRewriteRequested(e,t){return this._getDurationSincePerformanceMark(Pt,e,t,"Failed to get duration since rewrite requested.")}_handleServerMessage(e){gt(e)?this._handleAckMessage(e):pt(e)?(this._params.telemetryService.warn({message:'Server message with result "failure" received.'}),this._handleErrorMessage(e)):wt(e)?(this._params.telemetryService.infoOncePerMessage({message:'Server message with result "success" received.'}),this._handleRewriteResultMessage(e)):_t(e)?(this._params.telemetryService.infoOncePerMessage({message:'Server message with result "partial" received.'}),this._handleRewriteResultMessage(e)):(0,le.vE)(e)}_handleAckMessage(e){const t=this._ackMessageIds.getValue();t.add(e.id),this._ackMessageIds.next(t)}_handleRewriteResultMessage(e){var t;const i=this._cachedRewriteMap.get(e.correlationId);if(void 0===i)this._logger.warn("Received a successful result with unknown correlation ID.",{resultSuccessMessage:e}),this._params.telemetryService.warn({message:'Server message with result "success" and unknown correlation ID received.'});else{const a={id:i.get().id,rewriteTabId:i.get().rewriteTabId,vBar:i.get().vBar,type:i.get().type,augmentedText:i.get().augmentedText,callToAction:e.callToAction,metadata:e.metadata};if(e.kind===dt.PU.Partial){const t={...a,kind:"loading",patternName:e.actionId.id,rewriteTextPartial:e.rewrite};i.set(t)}else{this._params.trackingService.vBarCardRewriteResultReceived({vBar:a.vBar,rewriteType:a.type,duration:this._getDurationSinceRewriteRequestSent(e.correlationId,"rewrite-result-received")});const s=(0,n.zG)(kt.FS.getDiff(null!==(t=r.WG(i.get().augmentedText))&&void 0!==t?t:i.get().vBar.text,e.rewrite),ze.Vn((t=>this._logger.error("Failed to get diff for rewrite.",{error:t,newText:e.rewrite}))),r.Uo),o={...a,kind:"ready",title:e.explanation,rewriteText:e.rewrite,rewriteDiff:s,source:{kind:"server"},patternName:e.actionId.id,accessibilityLabel:(0,n.zG)(s,r.UI((e=>(0,xt.G)(e))))};this._logger.debug("Received a successful result; updating rewrite.",{rewriteBefore:i.get(),rewriteAfter:o}),i.set(o)}}}_handleErrorMessage(e){const t=this._cachedRewriteMap.get(e.correlationId);if(void 0===t)this._logger.warn("Received a failed result with unknown correlation ID.",{errorMessage:e}),this._params.telemetryService.warn({message:'Server message with result "failure" and unknown correlation ID received.'});else{const i={kind:"error",id:t.get().id,vBar:t.get().vBar,type:t.get().type,rewriteTabId:t.get().rewriteTabId,augmentedText:t.get().augmentedText,errorReason:e.errorType.kind,errorDetails:e.details,source:{kind:"server"}};this._logger.debug("Received a failed result; updating rewrite.",{rewriteBefore:t.get(),rewriteAfter:i}),t.set(i)}}_forceReconnect(){var e;this._ackMessageIds.next(new Set),null===(e=r.WG(this._params.checkingService.get()))||void 0===e||e.reconnect()}async _performRewriteRequest(e,t,i,a,o){const l=(0,nt.Z)();this._cachedRewriteIdMap.set(e,l);const d=s.h.create({kind:"loading",id:l,rewriteTabId:t,vBar:i,type:a,augmentedText:r.YP});return this._cachedRewriteMap.set(d.get().id,d),await(0,n.zG)(this._params.checkingService.get(),r.g_((()=>{const e="Getting rewrite failed: Checking service not initialized.";return this._logger.error(e),this._params.telemetryService.error({message:e}),d.modify((e=>({...e,kind:"error",errorReason:"checkingServiceUnavailable",source:{kind:"server"}}))),Promise.resolve(d)}),(async e=>{var t,n,s,l;try{this._logger.debug("Flushing text change buffer before sending rewrite request."),this._params.textChangeBuffer.flush(),await this._waitForCAPITextRevisionSync(e)}catch(e){const t="Getting rewrite failed: Something went wrong while waiting for CAPI text revision to sync with local text changes.";return this._logger.error(t,{error:e}),this._params.telemetryService.error({message:t,error:e}),d.modify((e=>({...e,kind:"error",errorReason:"waitForLatestCheckingRevisionTimeout",source:{kind:"server"}}))),d}const c=Bt(d.get(),o),h=this._params.integration.getRewriteScope(d.get());"otherText"===h.kind&&d.modify((e=>{var t,i;return{...e,augmentedText:r.G(h.text.slice(null===(t=h.range)||void 0===t?void 0:t.start,null===(i=h.range)||void 0===i?void 0:i.end))}}));try{this._logger.debug('Sending "text_actions:invokeRewrite" message to CAPI.',{data:c,scope:h}),performance.mark(Ft(c.correlationId)),this._params.trackingService.vBarCardRewriteRequestSent({vBar:i,rewriteType:a});const r=await e.sendMessage("text_actions:invokeRewrite",c,!1,{kind:"scope",scope:h})();if(ze.nM(r))throw r.left.message;{this._subs.add(this._ackMessageIds.pipe(lt.n((e=>!e.has(r.right))),u.q(1),Te.V(null!==(n=null===(t=this._params.dynamicConfig.get().vBars)||void 0===t?void 0:t.rewriteAckTimeoutMs)&&void 0!==n?n:Rt)).subscribe({error:()=>{const e="Never received ack for rewrite; forcing reconnect.",t={vBarType:i.kind,rewriteType:d.get().type.kind};this._logger.error(e,t),this._params.telemetryService.error({message:e,data:t}),this._forceReconnect()}}));const e=null!==(l=null===(s=this._params.dynamicConfig.view("vBars").get())||void 0===s?void 0:s.rewriteLoadingTimeoutMs)&&void 0!==l?l:Tt;return this._subs.add(d.pipe(lt.n(Et.z7),u.q(1),Te.V(e)).subscribe({error:()=>{const e="Rewrite stuck loading; transitioning to error state.",t={vBarType:i.kind,rewriteType:d.get().type.kind};this._logger.error(e,t),this._params.telemetryService.error({message:e,data:t}),d.modify((e=>({...e,kind:"error",errorReason:"rewriteLoadingTimeout",source:{kind:"server"}})))}})),this._logger.debug("Returning un-cached rewrite.",d.get()),d}}catch(e){const t='Getting rewrite failed: Sending "text_actions:invokeRewrite" message to CAPI failed.';return this._logger.error(t,{error:e}),this._params.telemetryService.error({message:t,error:e}),d.modify((e=>({...e,kind:"error",errorReason:"rewriteRequestFailure",source:{kind:"server"}}))),d}})))}async getRewrite(e){this._logger.debug("Getting rewrite.",e);const{rewriteType:t,skipCache:i,vBar:r,isPreload:n,rewriteTabId:a}=e,s=(0,E.Wu)(r.text);let o=`${t.kind}-${r.textRange.start}-${r.textRange.end}-${s}`;"translate"===t.kind&&(o+=`-${t.translationDirection.targetLanguageTag}`);const l=`${o}-${Date.now()}`;performance.mark(Pt(l)),this._params.trackingService.vBarCardRewriteRequested({vBar:r,rewriteTabId:"other"===t.kind?t.textActionId:a});const d=this._cachedRewriteIdMap.get(o),h=void 0!==d?this._cachedRewriteMap.get(d):void 0;let g;return"customPrompt"!==t.kind&&!i&&void 0!==h&&"error"!==h.get().kind?(h.modify(Mt),this._logger.debug("Returning cached rewrite.",h.get()),g=h):(void 0!==d&&this._cachedRewriteMap.delete(d),g=await this._performRewriteRequest(o,a,r,t,n),this._subs.add(g.pipe(c.h((0,at.Kg)(Et.NK,Et.Oy)),u.q(1)).subscribe((e=>{this._params.trackingService.vBarCardRewriteLoaded({vBar:r,rewrite:e,duration:this._getDurationSinceRewriteRequested(l,"rewrite-loaded"),textFieldElementSize:this._getTextFieldElementSize()})})))),g}getRewriteFromPushedContentItem(e){var t;const i=e.pushedContentItem.surface;if("lockedRewrite"===i.kind||"lockedComment"===i.kind||"uphookComment"===i.kind||"empty"===i.kind||("comment"===i.kind||"unlockedComment"===i.kind)&&void 0===i.rewrite)return r.YP;const a=(0,nt.Z)(),s={kind:"improve"};if("loadingCard"===i.kind||("comment"===i.kind||"unlockedComment"===i.kind)&&!i.hasFinalRewrite)return r.G({kind:"loading",id:a,rewriteTabId:"improve",type:s,vBar:e.vBar,augmentedText:r.YP});const o="comment"===i.kind||"unlockedComment"===i.kind?null!==(t=i.rewrite)&&void 0!==t?t:"":i.text,l=(0,n.zG)(kt.FS.getDiff(e.vBar.text,o),ze.Vn((e=>this._logger.error("Failed to get diff for pushed content item.",{error:e,newText:o}))),r.Uo);return r.G({kind:"ready",id:a,rewriteTabId:"improve",vBar:e.vBar,type:s,augmentedText:r.YP,title:i.title,rewriteText:o,rewriteDiff:l,source:{kind:"pushed_content",pushedContentId:e.pushedContentItemId},patternName:i.trackingSourceAction,accessibilityLabel:(0,n.zG)(l,r.UI((e=>(0,xt.G)(e))))})}_getTextFieldElementSize(){const e=this._params.integration.highlightsLayoutInfo.textFieldLayout.visibleRect.getApproximate().size;return{width:Math.round(e.width),height:Math.round(e.height)}}dispose(){this._subs.unsubscribe()}}var Lt=i(90595),At=i(8907),Ot=i(48813);const Ut=Ve.n(Ge.Schemable)(Ot.Ct).is;var zt=i(86576),Ht=i(16131);const Gt=(e,t)=>[e.id,t].join("-"),Vt=e=>"pushed_content"===e.kind?e.pushedContentVBarType:e.kind;class qt{constructor(e){this._params=e,this._subs=new B.w0,this._logger=S.Y.create("CapiFeedbacksTrackingServiceImpl"),this._subs.add(this._params.checkingService.pipe(l.oA,d.w((e=>e.capiMessages)),c.h(Ut),c.h((e=>e.result!==zt.e.Success))).subscribe((e=>{e.result===zt.e.ValidationFail?this._params.telemetryService.error({message:"vBar CAPI feedback validation failed.",error:e.errorMessage}):e.result===zt.e.Error&&this._params.telemetryService.error({message:"vBar CAPI feedback processing failed.",error:e.errorMessage})})))}_getRewriteReadyLoadResult(e,t){if(t)return zt.R.Uphook;const{kind:i}=e.source;switch(i){case"server":return zt.R.Loaded;case"cache":return zt.R.Cached;case"pushed_content":return zt.R.Prepopulated;default:(0,le.L0)(i)}}_getRewriteErrorLoadResult(e){switch(e.errorReason){case"backendError":return zt.R.FailedBackendError;case"badRequest":return zt.R.FailedBadRequest;case"sensitivity":return zt.R.FailedSensitivity;case"serviceLimitExceeded":return zt.R.FailedServiceLimitExceeded;case"unsupportedLanguage":return zt.R.FailedUnsupportedLanguage;case"updateClient":return zt.R.FailedUpdateClient;case"rewriteRequestFailure":case"rewriteLoadingTimeout":case"rewriteFromCalliopeAlertFailure":case"checkingServiceUnavailable":case"waitForLatestCheckingRevisionTimeout":case"other":return zt.R.FailedOther;default:(0,le.L0)(e.errorReason)}}_getVBarFeedbackRequestMessageData(e,t,i){const r=(0,Ht._Z)(t),n={vBarId:t.id,actionType:e,vBarType:Vt(t),range:{start:t.textRange.start,end:t.textRange.end},...void 0!==r?{pname:r}:{},...{...i,textFieldElementSize:null==i?void 0:i.textFieldElementSize}};return this._withTrackingVBarId(n,t)}_sendMessageViaCheckingService(e,t){return(0,n.zG)(this._params.checkingService.get(),r.g_((()=>Promise.reject("Checking service not available.")),(async i=>{const r=await i.sendMessage(e,t,!1)();if(ze.nM(r))throw r.left;return r.right})))}_sendVBarFeedbackRequestMessage(e){this._sendMessageViaCheckingService("vbar_feedback:vBarFeedbackRequest",e).catch((t=>this._params.telemetryService.error({message:"Failed to send vBar CAPI feedback.",error:t,data:e})))}_getVBarCommonFeedbackRequestMessageData(e){const t={...e,vBarId:e.vBar.id,vBarType:e.vBar.kind};return this._withTrackingVBarId(t,e.vBar)}_withTrackingVBarId(e,t){return(0,n.zG)(this._params.checkingService.get(),r.tS((e=>r.ij(e.sessionUuid))),r.g_((()=>(this._params.telemetryService.error({message:"Failed to retrieve sessionUuid while sending CAPI feedback; won't add it to vBarId."}),{...e,vBarId:t.id})),(i=>({...e,vBarId:Gt(t,i)}))))}_trySerializeObjectToJson(e){try{return JSON.stringify(e)}catch(t){return void this._logger.warn("Failed to serialize object to JSON string.",t,e)}}vBarShown(e){const t=this._getVBarFeedbackRequestMessageData("entrypoint_show",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarHidden(e){const t=this._getVBarFeedbackRequestMessageData("entrypoint_hide",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardShown(e){const t=this._getVBarFeedbackRequestMessageData("card_show",e.vBar,{textFieldElementSize:e.textFieldElementSize});if(this._sendVBarFeedbackRequestMessage(t),"pushed-comment"===Vt(e.vBar)){const t=this._getVBarFeedbackRequestMessageData("card_comment_show",e.vBar,{textFieldElementSize:e.textFieldElementSize});this._sendVBarFeedbackRequestMessage(t)}}vBarCardClosed(e){const t=this._getVBarFeedbackRequestMessageData("card_close",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteRequested(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_loading_start",e.vBar,{..."customPrompt"===e.rewriteTabId?{userPrompt:e.userPrompt}:void 0});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteLoaded(e){let t;t=(0,Et.NK)(e.rewrite)?e.vBar.text===e.rewrite.rewriteText?zt.R.Empty:this._getRewriteReadyLoadResult(e.rewrite,!1):this._getRewriteErrorLoadResult(e.rewrite);const i=this._getVBarFeedbackRequestMessageData("card_rewrite_loaded",e.vBar,{pname:(0,Et.NK)(e.rewrite)?e.rewrite.patternName:void 0,rewrite:(0,Et.NK)(e.rewrite)?e.rewrite.rewriteText:void 0,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,loadingTimeMs:e.duration,result:t,textFieldElementSize:e.textFieldElementSize,metadata:this._trySerializeObjectToJson(e.rewrite.metadata)});this._sendVBarFeedbackRequestMessage(i)}vBarCardRewriteStreamingStart(e){var t;const i=this._getVBarFeedbackRequestMessageData("card_rewrite_streaming_start",e.vBar,{pname:null!==(t=e.rewrite.patternName)&&void 0!==t?t:"",..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,loadingTimeMs:e.duration});this._sendVBarFeedbackRequestMessage(i)}vBarCardRewriteReadyShown(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_show",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,loadingTimeMs:e.duration,result:this._getRewriteReadyLoadResult(e.rewrite,e.isUphook),textFieldElementSize:e.textFieldElementSize,metadata:this._trySerializeObjectToJson(e.rewrite.metadata)});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteApplied(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_apply",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,textFieldElementSize:e.textFieldElementSize,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,metadata:this._trySerializeObjectToJson(e.rewrite.metadata)});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteDismissed(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_dismiss",e.vBar,{pname:e.rewrite.patternName,textFieldElementSize:e.textFieldElementSize,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,metadata:this._trySerializeObjectToJson(e.rewrite.metadata)});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteCopied(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_copy",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,textFieldElementSize:e.textFieldElementSize,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,metadata:this._trySerializeObjectToJson(e.rewrite.metadata)});this._sendVBarFeedbackRequestMessage(t)}vBarCardShowLessClicked(e){const t=this._getVBarFeedbackRequestMessageData("card_show_less",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteReverted(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_revert",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,metadata:this._trySerializeObjectToJson(e.rewrite.metadata)});this._sendVBarFeedbackRequestMessage(t)}vBarOnboardingPulse(e){const t=this._getVBarFeedbackRequestMessageData("onboarding_pulse",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarOnboardingShow(e){const t=this._getVBarFeedbackRequestMessageData("onboarding_show",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarOnboardingNext(e){const t=this._getVBarFeedbackRequestMessageData("onboarding_next",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarOnboardingClose(e){const t=this._getVBarFeedbackRequestMessageData("onboarding_close",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardUserSubmittedFeedback(e){const t=this._getVBarCommonFeedbackRequestMessageData(e),i={kind:At.PZ.USER_SATISFACTION_FEEDBACK,subtype:At.e3.Vbar,userSatisfactionDescription:t.userSatisfactionDescription,userSatisfaction:t.userSatisfaction,vBarId:t.vBarId,vBarType:t.vBarType,text:t.text,g2ActionInfo:t.g2ActionInfo};this._sendMessageViaCheckingService("feedback",i).catch((e=>this._params.telemetryService.error({message:"Failed to send vBar user satisfaction CAPI feedback.",error:e,data:t})))}vBarCardCtaClicked(e){const t=this._getVBarFeedbackRequestMessageData("card_call_to_action_click",e.vBar,{..."idle"!==e.rewrite.kind?{metadata:this._trySerializeObjectToJson(e.rewrite.metadata)}:{}});this._sendVBarFeedbackRequestMessage(t)}vBarCardLockedUIUnlock(e){const t=this._getVBarCommonFeedbackRequestMessageData(e),i={kind:At.PZ.UNLOCK,subtype:At.e3.Vbar,vBarId:t.vBarId,vBarType:t.vBarType,text:t.text,g2ActionInfo:t.g2ActionInfo};this._sendMessageViaCheckingService("feedback",i).catch((e=>this._params.telemetryService.error({message:"Failed to send vBar locked UI unlock CAPI feedback.",error:e,data:t})))}vBarCommentCardDismissed(e){if("pushed-comment"!==Vt(e.vBar))return;const t=this._getVBarFeedbackRequestMessageData("card_comment_dismiss",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCommentCardCopyButtonClicked(e){if("pushed-comment"!==Vt(e.vBar))return;const t=this._getVBarFeedbackRequestMessageData("card_comment_copy",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCommentCardMarkResolvedButtonClicked(e){if("pushed-comment"!==Vt(e.vBar))return;const t=this._getVBarFeedbackRequestMessageData("card_comment_mark_resolved",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCommentCardGenerateCitationButtonClicked(e){if("pushed-comment"!==Vt(e.vBar))return;const t=this._getVBarFeedbackRequestMessageData("card_comment_generate_citation",e.vBar);this._sendVBarFeedbackRequestMessage(t)}dispose(){this._subs.unsubscribe()}}var Nt=i(39963);class jt{constructor(e){this._params=e,this._felog=(0,Nt.Tb)(),this._commonLabels={domain:this._params.integrationInfo.domain,integrationName:this._params.integrationInfo.integrationName}}vBarsInitialized(){this._felog.sendFemetricsRate("vBarsInitialized",this._commonLabels)}vBarCardRewriteRequestSent(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewriteType.kind};this._felog.sendFemetricsRate("vBarCardRewriteRequestSent",t)}vBarCardRewriteResultReceived(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewriteType.kind};this._felog.sendFemetricsRate("vBarCardRewriteResultReceived",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteResultReceived",e.duration,"histogram",t)}vBarCardRewriteReadyShown(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind,isUphook:e.isUphook};this._felog.sendFemetricsRate("vBarCardRewriteReadyShown",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteReadyShown",e.duration,"histogram",t)}vBarCardRewriteEmptyShown(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind};this._felog.sendFemetricsRate("vBarCardRewriteEmptyShown",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteEmptyShown",e.duration,"histogram",t)}vBarCardRewriteErrorShown(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind,rewriteErrorReason:e.rewrite.errorReason};this._felog.sendFemetricsRate("vBarCardRewriteErrorShown",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteErrorShown",e.duration,"histogram",t)}vBarCardRewriteUphookShown(e){const t=(0,$e.e6)(e.vBar,e.rewriteType),i=(0,$e.pE)(e.isEligibleForInProductDiscount);this._felog.upgradeHooks.showUpgradeHook("blurredSuggestion",t,i);const r={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewriteType.kind};this._felog.sendFemetricsRate("vBarCardRewriteUphookShown",r)}vBarCardRewriteUphookClicked(e){const t=(0,$e.e6)(e.vBar,e.rewriteType),i=(0,$e.pE)(e.isEligibleForInProductDiscount);this._felog.upgradeHooks.clickUpgradeHook("blurredSuggestion",t,i);const r={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewriteType.kind};this._felog.sendFemetricsRate("vBarCardRewriteUphookClicked",r)}vBarCardRewriteStreamingStart(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind};this._felog.sendFemetricsRate("vBarCardRewriteStreamingStart",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteStreamingStart",e.duration,"histogram",t)}}class $t{constructor(e){this._params=e}_sendTelemetryError(e,t){this._params.telemetryService.error({message:"Failed to track Gnar event.",error:t,data:{eventName:e}})}_sendNoSessionUuidTelemetryError(e){this._sendTelemetryError(e,"Failed to retrieve sessionUuid.")}_trackWithSessionUuid(e,t){return(0,n.zG)(this._params.checkingService.get(),r.tS((e=>r.ij(e.sessionUuid))),r.g_((()=>this._sendNoSessionUuidTelemetryError(e)),(i=>t(i).catch((t=>this._sendTelemetryError(e,t))))))}_isGoogleDocs(){return"googleDocs"===this._params.integrationInfo.kind}_getRewriteReadyShownStatus(e,t){if(t)return"uphook";const{kind:i}=e.source;switch(i){case"server":return"loaded";case"cache":return"cached";case"pushed_content":return"prepopulated";default:(0,le.L0)(i)}}_getRewriteErrorShownStatus(e){return`failed_${e.errorReason}`}_getVBarKind(e){return"pushed_content"===e.kind?e.pushedContentVBarType:e.kind}vBarShown(e){this._trackWithSessionUuid("vBarEntrypointShow",(t=>this._params.gnarClient.vBarEntrypointShow(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarHidden(e){this._trackWithSessionUuid("vBarEntrypointClose",(t=>this._params.gnarClient.vBarEntrypointClose(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardShown(e){this._trackWithSessionUuid("vBarCardShow",(t=>this._params.gnarClient.vBarCardShow(this._isGoogleDocs(),e.isUphook,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardClosed(e){this._trackWithSessionUuid("vBarCardClose",(t=>this._params.gnarClient.vBarCardClose(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardCustomPromptSubmitted(e){this._trackWithSessionUuid("vBarCardSubmitCustomPrompt",(t=>this._params.gnarClient.vBarCardSubmitCustomPrompt(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardRewriteSelected(e){this._trackWithSessionUuid("vBarCardPromptSubmit",(t=>this._params.gnarClient.vBarCardPromptSubmit(this._isGoogleDocs(),e.previousRewriteTabId,e.rewriteTabId,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardRewriteStreamingStart(e){this._trackWithSessionUuid("vBarCardRewriteStreamingStart",(t=>this._params.gnarClient.vBarCardStreamingStart(this._isGoogleDocs(),e.rewrite.rewriteTabId,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar),e.duration)))}vBarCardRewriteEmptyShown(e){this._trackWithSessionUuid("vBarCardLoaded",(t=>this._params.gnarClient.vBarCardLoaded(this._isGoogleDocs(),e.rewrite.rewriteTabId,"empty",t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar),e.duration)))}vBarCardRewriteReadyShown(e){this._trackWithSessionUuid("vBarCardLoaded",(t=>this._params.gnarClient.vBarCardLoaded(this._isGoogleDocs(),e.rewrite.rewriteTabId,this._getRewriteReadyShownStatus(e.rewrite,e.isUphook),t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar),e.duration)))}vBarCardRewriteErrorShown(e){this._trackWithSessionUuid("vBarCardLoaded",(t=>this._params.gnarClient.vBarCardLoaded(this._isGoogleDocs(),e.rewrite.rewriteTabId,this._getRewriteErrorShownStatus(e.rewrite),t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar),e.duration)))}vBarCardRewriteApplied(e){this._trackWithSessionUuid("vBarCardRewriteApply",(t=>this._params.gnarClient.vBarCardRewriteApply(this._isGoogleDocs(),e.rewrite.rewriteTabId,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardRewriteDismissed(e){this._trackWithSessionUuid("vBarCardRewriteDismissed",(t=>this._params.gnarClient.vBarCardRewriteDismiss(this._isGoogleDocs(),e.rewrite.rewriteTabId,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardRewriteCopied(e){this._trackWithSessionUuid("vBarCardRewriteCopy",(t=>this._params.gnarClient.vBarCardRewriteCopy(this._isGoogleDocs(),e.rewrite.rewriteTabId,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardRewriteReverted(e){this._trackWithSessionUuid("vBarCardRewriteRevert",(t=>this._params.gnarClient.vBarCardRewriteRevert(this._isGoogleDocs(),e.rewrite.rewriteTabId,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardRewriteRegenerated(e){this._trackWithSessionUuid("vBarCardRewriteRegenerate",(t=>this._params.gnarClient.vBarCardRewriteRegenerate(this._isGoogleDocs(),e.rewrite.rewriteTabId,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}vBarCardRewriteFeedbackSubmitted(e){const t=JSON.stringify({vBarId:e.vBar.id,vBarType:Vt(e.vBar),prompt:e.rewrite.rewriteTabId,message:e.feedbackFormData.text,domain:e.feedbackFormData.domain,isGoogleDocs:this._isGoogleDocs()});this._params.gnarClient.feedbackSentButtonClick(t,"g2",e.feedbackFormData.score).catch((e=>this._sendTelemetryError("feedbackSentButtonClick",e)))}vBarCardRewriteUphookShown(e){const t=(0,$e.e6)(e.vBar,e.rewriteType),i=(0,$e.pE)(e.isEligibleForInProductDiscount);this._trackWithSessionUuid("getPremiumButtonShow",(e=>this._params.gnarClient.getPremiumButtonShow("blurredSuggestion",void 0,void 0,void 0,void 0,void 0,!1,void 0,void 0,e,"blurredSuggestion",t,i)))}vBarCardRewriteUphookClicked(e){const t=(0,$e.e6)(e.vBar,e.rewriteType),i=(0,$e.pE)(e.isEligibleForInProductDiscount);this._trackWithSessionUuid("getPremiumButtonClick",(e=>this._params.gnarClient.getPremiumButtonClick("blurredSuggestion",void 0,void 0,void 0,void 0,void 0,!1,void 0,void 0,e,"blurredSuggestion",t,i)))}vBarCardShowLessClicked(e){this._trackWithSessionUuid("vBarCardShowLess",(t=>this._params.gnarClient.vBarCardShowLess(e.domain,this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Gt(e.vBar,t),e.vBar.text.length,Vt(e.vBar))))}}class Wt{constructor(e){this._params=e,this._gnarTrackingService=new $t({gnarClient:this._params.gnarClient,checkingService:this._params.checkingService,integrationInfo:this._params.integrationInfo,telemetryService:this._params.telemetryService}),this._capiFeedbacksTrackingService=new qt({checkingService:this._params.checkingService,telemetryService:this._params.telemetryService}),this._feMetricsTrackingService=new jt({integrationInfo:this._params.integrationInfo})}vBarsInitialized(){this._feMetricsTrackingService.vBarsInitialized()}vBarShown(e){this._gnarTrackingService.vBarShown(e),this._capiFeedbacksTrackingService.vBarShown(e)}vBarHidden(e){this._gnarTrackingService.vBarHidden(e),this._capiFeedbacksTrackingService.vBarHidden(e)}vBarCardShown(e){this._gnarTrackingService.vBarCardShown(e),this._capiFeedbacksTrackingService.vBarCardShown(e)}vBarCardClosed(e){this._gnarTrackingService.vBarCardClosed(e),this._capiFeedbacksTrackingService.vBarCardClosed(e)}vBarCardCustomPromptSubmitted(e){this._gnarTrackingService.vBarCardCustomPromptSubmitted(e)}vBarCardRewriteSelected(e){this._gnarTrackingService.vBarCardRewriteSelected(e)}vBarCardRewriteRequested(e){this._capiFeedbacksTrackingService.vBarCardRewriteRequested(e)}vBarCardRewriteLoaded(e){this._capiFeedbacksTrackingService.vBarCardRewriteLoaded(e)}vBarCardRewriteRequestSent(e){this._feMetricsTrackingService.vBarCardRewriteRequestSent(e)}vBarCardRewriteResultReceived(e){this._feMetricsTrackingService.vBarCardRewriteResultReceived(e)}vBarCardRewriteStreamingStart(e){this._gnarTrackingService.vBarCardRewriteStreamingStart(e),this._capiFeedbacksTrackingService.vBarCardRewriteStreamingStart(e),this._feMetricsTrackingService.vBarCardRewriteStreamingStart(e)}vBarCardRewriteEmptyShown(e){this._gnarTrackingService.vBarCardRewriteEmptyShown(e),this._feMetricsTrackingService.vBarCardRewriteEmptyShown(e)}vBarCardRewriteReadyShown(e){this._gnarTrackingService.vBarCardRewriteReadyShown(e),this._capiFeedbacksTrackingService.vBarCardRewriteReadyShown(e),this._feMetricsTrackingService.vBarCardRewriteReadyShown(e)}vBarCardRewriteErrorShown(e){this._gnarTrackingService.vBarCardRewriteErrorShown(e),this._feMetricsTrackingService.vBarCardRewriteErrorShown(e)}vBarCardRewriteApplied(e){this._gnarTrackingService.vBarCardRewriteApplied(e),this._capiFeedbacksTrackingService.vBarCardRewriteApplied(e)}vBarCardRewriteDismissed(e){this._gnarTrackingService.vBarCardRewriteDismissed(e),this._capiFeedbacksTrackingService.vBarCardRewriteDismissed(e)}vBarCardRewriteCopied(e){this._gnarTrackingService.vBarCardRewriteCopied(e),this._capiFeedbacksTrackingService.vBarCardRewriteCopied(e)}vBarCardRewriteReverted(e){this._gnarTrackingService.vBarCardRewriteReverted(e),this._capiFeedbacksTrackingService.vBarCardRewriteReverted(e)}vBarCardRewriteRegenerated(e){this._gnarTrackingService.vBarCardRewriteRegenerated(e)}vBarCardRewriteFeedbackSubmitted(e){if(this._gnarTrackingService.vBarCardRewriteFeedbackSubmitted(e),e.feedbackFormData.shareUserText){const t={vBar:e.vBar,text:e.vBar.text,userSatisfaction:e.feedbackFormData.score,userSatisfactionDescription:e.feedbackFormData.text,g2ActionInfo:{actionId:e.rewrite.patternName,pname:e.rewrite.patternName,rewriteText:e.rewrite.rewriteText}};this._capiFeedbacksTrackingService.vBarCardUserSubmittedFeedback(t)}}vBarCardRewriteUphookShown(e){(0,F.OB)().experimentClient.isGateEnabled(Lt.K.UphookGnarEvents)&&this._gnarTrackingService.vBarCardRewriteUphookShown(e),this._feMetricsTrackingService.vBarCardRewriteUphookShown(e)}vBarCardRewriteUphookClicked(e){(0,F.OB)().experimentClient.isGateEnabled(Lt.K.UphookGnarEvents)&&this._gnarTrackingService.vBarCardRewriteUphookClicked(e),this._feMetricsTrackingService.vBarCardRewriteUphookClicked(e)}vBarCardShowLessClicked(e){this._gnarTrackingService.vBarCardShowLessClicked(e),this._capiFeedbacksTrackingService.vBarCardShowLessClicked({vBar:e.vBar})}vBarOnboardingPulse(e){this._capiFeedbacksTrackingService.vBarOnboardingPulse(e)}vBarOnboardingShow(e){this._capiFeedbacksTrackingService.vBarOnboardingShow(e)}vBarOnboardingNext(e){this._capiFeedbacksTrackingService.vBarOnboardingNext(e)}vBarOnboardingClose(e){this._capiFeedbacksTrackingService.vBarOnboardingClose(e)}vBarCardCtaClicked(e){this._capiFeedbacksTrackingService.vBarCardCtaClicked(e)}vBarCardLockedUIUnlock(e){this._capiFeedbacksTrackingService.vBarCardLockedUIUnlock(e)}vBarCommentCardDismissed(e){this._capiFeedbacksTrackingService.vBarCommentCardDismissed(e)}vBarCommentCardCopyButtonClicked(e){this._capiFeedbacksTrackingService.vBarCommentCardCopyButtonClicked(e)}vBarCommentCardMarkResolvedButtonClicked(e){this._capiFeedbacksTrackingService.vBarCommentCardMarkResolvedButtonClicked(e)}vBarCommentCardGenerateCitationButtonClicked(e){this._capiFeedbacksTrackingService.vBarCommentCardGenerateCitationButtonClicked(e)}dispose(){this._capiFeedbacksTrackingService.dispose()}}class Yt{constructor(e){this._params=e}primeTrustedRewrite(e,t){return(0,n.zG)(this._params.checkingService.get(),r.g_((()=>Promise.resolve(this._params.telemetryService.error({message:"Checking service is not available"}))),(async i=>{const r=await i.sendMessage("trusted_rewrite:prime",function(e,t){return{rewrite:t,range:{begin:e.start,end:e.end}}}(e,t),!1,{kind:"default"})();ze.nM(r)&&this._params.telemetryService.error({message:"Failed to prime trusted rewrite",error:r.left})})))}}const Kt=a.lazy((()=>Promise.all([i.e(9784),i.e(6333),i.e(1088),i.e(328),i.e(213),i.e(1990),i.e(9003),i.e(3244),i.e(490),i.e(2168),i.e(7503),i.e(7853),i.e(309),i.e(8072),i.e(3765),i.e(4751),i.e(4922),i.e(9259),i.e(274)]).then(i.bind(i,9710)).then((({FeedbackForm:e})=>({default:e}))))),Jt=a.lazy((()=>Promise.all([i.e(9784),i.e(6333),i.e(1088),i.e(328),i.e(213),i.e(1990),i.e(9003),i.e(3244),i.e(490),i.e(2168),i.e(7503),i.e(7853),i.e(309),i.e(8072),i.e(3765),i.e(4751),i.e(4922),i.e(9259),i.e(274)]).then(i.bind(i,4272)).then((({SidelineCardWrapper:e})=>({default:e}))))),Qt=a.lazy((()=>Promise.all([i.e(9784),i.e(6333),i.e(1088),i.e(328),i.e(213),i.e(1990),i.e(9003),i.e(3244),i.e(490),i.e(2168),i.e(7503),i.e(7853),i.e(309),i.e(8072),i.e(3765),i.e(4751),i.e(4922),i.e(9259),i.e(274)]).then(i.bind(i,38705)).then((({SidelineCollection:e})=>({default:e})))));class Zt{constructor(e){this._params=e,this._feedbackFormContext=s.h.create(r.YP),this.feedbackFormContext=this._feedbackFormContext.view()}showFeedbackForm(e,t){this._feedbackFormContext.set(r.G({rewrite:e,sidelineCard:t,domain:this._params.integrationInfo.domain}))}closeFeedbackForm(){this._feedbackFormContext.set(r.YP)}submitFeedbackForm(e,t){this._params.trackingService.vBarCardRewriteFeedbackSubmitted({vBar:t.sidelineCard.sideline,rewrite:t.rewrite,feedbackFormData:e}),this._params.telemetryService.feedback({feedbackData:{score:e.score,text:e.text,domain:e.domain,vBarType:t.sidelineCard.sideline.kind,rewriteType:t.rewrite.type.kind},message:"Feedback form submitted.",hideUserInfo:!1}),this._feedbackFormContext.set(r.YP)}}var Xt,ei=i(79625);!function(e){e.toVBarsField=function(e){return{...e.rect,left:e.rect.left+(e.textFieldPosition.left-e.vBarsScrollMirrorFieldPosition.left)}},e.toTextField=function(e){return{...e.rect,left:e.rect.left-(e.textFieldPosition.left-e.vBarsScrollMirrorFieldPosition.left)}}}(Xt||(Xt={}));class ti{constructor(e){this._params=e,this._subs=new B.w0,this._logger=(0,U.h)(ti.name),this._selectionHighlight=s.h.create(r.YP),this.selectionHighlight=this._selectionHighlight.view(),this._subs.add(this._params.integration.selectionRange.subscribe((e=>{this._logger.debug("Selection range changed, updating selection highlight geometry accordingly.",e),this._params.selectionHighlightGeometry.removeAllHighlights();const t=this._params.textObserver.getCurrentTextMap().getPlainText();(0,n.zG)(e,r.hX((e=>this._params.integration.textRangeFilter({textRange:e,fullText:t}))),p.bw((e=>{const i=V.y$.Id.create(`g2-selection-highlight-${e.start}-${e.end}`);this._params.selectionHighlightGeometry.addHighlight(i,e,{highlightId:i,text:t.slice(e.start,e.end),textRange:e,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null,fullTextLength:t.length})})))}))),this._subs.add(ge.a([this._params.integration.vBarsLayoutInfo.scrollMirrorLayout.rect,this._params.integration.vBarsLayoutInfo.scrollMirrorLayout.textField.paddingRect.behavior,this._params.selectionHighlightGeometry.geometry.view((e=>Array.from(e.values()))),this._params.integration.vBarsLayoutInfo.scrollMirrorLayout.textStartPosition]).pipe(x.U((([e,t,i,a])=>(0,n.zG)(r.ij(i[0]),r.tS((i=>{return s={highlightId:i.meta.highlightId.toString(),highlightRects:i.rects,text:i.meta.text,textRange:i.meta.textRange,fullTextLength:i.meta.fullTextLength,vBarsScrollMirrorFieldRect:e,textFieldPosition:t.client,textStartPosition:a,getVBarHighlightRect:this._params.integration.getVBarHighlightRect},(0,n.zG)(s.text.trim().split(/\s+/).filter((e=>""!==e)).length,r.DT((e=>e>=2&&e<=1e3)),r.tS((()=>{const e=s.highlightRects.map((e=>Xt.toVBarsField({rect:e,textFieldPosition:s.textFieldPosition,vBarsScrollMirrorFieldPosition:s.vBarsScrollMirrorFieldRect})));return(0,n.zG)(r.ij((0,ei.jr)(e)),r.UI((t=>({id:s.highlightId,text:s.text,textRange:s.textRange,fullTextLength:s.fullTextLength,rect:s.getVBarHighlightRect({vBarTextRectInMirror:t,scrollMirrorRectInViewport:s.vBarsScrollMirrorFieldRect,textStartPositionInViewport:s.textStartPosition}),selectionRects:e}))))})));var s})))))).subscribe(g.wW(this._selectionHighlight))),this._subs.add(this._params.selectionHighlightGeometry.geometry.view((e=>Array.from(e.values()))).subscribe((e=>this._logger.debug("Selection highlight geometry udpated. Resulting highlights:",e)))),this._subs.add(this._selectionHighlight.subscribe((e=>this._logger.debug("Selection highlight udpated.",e))))}dispose(){this._subs.unsubscribe()}}var ii=i(62220),ri=i(14979);async function ni(e,t,i=""){if(!await async function(){const e=await(0,F.OB)().browserApi.sessionStorage.get("isSidePanelOpen");return void 0!==e.isSidePanelOpen&&!1!==e.isSidePanelOpen}())return await(0,ri.d)((0,nt.Z)(),i,e,t,false);try{return await(0,F.OB)().browserApi.sessionStorage.set({alwaysOnAssistantOnOpenData:{assistantSessionId:"",agentId:e,openAgentProfile:false,selectedText:i}}),!0}catch(i){return S.Y.create("openAgent").warn("Failed to open agent in side panel",{agentId:e,source:t,error:i}),!1}}var ai=i(53680),si=i(78767),oi=i(87410),li=i(70843),di=i(2775);const ci=[di.U.improve,di.U.rephrase,di.U.shorten,di.U.friendly,di.U.formal];function ui(e){return(0,n.zG)(ci,hi,function(e){return t=>{const i=null==e?void 0:e.kind;if("gmail"!==i&&"outlook"!==i)return[...t];const r=(0,F.OB)().experimentClient.getTreatment(li.p.VBarsEmailFlexRewrite),n=(()=>{switch(r){case"flex_rephrase":return di.U.rephraseFlexMild;case"flex_rephrase_agressive":return di.U.rephraseFlexAggressive;default:return}})();return n?t.map((e=>e===di.U.rephrase?n:e)):[...t]}}(e),gi)}function hi(e){if(!(0,v.iT)())return[...e];return[...e.slice(0,2),di.U.translate,...e.slice(2)]}function gi(e){return{rewrites:new Map(e.map((e=>[e.rewrite.rewriteTabId,e]))),rewriteTabsOrder:e.map((e=>e.rewrite.rewriteTabId)),selectedRewriteTabId:e[0].rewrite.rewriteTabId,customPromptRewriteInfo:r.YP,expanded:!1,rewriteApplied:!1,rewriteCopied:!1}}var mi=i(50750);function pi(e){var t,i;const r=(0,re.wr)(e,(e=>"hidden"===e.style.overflow));if(!r)return e;const n=e.getBoundingClientRect();let a=Math.max(0,n.top),s=Math.min(self.innerHeight,n.top+n.height),o=r;for(;o&&"hidden"===o.style.overflow;){const{height:e,top:t}=o.getBoundingClientRect();a=Math.max(t,a),s=Math.min(t+e,s),o=o.parentElement}if(n.top>s||n.bottom<a)return e;if(n.top>=a&&n.bottom<=s)return e;const l=null===(i=null===(t=document.getElementsByTagName(xe.Hq)[0])||void 0===t?void 0:t.shadowRoot)||void 0===i?void 0:i.getElementById(xe.wE);return l?(l.style.top=`${a}px`,l.style.left=`${n.left}px`,l.style.width=`${n.width}px`,l.style.height=s-a+"px",l):e}var vi=i(85251),fi=i(17869);function Si(e,t=300){return e.pipe(vi.v((({rewrite:e,vBarCard:t})=>`${e.id}-${t.sideline.id}`)),fi.z((e=>e.pipe(H.b(t)))))}var wi=i(27929);function bi(e,t,i){return`${e}-${t.type.kind}-${i.sideline.id}`}function Ci(e,t){return bi("rewrite-loading",e,t)}class _i{constructor(e){var t,i,a,o,h,m;this._params=e,this._subs=new B.w0,this._logger=(0,U.h)(_i.name),this._sidelineCardStateMap=new Map,this._sidelineCard=s.h.create(r.YP),this._sidelineNotification=s.h.create(r.YP),this._notifyRewriteReadyShownSubject=new Oe.x,this._notifyRewriteEmptyShownSubject=new Oe.x,this._notifyRewriteErrorShownSubject=new Oe.x,this._rewriteSubjectMap=new Map,this._rewriteSubscriptionMap=new Map,this.sidelineCard=s.h.combine(this._sidelineCard,this._sidelineNotification,((e,t)=>r.pC(e)?e:t)),this._updates=new ii.v,this._subs.add((t=this._params.sidelineCollectionViewModel,i=this._params.pushedContentService,ge.a([t.activeSideline,t.pinnedSideline]).pipe(H.b(0),x.U((([e,t])=>(0,n.zG)(t,r.UI((e=>({sideline:e,isPinned:!0}))),r.wp((()=>(0,n.zG)(e,r.UI((e=>({sideline:e,isPinned:!1}))))))))),x.U(r.tS((({sideline:e,isPinned:a})=>{var s;const o=(e=>"pushed_content"===e.kind?{kind:"pushed-lazy-rewrite"===e.pushedContentVBarType?"pushed_content_super_underline":"pushed_content",pushedContentId:e.pushedContentId}:{kind:"default"})(e);let l=!0;if("pushed_content"===e.kind){const d=i.contentState.get()[e.pushedContentId];if(d&&"lazyRewriteCard"===d.surface.kind){const i=d.surface.title,s=d.surface.sourceAction;return(0,n.zG)(t.getSidelineHtmlElement(e.sequentialId),r.UI((l=>({kind:"lazy-rewrite-card",sideline:e,isSidelinePinned:a,referenceElement:pi(l),shouldFocus:(0,n.zG)(t.cardFocusedSidelineSequentialId.get(),r.UI((t=>t===e.sequentialId)),r.Gg(n.yR)),title:i,sourceAction:s,source:o,contentId:d.contentId}))))}if(d&&"rewriteCard"===d.surface.kind&&(l=!0===d.surface.allowPresetTabs),d&&"plagiarismCard"===d.surface.kind){const i=d.surface.similarity,l=Math.round(100*i),c=d.contentId,u=null!==(s=d.surface.title)&&void 0!==s?s:"source similarity found",h=`${l}% ${u}`,g=d.surface.reference;return(0,n.zG)(t.getSidelineHtmlElement(e.sequentialId),r.UI((i=>({kind:"plagiarism-card",sideline:e,isSidelinePinned:a,referenceElement:pi(i),shouldFocus:(0,n.zG)(t.cardFocusedSidelineSequentialId.get(),r.UI((t=>t===e.sequentialId)),r.Gg(n.yR)),source:o,resourceTitle:h,similarity:l,reference:g,contentId:c}))))}}return(0,n.zG)(t.getSidelineHtmlElement(e.sequentialId),r.UI((i=>({kind:"rewrite-card",sideline:e,isSidelinePinned:a,referenceElement:pi(i),shouldFocus:(0,n.zG)(t.cardFocusedSidelineSequentialId.get(),r.UI((t=>t===e.sequentialId)),r.Gg(n.yR)),showHeader:l,source:o}))))}))))).subscribe(g.wW(this._sidelineCard))),this._subs.add((a=this._sidelineCard,o=this._params.pushedContentService.contentState,h=this._params.monetizationService.unlock,a.pipe(c.h(r.pC),x.U((e=>e.value)),c.h((e=>"rewrite-card"===e.kind&&"pushed_content"===e.sideline.kind)),x.U((e=>e.sideline)),c.h((e=>{var t,i;return"lockedRewriteCard"===(null===(t=e.surface)||void 0===t?void 0:t.kind)||"lockedComment"===(null===(i=e.surface)||void 0===i?void 0:i.kind)}))).subscribe((e=>{const t=o.get()[e.pushedContentId];t&&(0,wi.isLockedPushedContentItem)(t)&&h(t)})))),this._subs.add(Si(this._notifyRewriteReadyShownSubject).subscribe((({rewrite:e,vBarCard:t,isUphook:i})=>{this._logger.debug("Tracking vBarCardRewriteReadyShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteReadyShown({vBar:t.sideline,rewrite:e,duration:this._getRewriteLoadingDuration("rewrite-ready-shown",e,t),isUphook:Boolean(i),textFieldElementSize:this._getTextFieldElementSize()})}))),this._subs.add(Si(this._notifyRewriteEmptyShownSubject).subscribe((({rewrite:e,vBarCard:t})=>{this._logger.debug("Tracking vBarCardRewriteEmptyShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteEmptyShown({vBar:t.sideline,rewrite:e,duration:this._getRewriteLoadingDuration("rewrite-empty-shown",e,t)})}))),this._subs.add(Si(this._notifyRewriteErrorShownSubject).subscribe((({rewrite:e,vBarCard:t})=>{this._logger.debug("Tracking vBarCardRewriteErrorShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteErrorShown({vBar:t.sideline,rewrite:e,duration:this._getRewriteLoadingDuration("rewrite-error-shown",e,t)})}))),(0,F.OB)().experimentClient.isGateEnabled(Lt.K.VBarsSelectionPreload)&&this._subs.add((m=this._params.sidelineCollectionViewModel.selectionSideline,m.pipe(d.w(r.g_((()=>Fe.of(r.YP)),(e=>pe.T(z.R(document,"mouseup"),z.R(document,"mousemove").pipe(c.h((e=>0===e.buttons)))).pipe(u.q(1),G.h(r.G(e)))))),H.b(yt.m9(.2)),l.oA)).subscribe((e=>{this._logger.debug('Preloading "improve" rewrite for selection sideline.',{sidelineId:e.id}),this._params.rewriteService.getRewrite({rewriteType:{kind:"improve"},rewriteTabId:"improve",vBar:e,isPreload:!0})}))),this._defaultSidelineCardState=ui(this._params.integration.info)}onPushedContentAction(e,t){var i;if("pushed_content"===e.source.kind)return"launchAgentAction"===t.type?(ni(t.agentId,"agent_promotion").catch((e=>{this._logger.warn("Failed to launch agent:",e)})),void this._params.pushedContentService.dismiss(e.source.pushedContentId)):void((null===(i=this._params.pushedContentService)||void 0===i?void 0:i.sendExecuteActionMessage)?this._params.pushedContentService.sendExecuteActionMessage(e.source.pushedContentId,{},t).catch((e=>{this._logger.error("Failed to execute pushed content action:",e)})):this._logger.error("Cannot execute pushed content action: pushedContentService or sendExecuteActionMessage method not available"));this._logger.error("Cannot execute pushed content action: sideline card is not of pushed content source")}_getSidelineCardState(e){var t;return null!==(t=this._sidelineCardStateMap.get(e.sideline.id))&&void 0!==t?t:this._initSidelineCardState(e)}_getDefaultSidelineCardState(e){const t=e.source.kind;switch(t){case"default":return this._defaultSidelineCardState;case"pushed_content_super_underline":{const t="pushed_content"===(i=e.sideline).kind&&"lazyRewriteCard"===(null===(a=i.surface)||void 0===a?void 0:a.kind)?e.sideline.surface:void 0,s=(null==t?void 0:t.onShowAction)&&"actionId"in t.onShowAction?t.onShowAction.actionId:void 0;return{...this._defaultSidelineCardState,selectedRewriteTabId:"other",rewrites:new Map([["other",(0,n.zG)(r.ij(s),r.fS((()=>di.U.enhancePrompt.rewrite.type.textActionId)),(e=>({...di.U.enhancePrompt,rewrite:{...di.U.enhancePrompt.rewrite,type:{kind:"other",textActionId:e}}})))]])}}case"pushed_content":return{...this._defaultSidelineCardState,pushedContentItem:this.toPushedContentItem(this._params.pushedContentService.contentState.view(e.source.pushedContentId).get(),e.source.pushedContentId)};default:(0,si.vE)(t)}var i,a}_initSidelineCardState(e){this._logger.debug("Initializing sideline card state.",{sidelineId:e.sideline.id});const t=s.h.create(this._getDefaultSidelineCardState(e));return this._sidelineCardStateMap.set(e.sideline.id,t),t}_setPushedContentInfo(e,t){this._logger.debug("Setting pushed content info.",{sidelineId:t.sideline.id,pushedContentItem:e});this._getSidelineCardState(t).modify((i=>"pushed_content"!==t.source.kind?i:{...i,pushedContentItem:e}))}_setRewriteInfo(e,t){this._logger.debug("Setting rewrite info.",{sidelineId:t.sideline.id,rewrite:e});const i=this._getSidelineCardState(t);"customPrompt"===e.rewriteTabId?i.lens("customPromptRewriteInfo").set(r.G(e)):i.lens("rewrites").modify((t=>{var i;const r=null===(i=t.get(e.rewriteTabId))||void 0===i?void 0:i.buttonProps;return void 0===r?t:new Map([...t.entries(),[e.rewriteTabId,{rewrite:e,buttonProps:r}]])}))}_showAllRewriteTypes(e){this._getSidelineCardState(e).lens("expanded").set(!0)}_measureDuration(e,t){return performance.getEntriesByName(t).length>0?performance.measure(e,t).duration:void 0}_getRewriteLoadingDuration(e,t,i){const r=Ci(t,i),n=bi(e,t,i),a=this._measureDuration(n,r);return void 0===a&&this._params.telemetryService.error({message:"Failed to measure rewrite loading duration.",data:{measureName:n,rewriteLoadingPerformanceMarkName:r}}),null!=a?a:0}_getTextFieldElementSize(){const e=this._params.integration.highlightsLayoutInfo.textFieldLayout.visibleRect.getApproximate().size;return{width:Math.round(e.width),height:Math.round(e.height)}}notifyDismissButtonClicked(e){this._params.pushedContentService.dismiss(e),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e,!0)}notifyDisableButtonClicked(e){e.startsWith("pe-")&&(this._params.promptEnhancerAgentService.sendRequest({commandId:"disable",payload:{persistence:"persistent"}})().catch((t=>{this._params.telemetryService.error({message:t.message,error:t.nestedError,data:{contentId:e,commandId:"disable"}})})),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e,!0))}getSidelineCardState(e){return this._getSidelineCardState(e)}activateSidelineCard(e,t){this._params.sidelineCollectionViewModel.notifySidelineCardActive(e.sideline.sequentialId,t)}deactivateSidelineCard(e,t){const i=e.isSidelinePinned&&t;e.isSidelinePinned&&!i||this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e.sideline.sequentialId,t),i&&this._updates.emit("sidelineCardUnpinned",{sidelineCard:e})}applyRewrite(e,t){this._logger.debug("Apply rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteApplied({vBar:t.sideline,rewrite:e,textFieldElementSize:this._getTextFieldElementSize()}),this._params.trustedRewriteService.primeTrustedRewrite(t.sideline.textRange,e.rewriteText),this._params.performReplacement({pos:e.vBar.textRange,value:e.rewriteText,oldValue:e.vBar.text},{sidelineType:t.sideline.kind}).then((e=>{const i=(Array.isArray(e)?e:[e]).filter(ai.j.isFail);if(i.length>0){let e="Replacement(s) failed.";const t=i.map((e=>e.reason)).filter(Boolean);throw t.length>0&&(e+=` Reason(s): ${t.join(", ")}.`),new Error(e)}"pushed_content"===t.source.kind&&this._params.pushedContentService.removePushedContentItemLocally(t.source.pushedContentId),this._params.telemetryService.info({message:"Applying rewrite succeeded."})})).catch((e=>this._params.telemetryService.error({message:"Applying rewrite failed.",error:e}))),this._getSidelineCardState(t).modify((e=>({...e,rewriteApplied:!0}))),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(t.sideline.sequentialId,!0)}async copyRewrite(e,t){this._logger.debug("Copy rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteCopied({vBar:t.sideline,rewrite:e,textFieldElementSize:this._getTextFieldElementSize()});try{await(0,oi.v)(e.rewriteText),this._params.telemetryService.info({message:"Copying rewrite succeeded."})}catch(e){this._params.telemetryService.error({message:"Copying rewrite failed.",error:e}),this._logger.error("Failed to copy rewrite.",e)}this._getSidelineCardState(t).modify((e=>({...e,rewriteCopied:!0})))}dismissRewrite(e,t){this._logger.debug("Dismiss rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteDismissed({vBar:t.sideline,rewrite:e,textFieldElementSize:this._getTextFieldElementSize()});const i="pushed_content"===e.source.kind?e.source.pushedContentId:void 0;i&&this._params.pushedContentService.dismiss(i),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(t.sideline.sequentialId,!0)}deactivateSidelineType(e,t,i){this._logger.debug("Show less.",{rewrite:t,sidelineCard:i,vBarType:i.sideline.kind}),this._params.trackingService.vBarCardShowLessClicked({vBar:i.sideline,rewrite:t,domain:this._params.integrationInfo.domain});const n=i.referenceElement.getBoundingClientRect(),a={getBoundingClientRect:()=>n};this.deactivateSidelineCard(i,!0),this._sidelineNotification.set(r.G({kind:"notification",text:`Youll see fewer sidebars with suggestions on ${this._params.integrationInfo.domain}.`,referenceElement:a,id:Date.now()})),this._subs.add(this._scheduleNotifcationHide()),this._params.availabilityService.deactivate(e).then((()=>{this._logger.debug("Deactivated sideline type.",{vBarType:e,refBoundingRect:a.getBoundingClientRect()})})).catch((e=>{this._logger.error("Failed to deactivate sideline type.",e),this._params.telemetryService.error({message:"Failed to deactivate sideline type",error:e})}))}_scheduleNotifcationHide(){var e;const t=[self,null===(e=this._params.integration.additionalGlobalEventSource)||void 0===e?void 0:e.scroll].filter((e=>!!e)).map((e=>z.R(e,"scroll",{capture:!0})));return pe.T(g.gw(void 0,yt.m9(3)),z.R(document,"click",{capture:!0}),...t).pipe(u.q(1)).subscribe((()=>{this._sidelineNotification.set(r.YP)}))}regenerateRewrite(e,t){var i;this._logger.debug("Regenerate rewrite.",{sidelineId:t.sideline.id,rewrite:e}),this._params.trackingService.vBarCardRewriteRegenerated({vBar:t.sideline,rewrite:e}),null===(i=this._rewriteSubjectMap.get(t.sideline.id))||void 0===i||i.next({rewriteType:e.type,rewriteTabId:e.rewriteTabId,sidelineCard:t,useCache:!1,isRegenerate:!0})}submitCustomPrompt(e,t){var i;this._logger.debug("Submitting custom prompt.",{sidelineId:t.sideline.id,prompt:e}),this._params.trackingService.vBarCardCustomPromptSubmitted({vBar:t.sideline}),null===(i=this._rewriteSubjectMap.get(t.sideline.id))||void 0===i||i.next({rewriteType:{kind:"customPrompt",prompt:e},rewriteTabId:"customPrompt",sidelineCard:t,useCache:!1,isRegenerate:!1})}notifySelectedRewriteTabChanged(e,t){if("default"!==t.source.kind)return;this._logger.debug("Selected rewrite changed.",{sidelineId:t.sideline.id,rewriteTabId:e}),this._showAllRewriteTypes(t);const i=this._getSidelineCardState(t).lens("selectedRewriteTabId"),a=i.get();if(void 0!==a&&(this._params.trackingService.vBarCardRewriteSelected({vBar:t.sideline,rewriteTabId:e,previousRewriteTabId:a}),i.set(e),"customPrompt"!==e)){const i=this._getSidelineCardState(t);(0,n.zG)(this._getCurrentRewriteType(i.get()),r.g_((()=>{this._logger.error("No rewrite found for selected rewrite tab.")}),(i=>{var r;let n=i.type;if("translate"===n.kind){const e=t.sideline.text,i=this._params.translationService.getTranslationDirection(e);n={...n,translationDirection:i}}null===(r=this._rewriteSubjectMap.get(t.sideline.id))||void 0===r||r.next({rewriteType:n,rewriteTabId:e,sidelineCard:t,useCache:!0,isRegenerate:!1})})))}}notifyCustomPromptChanged(e,t){this._getSidelineCardState(t).lens("customPromptRewriteInfo").set(r.YP)}notifyRewriteLoadingShown(e,t){this._logger.debug("notifyRewriteLoadingShown()",{rewrite:e,sidelineId:t.sideline.id});const i=Ci(e,t);performance.clearMarks(i),performance.mark(i)}notifyRewriteEmptyShown(e,t){this._notifyRewriteEmptyShownSubject.next({rewrite:e,vBarCard:t})}notifyRewriteReadyShown(e,t,i){this._params.monetizationService.markVBarUsed(t.sideline),this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline card rewrite succeeded."}),this._notifyRewriteReadyShownSubject.next({rewrite:e,vBarCard:t,isUphook:i})}notifyRewriteErrorShown(e,t){this._notifyRewriteErrorShownSubject.next({rewrite:e,vBarCard:t})}notifyRewriteStreamingStart(e,t){this._logger.debug("notifyRewriteStreamingStart()",{rewrite:e,sidelineId:t.sideline.id});const i=this._getRewriteLoadingDuration("rewrite-streaming-start",e,t);this._params.trackingService.vBarCardRewriteStreamingStart({vBar:t.sideline,duration:i,rewrite:e}),this._params.aiEditorPromotionService.setCallToAction(e.callToAction)}notifyRewriteReverted(e,t){this._logger.debug("notifyRewriteReverted()",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteReverted({vBar:t.sideline,rewrite:e})}_getCurrentRewriteType(e){var t,i;const a=e.selectedRewriteTabId;return"customPrompt"===a?null!==(t=e.customPromptRewriteInfo)&&void 0!==t?t:r.YP:(0,n.zG)(null===(i=e.rewrites.get(null!=a?a:""))||void 0===i?void 0:i.rewrite,r.ij)}_getOverrideUrlFromCardState(e){var t,i,r,n;const a=this._getSidelineCardState(e).get();return"uphookComment"===(null===(i=null===(t=a.pushedContentItem)||void 0===t?void 0:t.surface)||void 0===i?void 0:i.kind)?a.pushedContentItem.surface.uphookComment.ctaUrl:"uphookRewriteCard"===(null===(n=null===(r=a.pushedContentItem)||void 0===r?void 0:r.surface)||void 0===n?void 0:n.kind)?a.pushedContentItem.surface.uphookRewrite.ctaUrl:void 0}_getPushedContentUphookConfigFromCardState(e){var t,i,r,n;const a=this._getSidelineCardState(e).get();if("uphookComment"===(null===(i=null===(t=a.pushedContentItem)||void 0===t?void 0:t.surface)||void 0===i?void 0:i.kind)||"uphookRewriteCard"===(null===(n=null===(r=a.pushedContentItem)||void 0===r?void 0:r.surface)||void 0===n?void 0:n.kind))return a.pushedContentItem.surface.uphookConfig}_getCurrentRewriteFromCard(e){const t=this._getSidelineCardState(e).get();return(0,n.zG)(this._getCurrentRewriteType(t),r.fS((()=>{var e;return null===(e=Array.from(t.rewrites.values())[0])||void 0===e?void 0:e.rewrite})))}_getUphookPatternName(e){const t=this._getCurrentRewriteFromCard(e);return(0,Ht._Z)(e.sideline)||(t&&"patternName"in t?t.patternName:void 0)}_getSourceLanguage(e){var t,i,r,n;const a=this._getCurrentRewriteFromCard(e);if(!a||!("metadata"in a))return;const s=null===(i=null===(t=a.metadata)||void 0===t?void 0:t.isMultilingual)||void 0===i?void 0:i.json;if(!s||!0!==JSON.parse(s))return"en";const o=null===(n=null===(r=a.metadata)||void 0===r?void 0:r.detectedLanguage)||void 0===n?void 0:n.json;if(o)try{const e=JSON.parse(o);return"string"==typeof e?e.toLowerCase():void 0}catch(e){return}}notifySidelineCardShown(e,t){var i,a;this._logger.debug("notifySidelineCardShown()",{vBarId:e.sideline.id,isUphook:t}),this._params.trackingService.vBarCardShown({vBar:e.sideline,isUphook:t,textFieldElementSize:this._getTextFieldElementSize()}),this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline card succeeded."}),null===(i=this._rewriteSubscriptionMap.get(e.sideline.id))||void 0===i||i.unsubscribe();const s=null!==(a=this._rewriteSubjectMap.get(e.sideline.id))&&void 0!==a?a:new Oe.x;this._rewriteSubjectMap.set(e.sideline.id,s);const o=s.pipe(d.w((({rewriteType:e,rewriteTabId:t,sidelineCard:i,useCache:a,isRegenerate:s})=>("translate"===e.kind&&this._params.translationService.recordTranslationLanguages(e.translationDirection),function(e,t,i,a,s,o=!0){const l=e.source;return"pushed_content"===l.kind?s.contentState.view(l.pushedContentId).pipe(x.U((t=>t?a.getRewriteFromPushedContentItem({pushedContentItemId:l.pushedContentId,vBar:e.sideline,pushedContentItem:t}):r.YP)),x.U(r.FS),c.h((e=>void 0!==e))):mi.D(a.getRewrite({rewriteType:t,rewriteTabId:i,vBar:e.sideline,isPreload:!1,skipCache:!o})).pipe(u.q(1),d.w(n.yR))}(i,e,t,this._params.rewriteService,this._params.pushedContentService,a).pipe(x.U((e=>({rewrite:e,isRegenerate:s})))))))).subscribe((({rewrite:t,isRegenerate:i})=>{this._logger.debug("Rewrite observable emitted.",{sidelineId:e.sideline.id,rewrite:t,isRegenerate:i}),"ready"===t.kind&&(this._params.aiEditorPromotionService.setCallToAction(t.callToAction),this._params.telemetryService.info({message:i?"Regenerating rewrite succeeded.":"Retrieving rewrite succeeded."})),this._setRewriteInfo(t,e)}));if(this._rewriteSubscriptionMap.set(e.sideline.id,o),this._subs.add(o),"pushed_content"===e.source.kind){this._logger.debug("Subscribing to pushed content item updates.");const t=e.source.pushedContentId,i=this._params.pushedContentService.contentState.view(e.source.pushedContentId).subscribe((i=>this._setPushedContentInfo(this.toPushedContentItem(i,t),e)));this._subs.add(i)}const l=this._getSidelineCardState(e).get();(0,n.zG)(this._getCurrentRewriteType(l),r.fS((()=>Array.from(l.rewrites.values())[0].rewrite)),(t=>{var i;return s.next({rewriteType:t.type,sidelineCard:e,useCache:!0,isRegenerate:!1,rewriteTabId:null!==(i=l.selectedRewriteTabId)&&void 0!==i?i:"improve"})}))}notifySidelineCardClosed(e){var t;const i=this._getSidelineCardState(e),r=i.lens("rewriteApplied").get();this._logger.debug("notifySidelineCardClosed()",{sidelineId:e.sideline.id,isRewriteApplied:r}),r||this._params.trackingService.vBarCardClosed({vBar:e.sideline}),null===(t=this._rewriteSubscriptionMap.get(e.sideline.id))||void 0===t||t.unsubscribe(),i.set(this._getDefaultSidelineCardState(e)),this._params.aiEditorPromotionService.setCallToAction(void 0)}toPushedContentItem(e,t){if(void 0!==e)return{...e,contentId:t,id:0,action:"pushed_content:pushedContent"}}notifyMoreTabClicked(e){this._showAllRewriteTypes(e)}notifyFeedbackButtonClicked(e,t){this._params.feedbackFormViewModel.showFeedbackForm(e,t)}notifyTranslationTargetLanguageChanged(e,t,i){var r;const n=e.type;if("translate"!==n.kind)return void this._logger.warn('Target translation language changed, but the rewrite type is not "translate".');const a={...n,translationDirection:{...n.translationDirection,targetLanguageTag:i}};null===(r=this._rewriteSubjectMap.get(t.sideline.id))||void 0===r||r.next({rewriteType:a,rewriteTabId:e.rewriteTabId,sidelineCard:t,useCache:!0,isRegenerate:!1})}notifyUphookButtonClicked(e,t,i){const r=i.get(),n=this._getPushedContentUphookConfigFromCardState(t),a=this._getUphookPatternName(t),s=this._getSourceLanguage(t);this._params.monetizationService.sendUphookEvent(t.sideline,"click",e,n,a,s);const o=this._getOverrideUrlFromCardState(t);this._params.monetizationService.executeUphook(t.sideline,e,r,o),this._params.trackingService.vBarCardRewriteUphookClicked({vBar:t.sideline,rewriteType:e,isEligibleForInProductDiscount:r})}notifyUphookButtonShown(e,t,i){const r=this._getPushedContentUphookConfigFromCardState(t),n=this._getUphookPatternName(t),a=this._getSourceLanguage(t);this._params.monetizationService.sendUphookEvent(t.sideline,"show",e,r,n,a),this._params.trackingService.vBarCardRewriteUphookShown({vBar:t.sideline,rewriteType:e,isEligibleForInProductDiscount:i.get()})}notifyCtaClicked(e,t){this._params.trackingService.vBarCardCtaClicked({vBar:t.sideline,rewrite:e})}onPushedContentCommentCardDismiss(e){this._params.pushedContentService.dismiss(e.pushedContentId),this._params.trackingService.vBarCommentCardDismissed({vBar:e})}onPushedContentCommentCardMarkResolved(e){this._params.pushedContentService.markResolved(e.pushedContentId),this._params.trackingService.vBarCommentCardMarkResolvedButtonClicked({vBar:e})}onPushedContentCommentCardCopy(e,t){var i;this._params.trackingService.vBarCommentCardCopyButtonClicked({vBar:e});const r=null!==(i=null==t?void 0:t.content)&&void 0!==i?i:e.text;(0,oi.v)(r).then((()=>{this._params.telemetryService.info({message:"Copying pushed-content comment content succeeded."})})).catch((e=>{this._params.telemetryService.error({message:"Copying pushed-content comment content failed.",error:e}),this._logger.error("Failed to copy pushed-content comment content.",e)}))}onPushedContentCommentCardGenerateCitationClicked(e){this._params.trackingService.vBarCommentCardGenerateCitationButtonClicked({vBar:e})}addEventListener(e,t){return this._updates.on(e,t)}dispose(){this._params.promptEnhancerAgentService.dispose(),this._subs.unsubscribe()}}var yi=i(18117),ki=i(38538),Bi=i(93440),xi=i(18595),Ei=i(53186),Ri=i(64910),Ii=i(76022);function Ti(e,t){const i=(0,Ii.MY)(e.text),r=[t,"vbar",e.textRange.start,e.textRange.end,i];"selection"===t&&r.push(performance.now());return{kind:t,id:r.join("-"),text:e.text,textHash:i,textRange:e.textRange,fullTextLength:e.fullTextLength}}const Pi=e=>{var t;switch(e.kind){case"rewriteCard":case"lazyRewriteCard":case"lockedRewriteCard":case"unlockedRewriteCard":case"uphookRewriteCard":case"comment":case"lockedComment":case"unlockedComment":case"uphookComment":case"rewritePlaceholderCard":case"expertPanelCard":case"plagiarismCard":return null!==(t=e.explanation)&&void 0!==t?t:e.title;default:return}};class Fi{constructor(e){var t;this._params=e,this._subs=new B.w0,this._disposables=[],this._logger=(0,U.h)(Fi.name),this._htmlElementBySidelineSequentialId=new Map,this._sidelines=s.h.create([]),this._sidelineBySequentialId=new Map,this._pinnedSidelineSequentialId=s.h.create(r.YP),this._pinnedSideline=s.h.combine(this._pinnedSidelineSequentialId,this._sidelines,(e=>(0,n.zG)(e,r.tS((e=>e===Ht.ZR?this._selectionSideline.get():this._getSidelineBySequentialId(e)))))),this._activeSidelineSequentialId=s.h.create(r.YP),this._activationTimeoutRef=void 0,this._deactivationTimeout=N.zH,this._activeSideline=s.h.combine(this._pinnedSideline,this._activeSidelineSequentialId,this._sidelines,((e,t)=>(0,n.zG)(e,r.wp((()=>(0,n.zG)(t,r.tS((e=>e===Ht.ZR?this._selectionSideline.get():this._getSidelineBySequentialId(e))))))))),this._emphasizedSidelineSequentialId=s.h.create(r.YP),this._emphasizedSidelineSequentialIdByParagraphHighlight=s.h.create(r.YP),this._isSubdued=s.h.create(!1),this._vbarMousePositions=s.h.create({}),this._emphasizedSideline=s.h.combine(this._pinnedSideline,this._activeSideline,this._emphasizedSidelineSequentialId,this._emphasizedSidelineSequentialIdByParagraphHighlight,this._isSubdued,this._sidelines,((e,t,i,a,s)=>(0,n.zG)(t,r.tS((t=>r.pC(e)?r.YP:r.G(t))),r.wp((()=>(0,n.zG)(i,r.wp((()=>a)),r.tS((e=>e===Ht.ZR?this._selectionSideline.get():s?r.YP:this._getSidelineBySequentialId(e))))))))),this._selectionSideline=s.h.create(r.YP),this._shouldHideSidelines=s.h.create(!1),this._sidelineCardActiveNotifications=new Oe.x,this._deactivateSidelineSubs=new B.w0,this._notifySidelineShownSubject=new Oe.x,this._notifySidelinePulsedSubject=new Oe.x,this._selectionOrCaretPosition=s.h.create(r.YP),this._streamingStatus=s.h.create("not-streaming"),this.sidelines=this._sidelines.view(),this.pinnedSideline=this._pinnedSideline.view(),this.activeSideline=this._activeSideline.view(),this.emphasizedSideline=this._emphasizedSideline.view(),this.selectionSideline=this._selectionSideline.view(),this.shouldHideSidelines=this._shouldHideSidelines.view(),this.isSubdued=this._isSubdued.view(),this.vBarMousePositions=this._vbarMousePositions.view(),this.cardFocusedSidelineSequentialId=s.h.create(r.YP),this.streamingStatus=this._streamingStatus.view(),this._subs.add(ge.a([this._params.availabilityService.enabled,this._params.sidelineHighlightCollectionViewModel.sidelineHighlights]).pipe(x.U((([e,t])=>(0,n.zG)(e,r.g_((()=>[]),(e=>{const i=this._params.textObserver.getCurrentTextMap().getPlainText();return t.map((t=>{switch(t.kind){case"paragraph":return e.idleSidelines?(0,n.zG)(this._params.paragraphCollectionService.getParagraphById(t.paragraphId),r.g_((()=>(this._params.telemetryService.warn({message:"Creating sideline failed."}),this._logger.warn("Failed to create paragraph sideline; skipping.",{paragraphId:t.paragraphId}),r.YP)),(i=>function(e,t,i){const n=i?"idle":void 0;if(!n)return r.YP;const a={...Ti(e,n),sequentialId:e.sequentialId,highlightRect:t};return r.G(a)}(i,t.rect,e.idleSidelines))),r.WG):null;case"pushed_content":{const e=this._params.pushedContentService.contentState.get()[t.pushedContentId];return e?(0,n.zG)(function(e,t,i,n,a,s){const o=n.notificationElement,l=o.range,d=e.substring(l.start,l.end),c=o.vBarType,u=(0,Ii.MY)(d),h={kind:"pushed_content",id:[c,"vbar",l.start,l.end,i,u].join("-"),text:d,textHash:u,textRange:l,fullTextLength:e.length,pushedContentId:i,pushedContentVBarType:c,notificationElementKind:o.kind,color:o.colorHex,sequentialId:i,highlightRect:t,surface:a,fullTextRect:s,explanation:Pi(a)};return r.G(h)}(i,t.rect,t.pushedContentId,e.notification,e.surface,t.fullTextRect),r.WG):r.YP}default:(0,si.vE)(t)}})).filter(si.Nf)})))))).subscribe(g.wW(this._sidelines))),this._subs.add(this._sidelines.subscribe((e=>{this._sidelineBySequentialId.clear();for(const t of e)this._sidelineBySequentialId.set(t.sequentialId,t)}))),this._subs.add(this._params.sidelineHighlightCollectionViewModel.emphasizedSidelineHighlight.subscribe((e=>{(0,n.zG)(e,r.g_((()=>this._emphasizedSidelineSequentialIdByParagraphHighlight.set(r.YP)),(e=>{var t;const i=null===(t=this._sidelineBySequentialId.get(e.sequentialId))||void 0===t?void 0:t.id;if(i){const t=this._vbarMousePositions.get()[i];e.horizontalDistanceToPointer<=60?this._vbarMousePositions.modify(ki.dx(i,"HoverVBar"===t?t:"InsideSafeArea")):this._vbarMousePositions.modify((()=>({[i]:"HoverVBar"===t?t:"OutsideSafeArea"})))}this._emphasizedSidelineSequentialIdByParagraphHighlight.set(r.G(e.sequentialId))})))}))),this._setupSelectionSideline(),this._subs.add(ge.a([this._params.legacyAssistantOpenState,this._params.assistantState]).pipe(x.U((([e,t])=>"open"===e||"opened"===t.kind))).subscribe(g.wW(this._shouldHideSidelines))),this._subs.add(this._shouldHideSidelines.pipe(c.h(Boolean)).subscribe((()=>{this._pinnedSidelineSequentialId.set(r.YP),this._activeSidelineSequentialId.set(r.YP)}))),this._subs.add(this._params.textObserver.contentChanges.immediate.subscribe((({changes:e})=>{e.length>0&&(this._pinnedSidelineSequentialId.set(r.YP),this._activeSidelineSequentialId.set(r.YP))}))),this._subs.add(this._notifySidelineShownSubject.pipe(vi.v((e=>(0,Ht.iu)(e)?e.sequentialId:e.id)),fi.z((e=>e.pipe(H.b(300))))).subscribe((e=>{this._logger.debug("Tracking vBarShown().",{vBar:e}),this._params.trackingService.vBarShown({vBar:e})}))),this._subs.add(this._notifySidelinePulsedSubject.pipe(H.b(300)).subscribe((e=>{this._logger.debug("Tracking vBar onboarding pulse.",{vBar:e}),this._params.onboardingService.notifyPulsatingShown(e)}))),this._subs.add(this._params.integration.selectionOrCaretPosition.subscribe(g.wW(this._selectionOrCaretPosition)));const i=[self,null===(t=this._params.integration.additionalGlobalEventSource)||void 0===t?void 0:t.scroll].filter((e=>!!e));this._subs.add((0,pe.T)(...i.map((e=>(0,z.R)(e,"scroll",{capture:!0})))).pipe((0,st.p)(300)).subscribe((()=>{this._logger.debug("Clearing any pinned, active, or emphasized sidelines."),r.pC(this._pinnedSideline.get())&&this._params.onPinnedSidelineClearedByScroll(),this._pinnedSidelineSequentialId.set(r.YP),this._activeSidelineSequentialId.set(r.YP),this._emphasizedSidelineSequentialId.set(r.YP),this._emphasizedSidelineSequentialIdByParagraphHighlight.set(r.YP),self.clearTimeout(this._activationTimeoutRef),this._activationTimeoutRef=void 0}))),this._subs.add(this._params.integration.highlightsLayoutInfo.mouseData.pipe((0,Y.O)(null),(0,Me.b)((()=>{this._isSubdued.set(!1),this._params.paragraphCollectionService.resetEditingParagraphIndex()})),(0,d.w)((()=>(0,Bi.H)(yt.m9(3)).pipe((0,Me.b)((()=>{this._isSubdued.set(!0)})))))).subscribe()),this._setupVBarAccessibleActivation()}_setupSelectionSideline(){this._subs.add(ge.a([this._params.selectionHighlightViewModel.selectionHighlight,this._activeSideline,this._params.availabilityService.enabled.pipe(x.U((0,n.ls)(r.hX((e=>e.selectionSidelines)),r.pC)))]).pipe(c.h((([e,t,i])=>i)),c.h((([e,t])=>(0,n.zG)(yi.Yt(r.Kw)({selectionSideline:this._selectionSideline.get(),activeSideline:t}),r.g_(n.W8,(({selectionSideline:e,activeSideline:t})=>e.id!==t.id))))),x.U((([e])=>(0,n.zG)(e,r.UI((e=>function(e){return{...Ti(e,"selection"),sequentialId:Ht.ZR,highlightRect:e.rect,selectionRects:e.selectionRects}}(e))))))).subscribe(g.wW(this._selectionSideline)))}_setupVBarAccessibleActivation(){const e=new Ri.J({textField:this._params.integration.getKeyboardEventsTarget(),kind:"openVBar",settings:this._params.keyboardShortcutsSetting,handler:()=>this._handleActivationShortcut()});this._disposables.push(e)}_handleActivationShortcut(){const e=this._selectionOrCaretPosition.get();if(r.Wi(e))return;const t=e.value.start===e.value.end?(0,n.zG)(this.sidelines.get().filter((t=>t.textRange.end>e.value.start&&t.textRange.start<=e.value.start)),Ei.nI,r.UI(Ei.YM)):this._selectionSideline.get();(0,n.zG)(t,r.UI((e=>{this.cardFocusedSidelineSequentialId.set(r.G(e.sequentialId)),this.pinSideline(e),(0,n.zG)(this.getSidelineHtmlElement(e.sequentialId),r.UI((e=>e.focus())))})))}_doesSequentialIdMatchRelevantSidelineSequentialId(e,t){return(0,n.zG)(t,r.g_(n.jv,(t=>t===e)))}_getSidelineBySequentialId(e){return e===Ht.ZR?this._selectionSideline.get():r.ij(this._sidelineBySequentialId.get(e))}_deactivateSideline(e,t=!1){this._logger.debug("Deactivating sideline.",{sidelineSequentialId:e,immediate:t}),this._emphasizedSidelineSequentialId.set(r.YP),this._doesSequentialIdMatchRelevantSidelineSequentialId(e,this._activeSidelineSequentialId.get())&&(this._deactivateSidelineSubs.unsubscribe(),this._deactivateSidelineSubs=this._sidelineCardActiveNotifications.pipe(c.h((t=>t===e)),u.q(1),G.h(!1),xi.L(t?0:this._deactivationTimeout,Fe.of(!0))).subscribe((t=>{t?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to deactivate sideline.",{sidelineSequentialId:e}),this._activeSidelineSequentialId.set(r.YP)):this._logger.debug("Received a notification that corresponding sideline card is active, won't deactivate sideline.",{sidelineSequentialId:e})})))}_unpinSideline(e){this._logger.debug("Unpinning sideline.",{sidelineSequentialId:e}),this._doesSequentialIdMatchRelevantSidelineSequentialId(e,this._pinnedSidelineSequentialId.get())?(this._pinnedSidelineSequentialId.set(r.YP),this._activeSidelineSequentialId.set(r.YP)):(this._params.telemetryService.warn({message:"Unpinning of an unpinned sideline attempted."}),this._logger.warn("Tried to unpin sideline that is not pinned, this is a no-op.",{sidelineSequentialId:e}))}_pinSideline(e){this._logger.debug("Pinning sideline.",{sidelineSequentialId:e}),this._pinnedSidelineSequentialId.set(r.G(e))}activateSideline(e,t=!1){this._logger.debug("Activating sideline.",{sideline:e}),this._emphasizedSidelineSequentialId.set(r.G(e.sequentialId)),this._scheduleOpenVBarCard(e,t)}_scheduleOpenVBarCard(e,t){let i=(0,N.zq)(e.kind);r.pC(this._activeSideline.get())&&(i+=this._deactivationTimeout),self.clearTimeout(this._activationTimeoutRef),this._activationTimeoutRef=self.setTimeout((()=>{this._logger.debug("Opening vBar card for sideline.",{sideline:e}),t&&this._params.onboardingService.notifyPulsatingSeen(e),this._activeSidelineSequentialId.set(r.G(e.sequentialId)),this._deactivateSidelineSubs.unsubscribe()}),i)}deactivateSideline(e){self.clearTimeout(this._activationTimeoutRef),this._deactivateSideline(e.sequentialId)}pinSideline(e){this._pinSideline(e.sequentialId)}unpinSideline(e){this._unpinSideline(e.sequentialId)}getSideline(e){return this._getSidelineBySequentialId(e)}getSidelineHtmlElement(e){return r.ij(this._htmlElementBySidelineSequentialId.get(e))}notifySidelineMounted(e){this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline succeeded."})}notifySidelineShown(e){this._logger.debug("vBar shown (became visible)",{vBar:e}),this._notifySidelineShownSubject.next(e)}notifySidelineHidden(e){this._logger.debug("Sideline hidden (became invisible)",{sideline:e}),this._params.trackingService.vBarHidden({vBar:e})}notifySidelinePulsed(e){this._logger.debug("Sideline pulsed (onboarding)",{vBar:e}),this._notifySidelinePulsedSubject.next(e)}notifySidelineRefChanged(e,t){this._htmlElementBySidelineSequentialId.set(e.sequentialId,t)}notifySidelineCardActive(e,t){this._sidelineCardActiveNotifications.next(e),t&&this._pinSideline(e)}notifySidelineCardInactive(e,t){r.pC(this._pinnedSideline.get())?this._unpinSideline(e):r.pC(this._activeSideline.get())&&this._deactivateSideline(e,t)}setVBarMousePosition(e,t){t?this._vbarMousePositions.modify(ki.dx(e,"HoverVBar")):(0,n.zG)(this._emphasizedSideline.get(),r.hX((t=>t.id===e)),r.hX(Ht.WE),r.tS((e=>(0,n.zG)(this._params.sidelineHighlightCollectionViewModel.emphasizedSidelineHighlight.get(),r.hX((t=>t.sequentialId===e.sequentialId))))),r.hX((e=>e.horizontalDistanceToPointer<=60)),r.pC)?this._vbarMousePositions.modify(ki.dx(e,"InsideSafeArea")):this._vbarMousePositions.modify(ki.EG(e))}setStreamingStatus(e){this._streamingStatus.set(e)}dispose(){self.clearTimeout(this._activationTimeoutRef),this._activationTimeoutRef=void 0,this._deactivateSidelineSubs.unsubscribe(),this._subs.unsubscribe(),this._disposables.forEach((e=>e.dispose()))}}var Mi=i(92748),Di=i(79859),Li=i(49629),Ai=i(63310),Oi=i(68418),Ui=i(38894),zi=i(31272);function Hi(e){return{kind:"paragraph",highlightId:V.y$.Id.create(`g2-paragraph-highlight-${e.textRange.start}-${e.textRange.end}`),paragraphId:e.id,paragraphSequentialId:e.sequentialId,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null}}function Gi(e,t,i){return{kind:"pushed_content",highlightId:V.y$.Id.create(`g2-pushed-content-highlight-${t.notification.notificationElement.range.start}-${t.notification.notificationElement.range.end}`),pushedContentId:e,pushedContentVBarType:t.notification.notificationElement.vBarType,notificationElementKind:t.notification.notificationElement.kind,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null,sequentialId:e,overrides:i}}var Vi=i(91038);function qi(e,t,i,a,s){if(null!==t){const o=Oi.p8.fromClientPoint(t,i,s);return null===Vi.o||void 0===Vi.o||Vi.o.drawRect({...t,width:8,height:8},{color:"green"},void 0,"mouse-absolute"),null===Vi.o||void 0===Vi.o||Vi.o.drawRect({...o,width:4,height:4},{color:"red"},{left:i.left-s.left,top:i.top-s.top},"mouse-relative"),null===Vi.o||void 0===Vi.o||Vi.o.drawRect({...i,width:20,height:20},{color:"blueviolet"},void 0,"text-field-rect"),null===Vi.o||void 0===Vi.o||Vi.o.drawRect({...a,width:20,height:20},{color:"teal",borderWidth:6},void 0,"scroll-mirror-rect"),(0,n.zG)(e,(0,ie.f2)((e=>{const t=Xt.toTextField({rect:e.rect,textFieldPosition:i,vBarsScrollMirrorFieldPosition:a});return null===Vi.o||void 0===Vi.o||Vi.o.drawRect(t,{color:"green"},{left:i.left-s.left,top:i.top-s.top},e.id),(0,n.zG)(e,r.DT((()=>Ai.UL.contains(o,Ai.Wm.create(t)))),r.UI(function(e,t){return i=>({...i,horizontalDistanceToPointer:Math.abs(e.left-t.left)})}(o,t)))})))}return r.YP}const Ni=(e,t)=>{const i=Boolean(t.layer&e.suppressMask);return i==Boolean(e.layer&t.suppressMask)?Date.parse(e.timestamp)>Date.parse(t.timestamp):i};const ji=({rect:e})=>e.top,$i=({rect:e})=>e.top+e.height;class Wi{constructor(e){this._params=e,this._subs=new B.w0,this._logger=(0,U.h)(Wi.name),this._sidelineHighlights=s.h.create([]),this._hoveredSidelineHighlight=s.h.create(r.YP),this.sidelineHighlights=this._sidelineHighlights.view(),this.emphasizedSidelineHighlight=this._hoveredSidelineHighlight.view();const t=this._params.withParagraphHighlights,i=s.h.combine(this._params.pushedContentService.contentState,this._params.pushedContentFilters,this._params.pushedContentVBarOverrides,((e,t,i)=>{return r=e,n=t,a=i,Array.from(Object.values(r)).map((e=>{if(!function(e){return"vBar"===e.notification.notificationElement.kind||"superUnderline"===e.notification.notificationElement.kind}(e))return null;const t=[...n.entries()].find((([t,i])=>i(e.originalPushedContentMessage)));if(!t)return null;const[i]=t;return{item:e,overrides:a.get(i)}})).filter(si.C_);var r,n,a})).pipe(h.x(((e,t)=>(0,zi.vZ)(e,t))));this._subs.add(ge.a([this._params.paragraphCollectionService.paragraphs,i.pipe(Y.O([]),m.G(),me.D((([e,t])=>{const i=Fe.of(0);if(e.length!==t.length)return i;return ie.$R(e,t).every((([e,t])=>e.item.contentId===t.item.contentId&&(0,zi.vZ)(e.item.notification.notificationElement.range,t.item.notification.notificationElement.range)))?K.timer(1e3):i})),x.U(Mi.Yg),Y.O([])),t]).subscribe((([e,t,i])=>{if(this._params.sidelineHighlightCollectionGeometry.removeAllHighlights(),i)for(const t of e){const e=Hi(t);this._params.sidelineHighlightCollectionGeometry.addHighlight(e.highlightId,t.textRange,e)}for(const{item:e,overrides:i}of t){const t=Gi(e.contentId,e,i);this._params.sidelineHighlightCollectionGeometry.addHighlight(t.highlightId,e.notification.notificationElement.range,t)}}))),this._subs.add(ge.a([this._params.integration.vBarsLayoutInfo.scrollMirrorLayout.rect,this._params.integration.vBarsLayoutInfo.scrollMirrorLayout.textField.paddingRect.behavior,this._params.sidelineHighlightCollectionGeometry.geometry.view((e=>Array.from(e.values()))),this._params.paragraphCollectionService.editingParagraphIndex,this._params.integration.vBarsLayoutInfo.scrollMirrorLayout.textStartPosition,t]).pipe(x.U((([e,t,i,a,s,o])=>{const l=o?i.filter(((e,t)=>a!==t)).filter((({meta:e})=>"paragraph"===e.kind)).reduce(((i,a)=>{return(0,n.zG)((o={highlightId:a.meta.highlightId.toString(),highlightRects:a.rects,paragraphId:a.meta.paragraphId,paragraphSequentialId:a.meta.paragraphSequentialId,scrollMirrorRect:e,textFieldPosition:t.client,textStartPosition:s,getVBarHighlightRect:this._params.integration.getVBarHighlightRect},(0,n.zG)(r.ij((0,ei.jr)(o.highlightRects)),r.UI((e=>Xt.toVBarsField({rect:e,textFieldPosition:o.textFieldPosition,vBarsScrollMirrorFieldPosition:o.scrollMirrorRect}))),r.UI((e=>({kind:"paragraph",id:o.highlightId,paragraphId:o.paragraphId,sequentialId:o.paragraphSequentialId,rect:o.getVBarHighlightRect({vBarTextRectInMirror:e,scrollMirrorRectInViewport:o.scrollMirrorRect,textStartPositionInViewport:o.textStartPosition})}))))),r.g_((()=>(this._params.telemetry.warn({message:"Creating highlight for paragraph failed."}),this._logger.warn("Failed to create paragraph highlight from highlight geometry. Skipping.",a),i)),(e=>i.concat(e))));var o}),[]):[],d=(0,n.zG)(i.filter((({meta:e})=>"pushed_content"===e.kind)).reduce(((i,a)=>{return(0,n.zG)("superUnderline"===a.meta.notificationElementKind?function(e){const t=e.highlightRects[0];if(!t)return r.YP;const i=function(e){const t=e.underlineTextRectInMirror.width,i=e.underlineTextRectInMirror.height;let r=e.underlineTextRectInMirror.left;const n=e.scrollMirrorRectInViewport.width-t;return r>n&&(r=n),r<0&&(r=0),{top:e.underlineTextRectInMirror.top+i-2,left:r,width:t,height:3}}({underlineTextRectInMirror:Xt.toVBarsField({rect:t,textFieldPosition:e.textFieldPosition,vBarsScrollMirrorFieldPosition:e.scrollMirrorRect}),scrollMirrorRectInViewport:e.scrollMirrorRect,textStartPositionInViewport:e.textStartPosition,textEndPositionInViewport:e.textEndPosition}),n=(0,ei.jr)(e.highlightRects),a=n?Xt.toVBarsField({rect:n,textFieldPosition:e.textFieldPosition,vBarsScrollMirrorFieldPosition:e.scrollMirrorRect}):void 0;return r.G({kind:"pushed_content",id:e.highlightId,pushedContentId:e.pushedContentId,rect:i,sequentialId:e.pushedContentId,fullTextRect:a})}({highlightId:a.meta.highlightId.toString(),highlightRects:a.rects,pushedContentId:a.meta.pushedContentId,scrollMirrorRect:e,textFieldPosition:t.client,textStartPosition:s,textEndPosition:s+t.client.left}):(o={highlightId:a.meta.highlightId.toString(),highlightRects:a.rects,pushedContentId:a.meta.pushedContentId,scrollMirrorRect:e,textFieldPosition:t.client,textStartPosition:s,getVBarHighlightRect:this._params.integration.getVBarHighlightRect,overrides:a.meta.overrides},(0,n.zG)(r.ij((0,ei.jr)(o.highlightRects)),r.UI((e=>Xt.toVBarsField({rect:e,textFieldPosition:o.textFieldPosition,vBarsScrollMirrorFieldPosition:o.scrollMirrorRect}))),r.UI((e=>({kind:"pushed_content",id:o.highlightId,pushedContentId:o.pushedContentId,rect:o.getVBarHighlightRect({vBarTextRectInMirror:e,scrollMirrorRectInViewport:o.scrollMirrorRect,textStartPositionInViewport:o.textStartPosition}),sequentialId:o.pushedContentId,overrides:o.overrides}))))),r.g_((()=>(this._params.telemetry.warn({message:"Creating highlight for pushed content failed."}),this._logger.warn("Failed to create pushed content highlight from highlight geometry. Skipping.",a),i)),(e=>i.concat(e))));var o}),[]),(e=>function(e,t){const i=t.map((t=>({highlight:t,pushedContentItem:e.contentState.get()[t.pushedContentId]}))).filter((e=>void 0!==e.pushedContentItem)).sort(((e,t)=>e.pushedContentItem.notification.notificationElement.range.start-t.pushedContentItem.notification.notificationElement.range.start)).map((e=>({highlight:e.highlight,pushedContentId:e.highlight.pushedContentId,range:e.pushedContentItem.notification.notificationElement.range,notification:e.pushedContentItem.notification})));if(0===i.length)return[];const r=[i[0]];for(let e=1;e<i.length;++e){const t=r.pop(),n=i[e];J.SV.intersects(t.range,n.range)?r.push(Ni(t.notification,n.notification)?t:n):(r.push(t),r.push(n))}const n=new Set(r.map((e=>e.pushedContentId)));return t.filter((e=>n.has(e.pushedContentId)))}(this._params.pushedContentService,e)));return[...(e=>{if(e.length<2)return e;const t=e.sort(((e,t)=>ji(e)-ji(t))),i=[];let r=0,n=1,a=0;for(;r<e.length;){const e=t[r],s=t[n];void 0===s||ji(s)>=$i(e)?(0===a&&i.push(e),r=n,a=0):($i(s)<=$i(e)||(r=n),a++),n++}return i})(l.filter((({rect:e})=>void 0===d.find((({rect:t})=>Ai.UL.intersects(e,t)))))),...d]})),Me.b((e=>this._logger.debug("Sideline highlights updated.",e)))).subscribe(g.wW(this._sidelineHighlights))),this._subs.add(pe.T(this._params.integration.highlightsLayoutInfo.textFieldLayout.scroll.changes.pipe(G.h(r.YP)),this._params.integration.highlightsLayoutInfo.mouseData.pipe(Di.U(Li.S.hz30),K.skipBy(Ui.Z.eq),x.U((({client:e})=>qi(this._sidelineHighlights.get(),e,this._params.integration.highlightsLayoutInfo.textFieldLayout.rect.getApproximate().client,Oi.Ir.create(this._params.integration.vBarsLayoutInfo.scrollMirrorLayout.rect.get()),this._params.integration.highlightsLayoutInfo.textFieldLayout.scroll.getApproximate()))))).subscribe(g.wW(this._hoveredSidelineHighlight)))}dispose(){this._subs.unsubscribe()}}class Yi{constructor(e){this._params=e,this._subs=new o.w.Keeper,this._logger=(0,U.h)(Yi.name),this._servicesAndViewModels=s.h.create(r.YP),this._integration="googleDocs"===this._params.integrationInfo.kind?new Be({integrationInfo:this._params.integrationInfo,highlightsLayoutInfo:this._params.highlightsLayoutInfo,textObserver:this._params.textObserver,selectionSource:this._params.selectionSource,selectionOrCaretPosition:this._params.selectionOrCaretPosition,selectionService:this._params.selectionService,telemetryService:this._params.telemetryService}):new ue({integrationInfo:this._params.integrationInfo,highlightsLayoutInfo:this._params.highlightsLayoutInfo,selectionService:this._params.selectionService,telemetryService:this._params.telemetryService,selectionOrCaretPosition:this._params.selectionOrCaretPosition,textObserver:this._params.textObserver}),this._replacementService=this._params.replacementServiceInjector.create(L.P.g2),this._trackingService=new Wt({checkingService:this._params.checkingService,gnarClient:this._params.gnarClient,integrationInfo:this._integration.info,telemetryService:this._params.telemetryService}),this._inlineAlertsFilter=s.h.create(n.W8),this.integration=this._integration,this.inlineAlertsFilter=this._inlineAlertsFilter.view(),this._logger.debug("Initializing vBars.",{kind:this._integration.info.kind,domain:this._integration.info.domain,integrationName:this._integration.info.integrationName,..."googleDocs"===this._integration.info.kind?{integrationMode:this._integration.info.integrationMode.get()}:void 0}),this._trackingService.vBarsInitialized();const t=this._params.checkingService.pipe(l.oA,d.w((e=>e.readyState)),c.h((e=>e===M.kQ.firstTextCheckCompleted)),u.q(1));this._subs.push(t.pipe(d.w((()=>this._integration.isEnabled.pipe(h.x())))).subscribe((e=>{e?(this._logger.debug("G2 integration enabled, initializing services and VMs."),this._init()):(this._logger.debug("G2 integration disabled, disposing services and VMs."),this._disposeServicesAndViewModels())}))),this._subs.push(this._servicesAndViewModels.pipe(d.w(r.g_((()=>this._params.alertClassification.visibleInlineAlertsFilter),(e=>e.alertCollectionService.inlineAlertsFilter)))).subscribe(g.wW(this._inlineAlertsFilter)))}_init(){var e,t,i;const a=new Dt({checkingService:this._params.checkingService,textChangeBuffer:this._params.textChangeBuffer,telemetryService:this._params.telemetryService,integration:this._integration,dynamicConfig:this._params.dynamicConfig,trackingService:this._trackingService}),o=new et({user:this._params.user,csPageState:this._params.csPageState,csToBgActions:this._params.csToBgActions,telemetryService:this._params.telemetryService,trackingService:this._trackingService}),l=(0,v.e$)()?new y({currentUser:this._params.user,csPageState:this._params.csPageState,csToBgActions:this._params.csToBgActions,hasGeneralOnboardingBeenSeen:!o.shouldShowTooltip.get()}):new k,d=new rt({textObserver:this._params.textObserver,integration:this._integration}),c=new Re({alertClassification:this._params.alertClassification}),u=new Ye({user:this._params.user,csPageState:this._params.csPageState,csToBgActions:this._params.csToBgActions,uphookHubActions:this._params.uphookHubActions,telemetry:this._params.telemetryService,checkingService:this._params.checkingService,capiStartAckMessage:this._params.capiStartAckMessage,experimentClient:(0,F.OB)().experimentClient,pushedContentService:this._params.pushedContentService,trackingService:this._trackingService}),g=this._params.pushedContentService,p=new Yt({checkingService:this._params.checkingService,telemetryService:this._params.telemetryService}),f=new D.C(this._integration.highlightsLayoutInfo.geometryProvider,this._integration.highlightsLayoutInfo.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,this._integration.highlightGeometryInvalidator,!0,void 0,void 0,void 0,void 0),S=new Wi({pushedContentFilters:s.h.combine(this._params.pushedContentFilters,this._params.availabilityService.enabled.view((0,r.g_)(n.jv,(e=>e.pushedContentSidelines))),((e,t)=>t?e:new Map)),pushedContentVBarOverrides:this._params.pushedContentVBarOverrides,paragraphCollectionService:d,sidelineHighlightCollectionGeometry:f,pushedContentService:g,integration:this._integration,telemetry:this._params.telemetryService,withParagraphHighlights:this._params.availabilityService.enabled.view((0,r.g_)(n.jv,(e=>e.idleSidelines)))}),b=new D.C(this._integration.highlightsLayoutInfo.geometryProvider,this._integration.highlightsLayoutInfo.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,this._integration.highlightGeometryInvalidator,!0,void 0,void 0,void 0,void 0,(0,U.h)("SelectionHighlightGeometry")),C=new ti({selectionHighlightGeometry:b,sidelineHighlightCollectionViewModel:S,textObserver:this._params.textObserver,integration:this._integration}),_=new Fi({paragraphCollectionService:d,pushedContentService:g,sidelineHighlightCollectionViewModel:S,textObserver:this._params.textObserver,selectionHighlightViewModel:C,legacyAssistantOpenState:this._params.legacyAssistantOpenState,assistantState:this._params.assistantState,telemetryService:this._params.telemetryService,trackingService:this._trackingService,onboardingService:o,availabilityService:this._params.availabilityService,integration:this._integration,user:this._params.user,keyboardShortcutsSetting:this._params.csPageState.view("keyboardShortcuts"),onPinnedSidelineClearedByScroll:()=>{this._logger.trace("Deactivating auto-focus behavior (from onPinnedSidelineClearedByScroll)."),z.deactivate()}}),B=new Zt({trackingService:this._trackingService,telemetryService:this._params.telemetryService,integrationInfo:this._integration.info}),x=(0,v.iT)()?new I({i18nApi:(0,F.OB)().browserApi.i18n,sidelineCollectionViewModel:_,currentUser:this._params.user,csPageState:this._params.csPageState,csToBgActions:this._params.csToBgActions}):new T,E=new w,R=(0,v.e$)()?new Je({user:this._params.user,csPageState:this._params.csPageState,csToBgActions:this._params.csToBgActions,shouldTranslateOnboardingBeShown:l.shouldOnboardingBeShown,shouldInitialOnboardingBeShown:o.shouldShowTooltip}):new Qe;E.registerBannerService(R);const P=new Ee({shouldTranslateOnboardingBeShown:l.shouldOnboardingBeShown,shouldInitialOnboardingBeShown:o.shouldShowTooltip});E.registerBannerService(P);const M=new A.R({checkingService:this._params.checkingService,agentId:"promptEnhancement"}),L=new _i({rewriteService:a,sidelineCollectionViewModel:_,feedbackFormViewModel:B,performReplacement:(e,t)=>this._replacementService.performReplacement(e,t),telemetryService:this._params.telemetryService,integrationInfo:this._integration.info,trackingService:this._trackingService,alertCollectionService:c,monetizationService:u,trustedRewriteService:p,onboardingService:o,availabilityService:this._params.availabilityService,pushedContentService:g,translationService:x,aiEditorPromotionService:P,integration:this._integration,promptEnhancerAgentService:M}),z=new Ae({sidelines:_.sidelines.view((e=>e.filter((e=>"pushed_content"===e.kind)))),pinSideline:e=>_.pinSideline(e),experimentClient:(0,F.OB)().experimentClient,textFieldLayout:this._params.highlightsLayoutInfo.textFieldLayout,afterScrollCardPinTimeoutMs:null!==(t=null===(e=this._params.dynamicConfig.get().vBars)||void 0===e?void 0:e.afterScrollCardPinTimeoutMs)&&void 0!==t?t:200,scrollEventTargets:[self,null===(i=this._integration.additionalGlobalEventSource)||void 0===i?void 0:i.scroll].filter((e=>!!e)),isAutoFocusAllowed:_.selectionSideline.view(r.Wi)});this._subs.push(L.addEventListener("sidelineCardUnpinned",(()=>{this._logger.trace("Deactivating auto-focus behavior (from sidelineCardUnpinned)."),z.deactivate()}))),this._subs.push(this._params.autofocusNextVBar.subscribe((e=>{this._logger.trace("Setting auto-focus behavior (from autofocusNextVBar)",{enabled:e}),e?z.activate():z.deactivate()}))),this._subs.push(_.streamingStatus.pipe(h.x(),m.G()).subscribe((([e,t])=>{const i="streaming"===e,r="streaming"===t,{isVBarsRedesignEnabled:n}=(0,O.Z)();n?r?z.deactivate():i&&z.activate():r&&z.activate()}))),this._servicesAndViewModels.set(r.G({rewriteService:a,paragraphCollectionService:d,alertCollectionService:c,monetizationService:u,pushedContentService:g,onboardingService:o,multilingualOnboardingService:R,aiEditorPromotionService:P,translateOnboardingService:l,paragraphHighlightCollectionGeometry:f,sidelineHighlightCollectionViewModel:S,selectionHighlightGeometry:b,selectionHighlightViewModel:C,sidelineCollectionViewModel:_,autoFocusService:z,feedbackFormViewModel:B,sidelineCardViewModel:L,translationService:x,genericBannerService:E}))}_disposeServicesAndViewModels(){this._trackingService.dispose(),(0,n.zG)(this._servicesAndViewModels.get(),p.bw((e=>{e.rewriteService.dispose(),e.paragraphCollectionService.dispose(),e.alertCollectionService.dispose(),e.paragraphHighlightCollectionGeometry.dispose(),e.sidelineHighlightCollectionViewModel.dispose(),e.selectionHighlightGeometry.dispose(),e.selectionHighlightViewModel.dispose(),e.sidelineCollectionViewModel.dispose(),e.autoFocusService.dispose(),e.sidelineCardViewModel.dispose(),e.monetizationService.dispose(),e.pushedContentService.dispose(),e.translationService.dispose(),e.genericBannerService.dispose()}))),this._servicesAndViewModels.set(r.YP)}setStreamingStatus(e){this._logger.trace("Setting vBars streaming status",{status:e}),(0,n.zG)(this._servicesAndViewModels.get(),r.UI((({sidelineCollectionViewModel:t})=>t.setStreamingStatus(e))))}get vBarsUI(){const e="googleDocs"===this._params.integrationInfo.kind;return this._servicesAndViewModels.view(r.UI((({sidelineCollectionViewModel:t,onboardingService:i})=>a.createElement(a.Suspense,{fallback:a.createElement(a.Fragment,null)},a.createElement(Qt,{sidelines:t.sidelines,pinnedSideline:t.pinnedSideline,activeSideline:t.activeSideline,emphasizedSideline:t.emphasizedSideline,shouldHideSidelines:t.shouldHideSidelines,selectionSideline:t.selectionSideline,pulsatingOnboardingInfo:i.shouldShowPulsating,shouldShowSelectionHighlight:!e,shouldSubdueVBars:t.isSubdued,vBarMousePositions:t.vBarMousePositions,onPinSideline:e=>t.pinSideline(e),onActivateSideline:(e,i)=>t.activateSideline(e,i),onDeactivateSideline:e=>t.deactivateSideline(e),onMountSideline:e=>t.notifySidelineMounted(e),onShowSideline:e=>t.notifySidelineShown(e),onHideSideline:e=>t.notifySidelineHidden(e),onPulseSideline:e=>t.notifySidelinePulsed(e),onSidelineRefChange:(e,i)=>t.notifySidelineRefChanged(e,i),setVBarMousePosition:(e,i)=>t.setVBarMousePosition(e,i),streamingStatus:t.streamingStatus})))))}get vBarCardUI(){return this._servicesAndViewModels.view(r.UI((({sidelineCardViewModel:e,monetizationService:t,onboardingService:i,multilingualOnboardingService:r,aiEditorPromotionService:n,translateOnboardingService:s})=>a.createElement(a.Fragment,null,a.createElement(a.Suspense,{fallback:a.createElement(a.Fragment,null)},a.createElement(P.U8.Provider,{value:{hasSpecialOffer:this._params.hasInProductDiscountSpecialOffer}},a.createElement(Jt,{agentDirectoryService:this._params.agentDirectoryService,sidelineCard:e.sidelineCard,pushedContentCardOverrides:this._params.pushedContentVBarCardOverrides,vBarsQuotaInfo:t.vBarsQuotaInfo,vBarsUphookConfigs:t.vBarsUphookConfigs,onboardingService:i,multilingualOnboardingService:r,aiEditorPromotionService:n,translateOnboardingService:s,getSidelineCardState:t=>e.getSidelineCardState(t),onActivateSidelineCard:(t,i)=>e.activateSidelineCard(t,i),onDeactivateSidelineCard:(t,i)=>e.deactivateSidelineCard(t,i),onChangeSelectedRewriteTab:(t,i)=>e.notifySelectedRewriteTabChanged(t,i),onMountRewriteLoading:(t,i)=>e.notifyRewriteLoadingShown(t,i),onMountRewriteEmpty:(t,i)=>e.notifyRewriteEmptyShown(t,i),onMountRewriteReady:(t,i,r)=>e.notifyRewriteReadyShown(t,i,r),onMountRewriteError:(t,i)=>e.notifyRewriteErrorShown(t,i),onApplyRewrite:(t,i)=>e.applyRewrite(t,i),onCopyRewrite:(t,i)=>e.copyRewrite(t,i),onRevertRewrite:(t,i)=>e.notifyRewriteReverted(t,i),onDismissRewrite:(t,i)=>e.dismissRewrite(t,i),onRegenerateRewrite:(t,i)=>e.regenerateRewrite(t,i),onChangeCustomPrompt:(t,i)=>e.notifyCustomPromptChanged(t,i),onSubmitCustomPrompt:(t,i)=>e.submitCustomPrompt(t,i),onClickMoreTab:t=>e.notifyMoreTabClicked(t),onShow:(t,i)=>e.notifySidelineCardShown(t,i),onClose:t=>e.notifySidelineCardClosed(t),onDismiss:t=>e.notifyDismissButtonClicked(t),onDisable:t=>e.notifyDisableButtonClicked(t),onClickFeedbackButton:(t,i)=>e.notifyFeedbackButtonClicked(t,i),onTranslationTargetLanguageChange:(t,i,r)=>e.notifyTranslationTargetLanguageChanged(t,i,r),onShowUphookButton:(t,i)=>e.notifyUphookButtonShown(t,i,this._params.hasInProductDiscountSpecialOffer),onClickUphookButton:(t,i)=>e.notifyUphookButtonClicked(t,i,this._params.hasInProductDiscountSpecialOffer),onStreamingStart:(t,i)=>e.notifyRewriteStreamingStart(t,i),onDeactivateSidelineType:(t,i,r)=>e.deactivateSidelineType(t,i,r),onCtaClick:(t,i)=>{e.notifyCtaClicked(t,i)},onPushedContentAction:(t,i)=>{e.onPushedContentAction(t,i)},onPushedContentCommentCardDismiss:t=>e.onPushedContentCommentCardDismiss(t),onPushedContentCommentCardCopy:(t,i)=>e.onPushedContentCommentCardCopy(t,i),onPushedContentCommentCardMarkResolved:t=>e.onPushedContentCommentCardMarkResolved(t),onPushedContentCommentCardGenerateCitationClicked:t=>e.onPushedContentCommentCardGenerateCitationClicked(t),integration:this._integration}))),a.createElement("div",{id:xe.wE,style:{position:"fixed",pointerEvents:"none"}})))))}get vBarsFeedbackFormUI(){return this._servicesAndViewModels.view(r.UI((({feedbackFormViewModel:e})=>a.createElement(a.Suspense,{fallback:a.createElement(a.Fragment,null)},a.createElement(Kt,{feedbackFormContext:e.feedbackFormContext,onSubmit:(t,i)=>e.submitFeedbackForm(t,i),onClose:()=>e.closeFeedbackForm()})))))}dispose(){this._disposeServicesAndViewModels(),this._integration.dispose(),this._subs.dispose()}}},69:(e,t,i)=>{i.r(t),i.d(t,{injectUI:()=>T});var r=i(92379),n=i(33885),a=i(59179),s=i(58303),o=i(15083),l=i(29999),d=i(9542),c=i(1182),u=i(90189),h=i(83507),g=i(27327),m=i(4636),p=i(90595),v=i(43912),f=i(29483);const S=({children:e})=>{const t=function(){const[e,t]=(0,r.useState)("auto");return(0,r.useEffect)((()=>{const e=new v.h((0,f.OB)().browserApi.preferences).view((e=>{var t,i;return null!==(i=null===(t=e.extensionSettings)||void 0===t?void 0:t.common.colorScheme)&&void 0!==i?i:"auto"})).subscribe((e=>{t(e)}));return()=>{e.unsubscribe()}}),[]),e}(),i=(0,u.OB)().experimentClient.isGateEnabled(p.K.VBarsDarkMode)?t:void 0;return r.createElement(g.o,{style:{display:"contents"}},r.createElement(c.w,{dataGdsTheme:i,display:"contents"},r.createElement(m.p,null,r.createElement(h.L,{chunkNameList:["g2","g2External","assistantUiKit"]},e))))};const w={zIndex:i(99402).op-1,position:"absolute",top:0,left:0,width:"100%",pointerEvents:"all"};var b=i(30105);var C=i(85837),_=i(84308),y=i(91038),k=i(35975);function B(e){return{boxSizing:"content-box",position:"relative",pointerEvents:"none",overflow:"hidden",border:0,borderRadius:0,padding:0,margin:0,...e}}const x=e=>e.layout.scrollables.reduce(((t,i,s,o)=>r.createElement(n.F.div,{"data-testid":`grammarly-vbars-scroll-mirror-${s}`,style:i.borderRect.behavior.pipe(a.U((t=>B(s===o.length-1?{...e.layout.adjustSizeBeforeRendering(t.size),...e.layout.adjustOffsetBeforeRendering({top:t.offset.top,left:t.offset.left}),...null===y.o||void 0===y.o?void 0:y.o.getDebugMirrorStyles()}:{top:t.offset.top,left:0,width:"100%",height:t.size.height})))),mount:(0,C.y2)({scrollTop:i.scroll.behavior.pipe(a.U((e=>e.top))),scrollLeft:i.scroll.behavior.pipe(a.U((e=>e.left)))})},t,r.createElement(n.F.div,{style:i.scrollSize.behavior.pipe(a.U((e=>({boxSizing:"content-box",left:0,width:"100%",height:e.height,pointerEvents:"none",visibility:"hidden"}))))}))),r.createElement(E,{layout:e.layout},e.children)),E=e=>{const t=(0,k.M)({scrollTop:_.a([e.layout.textField.scroll.behavior,e.layout.textField.scrollSize.behavior]).pipe(a.U((([e,t])=>e.top))),scrollLeft:_.a([e.layout.textField.scroll.behavior,e.layout.textField.scrollSize.behavior]).pipe(a.U((([e,t])=>e.left)))});return r.createElement(n.F.div,{"data-testid":"grammarly-vbars-field-mirror",style:_.a([e.layout.textField.transform.behavior,e.layout.textField.paddingRect.behavior]).pipe(a.U((([t,i])=>B({...0===e.layout.scrollables.length?{...e.layout.adjustSizeBeforeRendering(i.size),...e.layout.adjustOffsetBeforeRendering({top:i.offset.top,left:i.offset.left})}:{top:i.offset.top,left:0,width:"100%",height:i.size.height},...t})))),mount:e=>t(e)},e.children)};var R=i(85807);var I=i(62810);function T(e){const{integration:t,vBarsUI:i,vBarCardUI:c,vBarsFeedbackFormUI:u,eventPropagationHandler:h}=e,g=(e=>{const t={position:"absolute",top:0,left:0,pointerEvents:"none",maxWidth:"100vw",...e.integration.vBarsLayoutInfo.scrollMirrorContainerStyleOverrides};return d.V.get({monitorAs:R.C}).inject(l.EM.fromDocument(document,R.A),(t=>{t.style.display="contents",e.integration.vBarsLayoutInfo.injectionPlace.appendChild(t)}),(i=>o.G7.showWhenLoaded(r.createElement(S,null,r.createElement(n.F.Fragment,null,e.vBarsUI.pipe(a.U(s.g_((()=>null),(i=>r.createElement("div",{"data-testid":"grammarly-vbars-scroll-mirror-container",style:t},r.createElement(x,{layout:e.integration.vBarsLayoutInfo.scrollMirrorLayout},r.createElement(n.F.div,{style:e.integration.vBarsLayoutInfo.scrollMirrorLayout.textField.scrollSize.behavior.pipe(a.U((e=>({width:0,height:e.height,pointerEvents:"all"}))))},i))))))))))(i)),{eventPropagationHandler:e.eventPropagationHandler})})({integration:t,vBarsUI:i,eventPropagationHandler:h}),m=(e=>d.V.get({monitorAs:b.Vt}).inject(l.EM.fromDocument(document,b.Hq),l.zs.appendChild(e.textFieldElement.ownerDocument.documentElement),(t=>o.G7.showWhenLoaded(r.createElement(S,null,r.createElement(n.F.Fragment,null,e.vBarCardUI.pipe(a.U(s.g_((()=>null),(e=>r.createElement("div",{style:w},e))))))))(t)),{eventPropagationHandler:e.eventPropagationHandler,vBarsCustomAttributes:e.domain.includes("atlassian.net")?{"data-no-focus-lock":"true"}:void 0}))({textFieldElement:t.highlightsLayoutInfo.textFieldElement,vBarCardUI:c,eventPropagationHandler:h,domain:e.domain}),p=(e=>d.V.get({monitorAs:I.h}).inject(l.EM.fromDocument(document,I.Z),l.zs.appendChild(e.textFieldElement.ownerDocument.documentElement),o.G7.showWhenLoaded(r.createElement(S,null,r.createElement(n.F.Fragment,null,e.vBarsFeedbackFormUI.pipe(a.U(s.g_((()=>null),(e=>r.createElement("div",{style:w},e)))))))),{eventPropagationHandler:e.eventPropagationHandler}))({textFieldElement:t.highlightsLayoutInfo.textFieldElement,vBarsFeedbackFormUI:u,eventPropagationHandler:h});return{dispose(){g.dispose(),m.dispose(),p.dispose()}}}},85807:(e,t,i)=>{i.d(t,{A:()=>n,C:()=>r});const r="vBars",n="grammarly-extension-vBars"},62810:(e,t,i)=>{i.d(t,{Z:()=>n,h:()=>r});const r="vBarsFeedbackForm",n="grammarly-extension-vBars-feedback-form"},91038:(e,t,i)=>{i.d(t,{o:()=>s});const r=()=>[void 0,void 0],[n,a]=r();const s=a},22586:(e,t,i)=>{i.d(t,{$U:()=>l,F6:()=>c,I:()=>o,MQ:()=>d,PD:()=>a,Qj:()=>s,R:()=>n});var r=i(56567);const n=e=>"test"===e.peekTreatment(r.p.VBarsCopyRotationText),a=e=>"test"===e.peekTreatment(r.p.VBarsSampleCounterRemoval);function s(e,t){return 0===e.quota&&!e.usedVBarsTextHashList.includes(t)}const o=e=>"test"===e.peekTreatment(r.p.VBarsUphookButtonInTitle),l=e=>"test"===e.peekTreatment(r.p.VBarsUphookHub),d=e=>"test"===e.peekTreatment(r.p.VBarsShimmerOnOpen),c=e=>"test"===e.peekTreatment(r.p.VBarsShimmerAfterLoad)},6003:(e,t,i)=>{i.d(t,{KT:()=>u,My:()=>c,V7:()=>o,e6:()=>l,pE:()=>d});var r=i(90023),n=i(58303),a=i(90189),s=i(22586);function o(e){return"selection"===e?"vBarSelection":"vBarIdle"}const l=(e,t)=>`vbar-${"pushed_content"===e.kind?e.pushedContentVBarType:e.kind}-${t.kind}`,d=e=>e?"discountPro":"pro",c=(e,t,i)=>{var l;if(i)return n.G({uphookContent:{},uphookMetaData:{...i}});if(!(0,s.$U)((0,a.OB)().experimentClient))return n.YP;const d=o(e);return(0,r.zG)(null!==(l=null==t?void 0:t.get())&&void 0!==l?l:n.YP,n.tS((e=>n.ij(e[d]))))},u=e=>(0,r.zG)(e,n.tS((e=>n.ij(e.uphookContent.title))),n.FS)},22110:(e,t,i)=>{var r;i.d(t,{X:()=>r,_:()=>n}),function(e){e.accept="accept",e.rewriteOptions="rewriteOptions",e.customPrompt="customPrompt",e.revert="revert"}(r||(r={}));const n=new Set(Object.values(r))},27929:(e,t,i)=>{i.r(t),i.d(t,{EmptyPushedContentServiceImpl:()=>O,G2PushedContentServiceImpl:()=>A,isLockedPushedContentItem:()=>L});var r=i(8351),n=i(90023),a=i(9141),s=i(96333),o=i(9868),l=i(68020),d=i(13391),c=i(42203),u=i(88012),h=i(74822),g=i(59179),m=i(90572),p=i(64271),v=i(31603),f=i(99887),S=i(24666),w=i(8794),b=i(36344),C=i(32486),_=i(48886),y=i(58303),k=i(10444),B=i(67177),x=i(43789),E=i(40594),R=i(31272),I=i(6824),T=i(36661),P=i(3244);const F=T.n(I.Schemable)(P.T0).is,M=T.n(I.Schemable)(P.D).is,D=T.n(I.Schemable)(P.JC).is;function L(e){return"lockedRewriteCard"===e.surface.kind||"lockedComment"===e.surface.kind}class A{constructor(e){this._params=e,this._logger=E.Y.create("G2PushedContentServiceImpl"),this._subs=new u.w.Keeper,this._disposed=new h.x,this._positionManager=new l.Xr,this._mapItemsToContentEntries=e=>Object.fromEntries(e.map((e=>[e.contentId,{notification:e.notification,surface:e.surface,contentId:e.contentId,originalPushedContentMessage:e}]))),this._updateContentState=e=>(0,n.zG)(e,s.$.createDiff,C.T.recover((e=>this._logger.error("conflicts on diff creating",e))),s.$.applyDiff,_.UI(C.T.recover((e=>this._logger.error("conflicts on diff apply",e)))),(e=>this.contentState.modify((t=>{const i=(0,n.zG)(t,Object.values,(e=>e.map((e=>e.originalPushedContentMessage))),s.$.from),r=e(i);return(0,n.zG)(r,s.$.values,this._mapItemsToContentEntries)})))),this.settingsState=d.h.create(y.YP),this.contentState=d.h.create({}),this._collectionState=this.contentState.view((0,n.ls)((0,r.KM)(a.Df)(((e,t)=>t)),(e=>e.map((e=>e.originalPushedContentMessage))),s.$.from)),this._telemetry=e.telemetryLogger;const t=this._params.capiStartAckMessage.pipe(g.U((0,n.ls)(y.UI((e=>{var t;return null===(t=e.serverConfigs)||void 0===t?void 0:t.PUSHED_CONTENT})),y.tS(y.ij))),m.h(y.pC),g.U(k.MH));this._pushedContentRangeManager=o.N.create(this._positionManager);const i=this._params.textObserver.getCurrentTextMap().getPlainText();this._positionManager.pushChanges(x.RI.resFromText(i)),this._subs.push(this._params.textObserver.contentChanges.async.subscribe((({deltaChange:e})=>{this._positionManager.pushChanges(e)}))),this._subs.push(this._pushedContentRangeManager.getDiff(this._collectionState).subscribe((({diffInput:e})=>{this._updateContentState(e)}))),this._subs.push(p.T([t,this._params.checkingService.pipe(m.h(y.pC),g.U((e=>e.value.capiMessages)),v.J(),m.h(M))]).pipe(v.J()).subscribe((e=>{this.settingsState.set(y.G(e))})),this._params.checkingService.pipe(m.h(y.pC),g.U((e=>e.value.capiMessages)),v.J(),m.h((0,c.Kg)(F,D))).subscribe(this._handlePushedContentMessage.bind(this)),this._listenForReconnect())}_listenForReconnect(){return this._params.capiStartAckMessage.pipe(f.oA,g.U((e=>e.sessionUuid)),S.x(),w.T(1)).subscribe((()=>{this._logger.info("Session started after disconnect, clearing pushed content items"),this.clear()}))}_handlePushedContentMessage(e){var t;switch(e.action){case"pushed_content:pushedContent":let i=!0;if("vBar"===e.notification.notificationElement.kind){const t=e.notification.notificationElement.range,r=this._positionManager.findById(e.contentId);i=this._params.textRangeFilterForVBars({textRange:t,fullText:this._params.textObserver.getCurrentTextMap().getPlainText()}),y.pC(r)?r.value.start===t.start&&r.value.end===t.end||(this._positionManager.deregisterRange(e.contentId),i&&this._positionManager.registerRange(e.contentId,{start:t.start,end:t.end,meta:{id:e.contentId}})):i&&this._positionManager.registerRange(e.contentId,{start:t.start,end:t.end,meta:{id:e.contentId}})}i&&this.contentState.modify((t=>({...t,[e.contentId]:{notification:e.notification,surface:e.surface,contentId:e.contentId,originalPushedContentMessage:e}})));break;case"pushed_content:removeContent":try{this._positionManager.deregisterRange(e.contentId)}catch(i){null===(t=this._telemetry)||void 0===t||t.warn({message:"Failed to deregister range for contentId",data:{contentId:e.contentId},error:i}),this._logger.warn("Failed to deregister range for contentId",{contentId:e.contentId,error:String(i)})}this.contentState.modify((t=>Object.fromEntries(Object.entries(t).filter((([t])=>t!==e.contentId)))))}}_sendPushedContentMessage(e){return(0,n.zG)(this._params.checkingService.get(),B.Yo((()=>"Checking service not available.")),B.tS((t=>t.sendMessage(e.action,e,!1))))().then((()=>{})).catch((e=>{this._logger.error("Could not send Pushed Content message.",e)}))}dismiss(e){this._sendDismissContentMessage(e),this.removePushedContentItemLocally(e)}markResolved(e){this._sendDismissContentMessage(e),this.removePushedContentItemLocally(e)}clear(e){return this._logger.debug("Clearing pushed content items",{predicate:e}),e?this.contentState.modify((t=>Object.fromEntries(Object.entries(t).filter((([t,{originalPushedContentMessage:i}])=>!e(i)))))):this.contentState.set({})}rebaseItems(e,t){return b.E}getCollection(e,t){return d.h.combine(this._collectionState,null!=t?t:d.h.create(!0),((t,i)=>i?s.$.filter(e)(t):s.$.empty))}_sendDismissContentMessage(e){return this._sendPushedContentMessage({action:"pushed_content:dismissContent",contentId:e})}sendExecuteActionMessage(e,t,i){return this._sendPushedContentMessage({action:"pushed_content:executeAction",contentId:e,clientContext:t,request:i}).catch((t=>{var r;throw null===(r=this._telemetry)||void 0===r||r.error({message:"Pushed content execute action error",data:{contentId:e,actionType:i.type},error:t}),t}))}sendGetSettingsMessage(e){return this._sendPushedContentMessage({action:"pushed_content:getSettings",contentId:e})}sendUpdateSettingsMessage(e,t){return this._sendPushedContentMessage({action:"pushed_content:updateSettings",contentId:e,extraSettings:t.extraSettings,defaultAction:t.defaultAction,expandedTabs:t.expandedTabs})}removePushedContentItemLocally(e){this.contentState.modify((t=>(0,R.hX)((t=>t!==e),t)))}dispose(){this._subs.dispose(),this._disposed.next(void 0)}}class O{constructor(){this.settingsState=d.h.create(y.YP),this.contentState=d.h.create({})}dismiss(e){}markResolved(e){}clear(e){}rebaseItems(e,t){return b.E}getCollection(e,t){return d.h.create(s.$.empty)}sendExecuteActionMessage(){return Promise.resolve()}sendGetSettingsMessage(){return Promise.resolve()}sendUpdateSettingsMessage(){return Promise.resolve()}removePushedContentItemLocally(e){}unlock(e){}dispose(){}}},9699:(e,t,i)=>{i.d(t,{G:()=>n});var r=i(972);function n(e){let t="";return e.forEach((([e,i])=>{switch(e){case r.FS.Operation.RETAIN:t+=i+", ";break;case r.FS.Operation.INSERT:" "===i?t+="insert, space, ":(t+="insert, ",t+=a(i),t+=", ");break;case r.FS.Operation.DELETE:" "===i?t+="delete, space, ":(t+="delete, ",t+=a(i),t+=", ")}})),t}function a(e){return e.replace(/\n/gm," line break ").replace(//gm," paragraph ").replace(//gm," bullet point ").replace(/,/gm," comma ").replace(/\./gm," period ").replace(/\(/gm," open parenthesis ").replace(/\)/gm," closed parenthesis ").replace(/-/gm," hyphen ").replace(//gm," en dash ").replace(//gm," em dash ").replace(/:/gm," colon ").replace(/;/gm," semicolon ").replace(/!/gm," exclamation mark ").replace(/\?/gm," question mark ").replace(//gm," ellipsis ").replace(/\*/gm," asterisk ").replace(/'/gm," apostrophe ").replace(/`/gm," grave accent ").replace(/"/gm," quotation mark ").replace(/"/gm," quotation mark ").replace(/'/gm," quotation mark ").replace(/'/gm," quotation mark ")}},70558:(e,t,i)=>{var r,n,a,s;i.d(t,{NK:()=>h,Oy:()=>g,es:()=>o,z7:()=>u}),function(e){e.is=function(e){return"improve"===e.kind}}(r||(r={})),function(e){e.is=function(e){return"rephrase"===e.kind}}(n||(n={})),function(e){e.is=function(e){return"customPrompt"===e.kind}}(a||(a={})),function(e){e.is=function(e){return"other"===e.kind}}(s||(s={}));const o=r.is;n.is,a.is,s.is;var l,d,c;!function(e){e.is=function(e){return"loading"===e.kind}}(l||(l={})),function(e){e.is=function(e){return"ready"===e.kind}}(d||(d={})),function(e){e.is=function(e){return"error"===e.kind}}(c||(c={}));const u=l.is,h=d.is,g=c.is},98587:(e,t,i)=>{i.d(t,{Ro:()=>o,T0:()=>a,jk:()=>n,xw:()=>s,yI:()=>r});const r="und";var n;function a(e,t){const i=e=>e.split("-")[0].toLowerCase();return i(e)===i(t)}!function(e){e.undetermined={sourceLanguageTag:r,targetLanguageTag:r},e.equals=function(e){return t=>t.sourceLanguageTag===e.sourceLanguageTag&&t.targetLanguageTag===e.targetLanguageTag}}(n||(n={}));const s={"zh-Hans":"Chinese (Simplified)",nl:"Dutch","en-US":"English (American)","en-GB":"English (British)",fr:"French",de:"German",id:"Indonesian",it:"Italian",ja:"Japanese",ko:"Korean",pl:"Polish","pt-BR":"Portuguese (Brazil)","pt-PT":"Portuguese (Portugal)","es-AR":"Spanish (Argentina)","es-MX":"Spanish (Mexico)","es-ES":"Spanish (Spain)",sv:"Swedish",tr:"Turkish",uk:"Ukrainian"};var o;!function(e){e.findMatch=function(e){let t;const i=Object.keys(s);for(const r of i){if(r.toLowerCase()===e.toLowerCase())return r;!t&&a(r,e)&&(t=r)}return t}}(o||(o={}))},46651:(e,t,i)=>{i.d(t,{a7:()=>c,kZ:()=>d,uz:()=>u});var r=i(90023),n=i(92379),a=i(84308),s=i(22110);const o=n.createContext({shouldShowTooltip:!1,sideline:null,currentStep:s.X.accept,acceptCount:0,rootElement:null,incrementAcceptCount:r.Q1,incrementRevertPresentedCount:r.Q1,onNextStep:r.Q1,onHide:r.Q1}),l={accept:{tooltipText:"Accept all changes to your paragraph",ctaText:"Next"},rewriteOptions:{tooltipText:"Try different ways to write it",ctaText:"Next"},customPrompt:{tooltipText:"Tell us how to change it",ctaText:"Try it"}};function d({onboardingService:e,children:t,rootElement:i,sideline:r}){const[s,l]=n.useState({shouldShowTooltip:e.shouldShowTooltip.get(),sideline:r,currentStep:e.currentStep.get(),acceptCount:e.acceptCount.get(),rootElement:i,incrementAcceptCount:()=>e.incrementAcceptCount(),incrementRevertPresentedCount:()=>e.incrementRevertPresentedCount(),onNextStep:t=>e.onNextStep(t),onHide:t=>e.onHide(t)});return n.useEffect((()=>{l((e=>({...e,rootElement:i})))}),[i]),n.useEffect((()=>{l((e=>({...e,sideline:r})))}),[r]),n.useEffect((()=>{const t=(0,a.a)([e.shouldShowTooltip,e.currentStep,e.acceptCount]).subscribe((([e,t,i])=>l((r=>({...r,shouldShowTooltip:e,currentStep:t,acceptCount:i})))));return()=>t.unsubscribe()}),[e]),n.createElement(o.Provider,{value:s},t)}function c(e){const{currentStep:t,shouldShowTooltip:i,sideline:r,rootElement:a,incrementAcceptCount:s,onNextStep:d,onHide:c}=n.useContext(o),{tooltipText:u,ctaText:h}=l[e];return{ctaText:h,rootElement:a,showTooltip:i&&t===e,tooltipText:u,incrementAcceptCount:s,onNextStep:()=>d(r),onHide:()=>c(r)}}function u(){const{currentStep:e,shouldShowTooltip:t,incrementRevertPresentedCount:i}=n.useContext(o);return{showOnboarding:t&&e===s.X.revert,onShow:()=>i()}}},76609:(e,t,i)=>{i.d(t,{q:()=>n});var r=i(92379);const n=({as:e="div",className:t,show:i,transitionDurationMs:n=250,display:a="inline-block",ariaHidden:s,children:o})=>{const[l,d]=r.useState(!1),[c,u]=r.useState(!1);r.useEffect((()=>{let e;d(!0),i||(e=self.setTimeout((()=>d(!1)),n)),u(!i);const t=self.setTimeout((()=>u(i)),0);return()=>[e,t].forEach(clearTimeout)}),[i]);const h={display:a,opacity:c?1:0,transition:`opacity ${n}ms`},g=e;return l&&o?r.createElement(g,{className:t,style:h,"data-testid":"grammarly-g2-fade-wrapper","aria-hidden":s},o):null}},75096:(e,t,i)=>{i.r(t),i.d(t,{SuperUnderline:()=>a});var r=i(92379),n=i(70938);const a=r.forwardRef((function({emphasized:e,widthInPixels:t,heightInPixels:i,underlineColor:a,onClick:s,onMouseEnter:o,onMouseLeave:l,onFocus:d,onBlur:c,dataTestId:u},h){const[g,m]=r.useState(!0),p=Math.max(.5*t,40),v=Math.min(i,4),f=p+2+(3*v+4),S=Math.min(i,3),w=()=>null;return r.createElement("div",{role:"button",tabIndex:-1,onMouseEnter:g?w:o,onMouseMove:g?e=>{m(!1),null==o||o(e)}:w,onMouseLeave:l,onFocus:e?d:void 0,onBlur:e?c:void 0,"data-testid":u},r.createElement("button",{className:[n.underline,e?n["underline--emphasized"]:"",n["underline--enhancement"]].filter(Boolean).join(" "),style:{width:f,height:S,zIndex:2},disabled:!e,onClick:e?s:void 0,"aria-label":"See enhancement suggestions",ref:h},r.createElement("div",{className:n["underline__hover-area"]}),r.createElement("div",{className:n["underline__main-bar"],style:{width:`${p}px`,height:`${S}px`,backgroundColor:a}}),r.createElement("div",{className:n.underline__dots},[1,2,3].map((e=>r.createElement("div",{key:e,className:n.underline__dot,style:{width:`${v}px`,height:`${v}px`,backgroundColor:a}}))))))}));a.displayName="SuperUnderline"},90245:(e,t,i)=>{i.d(t,{PA:()=>s,TM:()=>n,gK:()=>a,l7:()=>o,qt:()=>u,t:()=>l,zH:()=>d,zq:()=>c});var r=i(32103);const n=4,a=16,s=8,o=s+n+a,l=a,d=1e3;function c(e){return"pushed_content"===e?250:"idle"===e?700:"selection"===e?450:void(0,r.L0)(e)}function u(){return{"--idle-vbar-animation-duration":`${c("idle")}ms`,"--active-vbar-width":`${a}px`,"--idle-initial-width":"5px"}}},10886:(e,t,i)=>{i.d(t,{s:()=>a});var r=i(63349);const n={filter:`blur(${r.ux.px(3)})`,userSelect:"none"},a=r.ux.stylesheet({sidelineCardRewriteDiff:[{margin:0}],sidelineCardRewriteDiffBlurred:[n],sidelineCardRewriteDiffRevertButton:[{width:0,height:0,margin:0,padding:0,border:"none",cursor:"pointer"}],sidelineCardRewriteDiffPopoverWrapper:[{height:0,width:0}]})},28604:(e,t,i)=>{i.d(t,{V:()=>A});var r=i(90023),n=i(92379),a=i(52654),s=i(61483),o=i(31702),l=i(85837),d=i(53186),c=i(58303),u=i(9699),h=i(972),g=i(18647),m=i(46651),p=i(76609),v=i(78953),f=i(63349),S=i(53768);const w={position:"relative",borderRadius:`${f.ux.px(0)} ${f.ux.px(4.5)} ${f.ux.px(4.5)} ${f.ux.px(4.5)}`,border:`${f.ux.px(1.5)} solid ${s.I.Background.Base.Inverse}`,backgroundColor:"transparent"},b={$nest:{"&&":{padding:`${f.ux.px(2)} ${f.ux.px(4)}`,fontSize:f.ux.px(12),color:s.I.Text.Base.Inverse,borderRadius:`${f.ux.px(3)} ${f.ux.px(3)} ${f.ux.px(3)} ${f.ux.px(0)}`,backgroundColor:s.I.Background.Base.Inverse,lineHeight:f.ux.px(18)}}},C={animationName:f.ux.keyframes({"0%":{stroke:S.NeutralGray100},"50%":{stroke:S.NeutralGray40},"100%":{stroke:S.NeutralGray100}}),animationDuration:f.ux.milliseconds(833),animationIterationCount:3},_=f.ux.stylesheet({revertibleRewriteDiff:[w],revertibleRewriteDiffLabel:[b],revertibleRewriteDiffButton:[{cursor:"pointer",outline:"none"}],revertibleRewriteDiffOutlineOnboarding:[C]}),y=n.forwardRef((({children:e,diffs:t,diffAccessibilityLabel:i,onHidePopover:r,onMount:a,onRevert:s,onRedo:o,onShowPopover:l,groupID:d},c)=>{const u=n.useRef(null),h=n.useRef(null);n.useEffect((()=>{a&&u.current&&h.current&&a({diffs:t,referenceElement:u.current,diffSpanElement:h.current,groupID:d})}),[]);const g=null!=s?s:o;if(!g)return n.createElement("span",null,e);const m=()=>{u.current&&h.current&&l({diffs:t,referenceElement:u.current,diffSpanElement:h.current,groupID:d})};return n.createElement("span",{ref:(0,v.l)([c,u]),"data-testid":"grammarly-g2-revertible-rewrite-diff",role:"button",className:_.revertibleRewriteDiffButton,"aria-label":`Undo ${i||""} this cannot be redone. Focus will be on the next undoable rewrite`,tabIndex:0,onBlur:r,onClick:()=>g(t),onFocus:m,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),g(t))},onMouseOver:m},n.createElement("span",{ref:h,"aria-hidden":!0},e))}));y.displayName="RevertibleRewriteDiff";const k={position:"absolute",inset:`auto auto ${f.ux.px(0)} ${f.ux.px(0)}`,pointerEvents:"none"},B=f.ux.stylesheet({svg:[k],path:[{pointerEvents:"auto",fill:"transparent"}]}),x=e=>{const{x:t,y:i,width:r,height:n}=e;return[{x:t,y:i},{x:t+r,y:i},{x:t+r,y:i+n},{x:t,y:i+n}]},E=({largeArcFlag:e=0,radius:t=2,isClockwise:i=!0,end:r})=>`a ${t},${t} 0 ${e} ${i?1:0} ${r.dx},${r.dy} `,R=(e=!0)=>E({end:{dx:2,dy:2},isClockwise:e}),I=(e=!0)=>E({end:{dx:-2,dy:2},isClockwise:e}),T=(e=!0)=>E({end:{dx:-2,dy:-2},isClockwise:e}),P=(e=!0)=>E({end:{dx:2,dy:-2},isClockwise:e}),F=({className:e,rects:t,referenceRect:i,...r})=>{const a=(e=>{const t=[];let i={x:0,y:0},r="";const[n,a,s]=x(e[0]),o=n;r+=`M ${n.x+2} ${n.y} `,r+=`H ${a.x-2} `,r+=R(),i=s,e.forEach((e=>{const[n,a,s,o]=x(e),l=a.x>i.x;a.x!==i.x&&(r+=l?R(!1):I(),r+=`H ${a.x+(l?-2:2)} `,r+=l?R():I(!1)),r+=`V ${s.y-2} `,t.push(n,o),i=s}));const l=t[t.length-1];for(r+=I(),r+=`H ${l.x+2} `,r+=T(),i=l;t.length>0;){const e=t.pop(),n=t.pop(),a=e.x>i.x;e.x!==i.x&&(r+=a?P():T(!1),r+=`H ${e.x+(a?-2:2)} `,r+=a?P(!1):T()),r+=`V ${n.y+2} `,i=n}return r+=`V ${o.y} Z`,r})(t.map((e=>({x:e.x-i.x-2,y:e.y-i.y-2,width:e.width+4,height:e.height+4})))),o={width:i.width,height:i.height};return n.createElement("svg",{...(0,l.Sh)(B.svg,e),style:o,"data-testid":"grammarly-g2-revertible-rewrite-outline",...r},n.createElement("path",{className:B.path,d:a,stroke:s.I.Background.Base.Inverse,strokeWidth:"2px"}))};var M=i(10886);const D=e=>{const{children:t,renderer:i}=e,r=t.split("\n");return n.createElement(n.Fragment,null,r.map(((e,t)=>t>0?0===e.length?n.createElement("br",{key:`${t}_br`}):[n.createElement("br",{key:`${t}_br`}),n.createElement(n.Fragment,{key:t},i(e))]:0===e.length?[]:n.createElement(n.Fragment,{key:t},i(e)))).flat())},L={styleInsert:{color:s.I.Text.Addition.Default,background:"rgba(177, 240, 232, 0.5)",fontWeight:"bold"},styleDelete:{color:"#696969",backgroundColor:"rgba(156, 156, 156, 0.2)",textDecoration:"line-through"},styleRetain:{color:s.I.Text.Base.Default},styleRedo:{color:s.I.Text.Base.Default,textDecoration:"underline"}},A=({diff:e,displayDeletes:t,blur:i,diffStyles:s=L,isSduiTarget:v=!1,onRevert:f=r.Q1,onRedo:S=r.Q1,onFocusLost:w=r.Q1})=>{const[b,C]=n.useState(!1),{showOnboarding:k,onShow:B}=(0,m.uz)(),[x,E]=n.useState(k),[R,I]=n.useState(null),[T,P]=n.useState(null),[A,O]=n.useState(null),[U,z]=n.useState([]),[H,G]=n.useState(0),[V,q]=n.useState(null),{styles:N,attributes:j}=(0,a.D)(A,V,{placement:"top-start",modifiers:[{name:"offset",options:{offset:[-3,2]}}]}),{styleInsert:$,styleDelete:W,styleRetain:Y,styleRedo:K}=s,J=n.useRef(null),Q=n.useRef(new Map);n.useEffect((()=>(x&&(J.current=self.setTimeout((()=>{E(!1),C(!1),B()}),2500)),()=>{J.current&&self.clearTimeout(J.current)})),[x]),n.useEffect((()=>{T&&O({getBoundingClientRect:()=>T.getClientRects()[0],contextElement:T.ownerDocument.body})}),[T]);const Z=({diffs:e,referenceElement:t,diffSpanElement:i,groupID:r})=>{C(!0),I((0,g.bp)(t)),P(i),z(e),G(r)},X=()=>{E(!1),J.current&&self.clearTimeout(J.current)},ee=({diffs:e,referenceElement:t,diffSpanElement:i,groupID:r})=>{E(!0),Z({diffs:e,referenceElement:t,diffSpanElement:i,groupID:r})},te=()=>C(!1),ie=()=>{C(!0),X()},re=({diffs:e,referenceElement:t,diffSpanElement:i,groupID:r})=>{X(),Z({diffs:e,referenceElement:t,diffSpanElement:i,groupID:r})},ne=()=>{f(U),C(!1),P(null),z([]),G(0),v||setTimeout((()=>{const e=Array.from(Q.current.keys()).sort(((e,t)=>e-t)),t=e.findIndex((e=>e>H)),i=Q.current.get(e[t])||Q.current.values().next().value;i?i.focus():w()}),0)},ae=()=>{S(U),C(!1),P(null),z([]),G(0)},se=(0,h.jy)(e);let oe=!1;const le=v&&{onPointerDown:e=>e.stopPropagation()},de=se.find((e=>e.groupID===H)),ce=Boolean(v&&de&&de.diffs.some((([e,,t])=>e===h.FS.Operation.RETAIN&&Boolean(t))));return n.createElement("p",{...(0,l.Sh)(M.s.sidelineCardRewriteDiff,i&&M.s.sidelineCardRewriteDiffBlurred),"data-testid":"grammarly-g2-sideline-card-rewrite-diff"},se.map((({groupID:e,diffs:a,showDeletions:s,showRetainsAsInserts:l})=>{const g=a.some((([e])=>e===h.FS.Operation.DELETE||e===h.FS.Operation.INSERT)),m=a.some((([e,,t])=>e===h.FS.Operation.RETAIN&&t)),p=g&&t&&!i,f=m&&v&&!i,S=t&&(s||v),w=p&&!oe&&x,b=(0,r.zG)(a,d.nI,c.UI(u.G),c.FS);return oe=oe||p,n.createElement(y,{key:e,groupID:e,diffs:a,diffAccessibilityLabel:b,onHidePopover:te,onMount:w?ee:void 0,onRevert:p?ne:void 0,onRedo:f?ae:void 0,onShowPopover:re,ref:t=>{t?Q.current.set(e,t):Q.current.delete(e)}},a.map(((e,t)=>{const[i,r,s]=e;switch(i){case h.FS.Operation.DELETE:return S?n.createElement(o.x,{as:"span",variant:"text-small",key:t,style:W},r):null;case h.FS.Operation.INSERT:{const e=a.length,i=" "===r&&e>1?Y:$;return n.createElement(D,{key:t,renderer:e=>n.createElement(o.x,{as:"span",variant:"text-small",style:i},e)},r)}case h.FS.Operation.RETAIN:{let e=l?$:Y;return s&&(e=K),n.createElement(D,{key:t,renderer:t=>n.createElement(o.x,{as:"span",variant:"text-small",style:e},t)},r)}}})))})),n.createElement("span",{"aria-hidden":"true"},R&&T&&n.createElement(p.q,{className:M.s.sidelineCardRewriteDiffPopoverWrapper,as:"span",show:b,transitionDurationMs:400,display:"block",ariaHidden:!0},n.createElement("button",{className:M.s.sidelineCardRewriteDiffRevertButton,type:"button",onMouseOver:ie,onMouseLeave:te,onFocus:ie,onBlur:te,onClick:ce?ae:ne,...le},n.createElement(o.x,{as:"span","data-testid":"grammarly-g2-revertible-rewrite-diff-undo",ref:q,className:_.revertibleRewriteDiffLabel,style:N.popper,...j.popper},(ce?"Redo":"Undo")+" change"),n.createElement(F,{...(0,l.Sh)(x&&_.revertibleRewriteDiffOutlineOnboarding),rects:Array.from(T.getClientRects()),referenceRect:R.getBoundingClientRect()})))))}},9710:(e,t,i)=>{i.r(t),i.d(t,{FeedbackForm:()=>c});var r=i(90023),n=i(92379),a=i(33885),s=i(58303),o=i(37639),l=i(94901);const d=({domain:e,onSubmit:t,onClose:i})=>{const[r,a]=n.useState(!0);return n.createElement(o.u_,{"data-testid":"grammarly-g2-feedback-form-modal",width:"small",title:"How do you like Grammarly?",isOpen:r,onClose:()=>{a(!1),i()}},n.createElement(o.u_.Body,null,n.createElement(l.q,{withScore:!0,hideTitle:!0,hideTextBoxTitle:!0,hideLogo:!0,hideDomainHelpText:!0,domainSharedByDefault:!0,domain:e,showPostSubmitScreen:!1,showShareTextCheckbox:!0,onSubmit:e=>{a(!1),t(e)}})))},c=({feedbackFormContext:e,onSubmit:t,onClose:i})=>n.createElement(a.F.Fragment,null,e.view((0,r.ls)(s.UI((e=>n.createElement(d,{domain:e.domain,onSubmit:i=>t(i,e),onClose:()=>i()}))),s.WG)))},4272:(e,t,i)=>{i.r(t),i.d(t,{PushedContentCard:()=>Si,SidelineCardWrapper:()=>gi,getNewPushedContentCardRewrite:()=>wi,getPushedContentCardCallbacks:()=>bi,getSurfaceTitle:()=>vi,getVBarIcon:()=>fi});var r=i(90023),n=i(92379),a=i(5749),s=i(36949),o=i(32115),l=i(97411),d=i(33885),c=i(13391),u=i(59179),h=i(954),g=i(78129),m=i(84714),p=i(58303),v=i(35837),f=i(10269);const S=n.createContext({shouldOnboardingBeShown:!1,markOnboardingAsSeen:r.Q1});function w({translateOnboardingService:e,children:t}){const[i,r]=n.useState({shouldOnboardingBeShown:e.shouldOnboardingBeShown.get(),markOnboardingAsSeen:()=>e.markOnboardingAsSeen()});return n.useEffect((()=>{const t=e.shouldOnboardingBeShown.subscribe((e=>r((t=>({...t,shouldOnboardingBeShown:e})))));return()=>t.unsubscribe()}),[e]),n.createElement(S.Provider,{value:i},t)}var b,C=i(76609),_=i(90189),y=i(40224),k=i(30105),B=i(85807),x=i(62810),E=i(22586),R=i(972);!function(e){e.isNotification=function(e){return"notification"===e.kind},e.isCard=function(e){return"rewrite-card"===e.kind||"plagiarism-card"===e.kind||"lazy-rewrite-card"===e.kind}}(b||(b={}));var I=i(74702),T=i(46651),P=i(50635),F=i(36279),M=i(81224),D=i(31702),L=i(86690),A=i(6003);const O=["Upgrade for unlimited paragraph rewrites","Improve this section with Pro","Make it flawless with Pro","Unlock your best writing","Perfect your wording with Pro"];function U({shouldRotateCopyText:e,textHash:t,fallbackText:i}){if(!e||!t||0===t.length)return null!=i?i:O[0];const r=(parseInt(t.slice(0,8),16)>>>0)%O.length;return O[r]}var z=i(35614),H=i(42496),G=i(16381);const V=({onShowUphookButton:e,onClickUphookButton:t,vbarsUphookConfig:i})=>{const{hasSpecialOffer:a}=n.useContext(z.U8),s=a.get(),o=n.useRef(!1),l=n.useCallback((t=>{t&&!o.current&&(o.current=!0,e())}),[e]),d=(0,r.zG)(i,p.UI((e=>e.uphookContent.ctaCopy)),p.fS((()=>s?"Get 50% off Pro":"Get Pro")));return n.createElement(H.i,{ref:l,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-uphook-button",variant:"premium",href:(0,G.Um)().planComparison,onClick:e=>{e.preventDefault(),t()},size:"small"},d)};var q=i(24974);const N="Pro suggestion",j="Youre out of free paragraph rewrites for today",$=n.forwardRef((({children:e,quota:t,showUphook:i,shouldRemoveVbarsSampleCounter:r=!1,shouldShimmerOnOpen:a=!1,shouldShimmerAfterLoad:s=!1,showUphookInTitle:o=!1,...l},d)=>{const[c,u]=n.useState(!1);if(n.useImperativeHandle(d,(()=>({triggerDelayedShimmer:()=>{s&&!i&&u(!0)}})),[s,i]),n.useEffect((()=>{i&&u(!1)}),[i]),void 0===t)return e;const h=!i&&(a||s&&c),g=o&&i;return n.createElement("div",{className:q.monetizationWrapper},n.createElement(P.k,{gap:1,align:"center",justify:g?"space-between":"start",className:q.monetizationTitle},g?n.createElement(W,{...l}):n.createElement(n.Fragment,null,n.createElement(F.J,{icon:M.R,variant:"premium",accessibilityLabel:"",className:h?q.premiumIconShimmer:q.premiumIcon,size:"small"}),n.createElement(D.x,{as:"strong",variant:"text-xsmall",className:h?q.shimmer:"","aria-label":N,"data-testid":"grammarly-g2-sideline-card-monetization-wrapper-pro-text"},N),n.createElement(F.J,{icon:L.M,accessibilityLabel:"",size:"small",variant:"inherit",className:q.monetizationDividerDot}),r?n.createElement(P.k,{align:"center",gap:1,"data-testid":"grammarly-g2-sideline-card-monetization-wrapper-title"},n.createElement(D.x,{as:"p",variant:"text-xsmall"},i?j:"Free sample")):n.createElement(P.k,{align:"center",gap:1,"data-testid":"grammarly-g2-sideline-card-monetization-wrapper-title"},!i&&n.createElement(D.x,{as:"strong",variant:"text-xsmall"},t),n.createElement(D.x,{as:"p",variant:"text-xsmall"},i?j:(e=>`free paragraph ${1===e?"rewrite":"rewrites"} left today`)(t))))),e)}));function W(e){const t=(0,A.My)(e.sidelineType,e.vBarsUphookConfigs),i=(0,A.KT)(t),r=n.useMemo((()=>{var t;return U({shouldRotateCopyText:null!==(t=e.shouldRotateCopyText)&&void 0!==t&&t,textHash:e.textHash,fallbackText:i})}),[e.textHash,e.shouldRotateCopyText,i]);return n.createElement(n.Fragment,null,n.createElement(P.k,{align:"center",gap:1},n.createElement(F.J,{icon:M.R,variant:"premium",accessibilityLabel:"",className:q.premiumIcon,size:"small"}),n.createElement(D.x,{as:"strong",variant:"text-xsmall"},r)),n.createElement(V,{vbarsUphookConfig:t,...e}))}$.displayName="MonetizationWrapper";var Y=i(2852),K=i(32103),J=i(86211),Q=i(22110),Z=i(93656),X=i(12712),ee=i(64803),te=i(20905),ie=i(66741);const re=({placement:e,children:t})=>{if(!t||!n.isValidElement(t))throw new Error("TranslateFtuxTooltip: children must be a valid React element");const{shouldOnboardingBeShown:i,markOnboardingAsSeen:r}=n.useContext(S),[a,s]=n.useState(!0),o=n.useRef(!1);return n.useEffect((()=>{if(!i)return;const e=Date.now();return()=>{(Date.now()-e>=te.m9(4)||o.current)&&r()}}),[]),n.useEffect((()=>{a||(o.current=!0)}),[a]),i?n.createElement(Z.u,{open:a,placement:e},n.createElement(Z.aJ,{asChild:!0},n.createElement("span",{className:a?ie.TranslateFtuxTooltipOutline:null,onClickCapture:()=>s(!1)},t)),n.createElement(Z._v,{style:{maxWidth:"unset"},root:null},n.createElement(P.k,{className:ie.TranslateFtuxTooltipContent,align:"center",gap:3},n.createElement(D.x,{as:"p",variant:"text-xsmall"},n.createElement(D.x,{as:"span",variant:"text-xsmall",weight:"bold"},"New:")," ","Translate across 15+ languages"),n.createElement(X.h,{icon:ee.V,size:"small",variant:"tertiary",accessibilityLabel:"Dismiss",onClick:()=>s(!1)})))):n.createElement(n.Fragment,null,t)};var ne=i(52348),ae=i(27106),se=i(19347),oe=i(85837),le=i(10843);const de=({placement:e,actionUrl:t,iconUrl:i,showLabelNew:r,title:a,onClick:s})=>{const[o,l]=n.useState(null);n.useLayoutEffect((()=>{const e=requestAnimationFrame((()=>{l("entered")}));return()=>{cancelAnimationFrame(e)}}),[]);const d=`${r?"New: ":""}${a}. Opens a new tab.`;return n.createElement(ne.z,{onClick:()=>{self.open(t,"_blank","noreferrer"),null==s||s()},width:"full","data-testid":"grammarly-g2-sideline-card-ai-editor-promotion-button",accessibilityLabel:d,className:(0,oe.Sh)(le.sidelineCardAIEditorPromotionButton,"top"===e?le.topPlacement:le.bottomPlacement,o?le[o]:void 0).className},n.createElement(P.k,{justify:"space-between",align:"center",wrap:!1,gap:2},n.createElement(P.k,{align:"center",gap:2},n.createElement("img",{src:i,className:le.icon,alt:""}),n.createElement(D.x,{as:"p",variant:"text-xsmall"},a),r?n.createElement(ae.V,{label:"New",variant:"success",className:le.tag}):null),n.createElement(P.k,{justify:"center",align:"center",className:le.rightIconContainer},n.createElement(F.J,{icon:se.n,size:"small",accessibilityLabel:""}))))};var ce=i(61861),ue=i(99815);var he=i(2775);const ge=({placement:e,onDismiss:t,onShown:i})=>{const[r,a]=n.useState(null),s=n.useRef(!1),o=n.useRef();return n.useLayoutEffect((()=>{const e=requestAnimationFrame((()=>{a("entered")}));return()=>{cancelAnimationFrame(e)}}),[]),n.useEffect((()=>{const e=Date.now();return()=>{o.current&&clearTimeout(o.current);Date.now()-e>=te.m9(4)&&!s.current&&i()}}),[]),n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-multilingual-onboarding-wrapper",className:(0,oe.Sh)(ue.sidelineCardMultilingualOnboardingWrapper,"top"===e?ue.topPlacement:ue.bottomPlacement,r?ue[r]:void 0).className},n.createElement(P.k,{className:ue.sidelineCardMultilingualOnboarding,justify:"space-between",align:"center",gap:1},n.createElement(P.k,{wrap:!1,gap:1},n.createElement(F.J,{size:"small",icon:ce.X,accessibilityLabel:""}),n.createElement(P.k,{direction:"column"},n.createElement(D.x,{as:"p",variant:"text-xsmall",color:"base-subdued",weight:"semibold"},"Use ",he.U.improve.buttonProps.label," and ",he.U.rephrase.buttonProps.label," ","with more languages"),n.createElement(D.x,{as:"p",variant:"text-xsmall"},"Try them with French, German, Italian, Portuguese, Spanish, and Ukrainian"))),n.createElement(ne.z,{variant:"tertiary","aria-label":"Dismiss",title:"Dismiss",size:"small",onClick:()=>{a("exiting"),o.current=self.setTimeout((()=>{s.current=!0,t()}),200)}},n.createElement(F.J,{icon:ee.V,size:"small",accessibilityLabel:"Dismiss"}))))};var me=i(78953),pe=i(87410),ve=i(39124),fe=i(16475),Se=i(28569);const we=({onMount:e})=>(n.useEffect((()=>e()),[e]),n.createElement(P.k,{direction:"row",align:"center",gap:1,padding:2,"data-testid":"grammarly-prompt-enhancer-card-error",className:Se.promptEnhancerCardError},n.createElement(F.J,{icon:fe.F,size:"medium",variant:"warning",accessibilityLabel:"","data-testid":"grammarly-prompt-enhancer-card-error-icon"}),n.createElement(D.x,{as:"p",variant:"text-small",color:"base-subdued",align:"start","data-testid":"grammarly-prompt-enhancer-card-error-message"},n.createElement(D.x,{as:"span",variant:"text-small",color:"base-default",weight:"bold"},"Something went wrong.")," ","Please wait a moment and try again.")));var be=i(46155),Ce=i(54711),_e=i(37632),ye=i(69554),ke=i(96634),Be=i(10284);const xe=["Refining your prompt to get the best results","Applying best practices to improve your prompt","Enhancing your prompt according to best practices","Revising your prompt to get the best results","Improving your prompt to get the best results"],Ee=({maxHeight:e,streamedText:t,title:i,onMount:r,onStreamingStart:a})=>{const[s,o]=n.useState(!1);return n.useEffect((()=>{!s&&t&&(o(!0),a())}),[t,s,a]),Y.P.useEffectOnDidMount((()=>{r()})),n.createElement(P.k,{"data-testid":"grammarly-prompt-enhancer-card-loading-skeleton"},t?n.createElement(Ce.g,{accessibilityLabel:"Loading rewrite",label:"Loading rewrite",width:"100%"},n.createElement(P.k,{direction:"column",width:"100%",height:"100%",gap:3},n.createElement(P.k,{direction:"column",gap:3},n.createElement(P.k,{align:"center",gap:3},n.createElement(F.J,{icon:_e.H,size:"small",accessibilityLabel:""}),n.createElement(ye.X,{as:"h3",className:Be.promptEnhancerCardRewriteReadyContentTitle},i)),n.createElement(P.k,{"data-testid":"grammarly-prompt-enhancer-card-loading-skeleton-with-scroll-limits",direction:"column",width:"100%",height:"100%",gap:3,className:Be.promptEnhancerCardRewriteReadyContentWithScrollLimits,style:{maxHeight:e},tabIndex:0},n.createElement(D.x,{as:"p",variant:"text-small"},t.split(/\r?\n/).map(((e,t)=>n.createElement(n.Fragment,null,0!==t&&n.createElement("br",null),e))))),n.createElement(P.k,{justify:"space-between",style:{flex:"0 0 auto"}},n.createElement(P.k,{gap:2},n.createElement(Ce.g.Button,{size:"small",width:60}),n.createElement(Ce.g.Button,{size:"small",width:60})),n.createElement(ke.a,{accessibilityLabel:"Loading rewrite content"},n.createElement(ke.a.Branded,{size:"small"})))))):n.createElement(P.k,{align:"center",gap:3},n.createElement(F.J,{icon:_e.H,size:"small",accessibilityLabel:""}),n.createElement(be.Gz,{text:xe[Math.floor(Math.random()*xe.length)]})))};var Re=i(166),Ie=i(27389),Te=i(31573);const Pe=e=>(Y.P.useEffectOnDidMount(e.onMount),n.createElement(P.k,{direction:"column",width:"100%",height:"100%",gap:3,className:Be.promptEnhancerCardRewriteReadyContent},n.createElement(P.k,{direction:"column",width:"100%",height:"100%",gap:3},n.createElement(P.k,{align:"center",gap:3},n.createElement(F.J,{icon:_e.H,size:"small",accessibilityLabel:""}),n.createElement(ye.X,{as:"h3",className:Be.promptEnhancerCardRewriteReadyContentTitle},e.title)),n.createElement(P.k,{"data-testid":"grammarly-prompt-enhancer-card-with-scroll-limits",direction:"column",width:"100%",height:"100%",gap:3,className:Be.promptEnhancerCardRewriteReadyContentWithScrollLimits,style:{maxHeight:e.maxHeight},tabIndex:0},n.createElement(D.x,{as:"p",variant:"text-small"},e.newText.split(/\r?\n/).map(((e,t)=>n.createElement(n.Fragment,null,0!==t&&n.createElement("br",null),e))))),n.createElement(P.k,{gap:2,align:"center",justify:"space-between"},n.createElement(P.k,{gap:2,align:"center"},n.createElement(ne.z,{variant:"primary",size:"medium",onClick:()=>e.onApply(e.newText)},"Accept"),n.createElement(ne.z,{variant:"tertiary",size:"medium",onClick:e.onDismiss,"data-testid":"grammarly-prompt-enhancer-card-rewrite-dismiss-button"},"Dismiss"),e.showDisableButton&&n.createElement(ne.z,{variant:"tertiary",size:"medium",onClick:e.onDisable,"data-testid":"grammarly-prompt-enhancer-card-rewrite-disable-button"},"Turn off for a week")),n.createElement(P.k,{gap:1,align:"center"},n.createElement(Ie.v,{activator:"more-horizontal",accessibilityLabel:"Card options"},n.createElement(Ie.v.Item,{key:"giveFeedback",onClick:e.onClickFeedbackButton},"Give feedback"),n.createElement(Ie.v.Item,{key:"turnOffSession",onClick:e.onDismiss},"Turn off for this session"),e.showDisableButton&&n.createElement(Ie.v.Item,{key:"turnOffForWeek",onClick:e.onDisable},"Turn off for a week")),n.createElement(X.h,{icon:Te.c,size:"medium",variant:"tertiary",onClick:e.onCopy,accessibilityLabel:"Copy to clipboard"})))))),Fe=e=>{const t=e.maxHeight-20;return n.createElement(P.k,{accessibilityLabel:Me(e.kind),padding:3,direction:"column","aria-live":"error"===e.kind?"assertive":"polite","aria-busy":"loading"===e.kind,"data-testid":"grammarly-prompt-enhancer-card-rewrite",className:Re.promptEnhancerCardRewrite},(()=>{switch(e.kind){case"loading":return n.createElement(Ee,{maxHeight:t,streamedText:e.newText,title:e.title,onMount:e.onMount,onStreamingStart:e.onStreamingStart});case"ready":return n.createElement(Pe,{maxHeight:t,title:e.title,newText:e.newText,onApply:e.onApply,onCopy:e.onCopy,onDismiss:e.onDismiss,onDisable:e.onDisable,onMount:e.onMount,onClickFeedbackButton:e.onClickFeedbackButton,showDisableButton:e.showDisableButton});case"error":return n.createElement(we,{onMount:e.onMount});default:(0,K.L0)(e)}})())};function Me(e){switch(e){case"loading":return"Loading suggestion content";case"ready":return"Suggestion content";case"error":return"An error occurred";default:(0,K.L0)(e)}}const De=n.forwardRef(((e,t)=>{var i;const r=(null!==(i=e.maxHeight)&&void 0!==i?i:200)-24;n.useEffect((()=>{var t;null===(t=e.onShow)||void 0===t||t.call(e)}),[e.onShow]),n.useEffect((()=>()=>{var t;null===(t=e.onClose)||void 0===t||t.call(e)}),[e.onClose]);const a=n.useCallback((()=>{var t;null===(t=e.onDismiss)||void 0===t||t.call(e),"ready"===e.rewrite.kind&&e.rewrite.onDismiss()}),[e.onDismiss,e.rewrite.kind]),s=n.useCallback((()=>{var t;null===(t=e.onDisable)||void 0===t||t.call(e),"ready"===e.rewrite.kind&&e.rewrite.onDisable()}),[e.onDisable,e.rewrite.kind]);return n.createElement("div",{ref:t,className:ve.promptEnhancerCard,"data-testid":"grammarly-prompt-enhancer-card"},n.createElement(P.k,{direction:"column",width:"100%"},n.createElement(Fe,{...e.rewrite,..."ready"===e.rewrite.kind?{onDismiss:a,onDisable:s,showDisableButton:e.shouldShowDisableButton}:{},..."loading"===e.rewrite.kind?{title:e.title}:{},maxHeight:r})))}));De.displayName="PromptEnhancerCard";const Le=({sourceAction:e,contentId:t,title:i,maxHeight:r,rewrite:a,onDismiss:s,onDisable:o})=>"Agent/PromptEnhancement/LazyPushedContent/PushedContent"===e?n.createElement(De,{onDismiss:()=>s(t),onDisable:()=>o(t),rewrite:a,title:i,maxHeight:r,shouldShowDisableButton:!0}):e&&-1!==e.indexOf("/LazyPushedContent")?n.createElement(De,{onDismiss:()=>s(t),onDisable:()=>o(t),rewrite:a,title:i,maxHeight:r,shouldShowDisableButton:!1}):null;var Ae=i(92180),Oe=i(68108);const Ue=({className:e})=>n.createElement(F.J,{...(0,oe.Sh)(Oe.sidelineCardGrammarlyLogo,e),size:"small",icon:Ae.p,accessibilityLabel:"","data-testid":"grammarly-g2-sideline-card-grammarly-logo"});var ze=i(53569);const He=({title:e,referenceText:t,onMount:i,onDismiss:r,onDone:a,onCopy:s})=>{Y.P.useEffectOnDidMount((()=>i?i():void 0));const o=n.useMemo((()=>crypto.randomUUID()),[]);return n.createElement(P.k,{direction:"column",height:"100%",justify:"center","data-testid":"grammarly-g2-sideline-card-rewrite-success",className:ze.CardPlagiarism},n.createElement(P.k,{"data-testid":"grammarly-g2-sideline-card-rewrite-success-main",align:"center",gap:4},n.createElement(P.k,{direction:"column","data-testid":"grammarly-g2-sideline-card-rewrite-success-main-content",className:ze.CardPlagiarismMainContent},n.createElement(D.x,{className:ze.CardPlagiarismMainContentTitle,as:"strong",color:"brand-default",variant:"text-small"},n.createElement(F.J,{size:"small",accessibilityLabel:"",icon:Ge(o)})," ",e),n.createElement(D.x,{as:"p",variant:"text-small",color:"base-subdued",className:ze.CardPlagiarismText},t),n.createElement("div",{className:ze.CardPlagiarismFooter},n.createElement(ne.z,{onClick:s},"Copy citation"),a&&n.createElement(ne.z,{variant:"tertiary",onClick:a},"Mark done"),n.createElement(ne.z,{variant:"tertiary",onClick:r},"Dismiss"),n.createElement("div",{className:ze.CardPlagiarismGrammarlyLogo},n.createElement(Ue,null))))))},Ge=e=>{const t=t=>n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",...t},n.createElement("g",{clipPath:`url(#clip${e}`},n.createElement("rect",{x:"0.333328",y:"0.333313",width:"29.3333",height:"29.3333",rx:"14.6667",fill:`url(#paint${e})`}),n.createElement("g",{filter:`url(#filter${e})`},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.4515 17.5961C19.0626 18.4934 18.5553 19.3351 17.9358 20.1079C17.8473 20.219 17.8082 20.3621 17.8288 20.503C17.8483 20.644 17.9265 20.7695 18.0428 20.8508C18.5583 21.2131 19.0759 21.5639 19.5946 21.9159C19.7726 22.0363 20.0051 22.0332 20.1831 21.9076C22.2731 20.4073 23.795 18.2166 24.4669 15.7387C24.7972 14.5275 25.1584 12.2205 23.8619 10.3775C23.0181 9.188 21.5558 8.4821 20.1101 8.4821C19.7252 8.4821 19.3414 8.53149 18.9699 8.63542C17.4913 9.04291 16.3418 10.1872 15.8963 11.6967C15.4332 13.267 15.7913 14.9165 16.8553 16.1102C17.5334 16.8747 18.4534 17.3965 19.4515 17.5961Z",fill:"white"}),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.37997 16.1095C7.05809 16.8741 7.97905 17.3958 8.97616 17.5954C8.58719 18.4948 8.07783 19.3375 7.46146 20.1083C7.37193 20.2184 7.33283 20.3614 7.35238 20.5034C7.37296 20.6434 7.45117 20.7689 7.56745 20.8512C8.08401 21.2124 8.60057 21.5654 9.11919 21.9162C9.29824 22.0366 9.53183 22.0325 9.70779 21.908C11.7987 20.4077 13.3196 18.2159 13.9916 15.7391C14.3229 14.5259 14.682 12.2168 13.3886 10.3779C12.5437 9.18738 11.0815 8.48148 9.63473 8.48148C9.24988 8.48148 8.86503 8.5319 8.49458 8.6348C7.0159 9.04229 5.86649 10.1855 5.42093 11.6941C4.95788 13.2643 5.31597 14.9159 6.37997 16.1095Z",fill:"white"}))),n.createElement("defs",null,n.createElement("filter",{id:`filter${e}`,x:"1.22243",y:"8.48151",width:"27.5556",height:"21.5225",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n.createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),n.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),n.createElement("feOffset",{dy:"4"}),n.createElement("feGaussianBlur",{stdDeviation:"2"}),n.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),n.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),n.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_599_985"}),n.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_599_985",result:"shape"})),n.createElement("linearGradient",{id:`paint${e}`,x1:"15",y1:"0.333313",x2:"15",y2:"29.6666",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#8675EB"}),n.createElement("stop",{offset:"1",stopColor:"#5E47E5"})),n.createElement("clipPath",{id:`clip${e}`},n.createElement("rect",{x:"0.333328",y:"0.333313",width:"29.3333",height:"29.3333",rx:"14.6667",fill:"white"}))));return t.__brand="nocolor",t};var Ve=i(62484);function qe({className:e,onboardingStep:t,onClose:i,children:r}){if(!r||!n.isValidElement(r))throw new Error("FtuxTooltip: children must be a valid React element");const{showTooltip:a,tooltipText:s,ctaText:o,rootElement:l,onNextStep:d,onHide:c}=(0,T.a7)(t),[u,h]=n.useState(a),g=n.useRef(null),m=n.useRef(null),p=()=>{h(!1),null==i||i(),d()};return n.useEffect((()=>{a&&setTimeout((()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.focus()}),0)}),[a]),n.useEffect((()=>{h(a)}),[a]),a?n.createElement(Z.u,{open:u,placement:"right"},n.createElement(Z.aJ,{asChild:!0},n.createElement("span",{ref:g,onClickCapture:p,...(0,oe.Sh)(e,u?Ve.FtuxTooltipOutline:void 0)},r)),n.createElement(Z._v,{style:{maxWidth:"unset"},root:l},n.createElement(P.k,{align:"center",justify:"center",className:Ve.FtuxTooltipContent,"data-testid":"grammarly-g2-ftux-tooltip-content"},n.createElement(D.x,{as:"span",variant:"text-xsmall"},s),n.createElement(H.z,{variant:"ghost",size:"small",ref:m,style:{marginLeft:"var(--space-2"},onClick:p},o),n.createElement(X.h,{accessibilityLabel:"Dismiss",variant:"tertiary",icon:ee.V,size:"small",style:{marginLeft:"var(--space-1)"},tooltipContentProps:{children:n.createElement(D.x,{variant:"text-xsmall",as:"span"},"Dismiss")},onClick:()=>{h(!1),null==i||i(),c()}})))):n.createElement(n.Fragment,null,r)}var Ne=i(13118),je=i(9103);const $e=({children:e})=>{const t=n.useRef(null),i=n.useRef(null),r=n.useRef(null),a=()=>t.current?Array.from(t.current.querySelectorAll(Ne.qR)).filter((e=>null!==e.offsetParent)):[],s=()=>{const e=a();e.length>0&&e[e.length-1].focus()},o=()=>{const e=a();e.length>0&&e[0].focus()};return n.useEffect((()=>{const e=i.current,t=r.current;return null==e||e.addEventListener("focus",s),null==t||t.addEventListener("focus",o),()=>{null==e||e.removeEventListener("focus",s),null==t||t.removeEventListener("focus",o)}}),[]),n.createElement(n.Fragment,null,n.createElement("div",{ref:i,tabIndex:0,"aria-hidden":"true",className:je.offscreen}),n.createElement("div",{ref:t},e),n.createElement("div",{ref:r,tabIndex:0,"aria-hidden":"true",className:je.offscreen}))};var We=i(43862),Ye=i(79994),Ke=i(85687),Je=i(83816),Qe=i(41648);const Ze=({className:e,...t})=>n.createElement(H.z,{...(0,oe.Sh)(Qe.sidelineCardButton,e),variant:"tertiary",size:"small",...t});var Xe=i(92748);function et({errorDetails:e,errorReason:t}){switch(t){case"sensitivity":return["Can't help with this text","Grammarly assistance is unavailable because the text may contain sensitive content. Try with different text."];case"unsupportedLanguage":return["Can't help with this text","Grammarly only works with English language text."];case"serviceLimitExceeded":return["See more suggestions tomorrow","You've reached your suggestion limit for the day. It resets tomorrow."];case"backendError":return["Something went wrong","Please wait a moment, then try again."]}return e?["Assistance unavailable",e]:["Couldn't generate ideas","Please wait a moment, then try again."]}const tt=({errorDetails:e,errorReason:t,onMount:i})=>(Y.P.useEffectOnDidMount((()=>i())),n.createElement(P.k,{direction:"column",align:"center",gap:.5,padding:8,"data-testid":"grammarly-g2-sideline-card-rewrite-error"},n.createElement(F.J,{icon:fe.F,size:"large",variant:"warning",accessibilityLabel:"","data-testid":"grammarly-g2-sideline-card-rewrite-error-icon"}),n.createElement(D.x,{as:"p",variant:"text-medium",color:"base-default",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-title"},(0,Xe.li)(et({errorDetails:e,errorReason:t}))),n.createElement(D.x,{as:"p",variant:"text-small",color:"base-subdued",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-subtitle"},(0,Xe.Yg)(et({errorDetails:e,errorReason:t})))));var it=i(10305),rt=i(69441),nt=i(3537);function at(e){const t=n.useRef({value:e,prev:null}),i=t.current.value;return e!==i&&(t.current={value:e,prev:i}),t.current.prev}function st(e){const[t,i]=n.useState(!1),[r,a]=n.useState(!1),s=()=>{requestAnimationFrame((()=>{const t=e.current;t&&(i(t.scrollTop>0),a(Math.ceil(t.scrollTop+t.clientHeight)<t.scrollHeight))}))};return n.useEffect((()=>{if(!e.current)return;const t=new ResizeObserver((t=>{requestAnimationFrame((()=>{for(const i of t)if(i.target===e.current&&i.contentRect){const t=e.current;a(Math.ceil(t.scrollTop+t.clientHeight)<t.scrollHeight)}}))}));return t.observe(e.current),()=>t.disconnect()})),n.useEffect((()=>{const t=e.current;if(t)return t.addEventListener("scroll",s),()=>{t.removeEventListener("scroll",s)}}),[e]),{showTopScrollLimit:t,showBottomScrollLimit:r}}const ot=({maxHeight:e,streamedText:t,onMount:i,onStreamingStart:r})=>{const a=n.useRef(null),s=at(t);n.useEffect((()=>{!s&&t&&r()}),[s,t]),Y.P.useEffectOnDidMount((()=>i()));const{showBottomScrollLimit:o,showTopScrollLimit:l}=st(a);return n.useEffect((()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)}),[t]),n.createElement(P.k,{"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton",style:{maxHeight:e}},n.createElement(Ce.g,{accessibilityLabel:"Loading rewrite",label:"Loading rewrite",width:"100%"},n.createElement(P.k,{gap:4,height:"100%"},n.createElement(Ce.g.Rectangle,{width:3,height:"100%"}),n.createElement(P.k,{direction:"column",width:"100%",height:"100%",gap:3},n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton-content",ref:a,...(0,oe.Sh)(o&&nt.scrollBottomLimit,l&&nt.scrollTopLimit),style:{overflow:"auto"}},n.createElement(P.k,{style:{flex:"0 0 auto",marginBottom:"5px"}},n.createElement(Ce.g.Heading,{variant:"heading-small",width:"50%"})),t?n.createElement(rt.z,{animationDurationMs:500},m.of(t).pipe(u.U((()=>n.createElement(lt,{text:t}))))):n.createElement(P.k,{direction:"column",width:"100%",align:"start"},n.createElement(Ce.g.Text,{variant:"text-small",width:"100%"}),n.createElement(Ce.g.Text,{variant:"text-small",width:"100%"}),n.createElement(Ce.g.Text,{variant:"text-small",width:"100%"}))),n.createElement(P.k,{justify:"space-between",style:{flex:"0 0 auto"}},n.createElement(P.k,null,n.createElement(Ce.g.Button,{size:"small",width:60})),t?n.createElement(ke.a,{accessibilityLabel:"Loading rewrite content"},n.createElement(ke.a.Branded,{size:"small"})):null)))))},lt=({text:e=""})=>{const[t,i]=n.useState((()=>[e])),r=at(e)||"";return n.useEffect((()=>{if(0===r.length)return;const t=e.slice(r.length);i((e=>[...e,t]))}),[e,r]),n.createElement("div",null,t.map(((e,t)=>n.createElement("span",{key:`${e}-${t}`,className:nt.fadeInAnimation},n.createElement(D.x,{as:"span",variant:"text-small"},e)))))};var dt=i(55034),ct=i(9699),ut=i(28604),ht=i(45686),gt=i(80957),mt=i(17920);const pt=({domain:e,onCopy:t,onDismiss:i,onShowLess:r})=>n.createElement("div",{className:mt.moreButton,"data-testid":"grammarly-g2-sideline-card-menu"},n.createElement(Ie.v,{activator:"more-horizontal",accessibilityLabel:"Card options"},n.createElement(Ie.v.Item,{key:"copy",icon:Te.c,onClick:async()=>{await(null==t?void 0:t())}},"Copy"),i&&n.createElement(Ie.v.Item,{key:"dismiss",icon:ht.o,onClick:()=>{null==i||i()}},"Dismiss"),r&&n.createElement(n.Fragment,null,n.createElement(Ie.v.Separator,{role:"separator"}),n.createElement(Ie.v.Item,{key:"showLess",icon:gt.l,onClick:()=>{null==r||r()},"data-testid":"grammarly-g2-sideline-card-menu-show-less"},"Show less on ",e))));var vt=i(63178),ft=i(10886);const St=({text:e,blur:t})=>n.createElement(D.x,{className:t?ft.s.sidelineCardRewriteDiffBlurred:void 0,as:"p",variant:"text-small"},e);var wt=i(52563),bt=i(98587),Ct=i(38842);const _t=({targetLanguageTag:e,onChange:t})=>n.createElement(wt.P,{className:Ct.translationLanguageSelect,label:"Language",labelDisplay:"hidden",value:e,onChange:t},Object.entries(bt.xw).map((([e,t])=>n.createElement(wt.P.Option,{key:e,value:e,label:t})))),yt=e=>{const t=n.useRef(null),[i,a]=n.useState(e.diffProps);n.useEffect((()=>{a(e.diffProps)}),[e.diffProps]);const s=n.useMemo((()=>{const{diff:t}=p.fS((()=>({diff:[],displayDeletes:!1})))(i);return(0,R.Ns)(e.originalText,t)}),[i,e.originalText]);n.useEffect((()=>{e.onRewriteTextChange&&e.onRewriteTextChange(s)}),[s,e.onRewriteTextChange]),Y.P.useEffectOnDidMount((()=>{var t;null===(t=e.onMount)||void 0===t||t.call(e)}));const{showBottomScrollLimit:o,showTopScrollLimit:l}=st(t),d=t=>{const n=[];e.onRevert(),(0,r.zG)(i,p.UI((({diff:e,displayDeletes:i})=>{e.forEach((e=>{const[i,r]=e;t.find((([e,t])=>e===i&&t===r))?i===R.FS.Operation.DELETE?n.push([R.FS.Operation.RETAIN,r]):i===R.FS.Operation.RETAIN&&n.push([i,r]):n.push([i,r])})),a(0===n.length?p.YP:p.G({diff:n,displayDeletes:i,accessibilityLabel:(0,ct.G)(n)}))})))},c=void 0!==e.onClickUphookButton&&e.onClickUphookButton!==r.Q1,u=n.createElement(St,{text:e.newText,blur:c}),h=c&&e.onShowUphookButton&&e.onClickUphookButton;return n.createElement(P.k,{gap:4,align:"stretch",style:{maxHeight:e.maxHeight},accessibilityLabel:(0,r.zG)(i,p.UI((({accessibilityLabel:e})=>e)),p.FS),"data-testid":"grammarly-g2-sideline-card-rewrite-ready"},n.createElement("div",{...(0,oe.Sh)(vt.sidelineCardRewriteReadySignalBar,vt.sidelineCardRewriteReadySignalBarDefault),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-signal"}),n.createElement(P.k,{flex:"1",direction:"column",justify:"space-between","data-testid":"grammarly-g2-sideline-card-rewrite-ready-container",gap:2},n.createElement("div",{...(0,oe.Sh)(vt.sidelineCardRewriteReadyContent,l&&vt.sidelineCardRewriteReadyContentWithTopScrollLimit,o&&vt.sidelineCardRewriteReadyContentWithBottomScrollLimit),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content",ref:t},e.title&&n.createElement("h2",{...(0,oe.Sh)(vt.sidelineCardRewriteReadyContentTitle,vt.sidelineCardRewriteReadyContentTitleDefault)},e.title),"translate"===e.rewriteType.kind?u:(0,r.zG)(i,p.UI((t=>n.createElement(ut.V,{key:"diff",diff:t.diff,displayDeletes:t.displayDeletes,blur:c,onRevert:d,onFocusLost:e.onFocusLost}))),p.fS((()=>u)))),h&&!e.hideUphookFooter&&n.createElement(kt,{onShowUphookButton:e.onShowUphookButton,onClickUphookButton:e.onClickUphookButton,sidelineType:e.sidelineType,sidelineTextHash:e.sidelineTextHash,vBarsUphookConfigs:e.vBarsUphookConfigs}),!h&&!e.hideUphookFooter&&n.createElement(Bt,{...e,onApply:()=>{e.onApply(s)}})))},kt=e=>{const t=(0,E.R)((0,_.OB)().experimentClient),i=(0,A.My)(e.sidelineType,e.vBarsUphookConfigs),r=(0,A.KT)(i),a=n.useMemo((()=>U({shouldRotateCopyText:t,textHash:e.sidelineTextHash,fallbackText:r})),[e.sidelineTextHash,t,r]);return n.createElement(P.k,{direction:"column",gap:2},n.createElement(P.k,{align:"end",justify:"start",height:"2rem"},n.createElement(D.x,{as:"strong"},a)),n.createElement(P.k,{align:"end",justify:"space-between"},n.createElement(P.k,{align:"end",gap:2},n.createElement(V,{...e,vbarsUphookConfig:i})),n.createElement(P.k,{align:"end",justify:"end"},n.createElement(Ue,null))))},Bt=e=>{const[t,i]=n.useState(!1),a=n.useRef(),{incrementAcceptCount:s}=(0,T.a7)(Q.X.accept),{sidelineType:o}=e,l=e.isDefaultRewrite,d="pushed_content"===o,c=d&&!l,u=d&&l;n.useEffect((()=>()=>clearTimeout(a.current)),[]);const h=n.useCallback((()=>{var t,i;null===(t=e.onRegenerate)||void 0===t||t.call(e),null===(i=e.onFocusLost)||void 0===i||i.call(e)}),[e.onRegenerate,e.onFocusLost]);return n.createElement(P.k,{align:"end",justify:"space-between","data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar"},n.createElement(P.k,{align:"end",justify:"start",gap:2,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-left"},n.createElement(qe,{onboardingStep:Q.X.accept},n.createElement(Ze,{"aria-label":"Accept rewrite and return to doc",onClick:()=>{e.onApply(),s()},"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-apply-btn"},"Accept")),u&&n.createElement(H.z,{"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-dismiss-btn",variant:"tertiary","aria-label":"Dismiss recommendation and return to doc",size:"small",onClick:e.onDismiss},"Dismiss"),"translate"===e.rewriteType.kind&&n.createElement(_t,{...e.rewriteType.translationDirection,onChange:e.onTranslationTargetLanguageChange})),n.createElement(P.k,{align:"center",justify:"end",gap:2,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-right"},t&&n.createElement(P.k,{className:vt.sidelineCardRewriteCopyButtonCopyConfirmation,bgColor:"background-base-default"},n.createElement(D.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Copied")),n.createElement(H.z,{"data-testid":"grammarly-g2-sideline-feedback-btn",variant:"tertiary","aria-label":"Open feedback window to give feedback",size:"small",onClick:()=>e.onClickFeedbackButton()},"Feedback"),n.createElement(pt,{onCopy:async()=>{await e.onCopy(),i(!0),clearTimeout(a.current),a.current=setTimeout((()=>{i(!1)}),4e3)},onDismiss:c?e.onDismiss:void 0,onShowLess:"selection"!==o&&"pushed_content"!==o?()=>e.onShowLess(o):void 0,domain:e.domain}),e.onRegenerate&&e.onRegenerate!==r.Q1&&n.createElement(P.k,{className:vt.sidelineCardRewriteCopyButton},n.createElement(H.z,{"data-testid":"grammarly-g2-sideline-card-regenerate-btn",variant:"tertiary","aria-label":"Regenerate",title:"Regenerate",size:"small",onClick:h},n.createElement(F.J,{icon:dt.a,size:"small",accessibilityLabel:""}))),n.createElement(Ue,null)))};var xt=i(10792),Et=i(85639);const Rt=({title:e,text:t,onMount:i})=>(Y.P.useEffectOnDidMount((()=>i())),n.createElement(P.k,{direction:"column",height:"100%",justify:"center","data-testid":"grammarly-g2-sideline-card-rewrite-success",className:Et.sidelineCardRewriteSuccess},n.createElement(P.k,{"data-testid":"grammarly-g2-sideline-card-rewrite-success-main",align:"center",gap:4},n.createElement(F.J,{size:"small",accessibilityLabel:"",icon:xt.j}),n.createElement(P.k,{direction:"column","data-testid":"grammarly-g2-sideline-card-rewrite-success-main-content"},n.createElement(D.x,{className:Et.sidelineCardRewriteSuccessMainContentTitle,as:"strong",color:"brand-default",variant:"text-small"},e),n.createElement(D.x,{as:"p",variant:"text-small",color:"base-subdued"},t))),n.createElement(Ue,{className:Et.sidelineCardRewriteSuccessGrammarlyLogo}))),It=e=>n.createElement(P.k,{accessibilityLabel:Tt(e.kind),padding:3,direction:"column","aria-live":"error"===e.kind?"assertive":"polite","aria-busy":"loading"===e.kind,"data-testid":"grammarly-g2-sideline-card-rewrite",className:it.sidelineCardRewrite},(()=>{switch(e.kind){case"loading":return n.createElement(ot,{maxHeight:e.maxHeight,streamedText:e.newText,onMount:e.onMount,onStreamingStart:e.onStreamingStart});case"ready":return n.createElement(yt,{maxHeight:e.maxHeight,title:e.title,originalText:e.originalText,newText:e.newText,diffProps:e.diffProps,sidelineType:e.sidelineType,rewriteType:e.rewriteType,isDefaultRewrite:e.isDefaultRewrite,onApply:e.onApply,onCopy:e.onCopy,onRevert:e.onRevert,onDismiss:e.onDismiss,onMount:e.onMount,onRegenerate:e.onRegenerate,onClickFeedbackButton:e.onClickFeedbackButton,onTranslationTargetLanguageChange:e.onTranslationTargetLanguageChange,onShowUphookButton:e.onShowUphookButton,onClickUphookButton:e.onClickUphookButton,onShowLess:e.onShowLess,onFocusLost:e.onFocusLost,domain:e.domain,onRewriteTextChange:e.onRewriteTextChange,vBarsUphookConfigs:e.vBarsUphookConfigs,hideUphookFooter:e.hideUphookFooter,sidelineTextHash:e.sidelineTextHash});case"success":return n.createElement(Rt,{title:e.title,text:e.text,onMount:e.onMount});case"error":return n.createElement(tt,{errorDetails:e.errorDetails,errorReason:e.errorReason,onMount:e.onMount});default:(0,K.L0)(e)}})());function Tt(e){switch(e){case"loading":return"Loading suggestion content";case"ready":case"success":return"Suggestion content";case"error":return"An error occurred";default:(0,K.L0)(e)}}const Pt="";var Ft=i(85814);const Mt=({maxContentHeight:e,customPromptRewriteInfo:t,suggestedCustomPrompts:i,recentCustomPrompts:r,onGoBack:a,onChange:s,onSubmit:o})=>{const[l,d]=n.useState(""),c=n.useCallback((()=>{const e=l.trim();e.length>0&&o(e)}),[l]),u=n.useCallback((e=>{0===l.length&&"Backspace"===e.key&&(e.preventDefault(),e.stopPropagation(),a())}),[l]),h=i.length+r.length;return n.createElement(P.k,{className:Ft.sidelineCardCustomPrompt,direction:"column","data-testid":"grammarly-g2-sideline-card-custom-prompt"},n.createElement(P.k,{className:Ft.sidelineCardCustomPromptInput,align:"center",gap:{column:3},padding:2},n.createElement(Ze,{onClick:a,"aria-label":"Back to Grammarly suggestions","data-testid":"grammarly-g2-sideline-card-custom-prompt-back-button"},Pt),n.createElement("form",{className:Ft.sidelineCardCustomPromptInputForm,onSubmit:e=>{e.preventDefault(),c()}},n.createElement("input",{autoFocus:!0,type:"text",className:Ft.sidelineCardCustomPromptInputField,"aria-label":"Enter your prompt. Matching results will display in the search results group. Press enter to activate your prompt, or tab to navigate through other matching options.",placeholder:"Enter your prompt",onChange:e=>{d(e.target.value),s(e.target.value.trim())},onKeyDown:u,"data-testid":"grammarly-g2-sideline-card-custom-prompt-input-field"}),n.createElement("input",{type:"submit",style:{display:"none"},"data-testid":"grammarly-g2-sideline-card-custom-prompt-input-form-submit"})),l.trim().length>0&&n.createElement(Ze,{onClick:()=>c()},"Submit")),t?n.createElement(It,{...t,maxHeight:e}):n.createElement(P.k,{className:Ft.sidelineCardCustomPromptSuggestedResults,direction:"column",gap:{row:2},padding:2},n.createElement("p",{className:Ft.liveAnnouncement,"aria-live":"polite","aria-atomic":"true"},0===h?"There are no suggested prompts":`${h} suggested ${(0,Je._6)(h,"prompt","prompts")} found`),n.createElement(D.x,{as:"p",color:"base-subdued",variant:"text-xsmall",className:Ft.sidelineCardCustomPromptSuggestedResultsSubtitle},"Tell us how to change this text.",i.length>0?" Try ideas below:":""),i.map((e=>n.createElement(Ze,{key:e,className:Ft.sidelineCardCustomPromptSuggestedResultsOption,"aria-label":`Submit suggested prompt: ${e}`},n.createElement(F.J,{icon:Ye.p,accessibilityLabel:"",size:"small"}),e))),r.length>0&&n.createElement(D.x,{as:"p",color:"base-subdued",variant:"text-xsmall",className:Ft.sidelineCardCustomPromptSuggestedResultsSubtitle},"Recent"),r.map((e=>n.createElement(Ze,{key:e,className:Ft.sidelineCardCustomPromptSuggestedResultsOption,"aria-label":`Submit recent prompt: ${e}`},n.createElement(F.J,{icon:Ke.w,accessibilityLabel:"",size:"small"}),e)))))},Dt=n.forwardRef((({id:e,label:t,accessibilityDescription:i,selected:r,onClick:a},s)=>n.createElement(n.Fragment,null,n.createElement(H.z,{id:e,ref:s,"aria-label":t,"aria-describedby":`${e}-description`,"aria-pressed":r,variant:"tertiary",onClick:()=>{a(e)}},n.createElement(D.x,{as:"span",variant:"text-xsmall"},t)),n.createElement("p",{id:`${e}-description`,className:We.a11yDescription,"aria-hidden":!0},i)))),Lt=({rewrites:e,rewriteTabsOrder:t,tabListPosition:i,expanded:r,firstTabRef:a,firstExpandedTabRef:s,activeTabRef:o,selectedRewriteTabId:l,collapsedButtonsNumber:d,onSelectedRewriteChange:c,onClickMore:u,onClickCustomPromptEntryPoint:h})=>{const g=t.map((t=>e.get(t))).filter((e=>void 0!==e)),m=g.slice(0,d),p=g.slice(d),v=n.useRef(null);return n.createElement(P.k,{justify:"space-between","data-testid":"grammarly-g2-sideline-card-tabslist"},n.createElement(qe,{onboardingStep:Q.X.rewriteOptions,className:We.sidelineCardFtuxRewrites},n.createElement(P.k,null,n.createElement("div",{role:"group","aria-label":"Rewrite actions"},n.createElement(P.k,{gap:3},m.map(((e,t)=>{const r=n.createElement(Dt,{key:e.tabId,id:e.tabId,label:e.buttonProps.label,ref:(0,me.l)([0===t?a:void 0,e.tabId===l?o:void 0,e.tabId===l?v:void 0]),accessibilityDescription:e.buttonProps.accessibilityDescription,selected:e.tabId===l,onClick:c});if(e.tabId===he.U.translate.rewrite.rewriteTabId){const t=(()=>{switch(i){case"top":return"bottom-start";case"bottom":return"top-start";default:return}})();return n.createElement(re,{key:e.tabId,placement:t},r)}return r})),!r&&p.length>0?n.createElement(Dt,{id:"more",label:"More",accessibilityDescription:"Reveal more rewrite options. The more action will go away, and focus will be on the first of the 3 new actions.",onClick:u}):p.map(((e,t)=>n.createElement(Dt,{key:e.tabId,id:e.tabId,label:e.buttonProps.label,ref:(0,me.l)([0===t?s:void 0,e.tabId===l?o:void 0,e.tabId===l?v:void 0]),accessibilityDescription:e.buttonProps.accessibilityDescription,selected:e.tabId===l,onClick:c}))))))),n.createElement(P.k,{marginRight:3,align:"center"},n.createElement(qe,{onboardingStep:Q.X.customPrompt,className:We.sidelineCardFtuxCustomPromptEntryPoint,onClose:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.focus()}},n.createElement("button",{"aria-label":"Enter your own custom rewrite. Navigate to the Grammarly prompt.",className:We.sidelineCardCustomPromptEntryPoint,onClick:h,"data-testid":"grammarly-g2-sideline-card-custom-prompt-entry-point",type:"button"},"Enter your own..."))))},At=e=>"customPrompt"===e.selectedTabId?e.customPromptRewriteInfo:e.rewrites.get(e.selectedTabId),Ot=e=>{const t=At(e),i={maxHeight:e.maxContentHeight,onFocusLost:e.onFocusLost,onRewriteTextChange:e.onRewriteTextChange};return t?n.createElement(It,{...t,...i}):null};const Ut=n.forwardRef((function({maxHeight:e=200,tabListPosition:t,sidelineCard:i,initialSelectedRewriteTabId:r,rewrites:a,rewriteTabsOrder:s,expanded:o,suggestedCustomPrompts:l,recentCustomPrompts:d,customPromptRewriteInfo:c,onChangeCustomPrompt:u,onSubmitCustomPrompt:h,onChangeSelectedRewriteTab:g,onClickMoreTab:m,onShow:p,onClose:v,onDismiss:f,onDisable:S,onMultilingualOnboardingDismiss:w,onMultilingualOnboardingShown:b,shouldShowMultilingualOnboarding:C,onSetBannerHeight:_,shouldShowAIEditorPromotion:y,aiEditorPromotionCTA:k},B){const[x,E]=n.useState(!1),[R,I]=n.useState(r),[T,P]=n.useState(r),[F,M]=n.useState(""),D=n.useRef(r),L=n.useRef(null),A=n.useRef(null),O=n.useRef(null),U=n.useRef(null);n.useEffect((()=>{D.current!==T&&(D.current=T,g(T),x||E(!0))}),[T]),n.useEffect((()=>{p(i),null!==U.current&&v(U.current),U.current=i}),[i.sideline.id]),n.useEffect((()=>{requestAnimationFrame((()=>{var e;i.shouldFocus&&(null===(e=L.current)||void 0===e||e.focus())}))}),[i.sideline.id]),n.useEffect((()=>{_("hidden"===t?0:y?40:C?52:0)}),[C,y,t]),Y.P.useEffectOnWillUnmount((()=>v(i)));const z=n.createElement(Lt,{rewrites:a,rewriteTabsOrder:s,tabListPosition:t,expanded:o,selectedRewriteTabId:T,onClickCustomPromptEntryPoint:()=>{I(T),P("customPrompt"),u("")},onClickMore:()=>{m(),setTimeout((()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.focus()}),0)},onSelectedRewriteChange:e=>{if("customPrompt"!==e){const t=e;if(t!==T)P(t);else{const e=At({rewrites:a,selectedTabId:T});e&&"ready"===e.kind&&e.onApply(F)}}},firstTabRef:L,firstExpandedTabRef:O,activeTabRef:A,collapsedButtonsNumber:(0,J.iT)()?3:2}),H=e-40-24,G=()=>{switch(i.kind){case"rewrite-card":return n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-content"},n.createElement(Ot,{maxContentHeight:H,rewrites:a,selectedTabId:T,onFocusLost:()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.focus()},onRewriteTextChange:e=>M(e)}));case"plagiarism-card":return n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-content"},n.createElement(He,{title:i.resourceTitle,referenceText:i.reference,onDismiss:()=>{f(i.contentId)},onCopy:()=>{(0,pe.v)(i.reference)}}));case"lazy-rewrite-card":return n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-content"},n.createElement(Le,{sourceAction:i.sourceAction,contentId:i.contentId,title:i.title,maxHeight:H,rewrite:a.get(T),onDismiss:f,onDisable:S}));default:(0,K.L0)(i)}},V=At({rewrites:a,selectedTabId:r}),q=C&&(x||"loading"!==(null==V?void 0:V.kind))&&"hidden"!==t?n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-multilingualOnboarding"},n.createElement(ge,{onDismiss:w,onShown:b,placement:"top"===t?"bottom":"top"})):null,N=y&&k&&"hidden"!==t?n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-aiEditorPromotion"},n.createElement(de,{title:k.title,iconUrl:k.iconUrl,actionUrl:k.actionUrl,showLabelNew:k.showLabelNew,placement:"top"===t?"bottom":"top",onClick:null==V?void 0:V.onCtaClick})):null;return n.createElement("div",{ref:B,className:We.sidelineCard,"data-testid":"grammarly-g2-sideline-card"},n.createElement($e,null,"customPrompt"===T?n.createElement(Mt,{maxContentHeight:H,suggestedCustomPrompts:null!=l?l:[],recentCustomPrompts:null!=d?d:[],customPromptRewriteInfo:c,onGoBack:()=>P(R),onChange:u,onSubmit:h}):n.createElement("div",null,"hidden"===t?G():n.createElement(n.Fragment,null,"top"===t?z:n.createElement(n.Fragment,null,N,q,G()),n.createElement("div",{className:We.sidelineCardHorizontalDivider}),"bottom"===t?z:n.createElement(n.Fragment,null,G(),q,N)))))}));var zt=i(49177),Ht=i(1087);const Gt=({notification:e})=>{const t=n.useRef(null);return n.useEffect((()=>{if(t.current&&e.referenceElement){const i=(0,zt.fi)(e.referenceElement,t.current,{placement:"right",strategy:"fixed"});return()=>{i.destroy()}}return()=>{}}),[e.referenceElement]),n.createElement("div",{ref:t,key:"vbarNotification",className:We.sidelineCard},n.createElement(P.k,{gap:2,padding:4},n.createElement(P.k,{flex:"auto 0"},n.createElement(F.J,{icon:Ht.L,accessibilityLabel:""})),n.createElement(P.k,{flex:"auto 1"},n.createElement(D.x,{as:"span",variant:"text-medium"},e.text))))};var Vt=i(85427),qt=i(79118),Nt=i(52654),jt=i(19220),$t=i(90245),Wt=i(99146);const Yt={name:"flip",enabled:!1},Kt={name:"eventListeners",enabled:!1},Jt=({referenceElement:e,additionalEventSources:t=[],additionalIgnoredEventSources:i=[],onMouseEnter:r,onMouseLeave:a,onFocus:s,onClickAway:o,onEscPress:l,contentWrapperHeight:d=0,children:c})=>{const[u,h]=n.useState(null),[g,m]=n.useState(void 0),p=n.useMemo((()=>({...Vt.Z,options:{offset:({placement:e})=>["right-end"===e?0:$t.gK+4,$t.TM]}})),[]),v=n.useMemo((()=>({name:"maxHeight",enabled:!0,phase:"main",requiresIfExists:["offset"],fn({name:e,state:t,options:i}){if(t.modifiersData[e]._skip)return;const r=(0,qt.Z)({...t,placement:"top-start"},i),n=(0,qt.Z)({...t,placement:"bottom-start"},i),{height:a}=t.rects.popper,s=a-r.top-$t.TM-d,o=a-n.bottom-$t.TM-d,l=200+d;s<l&&o<l?(t.modifiersData[e]._skip=!0,t.placement="right-end",t.reset=!0,m(t.rects.reference.height+s)):o>=s?(t.modifiersData[e]._skip=!0,t.placement="bottom-start",t.reset=!0,m(o)):(t.modifiersData[e]._skip=!0,t.placement="top-start",t.reset=!0,m(s))},data:{_skip:!1}})),[d]),{styles:f,attributes:S,state:w}=(0,Nt.D)(e,u,{placement:"bottom-start",modifiers:[p,Yt,v,Kt]});return n.useEffect((()=>{const e="keydown",t=e=>{"Escape"===e.key&&(e.stopImmediatePropagation(),l(e))};return document.addEventListener(e,t,true),()=>{document.removeEventListener(e,t,true)}}),[l]),n.createElement(jt.d,{onClickAway:o,additionalEventSources:t,additionalIgnoredEventSources:i,onCapturePhase:!0},n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-popper",role:"dialog","aria-label":"Grammarly suggestion. Pressing ESC will close this window and return you to your doc.",tabIndex:0,ref:h,style:f.popper,className:Wt.sidelineCardPopper,onMouseEnter:r,onMouseLeave:a,onFocus:s,...S.popper},c({placement:null==w?void 0:w.placement,maxHeight:g})))};var Qt=i(10444),Zt=i(70558);var Xt=i(22268),ei=i(24679),ti=i(12001),ii=i(86149),ri=i(738),ni=i(65812),ai=i(63834),si=i(25207),oi=i(65688);var li=i(17109);function di(e){var t,i;return void 0!==e&&void 0!==e.surface&&"vBar"===(null===(i=null===(t=null==e?void 0:e.notification)||void 0===t?void 0:t.notificationElement)||void 0===i?void 0:i.kind)&&a.h.isWithRewriteOrComment(e)}function ci(e,t){if(di(e)){const i=e.surface.sourceAgent;return t&&(0,li.Z)(i)?t.getAgentIdForInstance(i):i}}function ui(e){var t,i;return void 0!==e&&void 0!==e.surface&&"vBar"===(null===(i=null===(t=null==e?void 0:e.notification)||void 0===t?void 0:t.notificationElement)||void 0===i?void 0:i.kind)&&a.h.isWithComment(e)}const hi=[B.A,k.Hq,x.Z].join(","),gi=({agentDirectoryService:e,sidelineCard:t,pushedContentCardOverrides:i,vBarsQuotaInfo:a,vBarsUphookConfigs:s,onboardingService:o,aiEditorPromotionService:l,multilingualOnboardingService:m,translateOnboardingService:v,getSidelineCardState:f,onActivateSidelineCard:S,onDeactivateSidelineCard:w,onChangeSelectedRewriteTab:y,onMountRewriteLoading:k,onMountRewriteEmpty:B,onMountRewriteReady:x,onMountRewriteError:R,onApplyRewrite:I,onCopyRewrite:P,onRevertRewrite:F,onDismissRewrite:M,onDeactivateSidelineType:D,onRegenerateRewrite:L,onChangeCustomPrompt:A,onSubmitCustomPrompt:O,onClickMoreTab:U,onClickFeedbackButton:z,onTranslationTargetLanguageChange:H,onShow:G,onClose:V,onDismiss:q,onDisable:N,onShowUphookButton:j,onClickUphookButton:$,onCtaClick:W,onStreamingStart:Y,onPushedContentAction:J,onPushedContentCommentCardDismiss:Q,onPushedContentCommentCardCopy:Z,onPushedContentCommentCardMarkResolved:X,onPushedContentCommentCardGenerateCitationClicked:ee,integration:te})=>{const[ie,re]=n.useState(null),[ne,ae]=n.useState(0),se=(e,t,i,n)=>function(e){const{rewrite:t,isDefaultRewrite:i,sidelineType:n,onMountRewriteLoading:a,onMountRewriteEmpty:s,onMountRewriteReady:o,onMountRewriteError:l,onApplyRewrite:d,onCopyRewrite:c,onRevertRewrite:u,onDismissRewrite:h,onRegenerateRewrite:g,onClickFeedbackButton:m,onTranslationTargetLanguageChange:v,onStreamingStart:f,onShowUphookButton:S,onClickUphookButton:w,onDeactivateSidelineType:b,domain:C,hideUphookFooter:_,onCtaClick:y}=e;if("loading"===t.kind||"idle"===t.kind){const e="loading"===t.kind;return{tabId:t.rewriteTabId,kind:"loading",newText:e?t.rewriteTextPartial:void 0,onMount:()=>a(t),onStreamingStart:e?()=>f(t):r.Q1,rewriteType:t.type,onCtaClick:()=>y(t)}}return"ready"===t.kind?t.vBar.text===t.rewriteText&&"translate"!==t.type.kind?{tabId:t.rewriteTabId,kind:"success",title:"This text is well-written",text:"To see a different version, select a rewrite option.",onMount:()=>s(t),rewriteType:t.type,onCtaClick:()=>y(t),onApply:()=>d(t),onDismiss:()=>h(t),onCopy:()=>{c(t)}}:{tabId:t.rewriteTabId,kind:"ready",title:t.title,originalText:t.vBar.text,sidelineTextHash:t.vBar.textHash,newText:t.rewriteText,diffProps:(0,r.zG)(t.rewriteDiff,p.UI((e=>({diff:e,displayDeletes:"improve"===t.type.kind,accessibilityLabel:Qt.MH(t.accessibilityLabel)})))),sidelineType:n,rewriteType:t.type,isDefaultRewrite:i,onMount:()=>o(t),onApply:e=>d({...t,rewriteText:e}),onCopy:()=>c(t),onRevert:()=>u(t),onDismiss:()=>h(t),onShowLess:e=>b(e,t),domain:C,onRegenerate:(0,Zt.es)(t.type)?r.Q1:()=>g(t),onClickFeedbackButton:()=>m(t),onTranslationTargetLanguageChange:v(t),onShowUphookButton:S,onClickUphookButton:w,vBarsUphookConfigs:e.vBarsUphookConfigs,hideUphookFooter:_,onCtaClick:()=>y(t)}:"error"===t.kind?{tabId:t.rewriteTabId,kind:"error",errorDetails:t.errorDetails,errorReason:t.errorReason,onMount:()=>l(t),rewriteType:t.type,onCtaClick:()=>y(t)}:void(0,K.L0)(t)}({rewrite:e,isDefaultRewrite:n,sidelineType:t.sideline.kind,onMountRewriteLoading:e=>k(e,t),onMountRewriteEmpty:e=>B(e,t),onMountRewriteReady:e=>{x(e,t,i),he()},onMountRewriteError:e=>R(e,t),onApplyRewrite:e=>I(e,t),onCopyRewrite:e=>P(e,t),onRevertRewrite:e=>F(e,t),onDismissRewrite:e=>M(e,t),onRegenerateRewrite:e=>L(e,t),onClickFeedbackButton:e=>z(e,t),onTranslationTargetLanguageChange:e=>i=>H(e,t,i),onStreamingStart:e=>Y(e,t),onShowUphookButton:i?()=>j(e.type,t):r.Q1,onClickUphookButton:i?()=>$(e.type,t):r.Q1,onCtaClick:e=>W(e,t),onDeactivateSidelineType:(e,i)=>D(e,i,t),domain:te.info.domain,vBarsUphookConfigs:s,hideUphookFooter:ce&&i}),oe=(0,E.PD)((0,_.OB)().experimentClient),le=(0,E.MQ)((0,_.OB)().experimentClient),de=(0,E.F6)((0,_.OB)().experimentClient),ce=(0,E.I)((0,_.OB)().experimentClient),ue=n.useRef(null),he=n.useCallback((()=>{var e;null===(e=ue.current)||void 0===e||e.triggerDelayedShimmer()}),[]);return n.createElement(d.F.Fragment,null,t.pipe(u.U(p.hX(b.isCard)),u.U(p.WG),h.O(null),g.G()).pipe(u.U((([t,r])=>{var u;const h=null!=r?r:t,g=h?f(h):null;return n.createElement(T.kZ,{onboardingService:o,rootElement:ie,sideline:h?h.sideline:null},n.createElement(C.q,{show:null!==r,transitionDurationMs:150},h&&g&&n.createElement(Jt,{referenceElement:h.referenceElement,contentWrapperHeight:(p.pC(a.get())?36:0)+ne,onMouseEnter:()=>S(h,!1),onMouseLeave:()=>w(h,!1),onFocus:()=>S(h,!0),onClickAway:()=>w(h,!0),onEscPress:()=>w(h,!0),additionalEventSources:(null===(u=te.additionalGlobalEventSource)||void 0===u?void 0:u.click)?[te.additionalGlobalEventSource.click]:[],additionalIgnoredEventSources:Array.from(document.querySelectorAll(hi))},(({placement:t,maxHeight:r})=>n.createElement(d.F.Fragment,null,"default"===h.source.kind||"lazy-rewrite-card"===h.kind?c.h.combine(g,a,m.shouldBeShownPrioritized,l.shouldBeShownPrioritized,l.callToAction,((e,i,n,a,o)=>mi(e,i,h,se,ce,j,$,v,oe,le,de,ue,n,a,o,r,t,A,O,y,U,G,V,q,N,m,ae,s))):c.h.combine(g,i,((e,t)=>({state:e,overrides:t}))).view((({state:i,overrides:r})=>{var a;return n.createElement(Si,{state:i,onShow:G,sidelineCard:h,placement:t,cardOverrides:r.get(null!==(a=ci(i.pushedContentItem,e))&&void 0!==a?a:""),onPushedContentCommentCardDismiss:Q,onPushedContentCommentCardCopy:Z,onPushedContentCommentCardMarkResolved:X,onPushedContentCommentCardGenerateCitationClicked:ee,getRewriteProps:se,onShowUphookButton:j,onClickUphookButton:$,onPushedContentAction:J})})))))),n.createElement("div",{ref:re,style:{height:0,width:0}}))}))),t.pipe(u.U(p.hX(b.isNotification)),u.U(p.UI((e=>n.createElement(Gt,{key:"vBarNotification",notification:e})))),u.U(p.WG)))},mi=(e,t,i,a,s,o,l,d,c,u,h,g,m,v,f,S,b,C,y,k,B,x,R,I,T,P,F,M)=>{const{rewrites:D,rewriteTabsOrder:L,customPromptRewriteInfo:A,selectedRewriteTabId:O,expanded:U}=e,{quota:z,showUphook:H}=(0,r.zG)(t,p.UI((e=>({quota:e.quota,showUphook:(0,E.Qj)(e,i.sideline.textHash)}))),p.pF((()=>({showUphook:!1,quota:void 0})))),G=new Map(Array.from(D.values()).map(((e,t)=>({...a(e.rewrite,i,H,0===t),buttonProps:e.buttonProps}))).map((e=>[e.tabId,e]))),V=s?G.get(null!=O?O:""):void 0,q=V?()=>o(V.rewriteType,i):r.Q1,N=V?()=>l(V.rewriteType,i):r.Q1,j=(0,E.R)((0,_.OB)().experimentClient);return n.createElement(w,{translateOnboardingService:d},n.createElement($,{ref:g,quota:z,showUphook:H,shouldRemoveVbarsSampleCounter:c,shouldShimmerOnOpen:u,shouldShimmerAfterLoad:h,shouldRotateCopyText:j,showUphookInTitle:s,onShowUphookButton:q,onClickUphookButton:N,sidelineType:i.sideline.kind,vBarsUphookConfigs:M,textHash:i.sideline.textHash},n.createElement(Ut,{key:i.sideline.id,shouldShowMultilingualOnboarding:m,shouldShowAIEditorPromotion:v,aiEditorPromotionCTA:f,initialSelectedRewriteTabId:null!=O?O:"improve",maxHeight:S,tabListPosition:"rewrite-card"===i.kind&&i.showHeader?"top-start"===b?"bottom":"top":"hidden",sidelineCard:i,rewrites:G,rewriteTabsOrder:null!=L?L:[],expanded:null!=U&&U,customPromptRewriteInfo:(0,r.zG)(A,p.UI((e=>a(e,i,H,!1))),p.pF(r.r5)),onChangeCustomPrompt:e=>C(e,i),onSubmitCustomPrompt:e=>y(e,i),onChangeSelectedRewriteTab:e=>{k(e,i)},onClickMoreTab:()=>B(i),onShow:e=>{x(e,H)},onClose:e=>{R(e)},onDismiss:e=>I(e),onDisable:e=>T(e),onMultilingualOnboardingDismiss:()=>{P.onOnboardingDismiss()},onMultilingualOnboardingShown:()=>{P.incrementOnboardingShowsCount()},onSetBannerHeight:F})))},pi=e=>{const t=null==e?void 0:e.surface;return t&&"title"in t&&"string"==typeof t.title?t.title:"Grammarly"},vi=(e,t)=>{var i;if(di(e)){const r=null===(i=null==t?void 0:t.getCardTitle)||void 0===i?void 0:i.call(t,e);if(void 0!==r)return"string"==typeof r?r:r.pipe(u.U((t=>null!=t?t:pi(e))))}return pi(e)},fi=(e,t)=>{var i;if(di(e)){const r="sourceAgent"in e.surface&&"AgentPromotion"===e.surface.sourceAgent&&"availableActions"in e.surface&&e.surface.availableActions.filter((e=>"launchAgentAction"===e.type)).at(0),n=r&&(e=>{switch(e){case"AIGrader":return Xt._;case"aiDetector":return ei.b;case"citationFinder":return ti.k;case"expertPanel":return ii.F;case"humanizer":return ri.i;case"paraphraser":return ni.y;case"plagiarism":return ai.L;case"proofreader":return si.O;case"readerReactions":return oi.Q;default:return}})(r.agentId);return n?{icon:n}:null===(i=null==t?void 0:t.getCardIcon)||void 0===i?void 0:i.call(t,e)}},Si=({state:e,onShow:t,sidelineCard:i,getRewriteProps:u,placement:h,onShowUphookButton:g,onClickUphookButton:S,onPushedContentAction:w,onPushedContentCommentCardDismiss:b,onPushedContentCommentCardMarkResolved:C,onPushedContentCommentCardCopy:_,onPushedContentCommentCardGenerateCitationClicked:k,cardOverrides:B})=>{var x,E;const R=null===(x=e.rewrites.get("improve"))||void 0===x?void 0:x.rewrite,T=n.useMemo((()=>void 0!==R&&"ready"===R.kind&&void 0!==e.pushedContentItem&&void 0!==e.pushedContentItem.surface&&a.h.isWithRewrite(e.pushedContentItem)&&"Some"===R.rewriteDiff._tag?p.G(s.Z.create(e.pushedContentItem,R.rewriteDiff.value,"resetState")):p.YP),[void 0!==R&&"ready"===R.kind&&void 0!==e.pushedContentItem&&void 0!==e.pushedContentItem.surface&&a.h.isWithRewrite(e.pushedContentItem)&&"Some"===R.rewriteDiff._tag,i.sideline.id]);n.useEffect((()=>{t(i,p.pC(T))}),[i.sideline.id]);const P=e.pushedContentItem;n.useEffect((()=>{var e;"uphookRewriteCard"!==(null==P?void 0:P.surface.kind)&&"uphookComment"!==(null==P?void 0:P.surface.kind)||g(null!==(e=null==R?void 0:R.type)&&void 0!==e?e:{kind:"other",textActionId:""},i)}),[i.sideline.id,null===(E=null==P?void 0:P.surface)||void 0===E?void 0:E.kind]);const{isGoEnabledForInstitution:F}=(0,f.q)();if(void 0===P)return null;const M="top-start"===h?"bottom":"top",D=vi(P,B);let L,A=fi(P,B);const O=null!=F?F:(0,y.i)();return O&&(A?L=(0,v.Mc)(A):A={icon:l.O,size:"medium"}),(0,r.zG)(T,p.g_((()=>n.createElement(o.X,{visible:c.h.create(!0),alignment:M,title:D,item:e.pushedContentItem,rewriteViewModel:T,navigationEnabled:m.of(!1),apply:r.Q1,dismiss:()=>{ui(P)&&(0,I._)(i.sideline)&&b(i.sideline)},markResolved:()=>{ui(P)&&(0,I._)(i.sideline)&&C(i.sideline)},onGenerateCitationClicked:()=>{ui(P)&&(0,I._)(i.sideline)&&k(i.sideline)},prev:r.Q1,next:r.Q1,onCopy:e=>{ui(P)&&(0,I._)(i.sideline)&&_(i.sideline,e)},openUphook:()=>{var e;return S(null!==(e=null==R?void 0:R.type)&&void 0!==e?e:{kind:"other",textActionId:""},i)},onPushedContentAction:e=>{w(i,e)},overrides:B,iconProps:A,isGoBrandingEnabled:O,agentIconProps:L})),(t=>n.createElement(d.F.Fragment,null,t.state.view((t=>{const a=wi(R,t),s=(()=>{if(void 0!==a)return u(a,i,!1,!0)})(),l=bi(a,s);return n.createElement(o.X,{visible:c.h.create(!0),alignment:M,title:D,item:e.pushedContentItem,rewriteViewModel:T,navigationEnabled:m.of(!1),apply:l.apply,dismiss:l.dismiss,markResolved:()=>{ui(P)&&(0,I._)(i.sideline)&&C(i.sideline)},onGenerateCitationClicked:()=>{ui(P)&&(0,I._)(i.sideline)&&k(i.sideline)},prev:r.Q1,next:r.Q1,onCopy:l.copy,openUphook:()=>{var e;S(null!==(e=null==a?void 0:a.type)&&void 0!==e?e:{kind:"other",textActionId:""},i)},onPushedContentAction:e=>{w(i,e)},overrides:B,iconProps:A,isGoBrandingEnabled:O,agentIconProps:L})}))))))};function wi(e,t){if(void 0===e)return;if("ready"!==(null==e?void 0:e.kind))return e;const i=t.diff;return{...e,rewriteDiff:i,rewriteText:(0,r.zG)(i,p.UI((t=>(0,R.Ns)(e.vBar.text,t))),p.fS((()=>e.vBar.text)))}}function bi(e,t){return"ready"!==(null==(i=t)?void 0:i.kind)&&"success"!==(null==i?void 0:i.kind)?{apply:r.Q1,copy:r.Q1,dismiss:r.Q1}:{apply:"ready"===(null==e?void 0:e.kind)?()=>{t.onApply(e.rewriteText)}:r.Q1,copy:()=>{t.onCopy()},dismiss:()=>{t.onDismiss()}};var i}},38705:(e,t,i)=>{i.r(t),i.d(t,{SidelineCollection:()=>X});var r=i(38538),n=i(90023),a=i(92379),s=i(13391),o=i(33885),l=i(58303),d=i(56817),c=i(78767),u=i(74702),h=i(16131),g=i(85837),m=i(86211),p=i(90189),v=i(3038),f=i(70843),S=i(25693),w=i(90245);var b=i(36279),C=i(78953),_=i(65338);const y=a.createContext(null),k=({children:e})=>{const[t,i]=a.useState(null),[r,n]=a.useState(null),s=a.useMemo((()=>({activeVBarId:t,hoveredVBarId:r,setActiveVBarId:i,setHoveredVBarId:n})),[t,r]);return a.createElement(y.Provider,{value:s},e)},B=()=>{const e=a.useContext(y);if(!e)throw new Error("useVBarContext must be used within a VBarContextProvider");return e},x=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",...e},a.createElement("path",{d:"M7.29314 10.707C6.90261 10.3164 6.90261 9.68343 7.29314 9.29291C7.68367 8.90247 8.31671 8.90241 8.7072 9.29291L12.0002 12.5859L15.2931 9.29291L15.3693 9.22455C15.7621 8.90428 16.3411 8.92682 16.7072 9.29291C17.0733 9.659 17.0958 10.238 16.7756 10.6308L16.7072 10.707L12.7072 14.707C12.3167 15.0975 11.6837 15.0975 11.2931 14.707L7.29314 10.707Z",fill:"currentColor"}));function E(e){const{isVisible:t,vBarId:i,onShow:r,onHide:n}=e,s=a.useRef(!1),o=a.useRef(i);a.useEffect((()=>()=>{s.current&&n()}),[]),a.useEffect((()=>{s.current!==t&&(s.current=t,t?r():n())}),[t,r,n]),a.useEffect((()=>{o.current!==i&&t&&r(),o.current=i}),[t,i,r])}x.__brand="nocolor";var R=i(52654),I=i(31702),T=i(39831);const P=a.createContext(null),F=({children:e})=>{const t=a.useRef(new Map),[i,r]=a.useState(new Set),n=a.useCallback((()=>{const e=(e=>{if(0===e.length)return[];const t=[...e].sort(((e,t)=>{const i=e.element.getBoundingClientRect(),r=t.element.getBoundingClientRect();return i.top-r.top})),i=[],r=[];for(const e of t){const t=e.element.getBoundingClientRect();let n=!1;for(const e of i){const i=e.element.getBoundingClientRect();if(t.top<i.bottom&&t.bottom>i.top){n=!0;break}}r.push({vBarId:e.vBarId,shouldHide:n}),n||i.push(e)}return r})(Array.from(t.current.values()));for(const t of e)t.shouldHide?r((e=>{if(e.has(t.vBarId))return e;const i=new Set(e);return i.add(t.vBarId),i})):r((e=>{if(!e.has(t.vBarId))return e;const i=new Set(e);return i.delete(t.vBarId),i}))}),[]),s=a.useCallback((e=>{t.current.set(e.vBarId,e),n()}),[]),o=a.useCallback((e=>{t.current.delete(e),r((t=>{if(!t.has(e))return t;const i=new Set(t);return i.delete(e),i})),n()}),[]),l=a.useMemo((()=>({registerComment:s,unregisterComment:o,hiddenCommentVBarIds:i})),[s,o,i]);return a.createElement(P.Provider,{value:l},e)},M=()=>{const e=a.useContext(P);if(!e)throw new Error("useVBarCommentCollisionManager must be used within a VBarCommentCollisionManagerProvider");return e},D=({vBarId:e,vBarPosition:t,show:i,shouldAnimateOnShow:r,comment:n,children:s})=>{const[o,l]=a.useState(null),[d,c]=a.useState(null),[u,h]=a.useState(null),m=(e=>{const{hoveredVBarId:t}=B();return t===e})(e),p=(e=>{const{activeVBarId:t}=B();return t===e})(e),v=(e=>{const{activeVBarId:t,hoveredVBarId:i}=B();return null!==t&&t!==e||null!==i&&i!==e})(e),f=(e=>{const{hiddenCommentVBarIds:t}=M();return t.has(e)})(e),{registerComment:S,unregisterComment:w}=M(),b=a.useMemo((()=>({name:"commentCollisionRegistration",enabled:!0,phase:"afterWrite",fn({state:t}){S({element:t.elements.popper,vBarId:e})}})),[S,e]);a.useEffect((()=>()=>{w(e)}),[w,e]);const{styles:_,attributes:y,forceUpdate:k}=(0,R.D)(o,d,{placement:"left",strategy:"fixed",modifiers:[{name:"arrow",options:{element:u}},{name:"preventOverflow",options:{rootBoundary:"viewport"}},{name:"flip",options:{fallbackPlacements:["right"]}},{name:"offset",options:{offset:[0,10]}},b]}),x=a.useRef(t);a.useEffect((()=>{const e=x.current;e.top===t.top&&e.left===t.left||null==k||k(),x.current=t}),[t,k]);const E=a.Children.only(s);return a.createElement(a.Fragment,null,a.cloneElement(E,{ref:(0,C.l)([(0,C.O)(E)?E.ref:void 0,l])}),!!n&&i&&a.createElement("div",{ref:c,className:(0,g.Sh)(T.vBarComment,r?T.vBarCommentAnimatedOnShow:void 0,m?T.vBarCommentHovered:void 0,p?T.vBarCommentActive:void 0,v?T.vBarCommentDimmed:void 0,f?T.vBarCommentHidden:void 0).className,style:_.popper,"data-testid":"superhuman-vbar-comment",...y.popper},a.createElement(I.x,{as:"span",variant:"text-xsmall",color:"base-subdued"},n),a.createElement("div",{ref:h,className:T.vBarCommentArrow,style:_.arrow,"data-testid":"superhuman-vbar-comment-arrow"})))},L=a.forwardRef((({vBarId:e,vBarPosition:t,heightInPixels:i,isActive:r,onMount:n,onShow:s,onHide:o,showCaretInsideDot:l,dotSize:d="regular",onMouseEnter:c,onMouseLeave:u,onClick:h,onFocus:m,comment:p,shouldAnimateOnShow:v=!1},f)=>{const{setActiveVBarId:S,setHoveredVBarId:y}=B(),k=a.useRef(null),R=function(e,t=1){const[i,r]=a.useState(!1);return a.useEffect((()=>{const i=e.current;if(!i)return;const n=new IntersectionObserver((e=>{e.forEach((e=>{r(e.isIntersecting)}))}),{threshold:t});return n.observe(i),()=>n.disconnect()}),[]),i}(k),I=i<24,[T,P]=a.useState(!1);a.useEffect((()=>n()),[]),a.useEffect((()=>{S(r?e:t=>t===e?null:t)}),[r,e,S]),E({isVisible:!0,vBarId:e,onShow:s,onHide:o});const F=a.useCallback((t=>{y(e),c(t)}),[c,y,e]),M=a.useCallback((e=>{y(null),u(e)}),[u,y]),L=a.useCallback((e=>{"::before"===e.pseudoElement&&P(!0)}),[]);return a.createElement("button",{"data-testid":"superhuman-vbar",ref:(0,C.l)([k,f]),className:(0,g.Sh)(_.vBar,r?_.vBarActive:void 0,I?_.vBarTooShort:void 0,v?_.vBarAnimatedOnShow:void 0,"large"===d?_.vBarDotSizeLarge:void 0,"regular"===d?_.vBarDotSizeRegular:void 0).className,style:{width:w.gK,height:`${i}px`},onMouseEnter:F,onMouseLeave:M,onClick:h,onFocus:m},a.createElement(D,{vBarId:e,vBarPosition:t,show:R&&(!v||T),shouldAnimateOnShow:v,comment:p},a.createElement("div",{"data-testid":"superhuman-vbar-dot",className:_.vBarDot,onAnimationEnd:L},l&&a.createElement(b.J,{"data-testid":"superhuman-vbar-dot-caret",icon:x,accessibilityLabel:"",size:"small",variant:"inverse"}))),a.createElement("div",{"data-testid":"superhuman-vbar-vertical-line",className:_.vBarVerticalLine}))}));L.displayName="VBar";const A=a.lazy((()=>Promise.all([i.e(9784),i.e(6333),i.e(1088),i.e(328),i.e(213),i.e(1990),i.e(9003),i.e(3244),i.e(490),i.e(2168),i.e(7503),i.e(7853),i.e(309),i.e(8072),i.e(3765),i.e(4751),i.e(4922),i.e(9259),i.e(274)]).then(i.bind(i,75096)).then((({SuperUnderline:e})=>({default:e}))))),O=a.forwardRef(((e,t)=>a.createElement(a.Suspense,{fallback:a.createElement(a.Fragment,null)},a.createElement(A,{...e,ref:t}))));O.displayName="SuperUnderline";var U=i(60220),z=i(32103),H=i(34898);function G(e){let t;switch(e){case"idle":t=H.pulsingIdleSideline;break;case"selection":t=H.pulsingSelectionSideline;break;case"pushed_content":t="";break;default:(0,z.L0)(e)}return(0,g.Sh)(H.pulsingSideline,t).className}function V(e,t,i,r,n){return"idle"!==t?function(e,t,i,r){return(0,g.Sh)(H.sideline,e?H.sidelineEmphasized:void 0,"selection"===t?H.sidelineWithSelectionSignal:void 0,i?H.sidelineWithSignalBar:void 0,r?G(t):void 0).className}(e,t,i,r):function(e,t,i){return(0,g.Sh)(H.sideline,e?H.sidelineIdle:void 0,e&&i?H.sidelineEmphasized:void 0,t?G("idle"):void 0).className}(e,r,n)}function q(e,t,i){return(0,g.Sh)(H.sidelineSignalBar,e?H.sidelineSignalBarEmphasized:void 0,t?void 0:H.sidelineSignalBarHidden,i?H.sidelineSignalBarSubdued:void 0).className}function N(e,t,i,r){return r?function(e,t){return(0,g.Sh)(t?H.sidelineIdle:void 0,e||t?H.sidelineIdleStaticEmphasized:void 0).className}(e,t):function(e,t,i){return(0,g.Sh)(t?H.sidelineIdle:void 0,"OutsideSafeArea"===i&&t?H.sidelineIdleOutsideSafeArea:void 0,"InsideSafeArea"===i&&t?H.sidelineIdleSafeArea:void 0,e||"HoverVBar"===i&&t?H.sidelineIdleHover:void 0,e?H.sidelineIdlePinned:void 0).className}(e,t,i)}function j(e,t){return(0,g.Sh)(H.sidelineArrow,e?H.sidelineArrowVisible:void 0,t?H.sidelineArrowBottom:void 0).className}function $(e,t,i,r){return(0,g.Sh)(H.sidelineArrow,!t||e||"HoverVBar"!==i&&!r?void 0:H.sidelineArrowVisibleIdle,e?H.sidelineArrowPinnedIdle:void 0,r?H.sidelineArrowVisibleIdleStatic:void 0).className}const W=a.forwardRef((function({emphasized:e,pinned:t,heightInPixels:i,sidelineType:r,sidelineColor:n,sidelineId:s,vBarMousePosition:l,onClick:d,isSubdued:c,shouldPulse:u,onMouseEnter:h,onMouseLeave:g,onFocus:m,onMount:p,onShow:v,onHide:f,onPulse:S,isStaticIdleVBarWidth:b},C){const _="pushed_content"===r&&!(e&&!(i>=24));return a.useEffect((()=>{p()}),[]),E({isVisible:_||e,vBarId:s,onShow:v,onHide:f}),a.useEffect((()=>{e&&!c&&u&&S()}),[e,c,u,S]),a.createElement("div",{onMouseEnter:h,onMouseLeave:g,onFocus:e?m:void 0,"data-testid":`grammarly-g2-sideline-${r}`},a.createElement("button",{className:V(e,r,_,u,b),style:{height:i,width:w.gK},disabled:!e,onClick:e?d:void 0,"aria-label":"See rewrite suggestions",ref:C},a.createElement(o.F.Fragment,null,l.view((i=>"idle"!==r?a.createElement(Y,{emphasized:e,sidelineType:r,sidelineColor:n,showSignalBar:_,isSubdued:c}):a.createElement(K,{pinned:t,emphasized:e,mousePosition:i,isStaticVBarWidth:b}))))))}));function Y({emphasized:e,sidelineType:t,sidelineColor:i,showSignalBar:r,isSubdued:n}){return a.createElement(a.Fragment,null,a.createElement("div",{className:q(e,r,n),style:"pushed_content"===t?{background:i}:void 0,"aria-hidden":!0}),a.createElement(b.J,{className:j(e,r),icon:U.b,accessibilityLabel:"",size:"small",variant:"selection"===t?"inverse":"default"}))}function K({pinned:e,emphasized:t,mousePosition:i,isStaticVBarWidth:r}){return a.createElement("div",{className:N(e,t,i,r),style:(0,w.qt)(),"aria-hidden":!0},a.createElement(b.J,{className:$(e,t,i,r),icon:U.b,accessibilityLabel:"",size:"small",variant:"default"}))}var J=i(55018);const Q=e=>{const{sideline:t,isEmphasized:i,isActive:r,isPinned:n,onPin:s,onActivate:o,onDeactivate:l,onMount:c,onShow:b,onHide:C,onPulse:_,onRefChange:y,setVBarMousePosition:k,vBarMousePosition:B,showSelectionHighlight:x=!1,isSubdued:E,shouldPulse:R,shouldAnimateOnShow:I}=e,T=function(e){const t={top:e.highlightRect.top-w.TM,left:e.highlightRect.left,width:e.highlightRect.width,height:e.highlightRect.height+2*w.TM};return(0,h.PH)(e)&&e.fullTextRect?{top:e.fullTextRect.top,left:e.fullTextRect.left,width:e.fullTextRect.width,height:e.fullTextRect.height+2*w.TM,zIndex:2}:t}(t),P=(0,h.PH)(t)?{top:t.highlightRect.top,left:t.highlightRect.left}:{top:t.highlightRect.top,left:t.highlightRect.left+w.TM},F=t.highlightRect.height,M=(0,h.iu)(t),D=(0,u._)(t),A=(0,h.PH)(t),U=r&&!M,z=x&&M,H=r||i,G=a.useMemo((()=>"idle"===t.kind&&(0,m.l0)("docs.google.com"===(0,S.ge)())),[t.kind]);let V;if(a.useMemo((()=>{const{isVBarsRedesignEnabled:e}=(0,d.Z)(),t=D&&!A&&e,i=M&&"test"===(0,p.OB)().experimentClient.getTreatment(f.p.VBarsRedesignForSelection);return t||i}),[D,A,M])){const{isVBarsPushedContentCommentsEnabled:e}=(0,d.Z)();V=a.createElement(L,{vBarId:t.id,vBarPosition:P,heightInPixels:F,isActive:r,onMount:()=>c(t),onShow:()=>b(t),onHide:()=>C(t),showCaretInsideDot:M,dotSize:M?"large":"regular",onMouseEnter:()=>o(t,R),onMouseLeave:()=>l(t),onClick:()=>s(t),onFocus:()=>s(t),comment:D&&e?t.explanation:void 0,shouldAnimateOnShow:I,ref:e=>{e&&y(t,e)}})}else V=A?a.createElement(O,{emphasized:H,widthInPixels:4*w.gK,heightInPixels:Math.min(F,3),underlineColor:t.color,onMouseEnter:()=>{o(t,R),k(t.id,!0)},onMouseLeave:()=>{l(t),k(t.id,!1)},dataTestId:`grammarly-g2-super-underline-${t.kind}`,ref:e=>{e&&y(t,e)}}):a.createElement(W,{isStaticIdleVBarWidth:G,isSubdued:E,shouldPulse:R,emphasized:H,pinned:n,heightInPixels:F,sidelineType:t.kind,sidelineColor:D?t.color:void 0,sidelineId:t.id,vBarMousePosition:B,onClick:()=>s(t),onFocus:()=>s(t),onMouseEnter:()=>{o(t,R),k(t.id,!0)},onMouseLeave:()=>{l(t),k(t.id,!1)},onMount:()=>c(t),onShow:()=>b(t),onHide:()=>C(t),onPulse:()=>_(t),ref:e=>{e&&y(t,e)}});return a.createElement(a.Fragment,null,a.createElement("span",{"data-testid":`grammarly-g2-sideline-paragraph-highlighter-${t.id}`,...(0,g.Sh)(J.sidelineParagraphHighlighter,U?J.sidelineParagraphHighlighterActive:void 0,(0,h.PH)(t)?J.sidelineParagraphHighlighterSuperUnderline:void 0),style:T}),z&&a.createElement("div",{"data-testid":`grammarly-g2-sideline-selection-highlight-${t.id}`,className:J.sidelineSelectionHighlight},a.createElement(v.y$,{id:t.id,rects:t.selectionRects,displayFormat:v.jk.background,color:v.hE.Preset.create(v.al.gray),liveliness:null,disappearOnHoverDelay:null})),a.createElement("span",{"data-testid":`grammarly-g2-sideline-positioner-${t.id}`,className:J.sidelinePositioner,style:P},V))};function Z(e,t){switch(t){case"selection":return e.shouldShowSelectionPulsating;case"idle":return e.shouldShowIdlePulsating;case"pushed_content":return!1;default:(0,c.vE)(t)}}const X=({sidelines:e,pinnedSideline:t,activeSideline:i,emphasizedSideline:c,selectionSideline:g,shouldHideSidelines:m,pulsatingOnboardingInfo:p,shouldShowSelectionHighlight:v,shouldSubdueVBars:f,vBarMousePositions:S,streamingStatus:w,onPinSideline:b,onActivateSideline:C,onDeactivateSideline:_,onMountSideline:y,onShowSideline:B,onHideSideline:x,onPulseSideline:E,onSidelineRefChange:R,setVBarMousePosition:I})=>{const T={onPin:b,onActivate:C,onDeactivate:_,onMount:y,onShow:B,onHide:x,onPulse:E,onRefChange:R,setVBarMousePosition:I},P=e=>S.view((0,n.ls)(r.P5(e),l.fS((()=>"OutsideSafeArea")))),{isVBarsPushedContentStreamingAnimationEnabled:M}=(0,d.Z)(),D=s.h.combine(e,g,t,i,c,m,p,((e,t,i,r,a,s,o)=>{if(s)return[];const d=e=>(0,n.zG)(i,l.Gg((t=>t.id===e))),c=e=>(0,n.zG)(r,l.Gg((t=>t.sequentialId===e)));return(0,n.zG)(t,l.UI((e=>[{...T,sideline:e,vBarMousePosition:P(e.id),isPinned:!1,isEmphasized:!0,isActive:c(e.sequentialId),showSelectionHighlight:d(e.id)&&v,shouldPulse:Z(o,"selection"),shouldAnimateOnShow:!1}])),l.pF((()=>e.map(((e,t)=>{const i=d(e.id),r=w.get();return{...T,sideline:e,vBarMousePosition:P(e.id),isPinned:i,isEmphasized:(s=e.sequentialId,(0,n.zG)(a,l.Gg((e=>e.sequentialId===s)))),isActive:c(e.sequentialId),showSelectionHighlight:i&&v,shouldPulse:Z(o,e.kind)&&0===t,shouldAnimateOnShow:M&&("streaming"===r||"thinking"===r)&&(0,u._)(e)&&!(0,h.PH)(e)};var s})))))}));return a.createElement(k,null,a.createElement(F,null,a.createElement(o.F.Fragment,null,D.view((e=>e.map((e=>a.createElement(o.F.Fragment,{key:e.sideline.id},f.view((t=>a.createElement(Q,{...e,isSubdued:t})))))))))))}},972:(e,t,i)=>{i.d(t,{FS:()=>x,Ns:()=>B,jy:()=>f});var r=i(60213),n=i(12518),a=i(53186),s=i(90023),o=i(78767);const l=/\s/;function d(e,t){const i=e.split(l),[r,...n]=i;t(r);let a=r.length;for(const i of n){t(e[a]),a+=i.length+1,t(i)}}function c(e,t){const i=new r.diff_match_patch,[n,a,s]=function(e,t){const i=[],r=new Map,n=e=>t=>{if(""===t)return;const n=r.get(t)||String.fromCharCode(r.size);r.has(t)||(i.push(t),r.set(t,n)),e.push(n)},a=[];d(e,n(a));const s=[];return d(t,n(s)),[a.join(""),s.join(""),i]}(e,t),o=i.diff_main(n,a,!1);return i.diff_charsToLines_(o,s),i.diff_cleanupSemantic(o),o}const u=/([.!?] )/;function h(e){const t=e.split(u),i=[];for(let e=0;e<t.length;e++){const r=t[e],n=t[e+1];let a=r;u.test(r)||(u.test(n)?(a+=n[0],i.push(a),i.push(" ")):i.push(a))}return i}function g(e){const t=[];for(const i of e){const[e,r]=i;if(e===x.Operation.INSERT&&u.test(r)){const i=h(r);for(const r of i)t.push([e,r])}else t.push(i)}return t}const m=/(\p{Punctuation}|\s)+/mu,p=e=>e[0],v=e=>e[1],f=e=>{const t=function(e){let t=0,i=0;for(const r of e){const[e,n]=r;e===x.Operation.DELETE&&(t+=n.length),e!==x.Operation.DELETE&&e!==x.Operation.RETAIN||(i+=n.length)}return t/i}(e),i=[],r=e=>({groupID:e,diffs:[],showDeletions:t<.4});let n,a=-1,o=r(a);for(const t of e){const[e,s,l]=t;switch(e){case x.Operation.INSERT:!n||p(n)!==x.Operation.DELETE&&p(n)!==x.Operation.INSERT?(a+=1,i.push(o),o=r(a),o.diffs.push(t)):o.diffs.push(t);break;case x.Operation.DELETE:a+=1,o.diffs.length>0&&i.push(o),o=r(a),o.diffs.push(t);break;case x.Operation.RETAIN:l?(a+=1,i.push(o),o=r(a),o.diffs.push(t)):y(s).map((t=>[e,t,l])).forEach((e=>{a+=1,o.diffs.length>0&&i.push(o),o=r(a),o.diffs.push(e)}))}n=t}return o.diffs.length>0&&i.push(o),(0,s.zG)(i,S,w,b,k)};function S(e){return e.map((e=>{const t=e.diffs.every((([e])=>e===x.Operation.DELETE));return{...e,showDeletions:t||e.showDeletions}}))}function w(e){return e.map((e=>{const{diffs:t,showDeletions:i}=e;if(2!==t.length||!i)return e;const[r,n]=t,[a,s]=r,[o,l]=n,d=a===x.Operation.DELETE&&o===x.Operation.INSERT&&s.toLocaleUpperCase()===l;return{...e,showDeletions:!d&&i}}))}function b(e){return e.map((e=>{const{diffs:t,showDeletions:i}=e;if(2!==t.length||!i)return e;const[r,n]=t,[a,s]=r,[o,l]=n,d=a===x.Operation.DELETE&&o===x.Operation.INSERT&&s.length===l.length;return{...e,showDeletions:!d&&i}}))}function C(e){const{diffs:t}=e;if(1===t.length){const[e]=t,[i,r]=e;return(i===x.Operation.INSERT||i===x.Operation.DELETE)&&!m.test(r)}if(2===t.length){const[e,i]=t,[r,n]=e,[a,s]=i;return r===x.Operation.DELETE&&a===x.Operation.INSERT&&n.length===s.length&&!m.test(n)&&!m.test(s)}return!1}function _(e){const{diffs:t}=e;return function(e){const{diffs:t}=e;return 1===t.length&&p(t[0])===x.Operation.RETAIN}(e)&&!m.test(v(t[0]))}function y(e){const t=e.split(m);if(1===t.length)return[e];const i=[],r=t[0],n=t[t.length-1];let a=0;return r&&(i.push(r),a=r.length),n?(i.push(e.substring(a,e.length-n.length)),i.push(n)):i.push(e.substring(a)),i}function k(e){const t=[];let i,r=[],n=[],a=!1,s=0;const o=()=>{s>=2&&a?t.push(...n):t.push(...r),r=[],n=[],i=void 0,s=0,a=!1};for(const l of e)void 0===i?C(l)||_(l)?(r.push(l),i={groupID:l.groupID,diffs:[...l.diffs],showRetainsAsInserts:!0,showDeletions:!1},n.push(i)):t.push(l):C(l)?(r.push(l),s++,i.diffs.push(...l.diffs)):_(l)?(r.push(l),s>0&&(a=!0),i.diffs.push(...l.diffs)):(o(),t.push(l));return o(),t}const B=(e,t)=>{const i=new r.diff_match_patch,n=i.patch_make(e,t),[a]=i.patch_apply(n,e);return a};var x;!function(e){let t;e.getDiff=(t,i)=>(0,s.zG)(n.Y3((()=>{if(t===i)return""===t?[]:[[e.Operation.RETAIN,t]];return g(c(t,i))}),n.KC),n.tS((0,s.ls)(a.nI,n.Yo((()=>new Error("Diff is empty")))))),function(e){e[e.DELETE=-1]="DELETE",e[e.RETAIN=0]="RETAIN",e[e.INSERT=1]="INSERT"}(t=e.Operation||(e.Operation={})),e.matchOperation=function({onInsert:e,onDelete:i,onRetain:r}){return n=>{const a=p(n);switch(a){case t.INSERT:return e(v(n));case t.DELETE:return i(v(n));case t.RETAIN:return r(v(n));default:(0,o.vE)(a)}}}}(x||(x={}))},2775:(e,t,i)=>{i.d(t,{U:()=>r});const r={improve:{rewrite:{type:{kind:"improve"},kind:"idle",rewriteTabId:"improve"},buttonProps:{label:"Improve",accessibilityLabel:"Improve",accessibilityDescription:"Improve your writing. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}},rephrase:{rewrite:{type:{kind:"rephrase"},kind:"idle",rewriteTabId:"rephrase"},buttonProps:{label:"Rephrase",accessibilityLabel:"Rephrase",accessibilityDescription:"Rephrase your writing. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}},translate:{rewrite:{type:{kind:"translate",translationDirection:i(98587).jk.undetermined},kind:"idle",rewriteTabId:"translate"},buttonProps:{label:"Translate",accessibilityLabel:"Translate",accessibilityDescription:"Translate your writing. Press enter when selected to apply translation and return to your doc. Manually review the translation in the suggestion contents group. Or press Tab to advance and review other options."}},shorten:{rewrite:{type:{kind:"shorten"},kind:"idle",rewriteTabId:"shorten"},buttonProps:{label:"Shorten",accessibilityLabel:"Shorten",accessibilityDescription:"Shorten your writing. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}},friendly:{rewrite:{type:{kind:"friendly"},kind:"idle",rewriteTabId:"friendly"},buttonProps:{label:"Friendly",accessibilityLabel:"Friendly",accessibilityDescription:"Make your writing more friendly. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}},formal:{rewrite:{type:{kind:"formal"},kind:"idle",rewriteTabId:"formal"},buttonProps:{label:"Formal",accessibilityLabel:"Formal",accessibilityDescription:"Make your writing more formal. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}},rephraseFlexMild:{rewrite:{type:{kind:"other",textActionId:"rewrite:flexRephraseMild"},kind:"idle",rewriteTabId:"rephrase"},buttonProps:{label:"Rephrase",accessibilityLabel:"Rephrase",accessibilityDescription:"Rephrase your writing. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}},rephraseFlexAggressive:{rewrite:{type:{kind:"other",textActionId:"rewrite:flexRephraseAggressive"},kind:"idle",rewriteTabId:"rephrase"},buttonProps:{label:"Polish Email",accessibilityLabel:"Polish Email",accessibilityDescription:"Polish your Email. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}},enhancePrompt:{rewrite:{type:{kind:"other",textActionId:"promptenhancer:enhancePrompt"},kind:"idle",rewriteTabId:"other"},buttonProps:{label:"Enhance Prompt",accessibilityLabel:"Enhance Prompt",accessibilityDescription:"Enhance your prompt. Press enter when selected to apply suggestions and return to your doc. Manually review the rewrite in the suggestion contents group. Or press Tab to advance and review other options."}}}},74702:(e,t,i)=>{function r(e){return"pushed_content"===e.kind}i.d(t,{_:()=>r})},16131:(e,t,i)=>{function r(e){return"selection"===e.kind}function n(e){return function(e){return"idle"===e.kind}(e)}function a(e){return"pushed_content"===e.kind&&"superUnderline"===e.notificationElementKind&&"pushed-lazy-rewrite"===e.pushedContentVBarType}i.d(t,{PH:()=>a,WE:()=>n,ZR:()=>s,_Z:()=>o,iu:()=>r});const s=-1;function o(e){return"pushed_content"===e.kind&&e.surface&&"trackingSourceAction"in e.surface?e.surface.trackingSourceAction:void 0}},56817:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(11660),n=i(90189);function a(){return(0,n.OB)().experimentClient.isGateEnabled(r.K.VBarsRedesign)?{isVBarsRedesignEnabled:!0,isVBarsPushedContentCommentsEnabled:(0,n.OB)().experimentClient.isGateEnabled(r.K.VBarsPushedContentComments),isVBarsPushedContentStreamingAnimationEnabled:(0,n.OB)().experimentClient.isGateEnabled(r.K.VBarsPushedContentStreamingAnimation)}:{isVBarsRedesignEnabled:!1,isVBarsPushedContentCommentsEnabled:!1,isVBarsPushedContentStreamingAnimationEnabled:!1}}},96312:(e,t,i)=>{i.d(t,{R:()=>l});var r=i(90023),n=i(28357),a=i(67177),s=i(89449);class o extends Error{constructor(e,t){super(e),this.nestedError=t}}class l{constructor(e){this._params=e;const t=new s.w(this._params.checkingService);this._agentGenericService=n.W.create(t)}sendRequest(e){const t="disable"===e.commandId?JSON.stringify(e.payload):"";return(0,r.zG)({commandId:e.commandId,payload:t,agentId:this._params.agentId},this._agentGenericService.request,a.Pd((t=>new o(`Failed to send ${e.commandId} request`,t)),r.Q1))}dispose(){this._agentGenericService.dispose()}}},25009:(e,t,i)=>{if(i.d(t,{Fb:()=>m,PF:()=>g,TY:()=>d,_V:()=>h,eg:()=>u,um:()=>l,yj:()=>c}),3075==i.j)var r=i(59179);if(3075==i.j)var n=i(24666);if(3075==i.j)var a=i(32103);if(3075==i.j)var s=i(49629);if(3075==i.j)var o=i(3944);var l,d,c;function u(e){if((0,o.uz)(e))return{mode:l.view};const t=(0,o.lW)(e);return t||((0,o.e$)(e)?{mode:l.noEditAccess}:{mode:l.edit})}!function(e){e.view="view",e.noEditAccess="noEditAccess",e.history="history",e.edit="edit"}(l||(l={})),function(e){e[e.ownDoc=0]="ownDoc",e[e.sharedDoc=1]="sharedDoc",e[e.noEditAccessDoc=2]="noEditAccessDoc"}(d||(d={})),function(e){e.read="read",e.write="write"}(c||(c={}));function h(e){return s.S.hz4.pipe((0,r.U)((()=>u(e))),(0,n.x)(((e,t)=>{return r=t,(i=e).mode===l.history&&r.mode===i.mode?i.subtype===r.subtype:i.mode===r.mode;var i,r})))}function g(e,t){return e?d.ownDoc:t?d.noEditAccessDoc:d.sharedDoc}function m(e,t,i,r){if(e.mode!==l.edit)return c.read;switch(t){case d.ownDoc:return c.write;case d.noEditAccessDoc:return c.read;case d.sharedDoc:return function(e,t,i){const r=!t&&!i;if(e.mode!==l.edit||r)return c.read;return c.write}(e,i,r);default:return(0,a.L0)(t)}}},3944:(e,t,i)=>{if(i.d(t,{LJ:()=>w,Nd:()=>c,Ov:()=>S,TW:()=>B,Ur:()=>u,Xs:()=>x,e$:()=>y,eg:()=>k,fN:()=>m,k6:()=>v,kh:()=>g,lW:()=>_,lz:()=>p,qg:()=>d,uj:()=>l,uz:()=>f}),3075==i.j)var r=i(90189);if(3075==i.j)var n=i(90595);if(3075==i.j)var a=i(36769);if(3075==i.j)var s=i(25009);var o=i(7833);function l(e){const t=(0,a.Cq)(e.querySelector(o.XG),"text buffer iframe");return(0,a.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function d(e){const t=c(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function c(e){return e.querySelector(o.Wp)}function u(e,t,i){return t?function(e,t){if(t&&h(t))return t;const i=e.querySelectorAll(o.Qy);for(const e of i)if(h(e))return e;return null}(e,i):e.querySelector(o.Qy)}const h=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function g(e){return e.querySelectorAll(o.gH)}function m(e){return e.querySelector(o.gH)}function p(e){return Boolean(e.querySelector(o.gH))}function v(e){let t=e.querySelector(o.os);return t||(t=document.querySelector(o.gH)),t?t.getBoundingClientRect():null}const f=e=>!!e.querySelector(o.Lq);function S(e){return e.querySelector(o.$x)}function w(e){return null==e?void 0:e.querySelector(o.y1)}var b;!function(e){e.legacy="legacy",e.modern="modern"}(b||(b={}));const C=e=>"versionHistorySidebarWizSelector"===e.id||e.getBoundingClientRect().top>0?b.modern:b.legacy;function _(e){let t=e.querySelector(o.f);const i=(0,r.OB)().experimentClient.isGateEnabled(n.K.GDocsVersionHistorySidebarSelector);!t&&i&&(t=e.querySelector(o.q6));return!!t&&t.offsetHeight>0&&t.offsetWidth>0&&t?{mode:s.um.history,subtype:C(t)}:null}function y(e){return!!e.querySelector(`${o.jW}, ${o.F8}`)}function k(){const e=document.querySelector(o.d0),t=(null==e?void 0:e.classList.contains(o.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(o._m))?"suggesting":void 0;return t||i||"other"}function B(e){return e.querySelector(o.QR)}function x(e){return e.querySelector(o.ij)}},7833:(e,t,i)=>{i.d(t,{$:()=>O,$x:()=>s,Cw:()=>V,F8:()=>S,Fh:()=>z,G$:()=>U,Go:()=>n,Jk:()=>G,Kt:()=>k,Lq:()=>h,Q:()=>D,Q6:()=>l,QO:()=>P,QR:()=>T,Qy:()=>b,Vk:()=>B,Wp:()=>r,XG:()=>a,_m:()=>p,d0:()=>g,f:()=>c,fD:()=>A,gH:()=>w,gL:()=>x,gv:()=>d,ij:()=>I,j5:()=>y,jW:()=>f,l$:()=>v,lO:()=>R,os:()=>_,q6:()=>u,qz:()=>F,rx:()=>E,tN:()=>L,uj:()=>m,wY:()=>H,y1:()=>o,yv:()=>M,yw:()=>C});const r=".kix-appview-editor",n=".docos-input",a=".docs-texteventtarget-iframe",s=".kix-cursor",o=".kix-cursor-caret",l="#docs-butterbar-container",d="docs-butterbar-container-compact",c="#docs-revisions-sidebar",u="#docs-wiz-sidebar-placeholder",h='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',g="#docs-toolbar-mode-switcher",m="edit-mode",p="suggest-mode",v="titlebar-mode-indicator-container",f="#titlebar-mode-indicator-container .titlebar-request-access-button",S="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",w="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",b=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",C=".kix-page-paginated",_=".kix-page-paginated.canvas-first-page",y=".docs-horizontal-ruler",k=".docs-vertical-ruler",B="#fontSizeSelect input",x=".docs-ruler-background",E=".docs-ruler-background-inner",R=".docs-ruler-indent-first-line",I=".modal-dialog.docs-dialog .fatal-error-message",T='#docs-titlebar-share-client-button div[role="button"]',P=".kix-ai-text-generator-preview-view-insert-button",F=".kix-ai-text-generator-preview-view",M=".kix-ai-text-generator-prompt-view",D="textarea.kix-ai-text-generator-prompt-view-input",L=".kix-ai-text-generator-preview-view-generated-text",A=".appsElementsSidekickFeedContainer",O=".appsElementsSidekickUserMessageBubbleContent",U=".appsElementsSidekickUserMessageRoot",z=".appsElementsSidekickAgentMessageBubbleContent",H=".appsElementsSidekickAgentMessageRoot",G="li.appsElementsGenerativeaiAstAnimated",V="span.appsElementsGenerativeaiAstAnimated:not(li span)"},83675:(e,t,i)=>{i.d(t,{b:()=>o});var r=i(32073),n=i(13391),a=i(78103),s=i(26155);class o{constructor(e){this._textObserver=e,this._mapChangedAtom=n.h.create([0,[]]),this._sub=new r.w0,this.highlightsFilterFactory=()=>n.h.combine((0,a.u)(),this._mapChangedAtom,((e,t)=>{const i=this._textObserver.getCurrentTextMap();return{filter:t=>e.filter(t)&&(null!==i.getFragmentAtOffset(t.start)||null!==i.getFragmentAtOffset(t.end)||null!==i.getFragmentAtOffset(t.end-1)),type:s.qH.ChangeType.preserve}})),this._sub.add(this._textObserver.textMapChanged.subscribe((e=>{this._mapChangedAtom.modify((([t,i])=>[t+1,e]))})))}dispose(){this._sub.unsubscribe()}}},73560:(e,t,i)=>{function r(e){return e}function n(e){return e}i.d(t,{Gk:()=>n,Ly:()=>r,Xo:()=>a,bn:()=>h,pl:()=>l});class a{constructor(e){const t=function(e){const{fullText:t,nonTextEntities:i,textSelectionRanges:r,deleteSuggestionRanges:n}=e,a=new Set;let l=t;for(const e of i.inline_image.startsAt)l=l.slice(0,e)+o+l.slice(e+1);for(const e of i.horizontal_rule.startsAt)a.add(e),l=l.slice(0,e)+" "+l.slice(e+1);""===t[0]&&a.add(0);t.replace(s,((e,t)=>(a.add(t),"")));for(const e of function*(e){const t=String.fromCodePoint(60419),i=String.fromCodePoint(60418);for(const r of u(e,t,i))yield r}(t))a.add(e);for(const e of function*(e){for(const t of u(e,d,c))e[t]!==d&&(yield t)}(t))a.add(e);const h=null==r?void 0:r.map((t=>({start:t.start,end:e.textSelectionRangeEndExclusive?t.end:t.end+1})));if(n)for(const{start:e,end:t}of n)for(let i=e;i<t;i++)a.add(i);const g=l.indexOf("",1),m=g>0?l.slice(0,g):l,p=m.length-1;"\n"===m[p]&&a.add(p);return{checkableText:m.split("").filter(((e,t)=>!a.has(t))).join(""),cleanedFullText:l,removedIndices:a,cleanedTextSelectionRanges:h}}(e);this._text=t.checkableText,this._fullText=e.fullText,this._linkInfoList=e.linkInfoList,this._cleanedFullText=t.cleanedFullText,this._ignoredIndices=t.removedIndices,this._textSelectionRanges=t.cleanedTextSelectionRanges}get checkableText(){return this._text}get fullText(){return this._fullText}get cleanedFullText(){return this._cleanedFullText}get linkInfoList(){return this._linkInfoList}get textSelectionRanges(){return this._textSelectionRanges}indexIsIgnored(e){return!!this._ignoredIndices.has(e)}getFullTextIndex(e){let t=-1,i=-1;for(;i<e;)t++,this._ignoredIndices.has(t)||i++;return t}getCheckableTextIndex(e){let t=0,i=0;for(;t<e;)this._ignoredIndices.has(t)||i++,t++;return i}}const s=new RegExp(`${String.fromCodePoint(61439)}|${String.fromCodePoint(61438)}`,"g"),o=String.fromCharCode(160),l=26,d=String.fromCodePoint(l),c=String.fromCodePoint(30);function*u(e,t,i){let r=0;for(;;){const n=e.indexOf(t,r);if(n<r)return;const a=e.indexOf(i,n);for(let e=n;e<=a;e++)yield e;r=a+1}}function h(e){return!!(null==e?void 0:e.includes(d))&&!(null==e?void 0:e.includes(`${d}${c}`))}},64180:(e,t,i)=>{i.d(t,{U3:()=>r,dk:()=>a,x:()=>n});const r=["rgba(17,85,204,1)","#1155cc"],n=1,a=-1},8674:(e,t,i)=>{i.d(t,{M:()=>r});class r{constructor(e,t){this._page=e,this._parsedFragment=t,this.startOffset=t.textRange.start,this.endOffset=t.textRange.end}getPage(){return this._page}}},43881:(e,t,i)=>{i.d(t,{I:()=>s});var r=i(64180),n=i(14042),a=i(8674);class s extends a.M{constructor(e,t,i){super(e,t),this._page=e,this._renderGeometry=i}getFragmentInnerRect(e,t){return this._renderGeometry.getTextFragmentDimensions(this._parsedFragment.fragment,e,t)}getLeftBorder(){return this.getFragmentInnerRect(0,0)}getRightBorder(){return this.getFragmentInnerRect(this.endOffset-this.startOffset,this.endOffset-this.startOffset)}getStyle(){const{style:e="none",color:t="none",underlineColor:i="none",strikeThroughColor:a="none",text:s}=this._parsedFragment.fragment,o=r.U3.includes(t)&&r.U3.includes(i),l=(0,n.cX)(s);return{style:e,isLink:o,isSmartChips:this._parsedFragment.fragment.special,canBeFootnote:l,color:t,underlineColor:i,strikeThroughColor:a}}getParsedFragment(){return this._parsedFragment}}},14042:(e,t,i)=>{i.d(t,{cX:()=>v,ds:()=>l,kn:()=>d,lO:()=>m,nn:()=>p,qH:()=>o,tZ:()=>f});var r=i(63951);const n=/[ \n\r\t\v]/,a=/[^\S\f\n]/,s=[..." \r\t\v\f"];function o(e){return 1===e.length&&n.test(e)}function l(e){return 1===e.length&&a.test(e)}function d(e){return s.includes(e)}const c=/^(\d{1,4}\.)*\d{1,4}$/,u=/^([a-zA-Z])\1{0,3}$/,h=/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,g=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/;function m(e){if(0===e.length)return!1;if(1===e.length)return!0;let t;if(e.startsWith("(")&&e.endsWith(")"))t=e.substring(1,e.length-1);else{if(!e.endsWith(".")&&!e.endsWith(")"))return!1;t=e.substring(0,e.length-1)}return t.endsWith(".")&&(t=t.substring(0,t.length-1)),c.test(t)||u.test(t)||h.test(t)||g.test(t)}function p(e){return r.v1.test(e)}function v(e){return r.ZS.test(e)}function f(e){return r.Dn.includes(e)}},63951:(e,t,i)=>{if(i.d(t,{Dn:()=>s,Ox:()=>c,ZS:()=>d,o2:()=>a,q4:()=>u,ui:()=>o,v1:()=>l}),3075==i.j)var r=i(25223);var n=i(73560);const a=String.fromCodePoint(59657),s=[59653,59654,59657,60417,60416,59656,n.pl].map((e=>String.fromCodePoint(e))).join(""),o=String.fromCodePoint(59649),l=/^\d+$/,d=/^\d+$/;function c(e){return e.toUpperCase()===e&&e.toLowerCase()!==e}function u(e){return e.includes(r.$O)}},69441:(e,t,i)=>{i.d(t,{z:()=>g});var r=i(90023),n=i(92379),a=i(2852),s=i(33885),o=i(59179),l=i(84308),d=i(29479),c=i(64271),u=i(18827),h=i(58303);const g=({children:e,animationDurationMs:t,...i})=>{const{onMount:g,rect:m}=a.P.useRectWatcher(),p=m.pipe(o.U((0,r.ls)(h.UI((e=>e.height)),h.fS((()=>0))))),v=l.a([e,m]).pipe(d.h("hidden")),f=c.T(v,v.pipe(u.g(t),d.h("visible")));return n.createElement(s.F.div,{...i,style:{height:p,overflow:f,transitionProperty:"height",transitionDuration:`${t}ms`}},n.createElement(s.F.div,{mount:g},e))}},94901:(e,t,i)=>{i.d(t,{q:()=>x});var r=i(92379),n=i(31702),a=i(405),s=i(52348),o=i(85837),l=i(1211),d=i(53345);const c=e=>e.domain?r.createElement(r.Fragment,null,e.withHelpText&&r.createElement("div",{className:d.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you're on:"),r.createElement(l.XZ,{isSelected:e.checked,id:"feedback-form-share-domain-checkbox",onChange:e.onChange,className:d.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,e.domain)," with my feedback")):null;var u=i(69003),h=i(72032);const g=e=>{const t=(0,h.T)("go");return e.isEnabled?r.createElement(u.T,{composition:"mark",accessibilityLabel:"",brand:t,height:26,className:d.feedbackFormLogoLine}):null},m=e=>{var t;if(!e.isEnabled)return null;const i=null!==(t=e.title)&&void 0!==t?t:r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?");return r.createElement("h3",{...(0,o.Sh)(d.feedbackFormTitle,e.isCompact&&d.compact)},i)},p=e=>r.createElement(r.Fragment,null,r.createElement(l.XZ,{isSelected:e.checked,id:"feedback-form-share-user-text-checkbox",onChange:e.onChange,className:d.feedbackFormShareUserTextCheckbox},r.createElement("p",null,"Share my text with Grammarly")),r.createElement("p",{className:d.fedbackFormShareUserTextCheckboxLabel},"The text you checked with Grammarly will also be shared to improve the quality of our suggestions. Your feedback and text will not be associated with your account and will be deleted within 100 days. We will not use your feedback to train any models."));var v=i(79584);const f=e=>{const{options:t,onChange:i=(()=>null),ariaLabel:n,className:a}=e,s=[],[l,d]=r.useState(null);r.useEffect((()=>{var e;null!==l&&(null===(e=s[l])||void 0===e||e.focus()),i(null!==l?t[l].value:null)}),[l]);const c=null!==l?t[l]:null;return r.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:a},r.createElement("div",{className:v.radioGroup,role:"radiogroup","aria-label":n,onKeyDown:e=>{if(" "!==e.key||c){if("ArrowRight"===e.key||"ArrowDown"===e.key){e.preventDefault(),e.stopPropagation();d(((l||0)+1)%t.length)}else if("ArrowLeft"===e.key||"ArrowUp"===e.key){e.preventDefault(),e.stopPropagation();const i=(l||0)-1;d(i<0?t.length-1:i)}}else e.preventDefault(),e.stopPropagation(),d(0)}},t.map(((e,t)=>{const i=(null==c?void 0:c.value)===e.value,n=0===t;return r.createElement("div",{key:e.value,...(0,o.Sh)(v.radioGroupOption,i?v.radioGroupOptionSelected:null),role:"radio",tabIndex:i||n&&!c?0:-1,"aria-checked":i,onClick:e=>{e.preventDefault(),e.stopPropagation(),d(t)},ref:e=>s.push(e)},e.render())}))))};var S,w=i(78767),b=i(60493);!function(e){e.bad="bad",e.ok="ok",e.good="good"}(S||(S={}));const C=e=>{const t=[S.bad,S.ok,S.good];return e.isEnabled?r.createElement(r.Fragment,null,r.createElement(f,{ariaLabel:"Feedback Score",options:t.map((e=>({value:e,render:()=>r.createElement("div",{className:b.feedbackFormOption},r.createElement("div",{...(0,o.Sh)(b.feedbackFormOptionIcon,_(e))}),r.createElement("div",null,function(e){switch(e){case S.bad:return"I dislike it";case S.ok:return"Its OK";case S.good:return"I like it";default:(0,w.vE)(e)}}(e)))}))),onChange:e.onChange,...(0,o.Sh)(d.feedbackFormScore,e.compactDisplay&&d.compact)}),!e.hideTextBoxTitle&&r.createElement("div",{className:d.feedbackFormTextBoxTitle},"Anything we can improve?")):null};function _(e){switch(e){case S.bad:return b.feedbackFormOptionIconDisheartening;case S.ok:return b.feedbackFormOptionIconNeutral;case S.good:return b.feedbackFormOptionIconSmiling;default:(0,w.vE)(e)}}const y=e=>{var t,i,l;const[u,h]=r.useState(null),[v,f]=r.useState(""),[S,w]=r.useState(null!==(t=e.domainSharedByDefault)&&void 0!==t&&t),[b,_]=r.useState(!1);return r.createElement("form",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,o.Sh)(d.feedbackFormContainer,"center"===e.align&&d.feedbackFormContainerAlignCenter,e.fixSubmitButtonOverflowBottomPadding&&d.feedbackFormContainerBottomPadding)},r.createElement("div",{className:d.feedbackFormFields},r.createElement(g,{isEnabled:!e.hideLogo}),r.createElement(m,{isEnabled:!e.hideTitle,title:e.title,isCompact:null!==(i=e.compactDisplay)&&void 0!==i&&i}),r.createElement(C,{isEnabled:e.withScore,compactDisplay:e.compactDisplay,hideTextBoxTitle:e.hideTextBoxTitle,onChange:h}),r.createElement("div",{className:(0,o.Sh)(d.feedbackFormTextBox,e.compactDisplay&&d.compact).className},r.createElement(n.x,{as:"p"},r.createElement(a.g,{onChange:f,placeholder:null!==(l=e.placeholderText)&&void 0!==l?l:"Your thoughts here",label:"Feedback Text",labelDisplay:"hidden",rows:5,value:v}))),r.createElement(c,{domain:e.domain,checked:e.domainSharedByDefault,withHelpText:!e.hideDomainHelpText,onChange:w}),e.showShareTextCheckbox&&r.createElement(p,{checked:b,onChange:_})),r.createElement(s.z,{variant:"primary",onClick:()=>{const t=S?e.domain:void 0;e.withScore&&u?e.onSubmit({score:u,text:v,domain:t,shareUserText:b}):!e.withScore&&v&&e.onSubmit({text:v,domain:t,shareUserText:b})},isDisabled:e.withScore?!u:!v,width:"full","data-grammarly-part":"surveys-feedback-form-submit-button"},"Submit"))},k=e=>r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,o.Sh)(d.feedbackFormContainer,d.feedbackFormContainerAlignCenter,e.fixSubmitButtonOverflowBottomPadding&&d.feedbackFormContainerBottomPadding)},r.createElement("div",{className:d.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:d.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:d.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:d.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(s.z,{variant:"primary",width:"full",onClick:e.onClose},"Done"));var B=i(35431);const x=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:i=!1,showPostSubmitScreen:n=!0,...a})=>{const[s,o]=r.useState(!1),l=s&&n;return r.createElement("div",{style:a.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback","aria-live":"polite"},l?r.createElement(k,{fixSubmitButtonOverflowBottomPadding:i,onClose:a.onClose}):r.createElement(y,{...a,hideLogo:e,align:t,fixSubmitButtonOverflowBottomPadding:i,onSubmit:e=>{a.withScore?((0,B.n8)(e),a.onSubmit(e)):((0,B.TY)(e),a.onSubmit(e)),o(!0)}}))}},35431:(e,t,i)=>{function r(e){return"score"in e}function n(e){if(!r(e))throw new Error("Received unexpected feedback form data without score")}function a(e){if(r(e))throw new Error("Received unexpected feedback form data with score")}i.d(t,{TY:()=>a,dK:()=>r,n8:()=>n})},76022:(e,t,i)=>{i.d(t,{JB:()=>a,MY:()=>n,z6:()=>r});class r extends Map{constructor(e){super(),this.maxSize=e}set(e,t){if(this.has(e))this.delete(e);else if(this.size>=this.maxSize){const e=this.keys().next(void 0).value;this.delete(e)}return super.set(e,t),this}get(e){const t=super.get(e);return void 0!==t&&(this.delete(e),this.set(e,t)),t}}function n(e){let t=2166136261;for(let i=0;i<e.length;i++)t^=e.charCodeAt(i),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return(t>>>0).toString(16)}function a(e){try{return n(JSON.stringify(e))}catch(e){return console.error("Error occurred while hashing object:",e),""}}},87410:(e,t,i)=>{i.d(t,{S:()=>a,v:()=>n});var r=i(12518);async function n(e,t=self){var i,r,n,a;if("string"==typeof e){if(null===(r=null===(i=t.navigator)||void 0===i?void 0:i.clipboard)||void 0===r?void 0:r.writeText)return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported (writeText)")}if(null===(a=null===(n=t.navigator)||void 0===n?void 0:n.clipboard)||void 0===a?void 0:a.write)return t.navigator.clipboard.write(Array.from(e));throw new Error("Clipboard API not supported (write)")}function a(e,t=self){return n(e,t).then((()=>r.F2(void 0))).catch((e=>r.t$(e instanceof Error?e:new Error(String(e)))))}},75224:(e,t,i)=>{function r(e,t=0){return(t<<5)-t+(0|e)|0}function n(e,t=0){let i=t;for(const t of e)i=r(t.charCodeAt(0),i);return i}i.d(t,{Wu:()=>n,k3:()=>r})},72032:(e,t,i)=>{i.d(t,{T:()=>n,n:()=>a});var r=i(18473);function n(e){return(0,r.Y)()?e:"grammarly"}function a(){return(0,r.Y)()?"Superhuman Go":"Grammarly"}},40224:(e,t,i)=>{i.d(t,{i:()=>a});var r=i(90595),n=i(29483);function a(){return(0,n.OB)().experimentClient.isGateEnabled(r.K.SuperhumanGoBranding)}},57758:()=>{},24974:e=>{e.exports={monetizationWrapper:"XLKBt",premiumIcon:"Mrvu1",premiumIconShimmer:"JFXhl","shimmer-scale":"bID5T",monetizationTitle:"vLnAx",monetizationDividerDot:"_owGm",shimmer:"iLEJ8"}},62484:e=>{e.exports={FtuxTooltipOutline:"vAmKA",FtuxTooltipContent:"_KM0Q"}},66741:e=>{e.exports={TranslateFtuxTooltipOutline:"H9SwM",TranslateFtuxTooltipContent:"QB8Yh"}},34898:e=>{e.exports={sideline:"G2vdT",sidelineEmphasized:"tw3gA",sidelineWithSelectionSignal:"ikZS7",pulsingSideline:"SHHbX",pulsingIdleSideline:"w6AcK","pulse-idle":"caBIF",pulsingSelectionSideline:"ETZAk","pulse-selection":"HP0j5",sidelineWithSignalBar:"gtUhG",sidelineSignalBar:"Pdlcn",sidelineSignalBarEmphasized:"_mi1U",sidelineSignalBarHidden:"BNKg6",sidelineSignalBarSubdued:"n9hN9",sidelineIdle:"ODKEt",sidelineIdleOutsideSafeArea:"w4UDM",sidelineIdleSafeArea:"VPslK",sidelineIdleHover:"vZ2y1",expandingIdleSideline:"Ld2yt",sidelineIdlePinned:"LBn82",sidelineIdleStaticEmphasized:"dQCFf",sidelineArrow:"Ihuz1",sidelineArrowVisible:"gtlTF",sidelineArrowVisibleIdle:"t5crG",sidelineArrowPinnedIdle:"kYVyH",sidelineArrowVisibleIdleStatic:"MUK0S",sidelineArrowBottom:"PPzfY",pulse:"PEPt4"}},55018:e=>{e.exports={sidelineParagraphHighlighter:"xCgoK",sidelineParagraphHighlighterActive:"Jjjhn",sidelineParagraphHighlighterSuperUnderline:"G4uk2",sidelinePositioner:"UPQQM",sidelineSelectionHighlight:"ra9fc"}},70938:e=>{e.exports={underline:"U1fsr","underline__hover-area":"SqU8u","underline--emphasized":"wOaz0","underline--enhancement":"uQj72","underline__main-bar":"NSJ0f",underline__dots:"EQu4e",underline__dot:"jchje"}},9103:e=>{e.exports={offscreen:"t4weG"}},43862:e=>{e.exports={sidelineCard:"KetZV",sidelineCardHorizontalDivider:"d96oB",sidelineCardCustomPromptEntryPoint:"USGAc",sidelineCardFtuxRewrites:"MsQEb",sidelineCardFtuxCustomPromptEntryPoint:"AHauo",a11yDescription:"ZxLNa"}},10843:e=>{e.exports={sidelineCardAIEditorPromotionButton:"SZVEX",entered:"P2fRR",exiting:"yBUEB",topPlacement:"M9ozz",bottomPlacement:"l8AZt",tag:"IqAQf",rightIconContainer:"ErGNN"}},41648:e=>{e.exports={sidelineCardButton:"qFbmx"}},85814:e=>{e.exports={sidelineCardCustomPrompt:"LfX1e",sidelineCardCustomPromptInput:"RoTP_",sidelineCardCustomPromptInputForm:"B0peX",sidelineCardCustomPromptInputField:"SLnHC",sidelineCardCustomPromptSuggestedResults:"o_ldN",sidelineCardCustomPromptSuggestedResultsSubtitle:"eezEJ",sidelineCardCustomPromptSuggestedResultsOption:"FmvTD",liveAnnouncement:"_BxQw"}},68108:e=>{e.exports={sidelineCardGrammarlyLogo:"e99eq"}},99815:e=>{e.exports={sidelineCardMultilingualOnboardingWrapper:"zupRi",entered:"IWWz3",exiting:"W122J",topPlacement:"skm_L",bottomPlacement:"PQFPy",sidelineCardMultilingualOnboarding:"Gtq9z"}},99146:e=>{e.exports={sidelineCardPopper:"m2vlI"}},10305:e=>{e.exports={sidelineCardRewrite:"SbBwe"}},3537:e=>{e.exports={scrollTopLimit:"PA1jn",scrollBottomLimit:"vhiR2",fadeInAnimation:"o53qS","left-to-right-fade-in":"OpP5u"}},17920:e=>{e.exports={moreButton:"rosQY"}},63178:e=>{e.exports={sidelineCardRewriteReadySignalBar:"zv_Ws",sidelineCardRewriteReadySignalBarAttention:"oimfv",sidelineCardRewriteReadySignalBarDefault:"GGpaV",sidelineCardRewriteReadyContent:"ANoVu",sidelineCardRewriteReadyContentWithTopScrollLimit:"M7jcz",sidelineCardRewriteReadyContentWithBottomScrollLimit:"SDH6l",sidelineCardRewriteReadyContentTitle:"JruGr",sidelineCardRewriteReadyContentTitleAttention:"ncGgB",sidelineCardRewriteReadyContentTitleDefault:"FKJEV",sidelineCardRewriteRegenerateButton:"As2d2",sidelineCardRewriteCopyButtonCopyConfirmation:"oM9oh",fadeInOut:"uUL1Y"}},85639:e=>{e.exports={sidelineCardRewriteSuccess:"qCfRi",sidelineCardRewriteSuccessMainContentTitle:"KYYEg",sidelineCardRewriteSuccessGrammarlyLogo:"PWfBY"}},38842:e=>{e.exports={translationLanguageSelect:"dU6KN"}},65338:e=>{e.exports={vBar:"JES_A",vBarDotSizeLarge:"sIR_0",vBarDotSizeRegular:"Y2yIZ",vBarDot:"CTnY3",vBarActive:"MyxR7",vBarVerticalLine:"IEmpT",vBarTooShort:"YJu1r",vBarAnimatedOnShow:"v1xeG",vBarDotFadeIn:"aFQQZ",vBarDotPulse:"VUTOu",vBarVerticalLineExpand:"VT1Wg"}},39831:e=>{e.exports={vBarComment:"d414Z",vBarCommentAnimatedOnShow:"l69Yb",vBarCommentFadeInFromRight:"iPhR3",vBarCommentHovered:"_84mF2",vBarCommentActive:"NfDe6",vBarCommentDimmed:"xbv1X",vBarCommentHidden:"jRAgo",vBarCommentArrow:"znZbb"}},39124:e=>{e.exports={promptEnhancerCard:"Pi5Bk"}},28569:e=>{e.exports={promptEnhancerCardError:"gnL7t"}},166:e=>{e.exports={sidelineCardRewrite:"qOuHL",promptEnhancerCardRewrite:"fH3ZT"}},10284:e=>{e.exports={promptEnhancerCardRewriteReadyContent:"MFqNQ",promptEnhancerCardRewriteReadyContentTitle:"uDed6",promptEnhancerCardRewriteReadyContentWithScrollLimits:"x4dHB"}},53569:e=>{e.exports={CardPlagiarism:"RrZNN",CardPlagiarismMainContent:"JJYip",CardPlagiarismMainContentTitle:"_6Qx6",CardPlagiarismGrammarlyLogo:"cxK1r",CardPlagiarismText:"sb8XO",CardPlagiarismFooter:"mFPvh"}},79584:e=>{e.exports={radioGroup:"KAzfW",radioGroupOption:"WkjDU",radioGroupOptionSelected:"onilo"}},53345:e=>{e.exports={feedbackFormContainer:"kjElf",feedbackFormContainerBottomPadding:"bXqDs",feedbackFormContainerAlignCenter:"hkEx2",feedbackFormFields:"Ua5wJ",feedbackFormTitle:"GnQ_a",feedbackFormTextBoxTitle:"kWEW0",feedbackFormLogoLine:"osGQI",compact:"b7yYp",feedbackFormScore:"ZOSRK",feedbackFormTextBox:"l8New",feedbackFormShareDomainTitle:"Qbnj_",feedbackFormShareDomainCheckbox:"VBCx1",feedbackFormShareUserTextCheckbox:"abP8L",fedbackFormShareUserTextCheckboxLabel:"hxgnL",feedbackFormSuccessMessageTextContainer:"ARBzt",feedbackFormSuccessMessageIcon:"kJIzg",feedbackFormSuccessMessageTitle:"iXQnf",feedbackFormSuccessMessageSubtitle:"Ydufo",spin:"Vv6WG"}},60493:e=>{e.exports={feedbackFormOption:"sp8vS",feedbackFormOptionIcon:"eH6DL",feedbackFormOptionIconDisheartening:"DhaWh",feedbackFormOptionIconNeutral:"BS_8d",feedbackFormOptionIconSmiling:"dUZNd",spin:"uouSO"}}}]);