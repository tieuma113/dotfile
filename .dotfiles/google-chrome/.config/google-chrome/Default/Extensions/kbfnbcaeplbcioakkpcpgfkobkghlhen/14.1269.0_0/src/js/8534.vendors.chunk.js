(self.webpackChunk=self.webpackChunk||[]).push([[8534],{45128:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(32103);const i=class e{constructor(t,r=new URLSearchParams){this.base=t,this.params=r;const i=e._toString(t,r).length;(0,n.kG)(i<e.MAX_URL_LENGTH,"url exceeded length limit",String(i));const o=t.toLowerCase();(0,n.kG)(!1===o.startsWith("javascript:")&&!1===o.startsWith("data:"),"url is not allowed to use javascript: or data: protocols",t)}addParams(t){const r=Object.entries(t).reduce(((e,[t,r])=>(e.append(t,r),e)),(n=this.params,new URLSearchParams(n.toString())));var n;return new e(this.base,r)}toString(){return e._toString(this.base,this.params)}static _toString(e,t){const r=t.toString();return`${e}${r.length?`?${r}`:""}`}};i.MAX_URL_LENGTH=2083;let o=i},68822:(e,t,r)=>{r.d(t,{EP:()=>a,PJ:()=>u,W5:()=>s,YG:()=>c});var n=r(12518),i=r(64443),o=r(32103);class s extends o.sH{constructor(e){super(Boolean(e)?e:"Timeout"),this.name="TimeoutError"}static isTimeoutError(e){return e instanceof s}}class a extends o.sH{constructor(e){super(Boolean(e)?e:"Dropped"),this.name="DroppedError"}static isDroppedError(e){return e instanceof a}}class c extends o.sH{constructor(e){super(Boolean(e)?e:"Not Connected to WS"),this.name="NotConnectedError"}static isNotConnectedError(e){return e instanceof c}}class u{constructor(e=5e3,t="",r=new s){this._timeout=e,this.name=t,this._timeoutError=r,this._requests=new Map,this._log=i.C8.Logging.getLogger("coreclients.valueRequester"+(t.length>0?"."+t:""))}watchRequest(e,t=this._timeout){return this._startRequestWatch(e,t)}hasRequest(e){return this._requests.has(e)}onValue(e,t){this._stopRequest(e,n.F2(t))}onError(e,t){this._log.trace(`onError:(${e})`),this._stopRequest(e,n.t$(t))}clear(e){this._log.trace("clearing request watches: "+e),this._requests.forEach(((t,r)=>{this.onError(r,new a(`command (${this.name}) can not be executed, reason: ${e}`))}))}_startRequestWatch(e,t){this._log.debug(`Starting request watch: ${e}`),(0,o.kG)(!this._requests.has(e),"must not start watch for same request twice, request already watched: "+e);const r={};return r.promise=new Promise((e=>{r.resolve=e})),r.timer=self.setTimeout((()=>this._stopRequest(e,n.t$(this._timeoutError))),t),this._requests.set(e,r),r.promise}_stopRequest(e,t){this._log.trace(`_stopRequest: stopping request watch: ${e}`,t);const r=this._requests.get(e);void 0===r?this._log.warn("Got result for unknown request or request has already expired.",{id:e,result:t}):(clearTimeout(r.timer),r.resolve(t),this._requests.delete(e))}}},8379:(e,t,r)=>{r.d(t,{Q:()=>u});var n=r(90023),i=r(68822),o=r(68291),s=r(64443);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"_capiSDUIClient",void 0),c(this,"_log",void 0),this._capiSDUIClient=t,this._log=s.C8.Logging.getLogger("SDUIFeedbackServiceImpl")}var t,r,u;return t=e,(r=[{key:"sendUserAction",value:function(e,t){var r=this;this._log.debug("Sending user action",{componentId:e,userAction:t}),(0,n.zG)(this._capiSDUIClient.sendUserAction(e,t),o.Vi,(function(e){return e.catch((function(e){i.EP.isDroppedError(e)?r._log.debug("Stopped listening for sendUserAction message acknowledge",e):i.YG.isNotConnectedError(e)?r._log.warn("Failed to sendUserAction as CAPI was not connected",e):r._log.error("Failed to sendUserAction",e)}))}))}}])&&a(t.prototype,r),u&&a(t,u),e}()},27643:(e,t,r)=>{r.d(t,{t:()=>a});var n=r(90023),i=r(93123);r(63332);function o(e,t){return{decode:e.decode,encode:t.encode}}function s(e){return{decode:e.decode,encode:n.yR}}i.Z_,i.Rx,i.O7,i.dX,i.mI;var a,c,u,d,l,p,h=r(34349),f=r(36661),v=r(21147),g=r(32103),m=r(12518),_=r(27947),y=r(51069),b=r(42203);c=a||(a={}),u=c.Type=_.lY.Type.sduiCardAction,d=(0,b.HP)((function(){return f.n(h.z2)(y.eXO)})),c.eq=v.f7((function(e,t){return e.type===u&&e.type===t.type&&e.cardId===t.cardId&&d().equals(e.actions,t.actions)&&e.scope===t.scope})),l=o(f.n(i.z2)(y.eXO),{encode:function(e){return e}}),p=(0,n.ls)(l.decode,m.Vn((function(e){return new Error(i.ii(e))}))),c.isSduiCardAction=function(e){return e.type===a.Type&&(r=e.actions,m.tO(p(r)))&&"object"==typeof(t=e.scope)&&null!=t&&Object.keys(t).every((function(e){var r=t[e];return"alertRefs"===e?Array.isArray(r):((0,g.L0)(e),!1)}));var t,r}},23685:(e,t,r)=>{r.d(t,{X:()=>T,x:()=>G});var n=r(90023),i=r(58303),o=r(10444),s=r(32103),a=r(12518),c=r(59833),u=r(86399),d=r(64443),l=r(21100),p=r(27643),h=r(88012),f=r(74822),v=r(10883),g=r(90572),m=r(59179),_=r(78129),y=r(99887),b=r(63532),I=r(81933),A=r(14969),w=r(90499),S=r(86305),C=r(58508),E=r(30922),R=r(45128),F=r(4782);function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){M(e,t,r[t])}))}return e}function q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var G=function(){function e(t,r,n,i,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new l.A;P(this,e),M(this,"_sduiService",void 0),M(this,"_sduiManager",void 0),M(this,"_sduiFeedManager",void 0),M(this,"_capiClient",void 0),M(this,"_focusedItem",void 0),M(this,"_platformEnvironment",void 0),M(this,"_log",void 0),M(this,"_subs",void 0),M(this,"_sduiAlertIdResolver",void 0),M(this,"sduiActionEvents",void 0),this._sduiService=t,this._sduiManager=r,this._sduiFeedManager=n,this._capiClient=i,this._focusedItem=o,this._platformEnvironment=s,this._log=d.C8.Logging.getLogger("SduiViewModelImpl",d.zW.i.DEBUG),this._subs=new h.w.Keeper,this.sduiActionEvents=new f.x,this._sduiAlertIdResolver=T(this._sduiManager.alertIdResolver,this._log),this._subs.push(this._handleSduiActions(),this._handleSduiCardOnFocus(),this._handleSduiCardOnBlur(),this._handleSduiFeedRemove(),this._handleSduiFeedEmpty(),this._handleSduiOnEmptyEvents())}var t,r,u;return t=e,(r=[{key:"onAssistantClose",value:function(){var e=this;(0,n.zG)(this._sduiFeedManager.currentFeed,i.UI((function(e){return e.feedId})),i.tS((function(t){return w.a.get(t)(e._sduiManager.state.get())})),i.tS((function(e){return(0,n.zG)(F.ab.findFirst(e.content,"assistantFeed"),i.hX((function(e){return Array.isArray(e.onAssistantClose)&&e.onAssistantClose.length>0})),i.UI((function(t){return[t,e]})))})),i.UI((function(t){var r=U(t,2),n=r[0],i=r[1];return e.sduiActionEvents.next({type:p.t.Type,sourceId:n.id,cardId:i.id,actions:n.onAssistantClose,scope:{alertRefs:i.alertIds}})})))}},{key:"_handleSduiOnEmptyEvents",value:function(){var e=this;return this._sduiManager.onAlertsRefEmpty.pipe(v.M(this._focusedItem),g.h((function(e){var t=U(e,2),r=t[0].sduiRootId,o=t[1];return(0,n.zG)(o,i.hX((function(e){return e===r})),i.pC)})),m.U((function(e){return U(e,1)[0]}))).subscribe((function(t){var r=t.sduiId,n=t.sduiRootId,i=t.emptyStrongAlertRef;return e.sduiActionEvents.next({type:p.t.Type,sourceId:r,cardId:n,actions:i.onEmpty,scope:{alertRefs:i.alertIds}})}))}},{key:"_handleSduiFeedRemove",value:function(){var e=this;return this._sduiFeedManager.onFeedRemove.subscribe((function(t){(0,s.kG)("assistantFeed"===t.content.type),e.sduiActionEvents.next({type:p.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onRemove,scope:{alertRefs:[]}})}))}},{key:"_handleSduiFeedEmpty",value:function(){var e=this;return this._sduiFeedManager.onFeedEmpty.subscribe((function(t){(0,s.kG)("assistantFeed"===t.content.type),t.content.onEmpty&&e.sduiActionEvents.next({type:p.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onEmpty,scope:{alertRefs:[]}})}))}},{key:"_handleSduiCardOnBlur",value:function(){var e=this;return this._focusedItem.pipe(_.G(),m.U((function(t){var r=U(t,1)[0];return(0,n.zG)(r,i.tS((function(t){return(0,n.zG)(e._sduiManager.findFirstCardWithContent(t),i.hX(S.E.isAssistantCardContent),i.UI((function(e){return[e,t]})))})))})),y.oA,b.b((function(t){var r=U(t,2),o=r[0],s=o.card,a=o.parentStrongAlertRef,u=r[1];e.sduiActionEvents.next({type:p.t.Type,sourceId:s.id,cardId:u,actions:s.onBlur,scope:{alertRefs:(0,n.zG)(a,i.UI((function(e){return e.alertIds})),i.fS((0,n.a9)(c.cS)))}})}))).subscribe()}},{key:"_handleSduiCardOnFocus",value:function(){var e=this;return this._focusedItem.pipe(y.oA,m.U((function(t){return(0,n.zG)(e._sduiManager.findFirstCardWithContent(t),i.UI((function(e){return[e,t]})))})),y.oA).subscribe((function(t){var r=U(t,2),o=r[0],s=o.card,a=o.parentStrongAlertRef,c=r[1];e._sduiFeedManager.notifyCardFocused(c),e.sduiActionEvents.next({type:p.t.Type,sourceId:s.id,cardId:c,actions:s.onFocus,scope:{alertRefs:(0,n.zG)(a,i.UI((function(e){return e.alertIds})),i.fS((function(){return[]})))}})}))}},{key:"_handleSduiActions",value:function(){var e=this;return this.sduiActionEvents.pipe(I.skipBy(p.t.eq),b.b((function(t){var r=t.cardId,c=t.sourceId,u=t.actions,d=t.scope;e._log.info("sdui card action:",{cardId:r,actions:u,scope:d}),u.forEach((function(t){switch(t.type){case"notify":return void e._sduiService.sendUserAction(t.sourceId||c,t.userAction);case"removeRoot":return void requestAnimationFrame((function(){e._sduiManager.pushRemovedRoot([C.j.Item.Id.from(r),E.i5.RemoveRootSDUIAction])}));case"applyAlerts":case"closeCard":case"highlightAlert":case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"upgradeToPremium":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"showHighlights":case"hideHighlights":case"stopApplyingAlerts":case"selectAlternative":case"copyToClipboard":case"newRevision":case"openGrammarlyGo":case"openPerformanceScore":case"nativeOpenUserSatisfactionFeedback":case"enableAudienceAdaptCheck":case"disableAudienceAdaptCheck":case"enableAiStudioCheck":case"disableAiStudioCheck":return;case"removeAlerts":return void(0,n.zG)(e._sduiAlertIdResolver(d.alertRefs),o.bw((function(){requestAnimationFrame((function(){e._sduiManager.pushRemovedAlerts([d.alertRefs.map(C.j.AlertId.from),E.i5.RemoveAlertsSDUIAction])}))})));case"openLink":return void e._platformEnvironment.actions.openPopup(new R.Z(t.url));case"pushAssistantFeed":return void requestAnimationFrame((function(){return(0,n.zG)(e._sduiFeedManager.pushFeed(C.j.Item.Id.from(t.feedId),t.cardId),a.Vn((function(t){return e._log.error(t),t})))}));case"popAssistantFeed":return void requestAnimationFrame((function(){return e._sduiFeedManager.popFeed(i.ij(t.fallbackFeed))}));case"focusAssistantCard":return void requestAnimationFrame((function(){return e._sduiFeedManager.focusCard(t.cardId)}));case"switchView":var u={where:t.where,selected:t.selected,sduiRootId:C.j.Item.Id.from(r)};return e._switchCallerCard(u),e._switchActiveCard(u),e._switchActiveFeed(u),void e._switchActivePopover(u);case"interactPopover":var l=e._sduiManager.popoverManager.getInteractionActions(t.rootPopoverId,t.popoverViewId,t.interaction);return void(l.length>0&&e.sduiActionEvents.next({type:p.t.Type,sourceId:t.rootPopoverId,cardId:t.popoverViewId,actions:l,scope:d}));case"closePopover":return e._sduiManager.popoverManager.removePopover(t.rootPopoverId),void e.sduiActionEvents.next({type:p.t.Type,sourceId:t.rootPopoverId,cardId:t.rootPopoverId,actions:[{type:"removeRoot"}],scope:d});case"enablePlagiarismCheck":return void e._capiClient.enablePlagiarismSearch();case"disablePlagiarismCheck":return void e._capiClient.disablePlagiarismSearch();case"enableWritingExpertCheck":return void e._capiClient.enableWritingExpert();case"disableWritingExpertCheck":return void e._capiClient.disableWritingExpert();default:(0,s.L0)(t)}}))}))).subscribe()}},{key:"_switchCallerCard",value:function(e){this._sduiManager.pushSwitchView(e)}},{key:"_switchActiveCard",value:function(e){var t=this;(0,n.zG)(this._focusedItem.get(),i.hX((function(t){return e.sduiRootId!==t})),o.bw((function(r){return t._sduiManager.pushSwitchView(q(j({},e),{sduiRootId:C.j.Item.Id.from(r)}))})))}},{key:"_switchActiveFeed",value:function(e){var t=this;(0,n.zG)(this._sduiFeedManager.currentFeed,i.hX((function(t){return t.feedId!==e.sduiRootId})),o.bw((function(r){var n=r.feedId;return t._sduiManager.pushSwitchView(q(j({},e),{sduiRootId:n}))})))}},{key:"_switchActivePopover",value:function(e){var t=this;this._sduiManager.popoverManager.activePopoverView.pipe(A.P()).subscribe(o.bw((function(r){var n=r.rootPopoverId;t._sduiManager.pushSwitchView(q(j({},e),{sduiRootId:n}))})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&k(t.prototype,r),u&&k(t,u),e}();function T(e,t){return function(r){return(0,n.zG)(r,u.UI(e),u.vP(i.Kw),o.ew((function(){return t.error("Could not resolve strong alert ref for ".concat(JSON.stringify(r)))})),i.hX(u.Od),o.ew((function(){return t.error("Strong alert refs are empty")})))}}},68291:(e,t,r)=>{r.d(t,{Vi:()=>s});var n=r(67177),i=r(90023),o=r(19659);function s(e){return e().then(o.MH)}(0,i.MZ)(n.tS)}}]);