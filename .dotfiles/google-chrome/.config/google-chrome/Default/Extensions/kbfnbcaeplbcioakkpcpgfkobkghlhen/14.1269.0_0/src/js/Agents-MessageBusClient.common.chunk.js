(self.webpackChunk=self.webpackChunk||[]).push([[4943],{71206:(e,t,s)=>{s.d(t,{K:()=>i});class i{constructor(){this._pendingRevision=0,this._finishedRevisions={regular:-1,plagiarism:-1,ai_detector:-1,writing_expert_check:-1,ai_studio:-1,audience_adapt:-1},this._wasChecked={regular:!1,plagiarism:!1,ai_detector:!1,writing_expert_check:!1,ai_studio:!1,audience_adapt:!1},this.reset()}getCheckState(e){return this._pendingRevision>this._finishedRevisions[e]?this._wasChecked[e]?"checking":"full":"idle"}getRevisionCheckState(){return this.getCheckState("regular")}getAsyncChecksState(){return{plagiarism:this.getCheckState("plagiarism"),ai_detector:this.getCheckState("ai_detector"),writing_expert_check:this.getCheckState("writing_expert_check"),ai_studio:this.getCheckState("ai_studio"),audience_adapt:this.getCheckState("audience_adapt")}}stage(e){this._pendingRevision=Math.max(this._pendingRevision,e)}finishRevision(e){this._finishedRevisions.regular=Math.max(this._finishedRevisions.regular,e),this._wasChecked.regular=!0}finishAsyncCheck(e,t){this._finishedRevisions[e]=Math.max(this._finishedRevisions[e],t),this._wasChecked[e]=!0}reset(){this._pendingRevision=0,this._finishedRevisions={regular:-1,plagiarism:-1,ai_detector:-1,writing_expert_check:-1,ai_studio:-1,audience_adapt:-1}}}},12898:(e,t,s)=>{s.d(t,{Kf:()=>g.K,TJ:()=>p.T,D8:()=>p.D,kX:()=>h});var i=s(64152),r=s(81484),n=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,u=(e,t,s)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;function h(e){return(0,i.t)(((e,t)=>a(e,o(t)))(((e,t)=>{for(var s in t||(t={}))l.call(t,s)&&u(e,s,t[s]);if(c)for(var s of c(t))d.call(t,s)&&u(e,s,t[s]);return e})({},e),{schema:e.protocol,factories:r.i}))}var p=s(88257);if(5526!=s.j)var g=s(71206)},57780:(e,t,s)=>{s.d(t,{b:()=>n});var i=s(5522),r=s(67546);const n={events:{documentSessionDisposed:(0,i.d)()},state:{activeTabId:(0,r.x)(),"activeDocument/:tabId":(0,r.x)(),"agentsFeatureFlags/:tabId":(0,r.x)(),lastActivePanelAgentId:(0,r.x)(),activePanelAgentId:(0,r.x)()}}},53128:(e,t,s)=>{s.r(t),s.d(t,{DefaultAgentsMessageBusClient:()=>l});var i=s(12898),r=s(99161),n=s(57780),a=s(9486),o=s(77784),c=s(24196);class l{constructor(e){this._disposables=new DisposableStack;const t=e.experimentClient.isGateEnabled(c.Nl.AgentsEarlyDisconnectHandler);this._messageBusRouter=this._disposables.use(new a.o({script:e.script,createContentScriptPort:()=>e.messageApi.createPortConnection(r.Tt.messageBusPort),routerName:(0,o.rL)(e.script,e.tabId),isEarlyDisconnectHandlerEnabled:t})),this.platformBus=this._disposables.use((0,i.kX)({port:this._messageBusRouter.createPort({name:(0,o.wS)(e.script,e.tabId)}),clientId:(0,o.EZ)(e.script,e.tabId),keyPrefix:(0,o.e7)(),protocol:n.b}))}createPort(...e){return this._messageBusRouter.createPort(...e)}[Symbol.dispose](){this._disposables.dispose()}}},9486:(e,t,s)=>{s.d(t,{o:()=>b});var i=s(74822),r=s(21070),n=s(79256),a=s(18519),o=s(71051),c=s(63532),l=s(66878),d=s(36344),u=s(98746),h=s(8840),p=s(39963),g=s(40594),_=s(9621);class b{constructor(e){this._init=e,this._disposables=new DisposableStack,this._logger=g.Y.create("AgentsReconnectingMessageBusRouterClient"),this._telemetry="cs"===this._init.script?(0,p.Tb)().agents.cs():(0,p.Tb)().agents.sidePanel,this._reconnectSubject=new i.x,this._volatileMessageBusServerPort=this._getNewPort(),this._messageBusServerPort=this._disposables.use(new u.S(this._volatileMessageBusServerPort)),this._messageBusContentScriptRouter=this._disposables.use(new h.C({tracingOptions:{enabled:!1,color:"green"},serverPort:this._messageBusServerPort,name:this._init.routerName})),this._isEarlyDisconnectHandlerEnabled=this._init.isEarlyDisconnectHandlerEnabled,this._disposables.defer((()=>this._volatileMessageBusServerPort[Symbol.dispose]()));let t=0;this._disposables.adopt(this._reconnectSubject.pipe((0,r.z)((()=>{var e,s;return(0,n.P)((()=>{this._logger.info("Reconnecting to message bus server... Attempt #"+ ++t);const e=this._volatileMessageBusServerPort;return this._volatileMessageBusServerPort=this._getNewPort(),this._messageBusServerPort.connectToServerPort(this._volatileMessageBusServerPort),e[Symbol.dispose](),this._messageBusContentScriptRouter.connect()})).pipe((0,a.V)(null!==(e=this._init.reconnectTimeoutMs)&&void 0!==e?e:1e3),(0,o.X)({count:null!==(s=this._init.reconnectMaxAttempts)&&void 0!==s?s:5}),(0,c.b)((()=>{this._logger.info("Reconnected to message bus server"),t=0})),(0,l.K)((e=>(this._telemetry.error("Failed to reconnect to message bus server",e),this._logger.error("Failed to reconnect to message bus server",e),d.E))))}))).subscribe(),(e=>e.unsubscribe()))}createPort(...e){return this._messageBusContentScriptRouter.createPort(...e)}[Symbol.dispose](){this._disposables.dispose()}_getNewPort(){return(0,_.S)(this._init.createContentScriptPort,(()=>this._reconnectSubject.next()),this._telemetry,this._isEarlyDisconnectHandlerEnabled)}}},77784:(e,t,s)=>{function i(){return"agents/@impl"}function r(e){return`agents/${e}`}function n(e,...t){return a(e,...t)}function a(e,...t){return`agents/@impl/${e}${d(t)}`}function o(e,t,...s){return c(e,t,...s)}function c(e,t,...s){return`${r(e)}/${t}${d(s)}`}function l(e,...t){return`agents/${e}${d(t)}`}function d(e){const t=e.filter(Boolean).join("/");return t?`/${t}`:""}s.d(t,{EZ:()=>a,Lu:()=>r,Yx:()=>c,e7:()=>i,rL:()=>l,wS:()=>n,yp:()=>o})},9621:(e,t,s)=>{s.d(t,{S:()=>n});var i=s(74822),r=s(40594);function n(e,t,s,n){let a=!0;const o=new DisposableStack,c=e();o.defer((()=>{var e;return null===(e=c.removeMessageListeners)||void 0===e?void 0:e.call(c)}));const l=new i.x,d=()=>{var e;a||!n?(a=!1,o.disposed||(null===(e=c.removeMessageListeners)||void 0===e||e.call(c),t())):r.Y.create("createClientPort").debug("Disconnect already handled, skipping")};return c.onDisconnect((()=>{d()})),c.onMessage((e=>{o.disposed||l.next(e)})),{send:e=>{if(o.disposed||!a)return s.warn("Cannot send message to a disposed BG port"),void r.Y.create("createClientPort").warn("Cannot send message to a disposed BG port");try{c.postMessage(e)}catch(e){n&&d(),s.warn("Error sending message to BG port",e,{isEarlyDisconnectHandlerEnabled:n}),r.Y.create("createClientPort").error("Error sending message to BG port",e)}},subscribe:e=>{if(o.disposed||!a)return s.warn("Cannot subscribe to a disposed BG port"),r.Y.create("createClientPort").warn("Cannot subscribe to a disposed BG port"),new DisposableStack;const t=o.use(new DisposableStack);return t.adopt(l.subscribe(e),(e=>e.unsubscribe())),t},[Symbol.dispose]:()=>o.dispose()}}}}]);