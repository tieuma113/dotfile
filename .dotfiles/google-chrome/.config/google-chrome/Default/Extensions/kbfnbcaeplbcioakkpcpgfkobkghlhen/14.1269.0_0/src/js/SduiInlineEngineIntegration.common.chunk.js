(self.webpackChunk=self.webpackChunk||[]).push([[5275],{972:(e,t,n)=>{n.d(t,{FS:()=>y,Ns:()=>C,jy:()=>I});var i=n(60213),s=n(12518),r=n(53186),o=n(90023),a=n(78767);const c=/\s/;function u(e,t){const n=e.split(c),[i,...s]=n;t(i);let r=i.length;for(const n of s){t(e[r]),r+=n.length+1,t(n)}}function d(e,t){const n=new i.diff_match_patch,[s,r,o]=function(e,t){const n=[],i=new Map,s=e=>t=>{if(""===t)return;const s=i.get(t)||String.fromCharCode(i.size);i.has(t)||(n.push(t),i.set(t,s)),e.push(s)},r=[];u(e,s(r));const o=[];return u(t,s(o)),[r.join(""),o.join(""),n]}(e,t),a=n.diff_main(s,r,!1);return n.diff_charsToLines_(a,o),n.diff_cleanupSemantic(a),a}const l=/([.!?] )/;function p(e){const t=e.split(l),n=[];for(let e=0;e<t.length;e++){const i=t[e],s=t[e+1];let r=i;l.test(i)||(l.test(s)?(r+=s[0],n.push(r),n.push(" ")):n.push(r))}return n}function h(e){const t=[];for(const n of e){const[e,i]=n;if(e===y.Operation.INSERT&&l.test(i)){const n=p(i);for(const i of n)t.push([e,i])}else t.push(n)}return t}const f=/(\p{Punctuation}|\s)+/mu,v=e=>e[0],g=e=>e[1],I=e=>{const t=function(e){let t=0,n=0;for(const i of e){const[e,s]=i;e===y.Operation.DELETE&&(t+=s.length),e!==y.Operation.DELETE&&e!==y.Operation.RETAIN||(n+=s.length)}return t/n}(e),n=[],i=e=>({groupID:e,diffs:[],showDeletions:t<.4});let s,r=-1,a=i(r);for(const t of e){const[e,o,c]=t;switch(e){case y.Operation.INSERT:!s||v(s)!==y.Operation.DELETE&&v(s)!==y.Operation.INSERT?(r+=1,n.push(a),a=i(r),a.diffs.push(t)):a.diffs.push(t);break;case y.Operation.DELETE:r+=1,a.diffs.length>0&&n.push(a),a=i(r),a.diffs.push(t);break;case y.Operation.RETAIN:c?(r+=1,n.push(a),a=i(r),a.diffs.push(t)):S(o).map((t=>[e,t,c])).forEach((e=>{r+=1,a.diffs.length>0&&n.push(a),a=i(r),a.diffs.push(e)}))}s=t}return a.diffs.length>0&&n.push(a),(0,o.zG)(n,E,m,A,_)};function E(e){return e.map((e=>{const t=e.diffs.every((([e])=>e===y.Operation.DELETE));return{...e,showDeletions:t||e.showDeletions}}))}function m(e){return e.map((e=>{const{diffs:t,showDeletions:n}=e;if(2!==t.length||!n)return e;const[i,s]=t,[r,o]=i,[a,c]=s,u=r===y.Operation.DELETE&&a===y.Operation.INSERT&&o.toLocaleUpperCase()===c;return{...e,showDeletions:!u&&n}}))}function A(e){return e.map((e=>{const{diffs:t,showDeletions:n}=e;if(2!==t.length||!n)return e;const[i,s]=t,[r,o]=i,[a,c]=s,u=r===y.Operation.DELETE&&a===y.Operation.INSERT&&o.length===c.length;return{...e,showDeletions:!u&&n}}))}function w(e){const{diffs:t}=e;if(1===t.length){const[e]=t,[n,i]=e;return(n===y.Operation.INSERT||n===y.Operation.DELETE)&&!f.test(i)}if(2===t.length){const[e,n]=t,[i,s]=e,[r,o]=n;return i===y.Operation.DELETE&&r===y.Operation.INSERT&&s.length===o.length&&!f.test(s)&&!f.test(o)}return!1}function b(e){const{diffs:t}=e;return function(e){const{diffs:t}=e;return 1===t.length&&v(t[0])===y.Operation.RETAIN}(e)&&!f.test(g(t[0]))}function S(e){const t=e.split(f);if(1===t.length)return[e];const n=[],i=t[0],s=t[t.length-1];let r=0;return i&&(n.push(i),r=i.length),s?(n.push(e.substring(r,e.length-s.length)),n.push(s)):n.push(e.substring(r)),n}function _(e){const t=[];let n,i=[],s=[],r=!1,o=0;const a=()=>{o>=2&&r?t.push(...s):t.push(...i),i=[],s=[],n=void 0,o=0,r=!1};for(const c of e)void 0===n?w(c)||b(c)?(i.push(c),n={groupID:c.groupID,diffs:[...c.diffs],showRetainsAsInserts:!0,showDeletions:!1},s.push(n)):t.push(c):w(c)?(i.push(c),o++,n.diffs.push(...c.diffs)):b(c)?(i.push(c),o>0&&(r=!0),n.diffs.push(...c.diffs)):(a(),t.push(c));return a(),t}const C=(e,t)=>{const n=new i.diff_match_patch,s=n.patch_make(e,t),[r]=n.patch_apply(s,e);return r};var y;!function(e){let t;e.getDiff=(t,n)=>(0,o.zG)(s.Y3((()=>{if(t===n)return""===t?[]:[[e.Operation.RETAIN,t]];return h(d(t,n))}),s.KC),s.tS((0,o.ls)(r.nI,s.Yo((()=>new Error("Diff is empty")))))),function(e){e[e.DELETE=-1]="DELETE",e[e.RETAIN=0]="RETAIN",e[e.INSERT=1]="INSERT"}(t=e.Operation||(e.Operation={})),e.matchOperation=function({onInsert:e,onDelete:n,onRetain:i}){return s=>{const r=v(s);switch(r){case t.INSERT:return e(g(s));case t.DELETE:return n(g(s));case t.RETAIN:return i(g(s));default:(0,a.vE)(r)}}}}(y||(y={}))},94978:(e,t,n)=>{n.d(t,{G:()=>o});var i=n(13391),s=n(58303),r=n(70155);class o extends r.J{constructor(){super(),this._popoverActionsHandler=i.h.create(s.YP)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(s.G(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}dispose(){this._popoverActionsHandler.set(s.YP)}}},34942:(e,t,n)=>{n.d(t,{z:()=>r});var i=n(13391),s=n(58303);class r{constructor(){this.activePopoverStack=i.h.create(s.YP),this.activePopoverView=i.h.create(s.YP),this._popoverActionsHandler=i.h.create(s.YP)}addPopover(e,t){}getInteractionActions(e,t,n){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}dispose(){}}},87945:(e,t,n)=>{n.d(t,{U:()=>k});var i=n(53186),s=n(90023),r=n(27947),o=n(32103),a=n(13391),c=n(74822),u=n(88012),d=n(10883),l=n(59179),p=n(954),h=n(81933),f=n(45128),v=n(58303),g=n(10444),I=n(59833),E=n(21147),m=n(23685),A=n(27643),w=n(72008),b=n(972),S=n(36344),_=n(12518);class C{constructor(){this.feed=S.E,this.currentFeed=v.YP,this.onFeedRemove=S.E,this.onFeedEmpty=S.E,this.header=S.E,this.footer=S.E,this.pushFeed=()=>_.F2(null),this.popFeed=s.Q1,this.focusCard=()=>_.F2(null),this.notifyCardFocused=s.Q1,this.dispose=s.Q1}}var y,T=n(37873),D=n(64181),P=n(65877),U=n(60431),R=n(87410),O=n(57420);class k{constructor(e,t,n,i,o,f){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=n,this.capiClient=i,this.integrationModel=o,this.onReplacement=f,this._focusedItem=a.h.create(v.YP),this._focusedItemUndoDiff=a.h.create(v.YP),this._sduiInlineCardActions=new c.x,this._subs=new u.w.Keeper,this.focusCard=e=>{this._focusedItem.set(v.G(e)),this.clearUndoDiff()},this.handleSduiCardAction=(e,t,n)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:n})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e),(0,s.zG)(k.getSduiFeedActions(e.actions),v.UI((t=>this.integrationModel.openAssistant({type:O.WT.sdui,action:{...e,actions:t,type:r.lY.Type.sduiCardAction}}))))},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new m.x(t,e,new C,i,this._focusedItem.view(v.UI((e=>e.id))));const g=this._sduiViewModel.sduiActionEvents.pipe(d.M(this._sduiInlineCardActions.pipe(l.U(v.G),p.O(v.YP)))).subscribe((([e,t])=>this._nativeHandling(e,(0,s.zG)(t,v.UI((e=>e.match))),(0,s.zG)(t,v.UI((e=>e.cardModel)))))),I=this._sduiInlineCardActions.pipe(h.skipBy(y.eq)).subscribe((({cardAction:e})=>this._sduiViewModel.sduiActionEvents.next(e)));this._subs.push(g,I,this._sduiViewModel)}setUndoDiff(e){this._focusedItemUndoDiff.set(e)}getUndoDiff(){return this._focusedItemUndoDiff.get()}clearUndoDiff(){this._focusedItemUndoDiff.set(v.YP)}_nativeHandling({actions:e,cardId:t,sourceId:n,scope:i},r,a){(0,s.zG)(k.getSduiFeedActions(e),v.UI((e=>{(0,s.zG)(a,v.UI((s=>{s.onOpenExpandedViewBySduiAction(T.Oe.create(e,t,n,i))})))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"openPerformanceScore":case"nativeOpenUserSatisfactionFeedback":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"enableWritingExpertCheck":case"disableWritingExpertCheck":case"enableAudienceAdaptCheck":case"disableAudienceAdaptCheck":case"enableAiStudioCheck":case"disableAiStudioCheck":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":case"stopApplyingAlerts":return;case"closePopover":return void this.integrationModel.closePopover(e.rootPopoverId);case"openLink":return void this.environment.actions.openPopup(new f.Z(e.url));case"copyToClipboard":return void(0,R.v)(e.text);case"upgradeToPremium":return(0,s.zG)(a,v.UI((t=>t.openPlanComparisonPage({utmCampaign:D.L.Place.assistantCardList,overrideUrl:e.url})))),void(0,s.zG)(r,v.UI((e=>e.hide())));case"applyAlerts":return void(0,s.zG)(r,v.UI((n=>{var i;if(null==n.alert)return;const{alert:r}=n,o=this.getUndoDiff();if(v.pC(o)){const s=(0,b.Ns)(n.alert.text,o.value);return n.replace(s,!0,e.alternativeIndex),null===(i=this.onReplacement)||void 0===i||i.call(this,t,r.group,r.category),this.clearUndoDiff(),void n.hide()}(0,s.zG)((0,P.UQ)(r,n.plainText),(t=>new U.U_(t,(t=>n.replace(null!=t?t:"",!1,e.alternativeIndex)))),(n=>(0,s.zG)(v.ij(n.replacements[e.alternativeIndex]),v.UI((e=>n.getOnReplace(e)())),g.bw((()=>{var e;null===(e=this.onReplacement)||void 0===e||e.call(this,t,r.group,r.category)}))))),n.hide()})));case"closeCard":case"removeRoot":return void(0,s.zG)(r,v.UI((e=>e.hide())));case"removeAlerts":return void(0,s.zG)(r,v.UI((e=>{e.ignore(),e.hide()})));case"openGrammarlyGo":return void(0,s.zG)(v.RD([a,r]),v.UI((([e,t])=>{var n,i;const s=(t,n)=>{e.onOpenGrammarlyGo({assistantMode:"genAI",genAIParams:t,source:n})};if(t.alert&&(0,w.t)(t.alert.patternName)){const e=(0,P.UQ)(t.alert,t.plainText);if(e.length>0&&e[0].newText){const n=e[0].newText;s({genAISessionMode:"pushRewrite",writingExpertContext:{alertId:t.alert.id,alertPname:t.alert.patternName,originalText:t.alert.text,replacementText:n},transformRange:t.alert.transformRange},{kind:"inlinePushRewriteSource"})}else s({genAISessionMode:"ideation"},{kind:"inlinePushRewriteSource"})}else s({genAISessionMode:"ideation"},{kind:"inlineCardSource",alertId:null!==(i=null===(n=t.alert)||void 0===n?void 0:n.id)&&void 0!==i?i:null})})));default:(0,o.L0)(e)}}))}}k.getSduiFeedActions=(0,s.ls)(I.hX((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type)),i.nI),function(e){e.eq=E.MW({cardAction:A.t.eq})}(y||(y={}))},56663:(e,t,n)=>{n.r(t),n.d(t,{createSduiInlineEngine:()=>R,default:()=>O});var i=n(90023),s=n(88012),r=n(90572),o=n(59179),a=n(58303),c=n(45676),u=n(58508),d=n(34457),l=n(73503),p=n(30922),h=n(86305),f=n(64443),v=n(4782),g=n(86214),I=n(954),E=n(78129),m=n(90499);function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,s,r=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){a=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw s}}return r}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"_state",new Map),b(this,"_subs",new s.w.Keeper),b(this,"_log",f.C8.Logging.getLogger("SDUIInlineManager",f.zW.i.TRACE,f.zW.T.Manager.getColor())),this._subs.push(t.pipe(I.O(m.a.empty),E.G(),o.U((function(e){var t=S(e,2),n=t[0],i=t[1];return m.a.diff(n,i)})),o.U((function(e){return n._processSDUIItems(e)}))).subscribe())}var t,n,r;return t=e,(n=[{key:"getInlineItemForAlert",value:function(e){return a.ij(this._state.get(e))}},{key:"_processSDUIItems",value:function(e){var t=this;(0,i.zG)(e,g.vh.forEach((function(e){C(e)&&(t._log.trace("inline item removed",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(e){return t._state.delete(e)})))}),(function(e,n){C(n)&&(t._log.trace("inline item updated",{alertIds:n.alertIds,itemId:n.id}),n.alertIds.forEach((function(e){return t._state.set(e,n)})))}),(function(e){C(e)&&(t._log.trace("inline item added",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(n){return t._state.set(n,e)})))})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&w(t.prototype,n),r&&w(t,r),e}(),C=function(e){return(0,i.zG)(v.ab.findFirst(e.content,"inlineCard"),a.pC)},y=n(8379),T=n(87945),D=n(37873),P=n(94978),U=n(34942);const R=({sduiBufferService:e,alertState:t,getByRawAlertId:n,sendUserAction:f,environment:v,capiClient:g,integrationModel:I,onReplacement:E,sduiPopoversSupported:m=!1})=>{const A=new s.w.Keeper,w=(0,i.ls)((e=>e.toString()),n,a.ij,a.UI((e=>u.j.AlertId.from(e.id)))),b=e.capiEvents.pipe(r.h(c.hX.is("sdui_add","sdui_remove","sdui_update")),r.h((e=>"sdui_remove"===e.kind||D.D1.InlineCard.isInlineCard(e.sdui)||D.D1.StrongAlertRef.isStrongAlertRefUpgradeHookContent(e.sdui)||D.D1.GButton.isGButtonContent(e.sdui)||D.D1.PopoverStack.isPopoverStack(e.sdui)||d.vK.isGlobalPart(e.sdui))),r.h(l.e.isSduiEvent),o.U(p.al.fromSource(p.i5.CAPI))),S=m?new P.G:new U.z,C=new h.G(b,w,S),R=new _(C.state),O=new y.Q({sendUserAction:f}),k=new T.U(C,O,v,g,I,E);return S.setPopoverActionsHandler(k),A.push(t.subscribe((e=>C.notifyAlertsChanged())),e.capiEvents.pipe(r.h(c.hX.is("session_started")),r.h((e=>e.isNewSession))).subscribe((e=>C.onSessionStarted())),e.capiEvents.pipe(r.h(c.hX.is("finish")),r.h((e=>0===e.revision))).subscribe((e=>C.onFirstCheckingFinished())),C,R,k),{sduiBufferService:e,sduiManager:C,sduiInlineManager:R,sduiFeedbackService:O,inlineCardViewModel:k,dispose:()=>{A.dispose(),S.dispose()}}},O={createSduiInlineEngine:R}},87410:(e,t,n)=>{n.d(t,{S:()=>r,v:()=>s});var i=n(12518);async function s(e,t=self){var n,i,s,r;if("string"==typeof e){if(null===(i=null===(n=t.navigator)||void 0===n?void 0:n.clipboard)||void 0===i?void 0:i.writeText)return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported (writeText)")}if(null===(r=null===(s=t.navigator)||void 0===s?void 0:s.clipboard)||void 0===r?void 0:r.write)return t.navigator.clipboard.write(Array.from(e));throw new Error("Clipboard API not supported (write)")}function r(e,t=self){return s(e,t).then((()=>i.F2(void 0))).catch((e=>i.t$(e instanceof Error?e:new Error(String(e)))))}}}]);