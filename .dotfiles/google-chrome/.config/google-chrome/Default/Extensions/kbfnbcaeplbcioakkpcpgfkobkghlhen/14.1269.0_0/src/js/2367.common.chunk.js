(self.webpackChunk=self.webpackChunk||[]).push([[2367],{6641:(e,t,n)=>{n.d(t,{i:()=>a});var i=n(5749),o=n(82638);const a=e=>{var t;return i.z.isVBar(e)&&i.h.isWithComment(e)&&e.surface.sourceAgent===o.P&&void 0!==(null==(t=e.surface.additionalElements)?void 0:t.plagiarism)}},9961:(e,t,n)=>{var i,o,a,d;n.d(t,{C:()=>i,P:()=>d}),o=i||(i={}),(a=o.Kind||(o.Kind={})).markAsAddedButtonClick="markAsAddedButtonClick",a.dismissButtonClick="dismissButtonClick",a.copyCitationButtonClick="copyCitationButtonClick",a.cardShow="cardShow",o.markAsAddedButtonClick=function(e){return{kind:"markAsAddedButtonClick",pushedContentItemId:e}},o.dismissButtonClick=function(e){return{kind:"dismissButtonClick",pushedContentItemId:e}},o.copyCitationButtonClick=function(e){return{kind:"copyCitationButtonClick",pushedContentItemId:e}},o.cardShow=function(e){return{kind:"cardShow",pushedContentItemId:e}},(e=>{var t;(t=e.Kind||(e.Kind={})).updateCitationStyle="updateCitationStyle",t.openUphook="openUphook",t.trackUphook="trackUphook",t.textTooShortViewMounted="textTooShortViewMounted",t.scoresLoadingViewMounted="scoresLoadingViewMounted",t.scoresLoadedViewMounted="scoresLoadedViewMounted",t.loadingLockedViewMounted="loadingLockedViewMounted",t.lockedViewMounted="lockedViewMounted",e.updateCitationStyle=function(e){return{kind:"updateCitationStyle",citationStyle:e}},e.openUphook=function(e){return{kind:"openUphook",paywallUphook:e}},e.trackUphook=function(e,t){return{kind:"trackUphook",paywallUphook:e,event:t}},e.textTooShortViewMounted=function(){return{kind:"textTooShortViewMounted"}},e.scoresLoadingViewMounted=function(){return{kind:"scoresLoadingViewMounted"}},e.scoresLoadedViewMounted=function(){return{kind:"scoresLoadedViewMounted"}},e.loadingLockedViewMounted=function(){return{kind:"loadingLockedViewMounted"}},e.lockedViewMounted=function(){return{kind:"lockedViewMounted"}}})(d||(d={}))},22367:(e,t,n)=>{n.r(t),n.d(t,{activate:()=>ee});var i,o,a,d,s,c,r,l,u=n(13391),p=n(8867),k=n(90572),h=n(84178),w=n(59179),g=n(20161),S=n(84714),C=n(50750),m=n(66878),v=n(36344),b=n(63532),y=n(954),f=n(32073),P=n(98189),V=n(78129),M=n(18827),L=n(84308),K=n(29416),A=n(79984),U=n(42203),I=n(32103),B=n(64443),E=n(62709),x=n(82638),T=n(9961),O=n(90023),D=n(96333),W=n(67177),G=n(12518),R=n(6641),q=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),z=e=>{throw TypeError(e)},_=(e,t,n)=>t.has(e)||z("Cannot "+n),j=(e,t,n)=>(_(e,t,"read from private field"),n?n.call(e):t.get(e)),H=(e,t,n)=>t.has(e)?z("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Z=(e,t,n,i)=>(_(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),$=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))($||{}),F=(e=>(e.TextTooShortView="agentPanel/plagiarism/textTooShortView",e.ScoresLoadingView="agentPanel/plagiarism/scoresLoadingView",e.ScoresLoadedView="agentPanel/plagiarism/scoresLoadedView",e.LoadingLockedView="agentPanel/plagiarism/loadingLockedView",e.LockedView="agentPanel/plagiarism/lockedView",e.PanelContentReceived="agentPanel/plagiarism/panelContentReceived",e.MarkAsAddedButton="agentPanel/plagiarism/markAsAddedButton",e.DismissButton="agentPanel/plagiarism/dismissButton",e.CopyCitationButton="agentPanel/plagiarism/copyCitationButton",e.CitationStyleSelect="agentPanel/plagiarism/citationStyleSelect",e.Card="agentCard/plagiarism",e))(F||{});function J(e){return new p.y((t=>(t.next(e),()=>e[Symbol.dispose]())))}class N{constructor(e){H(this,i),H(this,o),Z(this,i,new DisposableStack),Z(this,o,u.h.create(x.S.Locked.initial())),this.state=j(this,o).view(),j(this,i).adopt(u.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,k.h)(Boolean),(0,h.q)(1),(0,w.U)((()=>e.paywallConfig.get())),(0,g.w)((t=>(t?(0,S.of)(t):(0,C.D)(e.uphookHubClient.getUphookConfig("plagiarismAgentPanelPaywall")).pipe((0,m.K)((t=>(e.logger.error("Error while fetching uphook config",t),v.E))),(0,k.h)(U.C_),(0,b.b)((t=>e.paywallConfig.set(t))))).pipe((0,w.U)((e=>x.S.Locked.uphookConfigResolved(e))),(0,y.O)((0,O.zG)(e.paywallConfig.get(),(e=>e?x.S.Locked.uphookConfigResolved(e):x.S.Locked.uphookConfigRequested()))))))).subscribe((e=>j(this,o).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){j(this,i).dispose()}}i=new WeakMap,o=new WeakMap;class Q{constructor(e){H(this,a),H(this,d),Z(this,a,new DisposableStack),Z(this,d,u.h.create(x.S.Unlocked.Enabled.initial())),this.state=j(this,d).view();const t=j(this,a).adopt(new f.w0,(e=>e.unsubscribe())),n=e.capiConnectionStatus.view((e=>"connected"===e.kind?e.sessionId:null)).pipe((0,P.n)((e=>null===e)));t.add(n.pipe((0,g.w)((t=>null===t?v.E:u.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,y.O)(null),(0,V.G)(),(0,g.w)((([t,n])=>n?function(e,t){return new p.y((n=>{(0,O.zG)(e.request({commandId:"start",payload:"",agentId:x.P}),W.Vn((e=>(t.error("Error while starting checks",e),e))))().then((e=>{G.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):t?function(e,t){return new p.y((n=>{(0,O.zG)(e.request({commandId:"stop",payload:"",agentId:x.P}),W.Vn((e=>(t.error("Error while stopping checks",e),e))))().then((e=>{G.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):v.E)),(0,m.K)((()=>v.E)))))).subscribe());const i=u.h.create(new Set);t.add(e.cardActions.subscribe((e=>{if(e.kind===T.C.Kind.markAsAddedButtonClick)return i.modify((t=>new Set(t).add(e.pushedContentItemId)))})));const o=u.h.create(!1);t.add(e.capiConnectionStatus.view((e=>"disconnected"===e.kind)).pipe((0,k.h)(Boolean),(0,g.w)((()=>e.capiConnectionStatus.pipe((0,k.h)((e=>"connected"===e.kind)),(0,h.q)(1),(0,M.g)(500),(0,w.U)((()=>!1)),(0,y.O)(!0))))).subscribe((e=>o.set(e))));const s=u.h.combine(e.capiCheckingState.asyncScores.view("plagiarism").view((e=>(null==e?void 0:e.outcomeScores.Originality)??null)).view((e=>null!==e?100*e:null)),o,((e,t)=>t?null:e)),c=u.h.combine(s,e.capiCheckingState.asyncCheckingState.view("plagiarism").view((e=>"idle"!==e)),e.pushedContentService.getCollection(R.i).view((e=>D.$.values(e).filter(R.i))),((e,t,n)=>null!==e?{originalityScorePercent:e,checkingInProgress:t,pushedContentItems:n}:null));t.add((0,L.a)([e.capiConnectionStatus,c,c.pipe((0,k.h)(U.C_)),i]).pipe((0,w.U)((([e,t,n,i])=>[e,t??n,i]))).subscribe((([t,{originalityScorePercent:n,checkingInProgress:i,pushedContentItems:o},a])=>{e.onContentStateChanged({remainingSuggestionCount:o.length,citedSuggestionCount:a.size,originalityScorePercent:n}),j(this,d).set(x.S.Unlocked.Enabled.scoresReceived(a,o,n,i||"connected"!==t.kind))})))}[Symbol.dispose](){j(this,a).dispose()}}a=new WeakMap,d=new WeakMap;class X{constructor(e){H(this,s,new DisposableStack),H(this,c),Z(this,c,u.h.create(x.S.Unlocked.initial(e.citationStyle))),this.state=j(this,c).view();const t=j(this,s).adopt(new f.w0,(e=>e.unsubscribe())),n=u.h.create(e.citationStyle);t.add(e.panelActions.subscribe((e=>{if(e.kind===T.P.Kind.updateCitationStyle)return n.set(e.citationStyle)})));const i=J(new Q(e)).pipe((0,g.w)((e=>e.state)),(0,w.U)((e=>({kind:x.S.Unlocked.Kind.Enabled,enabledState:e}))));j(this,s).adopt((0,L.a)([e.wordCount.pipe((0,k.h)(U.C_),(0,h.q)(1),(0,w.U)(x.i),(0,g.w)((t=>t?i:e.wordCount.pipe((0,k.h)(x.i),(0,h.q)(1),(0,g.w)((()=>i)),(0,y.O)(x.S.Unlocked.textTooShort(n.get()))))),(0,y.O)(null===e.wordCount.get()||(0,x.i)(e.wordCount.get())?x.S.Unlocked.initial(n.get()):x.S.Unlocked.textTooShort(n.get()))),n]).pipe((0,w.U)((([e,t])=>({...e,citationStyle:t})))).subscribe((e=>j(this,c).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){j(this,s).dispose()}}s=new WeakMap,c=new WeakMap;class Y{constructor(e){H(this,r),H(this,l),Z(this,r,new DisposableStack),Z(this,l,u.h.create(x.S.initial())),this.state=j(this,l).view();const t=e.userService.user.view("free");j(this,r).adopt(t.pipe((0,g.w)((t=>t?J(new N(e)).pipe((0,g.w)((e=>e.state)),(0,w.U)((e=>({kind:x.S.Kind.Locked,lockedState:e})))):J(new X(e)).pipe((0,g.w)((e=>e.state)),(0,w.U)((e=>({kind:x.S.Kind.Unlocked,unlockedState:e}))))))).subscribe((e=>j(this,l).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){j(this,r).dispose()}}r=new WeakMap,l=new WeakMap;const ee=async({bus:e,userService:t,document:n,pushedContentService:i,capiConnectionStatus:o,capiCheckingState:a,navigation:d,uphookHubClient:s,environment:c,agentGenericService:r,trackingServiceProvider:l})=>{var p=[];try{const C=((e,t,n)=>{var i;return null!=t?("object"!=typeof t&&"function"!=typeof t&&z("Object expected"),n&&(i=t[q("asyncDispose")]),void 0===i&&(i=t[q("dispose")]),"function"!=typeof i&&z("Object not disposable"),e.push([n,i,t])):n&&e.push([n]),t})(p,new DisposableStack),m=C.adopt(new f.w0,(e=>e.unsubscribe())),b=B.C8.Logging.getLogger("PlagiarismCheckerAgent"),y=C.use(e.state.panelState.create(n.id,x.S.initial())),P=C.use(e.state.paywallConfig.create(null)),V=l.getTrackingService(),M=u.h.create(null),O=C.use(new Y({agentGenericService:r,uphookHubClient:s,userService:t,capiCheckingState:a,pushedContentService:i,capiConnectionStatus:o,isPanelOpen:d.isPanelOpen,isDocumentActive:n.isActive,paywallConfig:P,wordCount:a.textInfo.view((e=>(null==e?void 0:e.wordCount)??null)),cardActions:e.events.cardAction.view(n.id),panelActions:e.events.panelAction.view(n.id),citationStyle:E.aO.APA,onContentStateChanged:e=>M.set(e),logger:b}));C.adopt(O.state.subscribe((e=>y.set(e))),(e=>e.unsubscribe()));const D=()=>{var e;const t=o.get();return{agentId:x.P,capiSessionId:"connected"===t.kind?t.sessionId:void 0,documentWordCount:null==(e=a.textInfo.get())?void 0:e.wordCount}};return m.add((0,L.a)([M.pipe((0,K.b)(1e3)),d.isPanelOpen,n.isActive]).pipe((0,g.w)((([e,t,n])=>t&&n?(0,S.of)(e):v.E)),(0,k.h)(U.C_)).subscribe((e=>V.trackEvent($.ComponentImpression,{componentId:F.PanelContentReceived,detail:{...e,...D()}})))),C.adopt(e.events.panelAction.view(n.id).subscribe((e=>{const t=function(e,t,n){const i=t();switch(n.kind){case T.P.Kind.textTooShortViewMounted:case T.P.Kind.scoresLoadingViewMounted:case T.P.Kind.scoresLoadedViewMounted:case T.P.Kind.loadingLockedViewMounted:case T.P.Kind.lockedViewMounted:return{event:$.ComponentImpression,detail:{componentId:{[T.P.Kind.textTooShortViewMounted]:F.TextTooShortView,[T.P.Kind.scoresLoadingViewMounted]:F.ScoresLoadingView,[T.P.Kind.scoresLoadedViewMounted]:F.ScoresLoadedView,[T.P.Kind.lockedViewMounted]:F.LockedView,[T.P.Kind.loadingLockedViewMounted]:F.LoadingLockedView}[n.kind],detail:n.kind===T.P.Kind.scoresLoadedViewMounted&&i.kind===x.S.Kind.Unlocked&&i.unlockedState.kind===x.S.Unlocked.Kind.Enabled&&i.unlockedState.enabledState.kind===x.S.Unlocked.Enabled.Kind.ScoresReceived?{...e(),remainingSuggestionCount:i.unlockedState.enabledState.pushedContentItems.length,citedSuggestionCount:i.unlockedState.enabledState.citedPushedContentItemsIds.size,originalityScorePercent:i.unlockedState.enabledState.originalityScorePercent}:e()}};case T.P.Kind.updateCitationStyle:return{event:$.ComponentClicked,detail:{componentId:F.CitationStyleSelect,detail:{...e(),citationStyle:n.citationStyle}}};case T.P.Kind.openUphook:case T.P.Kind.trackUphook:return null;default:(0,I.L0)(n)}}(D,(()=>y.get()),e);switch(t&&V.trackEvent(t.event,t.detail),e.kind){case T.P.Kind.openUphook:c.actions.openPopup(new A.Z(e.paywallUphook.content.ctaUrl));break;case T.P.Kind.trackUphook:s.trackUphookEvent(e.paywallUphook,e.event);break;case T.P.Kind.textTooShortViewMounted:case T.P.Kind.scoresLoadingViewMounted:case T.P.Kind.scoresLoadedViewMounted:case T.P.Kind.loadingLockedViewMounted:case T.P.Kind.lockedViewMounted:case T.P.Kind.updateCitationStyle:break;default:(0,I.L0)(e)}})),(e=>e.unsubscribe())),C.adopt(e.events.cardAction.view(n.id).subscribe((e=>{const t=function(e,t){switch(t.kind){case T.C.Kind.markAsAddedButtonClick:case T.C.Kind.dismissButtonClick:case T.C.Kind.copyCitationButtonClick:return{event:$.ComponentClicked,detail:{componentId:{[T.C.Kind.markAsAddedButtonClick]:F.MarkAsAddedButton,[T.C.Kind.dismissButtonClick]:F.DismissButton,[T.C.Kind.copyCitationButtonClick]:F.CopyCitationButton}[t.kind],detail:e()}};case T.C.Kind.cardShow:return{event:$.ComponentImpression,detail:{componentId:F.Card,detail:e()}};default:(0,I.L0)(t)}}(D,e);t&&V.trackEvent(t.event,t.detail)})),(e=>e.unsubscribe())),C.move()}catch(e){var h=e,w=!0}finally{((e,t,n)=>{var i="function"==typeof SuppressedError?SuppressedError:function(e,t,n,i){return(i=Error(n)).name="SuppressedError",i.error=e,i.suppressed=t,i},o=e=>t=n?new i(e,t,"An error was suppressed during disposal"):(n=!0,e),a=i=>{for(;i=e.pop();)try{var d=i[1]&&i[1].call(i[2]);if(i[0])return Promise.resolve(d).then(a,(e=>(o(e),a())))}catch(e){o(e)}if(n)throw t};a()})(p,h,w)}}}}]);