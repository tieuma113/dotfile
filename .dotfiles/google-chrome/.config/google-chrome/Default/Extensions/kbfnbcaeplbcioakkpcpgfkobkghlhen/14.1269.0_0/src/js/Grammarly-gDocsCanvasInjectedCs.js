!function(){var t={51240:(t,e,n)=>{n.d(e,{C:()=>r});const r="_docs_annotate_canvas_by_ext";var o;self.GR_EXTENSION_ID=(null===(o=document.currentScript)||void 0===o?void 0:o.getAttribute("data-ext-id"))||"unknown",self.GR_EXTENSION_SEND=function(t,e){if(!t)throw new TypeError("cant be called without message");const n=document.createEvent("CustomEvent");n.initCustomEvent("external:"+t,!0,!0,e),document.dispatchEvent(n)}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,n),a.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{function t(t,e){return new Promise(((n,r)=>{setTimeout((()=>{void 0!==e?r(e):n()}),t)}))}function e(){let t,e;return{promise:new Promise(((n,r)=>{t=n,e=r})),resolve:t,reject:e}}class r extends Error{}function o(t){return new Promise(((e,n)=>setTimeout((()=>n(new r("Promise timed out."))),t)))}function a(t,e){return Promise.race([o(t),e])}class i extends Error{constructor(t){super(`Matching not exhaustive: unexpected value ${JSON.stringify(t)}`)}}function s(t,e){try{return t()}catch(t){return e(t)}}function c(){}async function l(e,n,r){const o=r();if(!(e>0))return o;try{return await o}catch(o){return await t(n),l(e-1,n,r)}}var u;!function(t){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}t.create=function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(u||(u={}));const f=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)";function d(t){return t.querySelector(".kix-appview-editor")}function g(t,e,n){return e?function(t,e){if(e&&p(e))return e;const n=t.querySelectorAll(f);for(const t of n)if(p(t))return t;return null}(t,n):t.querySelector(f)}const p=t=>t.checkVisibility?t.checkVisibility():t.parentElement&&"none"!==t.parentElement.style.display;function h(t){return t.matches("canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)")}function m(t){var e;return!!(null===(e=t.parentElement)||void 0===e?void 0:e.classList.contains("kix-page-canvas-compact-mode"))}var v;!function(t){t.legacy="legacy",t.modern="modern"}(v||(v={}));class y{constructor(t,e,n,r){this._customInboundEventName=e,this._customOutboundEventName=n,this._wrapOutboundMessage=r,this.inbound={subscribe:t=>{const e=({detail:e})=>{const n=e;t&&("function"==typeof t?t(n):t.next&&t.next(n))};return this._target.addEventListener(this._customInboundEventName,e,!1),{unsubscribe:()=>this._target.removeEventListener(this._customInboundEventName,e,!1)}}},this.outbound=t=>{const e=this._wrapOutboundMessage?this._wrapOutboundMessage(t):t,n=new CustomEvent(this._customOutboundEventName,{bubbles:!0,cancelable:!0,detail:e});this._target.dispatchEvent(n)},this._target=t.defaultView||t}}function x(t,e,n=.001){return t===e||Math.abs(t-e)<=n}function b(t,e,n=.001){return function(t,e,n=.001){return t>=e||t+n>=e}(e,t,n)}var w,S,E,T,k,C;!function(t){t.equals=function(t,e){return x(t.left,e.left)&&x(t.top,e.top)},t.fromCartesian=function({x:t,y:e}){return{top:e,left:t}},t.toCartesian=function({top:t,left:e}){return{x:e,y:t}},t.zero={top:0,left:0},t.minus=function(t,e){return{top:t.top-e.top,left:t.left-e.left}},t.plus=function(t,e){return{top:t.top+e.top,left:t.left+e.left}},t.ceil=function(t){return{left:Math.ceil(t.left),top:Math.ceil(t.top)}},t.floor=function(t){return{left:Math.floor(t.left),top:Math.floor(t.top)}},t.create=function(t){return{top:t.top,left:t.left}},t.l1Distance=function(t,e){return Math.abs(t.top-e.top)+Math.abs(t.left-e.left)}}(w||(w={})),function(t){function e(t){return{top:t.top,left:t.left}}t.create=e,t.fromClientPoint=function(t,n,r){return e({top:t.top-n.top+r.top,left:t.left-n.left+r.left})},t.zero={top:0,left:0}}(S||(S={})),function(t){function e(t){return{top:t.top,left:t.left}}t.create=e,t.fromOffsetPoint=function(t,n,r){return e({top:t.top+n.top-r.top,left:t.left+n.left-r.left})},t.fromPage=function(t,n){return e({top:t.top-n.top,left:t.left-n.left})}}(E||(E={})),function(t){function e(t){return{top:t.top,left:t.left}}t.create=e,t.getHighlightsPosition=function(t,n,r,o={top:0,left:0}){return e({top:t.top+n.top+r.top+o.top,left:t.left+n.left+r.left+o.left})},t.fromClient=function(t,n){return e({top:t.top+n.top,left:t.left+n.left})},t.fromOffset=function(t,e,n){return{top:t.top+e.top-n.top,left:t.left+e.left-n.left}}}(T||(T={})),function(t){t.editorElementSelector="div.kix-appview-editor",t.textEventsTargetIframeSelector="iframe.docs-texteventtarget-iframe",t.textEventsTargetElementSelector='[contenteditable="true"]'}(k||(k={})),function(t){t.spellingBubbleSelector="div.kix-spell-bubble",t.pageLessModeTableMaskInner="kix-domviewscroller-inner",t.pageLessModeTableMaskOuter="kix-domviewscroller-outer"}(C||(C={}));var A;!function(n){class r extends Error{constructor(t,e=1e3){super(`SafePromiseError: ${String(t)}`),this.stack=(super.stack||"").slice(e)}}function o(t){return t.catch((t=>t instanceof Error&&!t.stack?Promise.reject(new r(t.message)):Promise.reject(t)))}n.fromPromise=o,n.fromAsync=function(t){return(...e)=>o(t(...e))},n.noop=n.fromPromise(Promise.resolve()),n.create=function(t){return o(new Promise(t))},n.sync=function(t){return o(new Promise(((e,n)=>e(t()))))},n.createCompletionSource=e,n.delay=t}(A||(A={}));class M{constructor(t,e){this._transport=t,this._log=e,this._calls=new Map,this._sub=this._transport.inbound.subscribe({next:t=>{var e;const n=this._calls.get(t.id);if(n)try{"err"in t?n.reject(t.err):n.resolve(t.res)}finally{this._calls.delete(t.id)}else null===(e=this._log)||void 0===e||e.warn(`received rpc call response for unregistered call ${t.id}`)}}),this.api=new Proxy({},{get:(t,e)=>"then"===e?void 0:(...t)=>this._handleCall(e,t)})}_handleCall(t,e){let n=u.create();for(;this._calls.has(n);)n=u.create();const r=A.createCompletionSource();return this._calls.set(n,r),this._transport.outbound({id:n,method:t,args:e}),r.promise}dispose(){this._sub.unsubscribe()}}class P{constructor(t,e){this._transport=t,this._api=e,this._disposed=!1,this._sub=this._transport.inbound.subscribe({next:async t=>{try{const e=this._api[t.data.method];if("function"!=typeof e)throw{message:`invalid method name ${String(t.data.method)}`};{const n={clientId:t.clientId},r=await e.call(this._api,n,...t.data.args);this._transport.outbound({clientId:t.clientId,data:{id:t.data.id,res:r}})}}catch(e){this._transport.outbound({clientId:t.clientId,data:{id:t.data.id,err:e}})}}})}dispose(){this._disposed||(this._disposed=!0,this._sub.unsubscribe())}}function R(t){return function(t){return t&&"wrappedJSObject"in t}(t)?t.wrappedJSObject:t}function N(t,e){const n=s((()=>new DataTransfer),(()=>{})),r=new ClipboardEvent("paste",{clipboardData:n,bubbles:!0,cancelable:!0});return r.clipboardData?(void 0!==e.plain&&R(r.clipboardData).setData("text/plain",e.plain),void 0!==e.html&&R(r.clipboardData).setData("text/html",e.html),t.dispatchEvent(r)):null}function I(t){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:46,key:"Delete"}))}function O(t,e){const n=void 0===e.html?void 0:s((()=>new DataTransfer),(()=>{})),r=new InputEvent("beforeinput",{inputType:"insertReplacementText",data:e.plain,dataTransfer:n,cancelable:!0,bubbles:!0});r.dataTransfer&&(void 0!==e.plain&&R(r.dataTransfer).setData("text/plain",e.plain),void 0!==e.html&&R(r.dataTransfer).setData("text/html",e.html)),t.dispatchEvent(r)}function _(t){return"string"==typeof t}function D(t,e){const n=e.toUpperCase();return t.dispatchEvent(new KeyboardEvent("keypress",{altKey:!1,bubbles:!0,charCode:0,code:`Key${n}`,composed:!0,key:`${e.toLowerCase()}`,ctrlKey:!1,keyCode:e.charCodeAt(0),shiftKey:n===e,which:e.charCodeAt(0),isComposing:!1,repeat:!1,metaKey:!1}))}function j(t){const e=function(){if(!self.trustedTypes)return null;for(const t of Object.values(self))if(t instanceof self.TrustedTypePolicy&&"pastehandler"===t.name)return t;return null}();return e?e.createHTML(t):t}function L(t,e){switch(e.name){case"pasteEvent":N(t,e.pasteData),void 0!==e.pasteData.html&&(t.innerHTML=j(e.pasteData.html));break;case"typeText":void 0!==e.pasteData.plain&&function(t,e){let n=!0;for(let r=0;r<e.length;r++)n=D(t,e[r])&&n}(t.ownerDocument,e.pasteData.plain);break;case"insertReplacementTextBeforeInputEvent":O(t,e.pasteData);break;case"deleteKeypress":I(t);break;default:!function(t){throw new i(t)}(e.name)}}const F=10,B={status:"failed",textChanged:!1,failReason:"noFullText"},G={status:"failed",textChanged:!1,failReason:"fullTextMismatch"},K={status:"failed",textChanged:!1,failReason:"fullTextBeforeReplacementMismatch"},$={status:"failed",textChanged:!1,failReason:"fragmentReplacementMismatch"},z={status:"failed",textChanged:!1,failReason:"noInternals"},W={status:"failed",textChanged:!1,failReason:"internalSetSelectionFailed"},q={status:"failed",textChanged:!1,failReason:"noEventTarget"},V={status:"failed",textChanged:!1,failReason:"wrongRange"},H={status:"failed",textChanged:!0,failReason:"noFullTextAfter"},U={status:"failed",textChanged:!0,failReason:"resultTextMismatch"},J={status:"success",textChanged:!0,failReason:null},Y={...J,withIgnoreRanges:!0},X={status:"applied",textChanged:!0,failReason:null};class Q{constructor(t,e,n,r,o){this._canMakeTemporarySelection=!0,this._getSelectionWrapper=t,this._getFullTextInfo=e,this._getKeyboardEventTarget=n,this._getDocumentViewElement=r,this._getEditorViewElement=o}_resetSelectionNoScroll(){var t,e;const n=this._getDocumentViewElement();if(!n)return!1;const r=this._getEditorViewElement();if(!r)return!1;const o=null===(t=n.getClientRects())||void 0===t?void 0:t.item(0);if(!o||o.width<=0||o.height<=0)return!1;const a=null===(e=r.getClientRects())||void 0===e?void 0:e.item(0);if(!a||a.width<=0||a.height<=0)return!1;const i=Math.max(o.left,a.left),s=Math.min(o.right,a.right),c=Math.max(o.top,a.top),l=Math.min(o.bottom,a.bottom);if(i>s||c>l)return!1;const u=Math.floor((i+s)/2),f=Math.floor(c+l)/2;return function(t,e=E.create({left:0,top:0}),n=!1){const r={clientX:e.left,clientY:e.top,bubbles:!0,shiftKey:n};t.dispatchEvent(new MouseEvent("mousedown",r)),t.dispatchEvent(new MouseEvent("mouseup",r))}(n,E.create({left:u,top:f})),!0}_setSelectionSucceed(t,e,n,r){tt(t)&&(this._resetSelectionNoScroll()&&!tt(t)||Z(t,e));let o=t.setSelection(n,r);return!o&&this._canMakeTemporarySelection&&(function(t,e){if(function(t){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:39,key:"ArrowRight",code:"ArrowRight",shiftKey:!0}))}(e),t.getSelectionRanges().length>0)return!0;return function(t){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:37,key:"ArrowLeft",code:"ArrowLeft",shiftKey:!0}))}(e),t.getSelectionRanges().length>0}(t,e)&&(o=t.setSelection(n,r)),this._canMakeTemporarySelection=!1),o}replaceText(t,e,n,r){const o=this._getFullTextInfo();if(null===o)return B;const a=o.fullText,i=function({start:t,end:e},n,r,o){if(!_(o))return null;if(r.GDocsReplacementValidateOnlyFullTextBeforeReplacement){if(n.slice(0,e)!==o.slice(0,e))return K}else if(r.GDocsReplacementValidateOnlyFragmentText){const r=Math.max(0,t-F);if(n.slice(r,Math.min(n.length,e+F))!==o.slice(r,Math.min(o.length,e+F)))return $}else if(n!==o)return G;return null}(t,a,n,r);if(i)return i;const s=this._getSelectionWrapper();if(!s)return z;const c=this._getKeyboardEventTarget();if(!c)return q;const{start:l,end:u}=t;if(l>u||l<0||u>a.length)return V;if(!this._setSelectionSucceed(s,c,l,u))return W;if(L(c,e),n.GDocsReturnAppliedForAll)return X;const f=e.pasteData.plain||"",d=function({fullTextInfoAfter:t,fullTextBefore:e,newText:n,start:r,end:o,checkTextForSuggestionMode:a}){if(!t)return H;const i=t.fullText,s=e.slice(0,r)+n,c=s+e.slice(o);if(i===c)return J;const l=r+n.length,u=o+n.length,f=s+e.slice(r);if((!a||i===f)&&function(t,e,n){const{deleteSuggestionRanges:r}=t;if(r)for(const{start:t,end:o}of r)if(t<=e&&n<=o)return!0;return!1}(t,l,u))return Y;return U}({fullTextInfoAfter:this._getFullTextInfo(),fullTextBefore:a,newText:f,start:l,end:u,checkTextForSuggestionMode:n.GDocsCheckTextForSuggestionMode});return d!==B&&tt(s)&&function(t,e,n){return!((null==n?void 0:n.html)||!_(e))&&t.start!==t.end&&0!==e.length}(t,f,e.pasteData)&&Z(s,c),n.GDocsReturnAppliedForNonSuccess&&"success"!==d.status?X:d}}const Z=(t,e)=>{const n=t.getCurrentSelection();e.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:39,key:"ArrowRight",code:"ArrowRight"}));const r=t.getCurrentSelection();(n===r||t.equals({prevSelection:n,nextSelection:r}))&&function(t){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:37,key:"ArrowLeft",code:"ArrowLeft"}))}(e)},tt=t=>t.getSelectionRanges().length>0;var et,nt=n(51240);!function(t){t.CHROME_PROD="kbfnbcaeplbcioakkpcpgfkobkghlhen",t.CHROME_DEV="hnjmaaohmpmdoanfjacbknnehbdpjpmm",t.CHROME_QA="kioapjjehinomebhipemibkoghnfihaj",t.CHROME_NIGHTLY="aojbbefmgiilpnbipikljicoojkjbfle",t.CHROME_SHGO_NIGHTLY="cnkljppodomflaoljemgokomblgbgenf",t.CHROME_SHGO_PROD="fiicfmbdhpbnebmbofpphmalhgofdakc",t.EDGE_SHGO_PROD="pomkljejojcgechkiimaggeocndnliol",t.CHROME_EARTH="nlpbgkedmfjdliflklegppnapkojinhi",t.CHROME_MARS="ofklbkglijgokkagmgomakbafehgeacg",t.CHROME_VENUS="opbgoiocaoaggaladhoaldigpglopmej",t.FIREFOX="87677a2c52b84ad3a151a4a72f5bd3c4@jetpack"}(et||(et={}));const rt=(t=!1)=>{var e;const n=null===(e=document.currentScript)||void 0===e?void 0:e.getAttribute("data-ext-id");return n&&!t?n:et.CHROME_PROD};function ot(t,e){return t<e?-1:t>e?1:0}function at(t,e){const n=t.left<=e.left?t:e,r=n===t?e:t,o=t.top<=e.top?t:e,a=o===t?e:t;return n.left+n.width>r.left&&o.top+o.height>a.top}const it=(t,e)=>t.top===e.top?ot(t.left,e.left):ot(t.top,e.top);function st(t){let e=!0;const n=new Set;return{onRender(r,o){e?n.add([r,o]):t(r,o)},pause(){e=!0},resume(){e=!1,(()=>{const e=[...n.values()];n.clear();for(const[n,r]of e)t(n,r)})()}}}function ct(e,n,r=1){const o=new Set;let a=!1;return{onRender(i){if(i.pageFragment.partialRect)o.add(i),(async()=>{if(a)return;if(await t(0),a)return;if(!o.size)return;a=!0,n(),await t(r),a=!1;const i=[...o.values()];o.clear();for(const t of i)e.onRender(t,!0)})();else{let t=!1;if(a=!1,o.size){const e=i.pageFragment.pageAttrs.pageOffsetRect,n=[...o.values()];for(const r of n){at(r.pageFragment.pageAttrs.pageOffsetRect,e)&&(o.delete(r),t=!0)}}e.onRender(i,t)}},pause(){e.pause()},resume(){e.resume()}}}function lt(t,e){let n=0,r=t.length-1;for(;n<=r;){const o=n+r>>1,a=e(t[o]);if(a>0)n=o+1;else{if(!(a<0))return{kind:"found",index:o};r=o-1}}return{kind:"notFound",lastSearchRange:[Math.min(n,r),Math.max(n,r)]}}const ut="equation";function ft(t){return"text"===t.type}function dt(t){return"clip"===t.type}function*gt(t,e){var n,r,o,a;for(const i of t.fragments)yield i,pt(i)&&(null===(r=null===(n=null==e?void 0:e.containerPredicate)||void 0===n?void 0:n.call(e,i))||void 0===r||r)&&(null===(o=null==e?void 0:e.onEnter)||void 0===o||o.call(e,i),yield*gt(i,e),null===(a=null==e?void 0:e.onLeave)||void 0===a||a.call(e,i))}const pt=dt;var ht;!function(t){t[t.NOT_COMPARABLE=-2]="NOT_COMPARABLE",t[t.USE_FIRST=-1]="USE_FIRST",t[t.USE_SECOND=1]="USE_SECOND",t[t.EQUAL=0]="EQUAL"}(ht||(ht={}));const mt="text-foreground";function vt(t){if("moveTo"in t)return t.moveTo}function yt(t){if("lineTo"in t)return t.lineTo}const xt=t=>{if("bezierCurveTo"in t)return t.bezierCurveTo};function bt(t){if(!t.layoutNodes)return;const e=t.getLayoutNode();return null===e?null:e?t.layoutNodes.addNode(e):void 0}function wt(t,e){var n;if(e[0])return;if(!(null===(n=t.savableState.renderContainer)||void 0===n?void 0:n.fragments))return;const r=t.savableState.strokeStyle;if(!r)return;const o=function(t){if(2!==t.length)return null;const e=vt(t[0]);if(!e)return null;const n=yt(t[1]);return n?e.top!==n.top?null:{y:e.top,left:e.left,width:n.left-e.left}:null}(t.path);if(o){if(t.useStrikethroughFiltering){const e=t.getRenderingPhase();if(null!==e&&"text-decorations"!==e)return}if(function(t){return t.startsWith("rgba(")&&t.endsWith(",0.7)")}(r))t.savableState.renderContainer.fragments.push({type:"strikethrough",...o,unidentifiedUserColor:!St(r),nodeId:bt(t)});else if(t.trackUnderline)for(const{fragment:e,type:n}of function*(t,e){var n;if(!(null===(n=t.currentPageFragment)||void 0===n?void 0:n.fragments.length))return;const r=bt(t);for(const n of gt(t.currentPageFragment,{containerPredicate:t=>function(t,e){const n=t.top<=e.y&&e.y<=t.top+t.height,r=e.left+e.width,o=t.left+t.width,a=t.left<=e.left&&r<=o;return n&&a}(t.rect,e)})){if(!ft(n)||n.nodeId!==r)continue;const o=t.metricsMap.getMetrics(n.style,"M");if(!o)continue;const{top:a,bottom:i}=Tt(o,n),s=e.y;if(Et(n,a,i,e.left,e.left+e.width,s)){const t=s<n.baseline?"strikethrough":"underline";yield{fragment:n,type:t}}}}(t,o)){const o=e;"underline"===n?o.underlineColor=r:t.trackStrikeThrough&&"strikethrough"===n&&(o.strikeThroughColor=r)}}}function St(t){return"rgba(19,115,51,0.7)"===t}function Et(t,e,n,r,o,a){return function(t,e,n){const r=Math.max(1,t.scaleX),o=1*r,a=2*r;return b(e,t.left,o)&&t.left+a<n}(t,r,o)&&function(t,e,n){if(n<t)return!1;if(n>=e)return!1;return!0}(e,n,a)}function Tt(t,e){const n=-t.chunk.actualBoundingBoxAscent,r=t.chunk.actualBoundingBoxDescent,o=e.baseline+n*e.scaleY;return{top:o,bottom:o+(r-n)*e.scaleY}}function kt(t,e,n){const r=new DOMPoint(t,e).matrixTransform(n);return{left:r.x,top:r.y}}function Ct(t,e,n){return{width:n.a*t+n.c*e,height:n.b*t+n.d*e}}function At(t,e){return e.a*t}function Mt(t,e){return e.d*t}const Pt=["rgba(0,0,0,1)"];function Rt(t){const e=t.getRenderingPhase();if(null!==e&&e!==mt)return!1;const n=t.getLayoutNodeType();return"kix-reflow-footnote"===n||(null===n||"kix-column"===n)&&void 0}function Nt(){const t=new Map;return{recordRendering:function(e,n,r){var o;const a=null!==(o=null==r?void 0:r.getType())&&void 0!==o?o:null,i=`${e} ${null!=n?n:""} ${null!=a?a:""}`,s=t.get(i);s?s.count++:t.set(i,{method:e,renderingPhase:n,nodeType:a,count:1})},reset:function(){t.clear()},toJSON:function(){var e,n;const r={};for(const{method:o,renderingPhase:a,nodeType:i,count:s}of t.values()){const t=null!==(e=r[o])&&void 0!==e?e:r[o]={},c=null!=a?a:"<null>";(null!==(n=t[c])&&void 0!==n?n:t[c]={})[null!=i?i:"<null>"]=s}return r}}}function It(t){const e=new Set;let n={};const r={addNode(o){if(e.has(o))return t.getId(o);e.add(o);const a=o.getParent(),i=a?r.addNode(a):null,s=o.getType(),c=t.getId(o);return n[s]||(n[s]=[]),n[s].push([c,i]),c},reset(){e.clear(),n={}},exportToJson:()=>n};return r}new Set(["version","title","lang","translate","dir","dataset","hidden","tabIndex","accessKey","draggable","spellcheck","contentEditable","isContentEditable","offsetParent","offsetTop","offsetLeft","offsetWidth","offsetHeight","style","innerText","outerText","onabort","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextmenu","oncuechange","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onscroll","onseeked","onseeking","onselect","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","onvolumechange","onwaiting","onwheel","ongotpointercapture","onlostpointercapture","onpointerdown","onpointermove","onpointerup","onpointercancel","onpointerover","onpointerout","onpointerenter","onpointerleave","click","focus","blur","onauxclick","nonce","namespaceURI","prefix","localName","tagName","id","className","classList","slot","attributes","shadowRoot","assignedSlot","innerHTML","outerHTML","scrollTop","scrollLeft","scrollWidth","scrollHeight","clientTop","clientLeft","clientWidth","clientHeight","onbeforecopy","onbeforecut","onbeforepaste","oncopy","oncut","onpaste","onsearch","onselectstart","previousElementSibling","nextElementSibling","children","firstElementChild","lastElementChild","childElementCount","onwebkitfullscreenchange","onwebkitfullscreenerror","setPointerCapture","releasePointerCapture","hasPointerCapture","hasAttributes","getAttributeNames","getAttribute","getAttributeNS","setAttribute","setAttributeNS","removeAttribute","removeAttributeNS","hasAttribute","hasAttributeNS","getAttributeNode","getAttributeNodeNS","setAttributeNode","setAttributeNodeNS","removeAttributeNode","closest","matches","webkitMatchesSelector","attachShadow","getElementsByTagName","getElementsByTagNameNS","getElementsByClassName","insertAdjacentElement","insertAdjacentText","insertAdjacentHTML","requestPointerLock","getClientRects","getBoundingClientRect","scrollIntoView","scrollIntoViewIfNeeded","createShadowRoot","getDestinationInsertionPoints","animate","remove","querySelector","querySelectorAll","webkitRequestFullScreen","webkitRequestFullscreen","scroll","scrollTo","scrollBy","before","after","replaceWith","prepend","append","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","DOCUMENT_POSITION_DISCONNECTED","DOCUMENT_POSITION_PRECEDING","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_CONTAINS","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC","nodeType","nodeName","baseURI","isConnected","ownerDocument","parentNode","parentElement","childNodes","firstChild","lastChild","previousSibling","nextSibling","nodeValue","textContent","hasChildNodes","getRootNode","normalize","cloneNode","isEqualNode","isSameNode","compareDocumentPosition","contains","lookupPrefix","lookupNamespaceURI","isDefaultNamespace","insertBefore","appendChild","replaceChild","removeChild","addEventListener","removeEventListener","dispatchEvent"]);const Ot=[61439,61438,59651,26,30,59649,3,59653,59652,16,17],_t=[61439,61438,59651,26,30,59649,3,59653,59652,16,17,60417,60416,60419,60418],Dt=[Ot,_t],jt=[47,91,...Ot,93,47],Lt=[47,91,..._t,93,47],Ft=[jt,[...jt,103],Lt].map((t=>t.map((t=>String.fromCharCode(t))).join(""))),Bt=["rgba(118, 167, 250, 0.501960784313726)","rgba(118, 167, 250, 0.5)","rgba(143, 143, 143, 0.34)","rgba(0, 0, 0, 0.15)","rgba(79, 148, 252, 0.5)"].map((t=>t.replace(/\s+/g,""))),Gt={fontWeight:{bold:"700",normal:"400"},fontStyle:{italic:"italic",normal:"normal"}},Kt="GR_gdocs_connector",$t="GR_gdocs_connector_err";function zt(t,e){const n=e.getLayoutNodeType();if("rich-link-entity"===n||"page-count"===n)return!0;const r=(o=t).startsWith(Se)&&o.endsWith(Ee);var o;return null===n||r||"docstext-line-view"!==n&&"footnote"!==n&&"reflow-page-break"!==n&&"reflow-column-sector"!==n&&n!==ut&&"docstext-paragraph-view"!==n&&"reflow-column-break"!==n&&e.logError("proxy.isSpecialText",`Special text in node '${n}'`,{nodeType:n,renderingPhase:e.getRenderingPhase()}),!r}var Wt;function qt(){let t,e,n,r,o=Wt.INIT;const a=()=>{t=void 0,e=void 0,o=Wt.INIT,n=void 0,r=void 0};let i=0;return{hasEquations:()=>i>0,getEquationState:()=>({level:t,stage:o,seqIndex:n,fragmentStartIndex:r,equations:i}),onTranslate:(s,c,l,u,f)=>{if(c&&void 0!==r&&((r,a,i,s)=>r===t&&!(!e||e.x!==-i||e.y!==-s)&&n===a-1&&Wt.RESTORE===o)(s,l,u,f)){const t=c.fragments,e=r,n=t.length-e;if(n>0)return t.splice(e,n),a(),i++,!0}return t=s,e={x:u,y:f},r=null==c?void 0:c.fragments.length,o=Wt.TRANSLATE,n=l,!1},onBeforeSave:(e,r)=>{if(e===t){if(Wt.TRANSLATE!==o)return void a();if(void 0===n||r!==n+1)return void a();n=r,o=Wt.SAVE}},onAfterRestore:(e,r)=>{if(e===t){if(Wt.SAVE!==o)return void a();n=r,o=Wt.RESTORE}},onClip:()=>{a()},reset:()=>{i=0,a()}}}!function(t){t[t.INIT=-1]="INIT",t[t.TRANSLATE=0]="TRANSLATE",t[t.SAVE=1]="SAVE",t[t.RESTORE=2]="RESTORE"}(Wt||(Wt={}));const Vt={logError(){},logException(){}};function Ht(t,e,n){let r=0;return{call(o,a,i,s){var c;const l=s(i),u=null===(c=e.postFn)||void 0===c?void 0:c[a];if(u)try{u(o,t,i,l,r++)}catch(t){n.logException(`proxy.call.${String(a)}`,t)}return l},set(o,a,i,s){var c;r++;const l=null===(c=e.overrideSet)||void 0===c?void 0:c[a];if(l)try{const e=l(o,t,i);if(void 0!==e)return s(e)}catch(t){n.logException(`proxy.set.${String(a)}`,t)}return s(i)}}}function Ut(t=new Map){return{get size(){return t.size},getMetrics(e,n){var r;return null===(r=t.get(e))||void 0===r?void 0:r.get(n)},getFontMetrics(e){const n=function(e){let n=t.get(e);return n||(n=new Map,t.set(e,n)),n}(e);return{fontStyle:e,get size(){return n.size},getMetrics:t=>n.get(t),addMetrics(t,e){n.set(t,e)}}},toJSON:()=>Object.fromEntries(Jt(t,(t=>{var e,n,r,o;return{height:[null!==(n=null===(e=t.get(Qt))||void 0===e?void 0:e.chunk.actualBoundingBoxAscent)&&void 0!==n?n:0,null!==(o=null===(r=t.get(Qt))||void 0===r?void 0:r.chunk.actualBoundingBoxDescent)&&void 0!==o?o:0],widths:Object.fromEntries(Jt(t,(({chunk:t})=>t.width)))}})))}}function Jt(t,e=(t=>t)){return[...t.entries()].sort((([t],[e])=>ot(t,e))).map((([t,n])=>[t,e(n)]))}function Yt(t,e,n){let r;function o(o,a){const i=(void 0===r&&(r=null!==(s=e())&&void 0!==s?s:null,r||n.logError("createMeasuringFallbackMetricsMap","Can't create self-measuring canvas")),r);var s;if(!i)return;n.log("createMeasuringFallbackMetricsMap","No metrics for text"),i.font=o,i.measureText(a);const c=t.getMetrics(o,a);return c||n.logError("createMeasuringFallbackMetricsMap","Self-measuring failed for text"),c}return{get size(){return t.size},getMetrics(e,n){var r;return null!==(r=t.getMetrics(e,n))&&void 0!==r?r:o(e,n)},getFontMetrics(e){const n=t.getFontMetrics(e);return{fontStyle:e,get size(){return n.size},getMetrics(t){var r;return null!==(r=n.getMetrics(t))&&void 0!==r?r:o(e,t)}}},toJSON:()=>t.toJSON()}}function Xt(t){return{metricsMap:Ut(t)}}const Qt="M",Zt=" ";const te={overrideSet:{font:(t,e,n)=>(e.fontStyle=ee(n),n)},postFn:{measureText(t,e,[n],r){if(!e.fontStyle)return;const o=e.metricsMap.getFontMetrics(e.fontStyle);if(!o.size){const e=t.measureText(Qt),n=t.measureText("À"),r=t.measureText("g");o.addMetrics(Qt,{chunk:ne(e,n,r),charShifts:[]});const a=t.measureText(Zt);o.addMetrics(Zt,{chunk:ne(a),charShifts:[]})}const a=8237===n.charCodeAt(0),i=8236===n.charCodeAt(n.length-1),s=n.substring(a?1:0,n.length-(i?1:0));if(s===Qt)return;const c=[];for(let e=1;e<s.length;e++){const n=s.slice(0,e),a=o.getMetrics(n);if(a)c.push(a.chunk);else{if(s.length-e>30){let t=c.length>0?c[c.length-1].width:0,n=r.width-t;for(;e<s.length;){const o=n/(s.length-e+1);t+=o,n-=o,c.push({...r,width:t}),e++}break}const a=ne(t.measureText(n));o.addMetrics(n,{chunk:a,charShifts:[...c]}),c.push(a)}}o.addMetrics(s,{chunk:r,charShifts:c})}}};function ee(t){const e=/^(?:([\d\w]+) )?(?:(\w+) )?([\d.]+)px (?:['"])?([\w -]+)(?:['"])?$/.exec(t);if(e){const[t,n,r,o,a]=e,{fontWeight:i,fontStyle:s}=Gt;let c=i.normal,l=s.normal;return n&&(isNaN(parseInt(n,10))?n===s.italic?(l=s.italic,c=isNaN(parseInt(r,10))?"bold"===r?i.bold:i.normal:r):c="bold"===n?i.bold:i.normal:(c=n,l=r||l)),`${c} ${l} ${parseFloat(o).toFixed(4)}px "${a}"`}return t}function ne(t,e=t,n=e){return{width:t.width,actualBoundingBoxLeft:t.actualBoundingBoxLeft,actualBoundingBoxRight:t.actualBoundingBoxRight,actualBoundingBoxAscent:e.actualBoundingBoxAscent,actualBoundingBoxDescent:n.actualBoundingBoxDescent}}var re,oe;function ae(t){return t.type===re.text}function ie(t,e,n,r,o=!1){const a=(t,e,n,r=!1)=>{t.beginPath(),t.strokeStyle=`rgba(0,0,255,${r?.05:.2})`,t.lineWidth=2,t.moveTo(e,n),t.lineTo(e,n-20),t.stroke()};t.save(),t.resetTransform(),a(t,e,n,o),r.forEach((r=>a(t,e+r,n,o))),t.restore()}!function(t){t.text="text",t.space="space",t.lineBreak="lineBreak",t.footnoteLink="footnoteLink",t.mention="mention"}(re||(re={})),function(t){t.ordinary="ordinary",t.special="special"}(oe||(oe={}));const se=(t,e,n,r,o,a=0,i=!1)=>{t.save(),t.resetTransform(),t.fillStyle=`rgba(221,0,0,${i?.05:.1})`,t.fillRect(e,n,r,10),t.fillStyle=`rgba(221,0,0,${i?.4:.8})`,t.font="10px Arial",t.fillText(`${a}`,e,n+10),t.fillStyle=`rgba(0,128,221,${i?.4:.8})`,ie(t,e,n,o,i),t.restore()},ce=(t,e,n,r,o,a=!1)=>{t.save(),t.resetTransform(),t.fillStyle=`rgba(0,221,0,${a?.05:.1})`,t.fillRect(e,n+10,r,10),t.restore(),ie(t,e,n,o,a)},le=(t,e,n,r=!1)=>{t.save(),t.resetTransform(),t.beginPath(),t.strokeStyle=`rgba(0,221,0,${r?.05:.1})`,t.lineWidth=5,t.moveTo(e+2.5,n),t.lineTo(e+2.5,n+10),t.lineTo(e-10,n+10),t.stroke(),t.restore()},ue=.1;function fe(t,e){return t.left!==e.left||t.width!==e.width?0:0===t.top&&t.height<.6666666666666666*e.height?1:t.top>e.top&&t.top>.6666666666666666*e.height?2:0}function de(t,e){if(!t.currentPageMap)return null;const n=t.currentPageMap.sections,r=t.footnote.footnoteLineDetected&&e>t.footnote.footnoteLinePosition.top?t.currentPageMap.sections.footnotes:t.currentPageMap.sections.main;if(t.compact)return r;switch(function(t){if(t.compact)return 0;const{clips:e}=t.savableState;if(1===e.length)return t.currentPageMap?fe(e[0],{...t.currentPageMap.pageAttrs.canvasBitmapSize,left:0,top:0}):0;if(2===e.length){const[t,n]=e;return fe(n,t)}return 0}(t)){case 1:return n.header;case 2:return n.footer;default:return r}}function ge(t,e,n,r,o,a,i,s){const c=/^\d+$/.test(Ce(t)),l=!s&&!c,u=xe(n,e,o,a);if(l)return!0;if(c){const s=Ce(t);if(i&&u&&ae(i)){let t=i,c=r.fragments.length-1;for(let e=r.fragments.length-1;e>0;e--){const o=r.fragments[e];if(o.type===re.lineBreak)break;if(!(o.left>n.left)){t=o,c=e;break}}const l=Math.abs(.6*t.height-u.height)<ue*u.height,f=Math.abs(t.top-u.top)<u.height*ue;if(l&&f){const i=be(s,e,n,u,a,o);if(i){const e={...i,height:t.height,baseline:t.baseline,type:re.footnoteLink,class:oe.ordinary,linkText:s,text:"#"};if(function(t){return t.type===re.space}(t)&&x(t.left,n.left,.001))return b(t.width,i.width,.001)?r.fragments.splice(c,1,e):r.fragments.splice(c,1,e,{...t,left:t.left+i.width,width:t.width-i.width}),!0;if(Math.abs(i.left-t.left-t.width)<.5*u.spaceMetrics.chunk.width)return r.fragments.splice(c+1,0,e),!0}}}}else if(s&&i&&u&&ae(i)){const s=Math.abs(.6*i.height-u.height)<ue*u.height,c=Math.abs(i.top-u.top)<u.height*ue;if(s&&c){const s=be(Ce(t),e,n,u,a,o);if(s){if(Math.abs(s.left-i.left-i.width)<.5*u.spaceMetrics.chunk.width)return r.fragments.push({...s,height:i.height,baseline:i.baseline,type:re.text,class:oe.ordinary}),!0}}}return!1}function pe(t,e,n,r,o,a,i){e.fragments.push(t),i&&(o.match(/^\s+$/)?ce(n,r.left,r.top,t.width,t.charShifts):se(n,r.left,r.top,a.width,a.charShifts," "===o?void 0:e.wordCount++))}function he(t,e,n,r,o){const a=t&&((i=t).type===re.text||i.type===re.footnoteLink)?t:null;var i,s;if(a){const t={top:a.baseline,left:a.left},i=e.left-t.left-a.width,c=n.lastTextClipsId!==n.savableState.clipsId||e.top-t.top>.2*a.height;!c&&i>we&&(r.fragments.push({type:re.space,class:oe.ordinary,baseline:e.top,left:t.left+a.width,top:a.top,width:i,height:a.height}),n.debugVizualize&&ce(o,t.left+a.width,e.top,i,[])),c&&(r.fragments.push((s={baseline:a.baseline,left:a.left+a.width,top:a.top,height:a.height,width:n.lastTextWhitespaceWidth},{...s,type:re.lineBreak,class:oe.ordinary})),n.debugVizualize&&le(o,a.left+a.width,a.top))}}const me=["#ffffff","rgba(255,255,255,1)"],ve=["#f1f3f4","rgba(241,243,244,1)"];function ye(t){const e=t.getCurrentPageAttrs();if(t.matchingBroken=!1,t.footnote={footnoteLineDetected:!1},t.compact=e.isCompactLayout,t.clearedRect&&function(t,e){const{left:n,top:r,width:o,height:a}=e,i=t;return!(n<=0&&r<=0&&n+o>=i.width&&r+a>=i.height)}(e.canvasBitmapSize,t.clearedRect)){t.currentPageMap=null;const n={rect:null,fragments:[],wordCount:0};t.currentPartialMap={pageAttrs:e,rect:t.clearedRect,sections:{main:n}},t.savableState.renderContainer=t.currentPageFragment={type:"page",pageAttrs:e,partialRect:t.clearedRect,fragments:[],nodeId:bt(t)}}else t.currentPartialMap=null,t.currentPageMap=(n=e,{pageAttrs:{...n},sections:{main:{rect:null,fragments:[],wordCount:0},header:{rect:null,fragments:[],wordCount:0},footer:{rect:null,fragments:[],wordCount:0},footnotes:{rect:null,fragments:[],wordCount:0}}}),t.savableState.renderContainer=t.currentPageFragment={type:"page",pageAttrs:e,fragments:[],nodeId:bt(t)};var n}function xe(t,e,n,r){const o=n.metricsMap.getMetrics(e,Qt),a=n.metricsMap.getMetrics(e,Zt);if(!o||!a)return null;return{spaceMetrics:a,top:t.top-Mt(o.chunk.actualBoundingBoxAscent,r),height:Mt(o.chunk.actualBoundingBoxAscent+o.chunk.actualBoundingBoxDescent,r)}}function be(t,e,n,{top:r,height:o},a,i){const s=i.metricsMap.getMetrics(e,t);if(!s)return null;const c=At(s.chunk.width,a);return{baseline:n.top,top:r,left:n.left,text:t,width:c,height:o,charShifts:s.charShifts.map((t=>At(t.width,a)))}}const we=1,Se="‭",Ee="‬",Te=[String.fromCharCode(8204),Se,Ee],ke=new RegExp(`[${Te.join("")}]`,"g");function Ce(t){return t.replace(ke,"")}function Ae(t,e,n,r,o,a){var i,s;const c=o.getTransform(),l=kt(e,n,c),u=ee(null!==(i=r.savableState.font)&&void 0!==i?i:o.font),f=Ce(t),d=zt(t,r);if(g=r.savableState.font,p=r.savableState.strokeStyle,h=o.fillStyle,'400 14px "Google Sans"'===g&&"rgba(240,244,249,1)"===p&&"string"==typeof h&&["#1f1f1f","rgba(31,31,31,1)"].includes(h))return;var g,p,h;if(r.savableState.renderContainer&&f&&r.savableState.renderContainer.fragments.push({type:"text",style:u,color:"string"==typeof o.fillStyle?o.fillStyle:void 0,text:f,special:d,baseline:l.top,left:l.left,scaleX:c.a,scaleY:c.d,nodeId:bt(r)}),r.cleanupPageMapCanvas2dContext)return;if(null==a)return;const m=function(t){return t.fragments.length>0?t.fragments[t.fragments.length-1]:null}(a);if(ge(t,u,l,a,r,c,m,!d))return;he(m,l,r,a,o),r.lastTextClipsId=r.savableState.clipsId;const v=xe(l,u,r,c);if(!v)return;r.lastTextWhitespaceWidth=v.spaceMetrics.chunk.width;const y=null!==(s=f.match(/[^\s]+|\s+/g))&&void 0!==s?s:[];for(const t of y){const e=be(t,u,l,v,c,r);if(null==e)continue;const n={type:re.text,class:oe.ordinary,...e};pe(n,a,o,l,t,e,r.debugVizualize),l.left+=n.width}}const Me={postFn:{fillText(t,e,[n,r,o,a]){e.layoutRenderingStats.recordRendering("fillText",e.getRenderingPhase(),e.getLayoutNode());const i=e.getRenderingPhase();if(null!==i&&i!==mt)return;if(e.getLayoutNodeType()!==ut){try{const t=e.getLayoutNode();if(t&&function(t){for(let e=t;e;e=e.getParent())if("kix-code-snippet-block-view"===e.getType())return!0;return!1}(t))return}catch(t){e.logException("proxy.fillText.codeBlockFiltering",t,"Code block filtering error")}if(e.cleanupPageMapCanvas2dContext)Ae(n,r,o,e,t);else{const a=function(t,e){return t.currentPartialMap?t.currentPartialMap.sections.main:de(t,e)}(e,o);if(!a)return void function(t,e){!t.currentPageMap&&!t.currentPartialMap&&t.log(e,"Current page map expected")}(e,"proxy.fillText");const i=a.fragments.length>0;Ae(n,r,o,e,t,a),function(t,e,n){!t&&e.fragments.length>0&&(e.rect=Oe(n))}(!!i,a,e)}}},drawImage(t,e,n){e.layoutRenderingStats.recordRendering("drawImage",e.getRenderingPhase(),e.getLayoutNode());const r=e.savableState.renderContainer;if(r){const[e,o,a,i,s,c,l,u,f]=n,d=t.getTransform(),g=kt(null!=c?c:o,null!=l?l:a,d),p=null!=u?u:i,h=null!=f?f:s,m=void 0===p||void 0===h?void 0:{width:p,height:h},v=void 0===m?{...g,width:void 0,height:void 0}:{...g,...Ct(m.width,m.height,d)};r.fragments.push({type:"image",rect:v})}},fillRect(t,e,[n,r,o,a]){if(e.layoutRenderingStats.recordRendering("fillRect",e.getRenderingPhase(),e.getLayoutNode()),function(t,e){const n=e.getRenderingPhase();if(null!==n&&"selection"!==n)return!1;const{fillStyle:r}=t;return"string"==typeof r&&Bt.includes(r.replace(/\s+/g,""))}(t,e)){const i=t.getTransform(),s={...kt(n,r,i),...Ct(o,a,i)},c=Oe(e);if(!c||at(s,c)){const t=function(t,e,n){const r=lt(t,(t=>{const r=n(e,t);return 0===r?-1:r}));return"found"===r.kind?r.index:r.lastSearchRange[0]<0?null:r.lastSearchRange[0]}(e.currentSelection,s,it);null===t?e.currentSelection.unshift(s):e.currentSelection.splice(t+1,0,s)}}1===e.saveCount&&null===e.currentPageFragment&&"string"==typeof t.fillStyle&&me.includes(t.fillStyle)&&!e.savableState.clips.length&&_e(e,t,[n,r,o,a])},clearRect(t,e,n){e.savableState.clips.length||_e(e,t,n)},scale(t,e){1===e.saveCount&&null===e.currentPageFragment&&null!==e.clearedRect&&ye(e)},translate(t,e,[n,r],o,a){e.equations.onTranslate(e.saveCount,e.savableState.renderContainer,a,n,r)},save(t,e,n,r,o){e.equations.onBeforeSave(e.saveCount,o),e.saveCount++,e.savedState.push({...e.savableState})},restore(t,e,n,r,o){const a=e.savedState.pop();if(a&&(e.savableState=a),e.saveCount--,0===e.saveCount){if(e.currentPageMap&&e.currentPageFragment){const t=e.currentPageMap.pageAttrs;!function(t,e){if(e.cleanupPageMapCanvas2dContext)return;const n=e.currentPageMap.sections,r=n.footer.rect?Math.min(t.canvasBitmapSize.height,n.footer.rect.top):t.canvasBitmapSize.height,o=e.footnote.footnoteLineDetected?e.footnote.footnoteLinePosition.top:r;n.footnotes.rect={top:o,left:0,width:t.canvasBitmapSize.width,height:r-o};const a=n.header.rect?Math.max(0,n.header.rect.top+n.header.rect.height):0;n.main.rect={top:a,left:0,width:t.canvasBitmapSize.width,height:o-a}}(t,e),e.onRender({pageMap:(i=e.currentPageMap,{pageAttrs:i.pageAttrs}),pageAttrs:t,selection:e.currentSelection,hasEquations:e.equations.hasEquations(),pageFragment:e.currentPageFragment,layoutRenderingStats:e.layoutRenderingStats.toJSON(),layoutNodes:e.layoutNodes?e.layoutNodes.exportToJson():null}),e.currentPageFragment=null,e.currentPageMap=null,e.currentSelection=[],e.clearedRect=null}else e.currentPartialMap&&e.currentPageFragment&&(e.onRender({partialPageMap:Ie(e.currentPartialMap,e.cleanupPageMapCanvas2dContext),pageAttrs:e.currentPartialMap.pageAttrs,selection:e.currentSelection,hasEquations:e.equations.hasEquations(),pageFragment:e.currentPageFragment,layoutRenderingStats:e.layoutRenderingStats.toJSON(),layoutNodes:e.layoutNodes?e.layoutNodes.exportToJson():null}),e.currentPageFragment=null,e.currentPartialMap=null,e.clearedRect=null);e.layoutRenderingStats.reset(),e.equations.reset()}var i;e.equations.onAfterRestore(e.saveCount,o)},moveTo(t,e,[n,r]){!function(t,e,n){t.footnote.footnoteLineDetected||!1!==Rt(t)&&(t.footnote.lastPosition={left:e,top:n})}(e,n,r),e.path.push({moveTo:Re(t,[n,r])})},lineTo(t,e,[n,r]){!function(t,e,n,r){var o;if(t.footnote.footnoteLineDetected)return;const a=Rt(t);if(!1===a)return;const i=t.footnote.lastPosition;if(i){const s=e-i.left;if((a||n>0&&Math.abs(i.top-n)<we&&192===s&&(null===(o=null==t?void 0:t.savableState)||void 0===o?void 0:o.strokeStyle)&&Pt.includes(t.savableState.strokeStyle))&&(t.footnote={footnoteLineDetected:!0,footnoteLinePosition:i},t.savableState.renderContainer)){const o=kt(e,n,r.getTransform());t.savableState.renderContainer.fragments.push({type:"footnote_line",nodeId:bt(t),y:o.top})}}t.footnote.footnoteLineDetected||(t.footnote.lastPosition={left:e,top:n})}(e,n,r,t),e.path.push({lineTo:Re(t,[n,r])})},beginPath(t,e){e.path=[]},clip(t,e,n){if(e.layoutRenderingStats.recordRendering("clip",e.getRenderingPhase(),e.getLayoutNode()),e.equations.onClip(),n[0])e.logError("proxy.clip:unexpectedArguments","clip with parameters is not supported");else if(1!==e.path.length)e.logError("proxy.clip:unsupportedPath","clip with multiple paths is not supported",{pathSize:e.path.length});else if("rect"in e.path[0]){if(e.savableState.clips=[...e.savableState.clips,e.path[0].rect],e.savableState.renderContainer){const t={type:"clip",rect:e.path[0].rect,fragments:[],nodeId:bt(e)};e.savableState.renderContainer.fragments.push(t),e.savableState.renderContainer=t}}else e.logError("proxy.clip:unsupportedPath","clip only supports rect paths");e.savableState.clipsId=++e.lastClipsId},rect(t,e,n){e.path.push({rect:Pe(t,n)})},stroke(t,e,n){e.layoutRenderingStats.recordRendering("stroke",e.getRenderingPhase(),e.getLayoutNode()),wt(e,n)},bezierCurveTo(t,e,[n,r,o,a,i,s]){e.path.push({bezierCurveTo:Re(t,[i,s])})},fill(t,e){if(e.layoutRenderingStats.recordRendering("fill",e.getRenderingPhase(),e.getLayoutNode()),"string"==typeof(n=t.fillStyle)&&ve.includes(n)&&e.savableState.renderContainer){const t=function(t){if(9!==t.length)return;let e=1/0,n=1/0,r=-1/0,o=-1/0;for(let a=0;a<t.length;a++){let i;if(i=0===a?vt(t[0]):a%2==1?yt(t[a]):xt(t[a]),!i)return;e=Math.min(i.left,e),n=Math.min(i.top,n),o=Math.max(i.left,o),r=Math.max(i.top,r)}return{left:e,top:n,width:o-e,height:r-n}}(e.path);if(t){const n={type:"code_block",rect:t,nodeId:bt(e)};e.savableState.renderContainer.fragments.push(n)}}var n}},overrideSet:{strokeStyle(t,e,n){let r;return"string"==typeof n?("rgba(221,0,0,1)"!==n&&"rgba(66,133,244,1)"!==n||(r="rgba(0,0,0,0)"),e.savableState.strokeStyle=null!=r?r:n):e.savableState.strokeStyle=void 0,r},fillStyle:(t,e,n)=>"rgba(252,232,230,1)"===n||"rgba(232,240,254,1)"===n?"rgba(0,0,0,0)":void 0,font(t,e,n){e.savableState.font=n}}};function Pe(t,[e,n,r,o]){const a=t.getTransform();return{...kt(e,n,a),...Ct(r,o,a)}}function Re(t,[e,n]){return kt(e,n,t.getTransform())}function Ne(t){const{wordCount:e,...n}=t;return n}function Ie(t,e){const n={pageAttrs:t.pageAttrs,rect:t.rect};return e?n:{...n,sections:{main:Ne(t.sections.main)}}}function Oe(t){return t.savableState.clips.reduce(((t,e)=>t?function(t,e){const n=Math.max(t.left,e.left),r=Math.max(t.top,e.top),o=Math.min(t.left+t.width,e.left+e.width),a=Math.min(t.top+t.height,e.top+e.height);return{left:n,top:r,width:n>o?0:o-n,height:r>a?0:a-r}}(t,e):e),null)}function _e(t,e,[n,r,o,a]){const i=Pe(e,[n,r,o,a]);t.clearedRect=i,t.currentSelection=t.currentSelection.filter((t=>!at(t,i)))}function De(t,e){var n,r,o,a;try{const c=CanvasRenderingContext2D.prototype,l={postFn:[...Object.keys(null!==(n=Me.postFn)&&void 0!==n?n:{}),...Object.keys(null!==(r=te.postFn)&&void 0!==r?r:{})],overrideSet:[...Object.keys(null!==(o=Me.overrideSet)&&void 0!==o?o:{}),...Object.keys(null!==(a=te.overrideSet)&&void 0!==a?a:{})]};function i(e,n,r,o,a,s){for(let c=s;c<e.length;c++){const s=e[c].call;if(s)try{return s(n,r,o,(()=>i(e,n,r,o,a,c+1)))}catch(e){t.api.logError(`canvas.middleware.call.${r}`,"Middleware call failed, proceeding with subsequent middlewares",e)}}return a.apply(n,o)}function s(e,n,r,o,a,i){var c;for(let c=i;c<e.length;c++){const i=e[c].set;if(i)try{return i(n,r,o,(t=>s(e,n,r,t,a,c+1)))}catch(e){t.api.logError(`canvas.middleware.set.${r}`,"Middleware set failed, proceeding with subsequent middlewares",e)}}return null===(c=null==a?void 0:a.set)||void 0===c||c.call(n,o),!0}if(l.postFn.length>0){const u=Object.fromEntries(l.postFn.map((t=>[t,c[t]])));Object.entries(u).forEach((([t,n])=>{Object.defineProperty(c,t,{value:function(...r){const o=e.get(this);return o&&(null==o?void 0:o.length)>0?i(o,this,t,r,n,0):n.apply(this,r)}})}))}if(l.overrideSet.length>0){const f=l.overrideSet,d=Object.fromEntries(f.map((t=>[t,Object.getOwnPropertyDescriptor(c,t)])));f.forEach((t=>{const n=d[t];Object.defineProperty(c,t,{get:function(){var t;return null===(t=null==n?void 0:n.get)||void 0===t?void 0:t.call(this)},set:function(r){var o;const a=e.get(this);a&&(null==a?void 0:a.length)>0?s(a,this,t,r,n,0):null===(o=null==n?void 0:n.set)||void 0===o||o.call(this,r)}})}))}return!0}catch(g){return t.api.logError("init.patchCanvasPrototype","Failed to patch canvas prototype:",g),!1}}function je(t){const{unpatchedCanvases:e,client:n,middlewareFactories:r,textMeasuringState:o,addToPatchedCanvases:a,canvasContextMiddlewares:i}=t;return e.forEach((t=>{const e=t.getContext("2d");if(!e)return;const n=r.map((n=>n(t,e))).filter((t=>Boolean(t)));self.GR_GDOCSCANVAS_DEVTOOLS;if(function(t){return!t.className}(t)){const{middleware:t}=function({state:t=Xt(),options:e}){return{state:t,middleware:Ht(t,te,e)}}({state:o,options:Vt});n.push(t)}i.set(e,n);a({canvas:t,originalContext:e,proxy:{proxy:e,addMiddleware:c}})})),De(n,i),{allPatched:!0,latePatchedCount:e.length}}class Le extends Error{constructor(t){super(`Assertion failed: ${t?"string"==typeof t?t:t():"(unnamed)"}`)}}function Fe(t,e){if(!t)throw new Le(e)}function Be(t,e){if(null==t)throw new Le((()=>e?`Expected ${e} to be non-null`:"Expected non-null"));return t}function Ge(t){const e=Date.now();return setTimeout((()=>{t({didTimeout:!1,timeRemaining:()=>Math.max(0,50-Date.now()+e)})}),1)}const Ke="undefined"==typeof self||"function"!=typeof self.requestIdleCallback?Ge:(t,e)=>{try{return self.requestIdleCallback(t,e)}catch(e){return Ge(t)}};function $e(t,e,n){if(!(e in t))return!1;const r=t[e];return"function"==typeof r&&r.length===n}const ze="extracting index lookup map keys";function We(t,e){if(!function(t){if("object"!=typeof t||!t)return!1;if(![{name:"clear",length:0},{name:"get",length:1},{name:"size",length:0},{name:"map",length:1}].every((({name:e,length:n})=>$e(t,e,n))))return!1;try{return qe(t),!0}catch(t){return!1}}(t))return!1;for(const n of Object.values(t))if(Array.isArray(n)&&0!=n.length&&n.every((t=>void 0===t||e(t))))return!0;return!1}function qe(t){const e=t,n=Object.keys(t).filter((t=>Array.isArray(e[t])));if(2!==n.length)throw new Error(`find more ${n.length} array keys`);const r=e[n[0]],o=e[n[1]];if(!1!==Ve(r,o)){if(!1!==Ve(o,r))return;return{indexKey:n[0],dataKey:n[1]}}if(!1!==Ve(o,r))return{indexKey:n[1],dataKey:n[0]};throw new Error("we can not find the relationship between two arrays")}function Ve(t,e){if(0!==t.length||0!==e.length){if(t.length>0&&e.length>0&&t.every((t=>"number"==typeof t&&void 0!==e[t]))){return function(t,e=3){const n=[];let r=0;for(const o of t){for(;r<o;){if(n.push(r),n.length===e)return n;r++}r=o+1}for(;n.length<e;)n.push(r++);return n}(t).every((t=>void 0===e[t]))}return!1}}function He(t){return!("object"!=typeof t||!t)&&("number"==typeof t.start&&"number"==typeof t.end)}function Ue(t){return Array.isArray(t)&&t.length>0&&void 0!==t[0]&&t.every(He)}function Je(t,e){return{get:()=>e.reduce(((t,e)=>null==t?void 0:t[e]),t.get()),parent(){if(0!==e.length)return Je(t,e.slice(0,-1))},getPath:()=>[t,e]}}function Ye(t){return{get(e){let n=e;for(const e of t){if(null==n)return;n=n[e]}return null!=n?n:void 0},getPath:()=>t}}function Xe(t){let e;function n(e){return t(ze),function(t){const e=qe(t);if(e)return{indexes:Ye([e.indexKey]),data:Ye([e.dataKey])}}(e)}return{getIndexes:t=>(void 0===e&&(e=n(t)),e&&e.indexes.get(t)||[]),getData:t=>(void 0===e&&(e=n(t)),e&&e.data.get(t)||[])}}function*Qe(t,e){const n=e.getIndexes(t),r=e.getData(t);for(const t of n){const e=r[t];void 0!==e&&(yield[t,e])}}function Ze(t,e,n){const r=t.get();if(!r)return[void 0,void 0,void 0];const o=tn(r,e,n);if(!o.results.length)return[void 0,void 0,void 0];const a=o.results.map((e=>Je(t,e.path)));return[a[0],o.results[0].value,a]}function tn(t,e,n,r=Object.getOwnPropertyNames(t),o=0,a){var i;const s=new Set,c=[];let l=0;const u=performance.now();let f,d;const g=(t,e,n,r)=>{if(null==t)return;if(s.has(t))return;if(s.add(t),a&&!a(t,e))return;const o={next:void 0,value:t,key:e,parent:n,depth:r};d?d.next=o:f=o,d=o},p=()=>{const t=f;return t&&(f=t.next,f||(d=void 0)),t},h=t=>{const e=[];let n=t;for(;n;)e.push(n.key),n=n.parent;return e.reverse()};for(const e of r)"prototype"!==e&&g(t[e],e,void 0,0);for(;f;){const t=p();if(!t)break;l++;const{key:r,value:a,depth:s}=t;if(!(a instanceof Window)&&!(a instanceof Node)){try{const t=null===(i=null==a?void 0:a.constructor)||void 0===i?void 0:i.name;if("Window"===t||"HTMLDocument"===t)continue}catch(t){}if(!(s>n)){try{if(e(r,a)){const e=h(t);c.push({path:e,value:a,depth:s,iterations:l,performance:performance.now()-u});continue}}catch(t){}if(null!=a)if(Array.isArray(a))for(let e=0;e<a.length&&e<o;e++)try{g(a[e],`${e}`,t,s+1)}catch(t){}else if("function"==typeof a);else if(a instanceof Object)if(a instanceof Node);else for(const e of Object.getOwnPropertyNames(a))if("prototype"!==e)try{g(a[e],e,t,s+1)}catch(t){}}}}return{results:c,iterations:l,performance:performance.now()-u}}function en(t,e,n){const r=Object.entries(t).filter((([t,e])=>function(t,e){if(!e||"object"!=typeof e)return!1;return[{name:"splice",length:3},{name:"shift",length:3},{name:"mark",length:4},{name:"constructor",length:1}].every((({name:t,length:n})=>$e(e,t,n)))}(0,e))).map((([t,e])=>({value:e,path:[t]}))),o=[];for(const{value:t,path:a}of r){const r=tn(t,e,1).results;if(1===r.length)o.push({value:r[0].value,path:a.concat(r[0].path)});else if(r.length>1){const e=Sn(t);n(gn.wrongLookupMapContainer,{signature:e,name:"lookupMapContainer",paths:r.map((t=>t.path.join(".")))})}}return o}function nn(t,e,n){return en(t,(function(t,n){return function(t,e){let n=!1;return We(t,(t=>{if(!Array.isArray(t))return!1;for(const r of t){if(!rn(r))return!1;r===e&&(n=!0)}return!0}))&&n}(n,e)}),n)}function rn(t){return"string"==typeof t&&t.startsWith("suggest.")}function on(t){return Array.isArray(t)&&t.every(rn)}function an(t,e){return We(e,on)}const sn="start to extract annotationSets",cn="openEndRangesMapPath extracted",ln="extracting IndexLookupMapPaths",un="extracting DeletionSuggestionIndexLookupMapPath",fn="extract addition lookup map path by addition lookup map path",dn="pick deletion lookup map from two lookup maps",gn={canNotGetGDocsDocument:"can not get extracted gdocs document object",annotationMapPathIsInvalid:"annotation map path is invalid",canNotRetryGetAnnotation:"time not passed, can not retry get annotation",suggestionMustHaveSameStart:"suggestion range must have same start",suggestionCountNotMatch:"two SuggestionMaps must contains same amount of suggestions",canNotFindAnnotationSetContainer:"can not find annotation sets container",canNotGetSuggestionRangeFromLookupMap:"can not get suggestion range from lookup map",canNotExtractSuggestionRange:"can not extract suggestion range from suggestion",canNotGetFirstSuggestionId:"can not get first suggestion id, annotationMapAll is wrong",annotationSetsAreNotSameType:"suggestion sets do not have same type",canNotGetAdditionLookupMapContainer:"additionLookupMapContainer getter is wrong",canNotGetSuggestionMapAdd:"can not find annotationMapAdd by the same path for annotationMapAll",wrongLookupMapDetails:"get wrong suggestion lookup maps",wrongLookupMapContainer:"get wrong suggestion lookup map container"},pn=t=>`find ${t} suggestions set(s)`,hn=t=>`find ${t} suggestion Map(s) in suggestion set`,mn=t=>`find ${t} deletion suggestion lookup map container(s)`,vn=t=>`find ${t} suggestion lookup map(s)`,yn=t=>`find ${t} deletion suggestion lookup map(s)`,xn=t=>`get ${t} annotation sets container`;const bn=(t,e,n)=>{let r;for(const[o,a]of Qe(t,e))if(void 0===r)a.includes(n)&&(r=o);else if(0==a.length)return{start:r,end:o}};function wn(t){const e=new Set;return t.map((t=>{for(const n of t)e.add(n)})),e.size}function Sn(t){let e=Object.getPrototypeOf(t);const n=[];for(;e&&e.constructor!==Object;)if(e&&e.constructor!==Object){const t=Object.getOwnPropertyNames(e).filter((t=>t.length>3&&"constructor"!==t&&"function"==typeof e[t])).map((t=>`${t}(${e[t].length})`));n.push(t),e=Object.getPrototypeOf(e)}return n}function En(t,e){if("object"!=typeof e||!e)return!1;if(!$e(e,"constructor",6)&&!$e(e,"constructor",5))return!1;for(const[t,n]of Object.entries(e))if(Tn(t,n))return!0;return!1}function Tn(t,e){return"object"==typeof e&&!!e&&"constructor"in e&&"clear"in e&&"contains"in e&&"add"in e&&"function"==typeof e.add&&4===e.add.length}function kn(t){const e=Object.entries(t).map((([t,e])=>{if("object"!=typeof e||!e)return null;const n=Object.keys(e).filter(rn);if(0===n.length)return null;return{openEndRangesMapPath:t,annotationMap:e,suggestionIds:n,range:function(t){const e=tn(t,((t,e)=>Ue(e)),0);if(1!==e.results.length)throw new Error(gn.canNotExtractSuggestionRange);return e.results[0].value[0]}(e[n[0]])}})).filter(Boolean);if(0===e.length)return;if(2!=e.length)throw new Error(hn(e.length));const[n,r]=e;if(n.suggestionIds.length!==r.suggestionIds.length||n.suggestionIds.some((t=>!r.annotationMap[t])))throw new Error(gn.suggestionCountNotMatch);if(n.range.start!==r.range.start)throw new Error(gn.suggestionMustHaveSameStart);return n.range.end>r.range.end?Ye([n.openEndRangesMapPath]):Ye([r.openEndRangesMapPath])}function Cn(t,e,n,r,o){r(dn);const a=function(t){const e=wn(t[0]),n=wn(t[1]);if(e!==n)return e<n?0:1;return}(e);return void 0!==a?a:function([t,e],n,r,o){const a=Object.keys(r).find(rn),i=bn(t,n,a),s=bn(e,n,a);if(!i||!s){const e=Sn(t);throw o(gn.wrongLookupMapDetails,{signature:e,name:"suggestionLookupMap"}),new Error(gn.canNotGetSuggestionRangeFromLookupMap)}const c=r[a],l=c.contains(i.start,i.end),u=c.contains(s.start,s.end);if(!l||!u)return l?1:0;return i.start>s.start?0:1}(e,t,n,o)}function An(t,e,n,r,o,a,i){const s=i?r.getAnnotationMapByPath(e.annotationSetAllPath):r.getAnnotationMap(e.annotationSetAll);if(!s)return;const c=i?r.getAnnotationMapByPath(e.annotationSetAddPath):r.getAnnotationMap(e.annotationSetAdd);if(!c)throw new Error(gn.canNotGetSuggestionMapAdd);const l=function(t,e){const n=Object.keys(t).filter(rn),r=Object.keys(e).filter(rn);if(n.length!==r.length){for(const t of n)if(!e[t])return t;if(n.length<r.length)throw new Error(gn.canNotGetFirstSuggestionId)}}(s,c);return l?function(t,e,n,r){n(un);const o=nn(t,e,r);if(1==o.length)return Mn(o[0].path);throw new Error(yn(o.length))}(t,l,o,a):function(t,e,n,r,o){r(ln);const a=function(t,e){return en(t,an,e)}(t,o);if(1==a.length){const[t,...e]=a[0].path;return function(t,e,n){let r;return{getDeletionLookupMap(o){if(void 0===r){const a=t.get(o);if(!a)throw new Error(gn.canNotGetAdditionLookupMapContainer);const i=function(t,e,n){n(fn);const r=[];for(const[n,i]of Object.entries(e))(o=i)!==(a=t)&&"object"==typeof o&&o&&o.constructor===a.constructor&&r.push(n);var o,a;if(1===r.length)return Ye([r[0]]);if(r.length>1)throw new Error(mn(r.length))}(a,o,n);if(!i)return;r=Ye([...i.getPath(),...e.getPath()])}return r.get(o)}}}(Ye([t]),Ye(e),r)}if(2==a.length){const t=Cn(n,[a[0].value,a[1].value],e,r,function(t,e){return(n,r)=>{const o=e(r);t(n,o?{...o,...r}:r)}}(o,(()=>({paths:a.map((t=>t.path.join(".")))}))));return Mn(a[t].path)}const i=Sn(t);throw o(gn.wrongLookupMapDetails,{signature:i,name:"gdocsDocument",paths:a.map((t=>t.path.join(".")))}),new Error(vn(a.length))}(t,c,n,o,a)}function Mn(t){const e=Ye(t);return{getDeletionLookupMap:t=>e.get(t)}}function Pn(t,e,n,r){try{const o=Xe(n),a=function(t,e){let n;return{getAnnotationMap:t=>(void 0===n&&(n=kn(t),n&&e(cn)),null==n?void 0:n.get(t)),getAnnotationMapByPath(r){const o=r.get(t);if(!o)throw new Error(gn.annotationMapPathIsInvalid);return void 0===n&&(n=kn(o),n&&e(cn)),null==n?void 0:n.get(o)}}}(t,n);let i,s;const c=Rn(r,e);return{getDeleteSuggestionRanges(l){if(!l)return[];try{if(void 0===i){if(void 0===s&&c.timeExceededForLastAttempt()&&(s=function(t,e,n,r){r(sn);const o=tn(t,En,1);if(e&&0===o.results.length)return;if(1!==o.results.length){const e=Sn(t);throw n(xn(o.results.length),{signature:e,name:"kixApp",paths:o.results.map((t=>t.path.join(".")))}),new Error(gn.canNotFindAnnotationSetContainer)}const a=tn(o.results[0].value,Tn,1);if(2!==a.results.length)throw new Error(pn(a.results.length));const i=a.results[0].value,s=a.results[1].value;if(s.constructor!==i.constructor)throw new Error(gn.annotationSetsAreNotSameType);return{annotationSetAll:i,annotationSetAdd:s,annotationSetAllPath:Ye(o.results[0].path.concat(a.results[0].path)),annotationSetAddPath:Ye(o.results[0].path.concat(a.results[1].path))}}(t,c.canRetry(),e,n)),!s)return[];i=An(l,s,o,a,n,e,r.extractSuggestionObjectsWithPath)}if(!i)return[];const u=i.getDeletionLookupMap(l);return u?((t,e)=>{const n=[];let r=-1;for(const[o,a]of Qe(t,e))-1===r?a.length>0&&(r=o):0==a.length&&(n.push({start:r,end:o}),r=-1);return n})(u,o):[]}catch(t){return i=null,e(t.message),[]}}}}catch(t){return e(t.message),{getDeleteSuggestionRanges:()=>[]}}}const Rn=(t,e)=>{const{retryAfterOneSecond:n,retryAnnotation100Times:r}=t;let o=r?100:10,a=-1/0;return{timeExceededForLastAttempt:()=>{if(!n)return!0;const t=(performance.now()-a)/1e3>1;return t||e(gn.canNotRetryGetAnnotation),t},canRetry:()=>{const t=o>0;return t&&(o--,n&&(a=performance.now())),t}}},Nn="invalid linkLookupMap",In="link lookup map path is in valid",On=t=>`find ${t} LinkContainer`,_n=t=>`find ${t} LinkLookupMap`,Dn=t=>`find ${t} link object`;const jn=[{name:"shift",length:3},{name:"splice",length:3}],Ln=[{name:"mark",length:4}];function Fn(t,e){return"link"===t&&"object"==typeof e&&null!==e&&(!!jn.every((({name:t,length:n})=>$e(e,t,n)))&&!Ln.some((({name:t,length:n})=>$e(e,t,n))))}const Bn=[{name:"getUrl",length:0},{name:"clone",length:0}];function Gn(t,e){return null!==e&&"object"==typeof e&&!!Bn.every((({name:t,length:n})=>$e(e,t,n)))}function Kn(t,e,n,r){try{const{template:o,path:a}=function(t){const e=tn(t,Fn,2);if(1!==e.results.length)throw new Error(On(e.results.length));const n=e.results[0].value,r=[];for(const[t,e]of Object.entries(n))We(e,(t=>"object"==typeof t&&null!==t))&&r.push({key:t,value:e});if(1!==r.length)throw new Error(_n(r.length));return{template:r[0].value,path:Ye(e.results[0].path.concat(r[0].key))}}(t),i=Xe(n);let s;return{getLinkInfoList(t){if(!t)return[];try{let e;if(r.extractLinkInternalsByPath){if(e=a.get(t),!e)throw new Error(In)}else e=o;return void 0===s&&(s=function(t,e){const n=e.getIndexes(t);if(n.length<=1)return;const r=n[1],o=e.getData(t)[r];if(!o)throw new Error(Nn);const a=tn(o,Gn,2);if(1!==a.results.length)throw new Error(Dn(a.results.length));const i=Ye(a.results[0].path);return{getLink:t=>i.get(t)}}(e,i)),s?$n(e,i,s):[]}catch(t){return s=null,e(t.message),[]}}}}catch(t){return e(t.message),{getLinkInfoList:()=>[]}}}const $n=(t,e,n)=>{var r;const o=[],a={start:-1,url:""};for(const[i,s]of Qe(t,e))if(-1===a.start){const t=null===(r=n.getLink(s))||void 0===r?void 0:r.getUrl();void 0!==t&&(a.start=i,a.url=t)}else o.push({...a,end:i}),a.start=-1,a.url="";return o},zn="Could not find fullText by path",Wn="Could not find gdocs document by path",qn=t=>`find ${t} searchable text`,Vn=t=>`find ${t} string in searchable text`,Hn=t=>`find ${t} GDocsDocument`;function Un(t,e){const n=function(t){const e=[];for(const[n,r]of Object.entries(t))Yn("",r)&&e.push([n,r]);if(1===e.length)return e[0];return}(t);if(n)return{path:Ye([n[0]]),template:n[1]};const r=[];for(const[e,n]of Object.entries(t))if(Jn(n)){const t=tn(n,Yn,2);if(1!==t.results.length)continue;const[o]=t.results;r.push({path:[e].concat(o.path),value:o.value,parent:n})}if(0===r.length)throw new Error(Hn(0));const o=function(t){if(3===t.length)return function(t){const[e,n,r]=t;if(e.parent===n.parent&&e.parent!==r.parent)return r;if(e.parent===r.parent&&e.parent!==n.parent)return n;if(n.parent===r.parent&&n.parent!==e.parent)return e;return}(t);if(2===t.length){const[e,n]=t;if(e.value===n.value&&Object.getPrototypeOf(n.parent)===Object.getPrototypeOf(e.parent))return n}return}(r);if(o)return{path:Ye(o.path),template:o.value};e(Hn(r.length));const a=r[0];return{path:Ye(a.path),template:a.value}}function Jn(t){if(!t||"object"!=typeof t)return!1;return[{name:"flush",length:3},{name:"getId",length:0},{name:"toString",length:0},{name:"dispose",length:0},{name:"isDisposed",length:0}].every((({name:e,length:n})=>$e(t,e,n)))}function Yn(t,e){if(!e||"object"!=typeof e)return!1;return[{name:"initialize",length:0},{name:"getStyle",length:2},{name:"clear",length:0}].every((({name:t,length:n})=>$e(e,t,n)))}function Xn(t){const e=[];for(const[r,o]of Object.entries(t))(function(t){if(!t||"object"!=typeof t)return!1;return[{name:"clone",length:0},{name:"indexOf",length:2},{name:"insert",length:2},{name:"lastIndexOf",length:2},{name:"remove",length:2},{name:"slice",length:2}].every((({name:e,length:n})=>$e(t,e,n)))})(n=o)&&Qn(n)&&e.push([r,o]);var n;if(1!==e.length)throw new Error(qn(e.length));return{path:Ye([e[0][0]]),template:e[0][1]}}function Qn(t){const e=[];for(const[n,r]of Object.entries(t))"string"==typeof r&&""===r.charAt(0)&&e.push([n,r]);if(1!==e.length)throw new Error(Vn(e.length));return Ye([e[0][0]])}function Zn(t){let e,n=0;const r=()=>{n++,e=t()};return{get calcCount(){return n},refresh:r,get:()=>(0===n&&r(),e)}}function tr(t,e){try{const n=rr(t,e),r=Be(t[n],"kixApp"),o=function(t,e){const n=new Set;return t.filter((t=>{const r=e(t);return!n.has(r)&&(n.add(r),!0)}))}(tn(r,((t,e)=>"string"==typeof e&&""===e.charAt(0)),5).results,(t=>t.value)).filter((t=>isNaN(parseInt(t.path[t.path.length-1],10))));for(const t of o){const e=t.path.slice(0,t.path.length-1).reduce(((t,e)=>t[e]),r);if(1===tn(e,er,2).results.length)return[n].concat(t.path);if(1===tn(e,nr,2).results.length)return[n].concat(t.path)}return null}catch(t){return null}}function er(t,e){return Array.isArray(e)&&Dt.some((t=>e.length===t.length&&e.every(((e,n)=>e.charCodeAt(0)===t[n]))))}function nr(t,e){return e instanceof RegExp&&Ft.includes(e.toString())}function rr(t,e,n){if(e)throw n&&n("getKixAppPath","DisableKixApp kill-switch is ACTIVE - blocking kixApp access",{message:"Testing fallback mechanisms"}),new Error("kixApp access disabled by DisableKixApp gate");let r=null;Kt in t?r=Kt:$t in t&&n&&n("findKixApp","GDocs connector patch failed",{error:t.GR_gdocs_connector_err});const o=Object.getOwnPropertyNames(t).find((t=>-1!==t.toString().indexOf("_kixApp")));return o&&(r=o),Be(r,"kix app path")}function or(t,e,n){return t.push(Array.isArray(e)||isNaN(e)?n:e),t}const ar="*";class ir{constructor(t,e,n,r){this._win=t,this._logError=e,this._logInfo=n,this._options=r,this._result=null,this._resizer=void 0;try{this._kixApp=function(t,e,n,r){try{n("findKixApp","extracting KixApp path");const a=rr(t,r,e);return a===Kt?n("findKixApp.backup","KixApp backup connector path found",{appPath:a}):a&&n("findKixApp.original","KixApp primary connector path found",{appPath:a}),Je((o=t,{get:()=>o}),[a])}catch(t){return e("findKixApp","Failed to find kixApp - using fallback mode",{error:t instanceof Error?t.message:String(t)}),Zn((()=>null))}var o}(this._win,e,n,this._options.disableKixApp)}catch(t){e("FullTextExtractor","Failed to find kixApp - using fallback mode",{error:t instanceof Error?t.message:String(t)}),this._kixApp=Zn((()=>null))}this._images=Zn((()=>function(t){const e="inline";try{const[n]=Ze(t,((t,n)=>(t===e||"positioned"===t)&&"object"==typeof n),5);Fe(!!n);const r=n.parent();Fe(!!r);const[o,a]=Ze(n,((t,e)=>We(e,(t=>Array.isArray(t)))),5);Fe(!!o&&!!a);const i=Be(Object.keys(a)[0]),[s,c]=Be(o.getPath());return{inline:Je(r,[e,...c,i])}}catch(t){return{inline:null,error:t}}}(this._kixApp)))}_attemptTextExtraction(t){try{const e=tr(this._win,t),n=function(t,e){try{const n=rr(t,e),r=tn(Be(t[n],"kixApp"),((t,e)=>"horizontal_rule"===t&&"object"==typeof e&&null!==e&&2===Object.keys(e).length),6);return 0===r.results.length?null:[n].concat(Be(r.results[0]).path,Object.keys(r.results[0].value)[0])}catch(t){return null}}(this._win,t);let r=!1;this._images.refresh();const o=e?[...e]:[],a=o.pop(),i=o.reduce(((t,e)=>t[e]),this._win),s=null==n?void 0:n.pop(),c=n?null==n?void 0:n.reduce(((t,e)=>t[e]),this._win):{},l=this.getKixApp(),u=this._options.extractDocumentInternals&&l?function(t,e){try{const{path:n,template:r}=Un(t,e),{path:o,template:a}=Xn(r),i=Qn(a),s=n,c=Ye(s.getPath().concat(o.getPath()).concat(i.getPath()));return{getText(){const n=c.get(t);return void 0===n?(e(zn,{path:c.getPath().join(".")}),""):n},getGdocsDocument(){const n=s.get(t);if(n)return n;e(Wn,{path:s.getPath().join(".")})}}}catch(t){return e(t.message),{getText:()=>"",getGdocsDocument:()=>{}}}}(l,((t,e)=>this._logError("ExtractDocumentInternals",t,e))):void 0;if(o.length>0||u){const t=()=>(null==u?void 0:u.getGdocsDocument())||o.slice(0,-1).reduce(((t,e)=>t[e]),this._win),e=l?Pn(l,((t,e)=>this._logError("ExtractSuggestionInternals",t,e)),(t=>this._logInfo("ExtractSuggestionInternals",t)),{extractSuggestionObjectsWithPath:this._options.extractSuggestionObjectsWithPath,retryAfterOneSecond:this._options.retryExtractAnnotationAfterOneSecond,retryAnnotation100Times:this._options.retryExtractAnnotation100Times}):void 0;let n;this._options.extractLinkFromInternals&&Ke((()=>{n=Kn(t(),((t,e)=>this._logError("ExtractLinkInternals",t,e)),(t=>this._logInfo("ExtractLinkInternals",t)),{extractLinkInternalsByPath:this._options.extractLinkInternalsByPath})}));const f=t=>{const e=null==t?void 0:t.get();return Array.isArray(e)?e.reduce(or,[]):[]};return{getText:()=>{const o=(null==u?void 0:u.getText())||i[a];if("string"!=typeof o)throw this._logError("ExtractFullText","unexpected text value type"),new Error("unexpected text value type");const l=c[s],d=Array.isArray(l)?l.reduce(or,[]).sort(((t,e)=>t-e)):[];let g=f(this._images.get().inline);return r||(g.length>0?r=!0:this._images.calcCount<10&&"string"==typeof o&&o.indexOf(ar)>=0&&(this._images.refresh(),g=f(this._images.get().inline),r=g.length>0)),{fullText:o,linkInfoList:null==n?void 0:n.getLinkInfoList(t()),deleteSuggestionRanges:null==e?void 0:e.getDeleteSuggestionRanges(t()),nonTextEntities:{horizontal_rule:{startsAt:d,textRepresentation:"-"},inline_image:{startsAt:g,textRepresentation:ar}}}}}}return{error:"notFound"}}catch(t){return{error:"exception",message:t.message}}}_attemptResizerExtraction(){const t=function(t,e){try{return[rr(t,e)].concat("resize")}catch(t){return null}}(this._win,this._options.disableKixApp);try{return t?t.reduce(((t,e)=>t[e]),this._win):null}catch(t){return null}}_getText(){try{return this._result||(this._result=this._attemptTextExtraction(this._options.disableKixApp)),"getText"in this._result?this._result.getText():null}catch(t){return null}}getKixApp(){return this._kixApp.get()}getText(){return this._getText()}triggerRender(){try{return void 0===this._resizer&&(this._resizer=this._attemptResizerExtraction()),this._resizer?(this._resizer(),!0):!1}catch(t){return!1}}}const sr=t=>Array.isArray(t);function cr(t,e){return!(!t||"object"!=typeof t)&&e.every((({name:e,length:n})=>$e(t,e,n)))}function lr(t,e){return cr(e,[{name:"remove",length:1},{name:"add",length:1}])&&!cr(e,[{name:"contains",length:1}])}function ur(t,e){const n=tn(t,((t,n)=>function(t,e){return cr(t,[{name:"getId",length:0}])&&t.getId()===e}(n,e)),1);if(1!==n.results.length)throw new Error(`find ${n.results.length} thread data container`);return{path:Ye(n.results[0].path),template:n.results[0].value}}function fr(t,e){const n=tn(t,((t,n)=>function(t,e){if(!cr(t,[{name:"getId",length:0},{name:"getOrigin",length:0}]))return!1;const n=t.getId();if(void 0!==n)return n===e;return!!tn(t,((t,n)=>"string"==typeof n&&n===e),1,void 0,21).results.length}(n,e)),1,void 0,5);if(1!==n.results.length)throw new Error(`find ${n.results.length} message data container`);return{path:Ye(n.results[0].path),template:n.results[0].value}}function dr(t,e){return!!sr(t)&&(t[1]===e||t[10]===e)}function gr(t){return!!sr(t)&&t.length>7}function pr(t,e,n,r){var o;const a=e.getData(t,n);if(!a)throw new Error("get message data failed");const[i,s,c,l,u,f,d,g=[],p,h,m,v,y,x,b]=a,w=function(t){var e;if(!t)return;if(sr(t)){const[e,n,r,o,a]=t;return{id:o,name:e,isCurrentSessionUser:a}}const n=function(){let t;return{getData(e){if(t)return t.get(e);const n=[];for(const[t,r]of Object.entries(e))gr(r)&&n.push([t,r]);if(1!==n.length)throw new Error(`find ${n.length} userInfo candidates`);const[r,o]=n[0];return t=Ye([r]),o}}}();return{id:t.getId(),name:t.getName(),email:t.getEmail(),isCurrentSessionUser:null===(e=n.getData(t))||void 0===e?void 0:e[4]}}(u);if(!w||b)return[];const S=[];for(const t of g)S.push(...pr(t,e,n,r));let E=function(t){if(!t)return"";if(sr(t)){const[e,n]=t;return n}return t.getValue()}(l);return r.startsWith("suggest.")&&a[20]&&(E=null===(o=Object.values(a[20])[0])||void 0===o?void 0:o[1]),E?[{id:m,content:E,author:w},...S]:S}function hr(){let t,e;const n=function(){let t;return{getData(e){if(t)return t.get(e);const n=[];for(const[t,r]of Object.entries(e))sr(r)&&n.push([t,r]);if(1!==n.length)throw new Error(`find ${n.length} thread data candidates`);const[r,o]=n[0];return t=Ye([r]),o}}}(),r=function(){let t;return{getData(e,n){if(t)return t.get(e);const r=[];for(const[t,o]of Object.entries(e))dr(o,n)&&r.push([t,o]);if(1!==r.length)throw new Error(`find ${r.length} message data candidates`);const[o,a]=r[0];return t=Ye([o]),a}}}();return{getValue(o){var a;const i=o.getId(),s=((e,n)=>{if(t)return t.get(e);const{path:r,template:o}=ur(e,n);return t=r,o})(o,i);if(!s)throw new Error("get thread data container failed");const c=null===(a=n.getData(s))||void 0===a?void 0:a[7];if(!c||!(l=c).startsWith("kix.")&&!l.startsWith("suggest."))throw new Error("get thread innerId failed");var l;const u=((t,n)=>{if(e)return e.get(t);const{path:r,template:o}=fr(t,n);return e=r,o})(s,i);if(!u)throw new Error("get message data container failed");return{id:i,messages:pr(u,r,i,c)}}}}function mr(t,e){return cr(e,[{name:"getId",length:0},{name:"isResolved",length:0}])}function vr(t,e){try{const n=function(t){const e=tn(t,lr,2).results;if(1!==e.length)throw new Error(`find ${e.length} threadMap`);return e[0].value}(t),r=function(){let t;const e=e=>{const n=tn(e,mr,1).results;if(0===n.length)return;const r=Ye(n[0].path.slice(0,1));return t=r.get(e),t};return{getList(t){const n=e(t);return n?Object.values(n):[]}}}(),o=hr();return{getThreadInfoList(){try{return r.getList(n).map((t=>o.getValue(t))).filter((t=>!!t.messages.length))}catch(t){return e(t.message),[]}}}}catch(t){return e(t.message),{getThreadInfoList:()=>[]}}}function yr(t,e,n,r){const o=t[e];if("function"!=typeof o)throw new Error(`Cannot patch non-function ${String(e)}`);const a=new Proxy(o,{apply(t,e,a){let i;const s=()=>{if(!i)try{i={originalResult:o.apply(e,a)}}catch(t){i={originalError:t}}if("originalError"in i)throw i.originalError;return i.originalResult};try{n(a,s,e)}catch(t){if(!(i&&"originalError"in i&&t===i.originalError))try{r(t,a)}catch(t){}}return s()}});t[e]=a;let i=!0;return{dispose:function(){if(i){if(t[e]!==a)throw new Error("Cannot un-patch the object");t[e]=o,i=!1}}}}function xr(t,e){if("object"!=typeof t||null===t)return;const n=t[e];return"function"==typeof n?n:void 0}function br(t){if(null===t||"object"!=typeof t)return!1;const e=t;if("function"!=typeof e.register||e.register.length<3)return!1;return Object.values(e).some(wr)}function wr(t){if(null===t||"object"!=typeof t)return!1;const e=t[mt];return"object"==typeof e&&null!==e}function Sr(t){var e;return(e=br,tn(t,((t,n)=>e(n)),5).results).map((t=>t.value))}function Er(t,e,n,r){const o=Sr(t);if(0===o.length)throw new Error("No layout renderer registries found");const a=function(t){const e=Object.entries(t).filter((([t,e])=>wr(e)));if(1!==e.length)throw new Error(`Cannot find the registry record: ${e.length} matched`);const n=e[0][0];return{getRegistryRecord:t=>t[n]}}(o[0]),i=o[0].constructor,s=o.filter((t=>t.constructor===i));for(const t of s)l(t);const c=yr(Object.getPrototypeOf(o[0]),"register",(([t,r,o],a)=>{try{a()}catch(e){return void n(e,t,r)}e(t,r,o)}),((t,[e,n])=>r(t,e,n)));return{dispose(){c.dispose()}};function l(t){const n=a.getRegistryRecord(t);for(const[t,r]of Object.entries(n))if("string"==typeof t)for(const[n,o]of Object.entries(r))"string"==typeof n&&e(t,n,o)}}function Tr(t,e,n=(()=>!0)){const r=new Map,o=new Map,a=new Set;let i=!1,s=null;const c=Er(t,(function(t,a,s){if(n(t,a)&&!r.has(s.constructor)){const e=Object.getPrototypeOf(s);r.set(s.constructor,{rendererProto:e,phase:t,nodeType:a}),i&&f(e,t,a)}const c=o.get(s);c?(c.phase!==t&&e("Renderer registered for multiple phases",{phases:[c.phase,t],nodeType:a}),c.phases.add(t)):o.set(s,{phases:new Set([t]),phase:t})}),((t,n,r)=>{e("Error in original #register method",{error:t,phase:n,nodeType:r})}),((t,n,r)=>{e("Error in #register hook",{error:t,phase:n,nodeType:r})}));let l;try{l=function(t){if(0===t.length)throw new Error("Cannot find the #paint method name: no samples.");let e=null;for(const n of Object.keys(t[0]))if("constructor"!==n&&t.every((t=>xr(t,n)))&&t.some((t=>{var e;return 3===(null===(e=xr(t,n))||void 0===e?void 0:e.length)}))){if(e)throw new Error("Cannot find the #paint method name: multiple candidates.");e=n}if(!e)throw new Error("Cannot find the #paint method name: no candidates.");return e}([...r.values()].map((t=>t.rendererProto)));for(const[t,e]of r)f(e.rendererProto,e.phase,e.nodeType);return i=!0,{isRendering:()=>null!==s,getNodeType:()=>s?s.nodeType:null,getNode:()=>s?s.node:null,getRenderingPhase:()=>s?s.phase:null,dispose:u}}catch(t){throw u(),t}function u(){i=!1,c.dispose();for(const t of a)t.dispose()}function f(t,n,r){try{a.add(yr(t,l,d,((t,[o,a])=>{let i;try{i=a&&"function"==typeof a.getType&&0===a.getType.length?a.getType():"[type-mismatch]"}catch(t){i="[error]"}e("Error in #paint hook",{error:t,phase:n,nodeType:r,paintNodeType:i})})))}catch(t){e("Failed to patch a renderer class",{error:t,phase:n,nodeType:r})}}function d([t,n],r,a){var i,c;const l=s;try{const t=o.get(a),u=n&&"function"==typeof n.getType?n.getType():null,f=null!==(c=null!==(i=null==t?void 0:t.phase)&&void 0!==i?i:null==l?void 0:l.phase)&&void 0!==c?c:null;s={parent:l,phase:f,nodeType:u,node:n};try{r()}catch(t){e("Error in original #paint method",{error:t,phase:f,nodeType:u})}}finally{s=l}}}var kr;!function(t){t.PagedMode="kix-document",t.PagelessMode="docstext-simple"}(kr||(kr={}));const Cr=(t,e)=>{const{results:n}=tn(t,((t,e)=>(t=>{const e=[kr.PagedMode,kr.PagelessMode];return"object"==typeof t&&null!==t&&"function"==typeof t.isRoot&&t.isRoot()&&"function"==typeof t.getType&&e.includes(t.getType())})(e)),5);if(1!==n.length)return e("extractGDocsInternalsLayoutTree",`Failed to extract GDocsInternalsLayoutTree, found ${n.length} instances.`),{status:"fail",failReason:0===n.length?"noInstances":"multipleInstances"};return{status:"success",rootNodeType:n[0].value.getType()}},Ar=t=>`find ${t} selection cursor constructor`,Mr="unexpected result when extract selection cursor",Pr="extract selection controller failed",Rr="get selection controller accessor failed",Nr="can not get current selection",Ir="can not extract cursor results";const Or=[{name:"constructor",length:3},{name:"toString",length:0}];function _r(t,e){return!!t&&t.constructor!==e&&Or.every((({name:e,length:n})=>$e(t,e,n)))}function Dr(t,e){return"function"==typeof e&&2===e.length}function jr(t,e){try{const{selectionController:n,cursorConstructor:r,selectionConstructor:o,cursorPropName:a,selectionControllerAccessor:i}=function(t,e){const n=function(t){const e=tn(t,((t,e)=>function(t){if("object"==typeof t&&null!==t&&"function"==typeof t.getSelection&&"function"==typeof t.constructor&&3===t.constructor.length){const e=t.getSelection();return null!=e&&"object"==typeof e&&"function"==typeof e.constructor&&6===e.constructor.length}return!1}(e)),2);if(e.results.length>0&&e.results.every((t=>t.value.constructor===e.results[0].value.constructor)))return e.results[0].value;return null}(t);if(null===n)throw new Error(Pr);const r=n.getSelection();if(!r)throw new Error(Nr);const o=function(t){const e=tn(t,((t,e)=>function(t){if("object"!=typeof t||!t)return!1;const e=t.constructor;return 3===(null==e?void 0:e.length)&&"function"==typeof t.shift&&1===t.shift.length}(e)),0);if(1!==e.results.length)return null;const n=e.results[0].value;return{GDocsCursor:n.constructor,currentCursor:n,cursorPropName:e.results[0].path[0]}}(r);if(null===o)throw new Error(Ir);const a=function(t,e){const n=tn(t,Dr,0,Object.getOwnPropertyNames(Object.getPrototypeOf(t)));if(1!==n.results.length)return e(`Failed to extract setSelection, found ${(r=n.results).length<5?r.length:">5"} candidates`,n.results),null;var r;const o=n.results[0].value;return{setSelection(t,e,n){o.call(t,e,n)}}}(n,e);if(null===a)throw new Error(Rr);return{selectionController:n,cursorConstructor:o.GDocsCursor,selectionConstructor:r.constructor,cursorPropName:o.cursorPropName,selectionControllerAccessor:a}}(t,e),s=function(t,e){let n;return()=>{if(!n){const r=t.getSelection();n=function(t,e){const n=tn(t,((t,e)=>Ue(e)),0),r=tn(t,(function(e,n){return"function"==typeof n&&1===n.length&&!1===n.call(t,{})&&!0===n.call(t,t)}),0,Object.getOwnPropertyNames(Object.getPrototypeOf(t)));if(1!==n.results.length||1!==r.results.length)return;const o=n.results[0].path[0],a=r.results[0].value;return{getCursor:t=>t[e],getRanges:t=>t[o],equals:(t,e)=>a.call(t,e)}}(r,e)}return n}}(n,a),c=function(t,e,n){let r;return()=>{if(void 0===r)try{const n=t.getSelection();r=function(t,e){let n,r=0;for(const o of Object.values(t))if(_r(o,e)){if(r++,!n){n=o.constructor;continue}if(n!==o.constructor)throw new Error(Mr)}if(0!==r){if(2!==r)throw new Error(Ar(r));return n}}(n,e)}catch(t){n("getKixSelectionWrapper",t.message),r=null}return r}}(n,r,e);return{equals(t){var n;const{prevSelection:r,nextSelection:o}=t;if(!r||!o)return!1;try{return(null===(n=s())||void 0===n?void 0:n.equals(r,o))||!1}catch(t){return e("getKixSelectionWrapper",t.message),!1}},getCurrentSelection(){try{return n.getSelection()}catch(t){return e("getKixSelectionWrapper",t.message),null}},getSelectionRanges(){var t;try{const e=n.getSelection(),r=(null===(t=s())||void 0===t?void 0:t.getRanges(e))||[];return r.length>0&&c(),r}catch(t){return e("getKixSelectionWrapper",t.message),[]}},setSelection(t,a){const s=c();if(!s)return!1;try{const e=function(t,e,n){const r=new t.GDocsCursor(n);if(n>e){const o=new t.GDocsCursor(e),a=new t.GDocsSelectionCursor(e,n-1,o),i=new t.GDocsSelectionCursor(e,n-1,r);return new t.GDocsSelection(r,i,a)}return new t.GDocsSelection(r,null,null)}({GDocsCursor:r,GDocsSelectionCursor:s,GDocsSelection:o},t,a);return i.setSelection(n,e,!0),!0}catch(t){return e("getKixSelectionWrapper",t.message),!1}}}}catch(t){return e("getKixSelectionWrapper",t.message),null}}var Lr;!function(t){t.Link="link",t.InlineObject="inlineObject",t.HorizontalRule="horizontalRule",t.SuggestedDeletion="suggestedDeletion"}(Lr||(Lr={}));const Fr={deleteSuggestionRanges:[],linkInfoList:[],nonTextEntities:{horizontal_rule:{startsAt:[],textRepresentation:"-"},inline_image:{startsAt:[],textRepresentation:ar}}};function Br(t,e,n){return(t[e]||[]).map(n)}function Gr(t,e,n,r){return{getText:()=>{const n=t.getText();try{return{fullText:n,...(r=t.getAnnotations(),{...Fr,deleteSuggestionRanges:Br(r,Lr.SuggestedDeletion,(t=>({start:t.range.start,end:t.range.end}))),linkInfoList:Br(r,Lr.Link,(t=>({start:t.range.start,end:t.range.end,url:t.value||""}))),nonTextEntities:{horizontal_rule:{startsAt:Br(r,Lr.HorizontalRule,(t=>t.range.start)),textRepresentation:"-"},inline_image:{startsAt:Br(r,Lr.InlineObject,(t=>t.range.start)),textRepresentation:ar}}})}}catch(t){e("annotatedFullTextExtractor","Failed to extract annotations",t)}var r;return{fullText:n,...Fr}},triggerRender:()=>!1}}async function Kr(t,e,n){try{e("createGDocsInternalsAccessorV2","Creating GDocsInternalsAccessorV2");const n=await(async()=>{try{const t=rt(!0);return Fe(t.length>0,"extensionId is empty"),Be(self._docs_annotate_getAnnotatedText,"_docs_annotate_getAnnotatedText"),await l(3,0,(()=>a(400,self._docs_annotate_getAnnotatedText(t))))}catch(t){return null}})();if(n)return e("createGDocsInternalsAccessorV2","Successfully fetched Annotated Text"),{type:"annotatedText",fullTextExtractor:Gr(n,t),getSelectionWrapper:()=>{const e=function(t,e){return{equals(t){const{prevSelection:e,nextSelection:n}=t;return!(!e||!n)&&e.start===n.start&&e.end===n.end},getCurrentSelection(){try{return t.getSelection()[0]}catch(t){return e("getAnnotatedTextSelectionWrapper",t.message),null}},getSelectionRanges(){try{return t.getSelection()}catch(t){return e("getAnnotatedTextSelectionWrapper",t.message),[]}},setSelection(n,r){try{return t.setSelection(n,r),!0}catch(t){return e("getAnnotatedTextSelectionWrapper",t.message),!1}}}}(n,t.bind(null,"getAnnotatedTextSelectionWrapper"));return e},getLayoutTreeAvailability:()=>null,getRenderingPhase:()=>null,getLayoutNodeType:()=>null,getLayoutNode:()=>null,getCommentWrapper:()=>{},dispose:()=>{}};throw new Error("Could not extract Annotated Text")}catch(e){throw t("createGDocsInternalsAccessorV2","Exception occurred",e),e}}var $r;async function zr(t,e,n,r){try{const r=await Kr(t,e);return n("createGDocsInternalsAccessor",$r.usedAnnotatedTextAsPrimary),r}catch(e){t("createGDocsInternalsAccessor","Falling back to kix internals accessor",{errorMessage:e.message})}try{const o=function(t,e,n){e("createGDocsInternalsAccessorV1","Creating GDocsInternalsAccessorV1"),n.disableKixApp&&e("createGDocsInternalsAccessorV1","DisableKixApp kill-switch is ACTIVE - initializing without kixApp",{disableKixApp:!0});const r=new ir(self,t,e,{extractLinkFromInternals:n.extractLinkFromInternals,extractDocumentInternals:n.extractDocumentInternals,extractSuggestionObjectsWithPath:n.extractSuggestionObjectsWithPath,extractLinkInternalsByPath:n.extractLinkInternalsByPath,retryExtractAnnotation100Times:n.retryExtractAnnotation100Times,retryExtractAnnotationAfterOneSecond:n.retryExtractAnnotationAfterOneSecond,disableKixApp:n.disableKixApp});let o,a,i=r.getKixApp(),s=0;const c=function(){if(!i)return null;const e=t.bind(null,"monitorLayoutNodeRenderers");try{return Tr(i,e)}catch(t){return e("Failed to create layout node renderers monitor",t),null}}();return{type:"kixApp",fullTextExtractor:r,getSelectionWrapper:()=>(void 0===a&&i&&(a=jr(i,t.bind(null,"getKixSelectionWrapper"))),a),getLayoutTreeAvailability:()=>s>=2?null:(s++,i=r.getKixApp(),i?Cr(i,t):{status:"fail",failReason:"noInstances"}),getRenderingPhase:()=>c?c.getRenderingPhase():null,getLayoutNodeType:()=>c?c.getNodeType():null,getLayoutNode:()=>c?c.getNode():null,getCommentWrapper:()=>(!o&&i&&(o=vr(i,t.bind(null,"getCommentWrapper"))),o),dispose(){c&&c.dispose()}}}(t,e,r);return n("createGDocsInternalsAccessor",$r.usedKixAppAsFallback),o}catch(e){throw n("createGDocsInternalsAccessor",$r.failedAll),t("createGDocsInternalsAccessor","Complete Fail",{errorMessage:e.message}),e}}!function(t){t.usedAnnotatedTextAsPrimary="usedAnnotatedTextAsPrimary",t.usedKixAppAsFallback="usedKixAppAsFallback",t.usedKixAppAsPrimary="usedKixAppAsPrimary",t.failedAll="failedAll",t.failedKixAppAsPrimary="failedKixAppAsPrimary"}($r||($r={}));const Wr=(t,e)=>{const n=d(document);return n?{layoutRoot:g(n,t,e),editorElement:n}:null};!async function(){var e;let n;try{self[nt.C]=rt(!0);const r=document.documentElement.dataset.grGdcConnId||(document.documentElement.dataset.grGdcConnId=`${Date.now()}-${Math.random()}`),o=function(t){return{request:`gr-cs-request-${t}`,response:`gr-cs-response-${t}`}}(r);n=new M(new y(document,o.response,o.request)),n.api.log("injected.starting","Injected script initialization");const i=self[`GR_GDEI_${r}`];if(!i){console.error("Could not start grammarly integration","no early injected data found");const t={message:document.documentElement.dataset.grGdcErrorMsg,stack:document.documentElement.dataset.grGdcErrorStack};return void n.api.logError("injected.starting","No early injected data found",t)}const s=(null===(e=document.currentScript)||void 0===e?void 0:e.getAttribute("data-ext-version"))||"unknown",c=function(t){return{request:`gr-ics-request-${t}`,response:`gr-ics-response-${t}`}}(r);!async function(e,n,r,o,i,s,c,u){try{const f=await l(10,0,(()=>a(400,e.api.getInitOptions()))),d=f.useVisibleLayoutRoot,p=await async function(e){let n=120;const r=250;for(;n;){const o=Wr(e);if(o)return o;await t(r),n--}return null}(d);if(!p)return void e.api.logError("injected.starting","Injected init failed: Cannot find rotating tile manager in 30 seconds");const{editorElement:v}=p;let y=p.layoutRoot;const x=()=>(d&&(y=g(v,!0,y)),y),b=()=>function(t){var e,n,r;try{return null!==(r=null===(n=null===(e=t.querySelector(k.textEventsTargetIframeSelector))||void 0===e?void 0:e.contentDocument)||void 0===n?void 0:n.querySelector(k.textEventsTargetElementSelector))&&void 0!==r?r:null}catch(t){return null}}(document),w=()=>v;f.disableKixApp&&e.api.log("injected.init","DisableKixApp kill-switch is ACTIVE in injected script",{disableKixApp:!0});const S=await zr(e.api.logError,e.api.log,e.api.trackGdocsInjectedMetric,{extractLinkFromInternals:f.extractLinkFromInternals,extractDocumentInternals:f.extractDocumentInternals,extractSuggestionObjectsWithPath:f.extractSuggestionObjectsWithPath,retryExtractAnnotationAfterOneSecond:f.retryExtractAnnotationAfterOneSecond,retryExtractAnnotation100Times:f.retryExtractAnnotation100Times,extractLinkInternalsByPath:f.extractLinkInternalsByPath,disableKixApp:f.disableKixApp});0;const E=new Q((()=>S.getSelectionWrapper()),(()=>S.fullTextExtractor.getText()),b,x,w),T=function(e,n,r,o){let a=!1,i=!1;let s=st(((t,s=!1)=>{const c={fullText:(()=>{if(i||!a)return null;const t=r.fullTextExtractor.getText();if(!t)return t;const e=r.getSelectionWrapper(),n=null==e?void 0:e.getSelectionRanges();return{...t,textSelectionRanges:(null==n?void 0:n.length)?n:null,textSelectionRangeEndExclusive:"annotatedText"===r.type&&o.textSelectionRangeEndExclusive}})(),renderResult:t,forcedFullRender:s};e.pageRendered(c,n)}));return s.pause(),{onRender(t){s.onRender(t)},init:t=>{t.forceFullRender&&(s=ct(s,(()=>r.fullTextExtractor.triggerRender()))),c()}};async function c(){if(await t(0),a||i)return;null===r.fullTextExtractor.getText()?(i=!0,e.logError("FullTextExtractor","Cannot get full document text")):a=!0,s.resume()}}(e.api,n,S,f),C=Yt(i.metricsMap,(()=>document.createElement("canvas").getContext("2d")),e.api),A=new Set,M=f.collectLayoutRenderingStats?function(){const t=new WeakMap;let e=0;return{getId(n){let r=t.get(n);return r||(r=++e,t.set(n,r)),r}}}():void 0;o((t=>{if(function(t){return t.matches(".kix-canvas-tile-content")}(t)){A.add(t);return function(t){return Ht(t,Me,t)}((n={log:e.api.log,logError:e.api.logError,logException:e.api.logException,collectLayoutRenderingStats:f.collectLayoutRenderingStats,useStrikethroughFiltering:f.useStrikethroughFiltering,useCodeBlockFiltering:f.useCodeBlockFiltering,trackUnderline:f.trackUnderline,trackStrikeThrough:f.trackStrikeThrough,cleanupPageMapCanvas2dContext:f.cleanupPageMapCanvas2dContext,metricsMap:C,layoutNodeIdProvider:M,getRenderingPhase:()=>S.getRenderingPhase(),getLayoutNodeType:()=>S.getLayoutNodeType(),getLayoutNode:()=>S.getLayoutNode(),getCurrentPageAttrs(){const e=x().getBoundingClientRect(),{left:n,top:r,width:o,height:a}=t.getBoundingClientRect(),i={left:n-e.left,top:r-e.top,width:o,height:a};return{canvasBitmapSize:{width:t.width,height:t.height},pageOffsetRect:i,isCompactLayout:m(t)}},onRender(e){!e.pageFragment.partialRect&&A.has(t)&&A.delete(t),h(t)&&T.onRender(e)}},{...n,matchingBroken:!1,currentSelection:[],currentPageFragment:null,currentPageMap:null,currentPartialMap:null,saveCount:0,savedState:[],savableState:{clips:[],clipsId:0,font:void 0,strokeStyle:void 0,renderContainer:null},path:[],lastClipsId:0,lastTextClipsId:0,lastTextWhitespaceWidth:0,clearedRect:null,footnote:{footnoteLineDetected:!1},compact:!1,equations:qt(),layoutRenderingStats:n.collectLayoutRenderingStats?Nt():{recordRendering(){},reset(){},toJSON:()=>null},layoutNodes:n.layoutNodeIdProvider?It(n.layoutNodeIdProvider):null}))}var n})),r({replaceText:E.replaceText.bind(E),getLayoutTreeAvailability:()=>S.getLayoutTreeAvailability(),getThreadInfo:()=>{var t;return(null===(t=S.getCommentWrapper())||void 0===t?void 0:t.getThreadInfoList())||[]}});if(!await e.api.init(S.type))return void e.api.logError("injected.starting","Injected init failed: server init failed");if(T.init(f),await t(10),A.size&&Array.from(A.values()).some(h)&&S.fullTextExtractor.triggerRender(),await t(1e3),i.metricsMap.size||await e.api.logError("init.textMeasuringCheck","No text measuring events received"),f.patchCanvasPrototype){e.api.log("init.checkAndPatchCanvases","Checking and late-patching canvases.");const n=await async function(e){const{getPatchedCanvases:n,client:r}=e;for(let o=0;o<60;o++){const o=document.querySelectorAll("canvas");if(o.length){const t=n(),a=[...o].filter((e=>!t.includes(e)));if(a.length>0){const n=new WeakMap,{allPatched:r,latePatchedCount:o}=je({...e,unpatchedCanvases:a,canvasContextMiddlewares:n});return{allCanvasesPatched:r,earlyPatchedCanvasesCount:t.length,latePatchedCanvasesCount:o,patchedCanvasesCount:t.length+o}}return r.api.log("init.checkAndPatchCanvases","No unpatched canvases found."),{allCanvasesPatched:!0,earlyPatchedCanvasesCount:t.length,latePatchedCanvasesCount:0,patchedCanvasesCount:t.length}}await t(1e3)}return await r.api.logError("init.patchedCanvasesCheck","No document canvases found after 60 seconds"),{allCanvasesPatched:!1,earlyPatchedCanvasesCount:0,latePatchedCanvasesCount:0,patchedCanvasesCount:0}}({client:e,getPatchedCanvases:s,middlewareFactories:c,addToPatchedCanvases:u,textMeasuringState:i});if(n.allCanvasesPatched&&0===n.latePatchedCanvasesCount)e.api.logCanvasPatching("init.checkAndPatchCanvases","All canvases patched.",n);else if(n.allCanvasesPatched&&n.latePatchedCanvasesCount>0)try{e.api.logCanvasPatching("init.checkAndPatchCanvases","All canvases patched.",n),T.init(f),S.fullTextExtractor.triggerRender()}catch(t){e.api.logError("injected.starting","Failed to init text observer after late canvas patching:",{error:t,...n})}else await e.api.logError("init.patchedCanvasesCheck","Not all the document canvases have been patched",n)}else e.api.log("init.checkCanvasesPatched","Checking patched canvases."),await async function(e,n){for(let r=0;r<60;r++){const r=document.querySelectorAll("canvas");if(r.length){const t=n();return void([...r].every((e=>t.includes(e)))||await e.api.logError("init.patchedCanvasesCheck","Not all the document canvases have been patched"))}await t(1e3)}await e.api.logError("init.patchedCanvasesCheck","No document canvases found after 60 seconds")}(e,s)}catch(t){try{await e.api.logException("init",t)}catch(t){}}}(n,s,(t=>{new P(function(t,e=u.create()){return{inbound:{subscribe:n=>t.inbound.subscribe({next(t){var r;if(n){const o={clientId:e,data:t};null===(r=n.next)||void 0===r||r.call(n,o)}}})},outbound(n){n.clientId===e&&t.outbound(n.data)}}}(new y(document,c.request,c.response)),{replaceText:(e,...n)=>t.replaceText(...n),getLayoutTreeAvailability:()=>t.getLayoutTreeAvailability(),getThreadInfo:()=>t.getThreadInfo()})}),i.addMiddleware,i.textMeasuringState,i.getPatchedCanvases,i.middlewareFactories,i.addToPatchedCanvases)}catch(t){console.error("Could not start grammarly integration","module not loaded",t),n&&n.api.logException("injected.starting",t)}}()})()}();