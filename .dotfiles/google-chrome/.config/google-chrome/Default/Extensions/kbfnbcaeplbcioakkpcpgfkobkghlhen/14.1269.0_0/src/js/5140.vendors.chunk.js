(self.webpackChunk=self.webpackChunk||[]).push([[5140],{98705:(e,t,n)=>{n.d(t,{g:()=>r,u:()=>i});var r=(e=>(e.Forbidden="Forbidden: User not assigned to feature",e.Unauthorized="Unauthorized: User not assigned to feature",e.UnprocessableContent="Document did not pass pre-filtering",e.Sensitivity="Document did not pass sensitivity filtering",e.InternalServerError="Internal server error",e.ServiceLimitExceeded="Service limit exceeded",e.UnsupportedLanguage="Unsupported language",e.UpdateClient="Client has to be updated to process the result of the requested action",e.Other="Other error",e.NothingToImprove="Nothing to improve",e))(r||{});const o=class e extends Error{constructor(e,t){super(`[${e}] ${t}`),this.kind=e}static fromMessageError(t){return new e(e.getKind(t),t.title)}};o.getKind=e=>{switch(e.errorType.kind){case"sensitivity":return"Document did not pass sensitivity filtering";case"serviceLimitExceeded":return"Service limit exceeded";case"unsupportedLanguage":return"Unsupported language";case"updateClient":return"Client has to be updated to process the result of the requested action";case"backendError":return"Internal server error";case"badRequest":switch(e.errorType.errorCode){case 403:return"Forbidden: User not assigned to feature";case 401:return"Unauthorized: User not assigned to feature";case 422:return"Document did not pass pre-filtering";default:return"Internal server error"}default:return"Other error"}};let i=o},18240:(e,t,n)=>{n.d(t,{D:()=>a,k:()=>o});var r=n(32103),o=(e=>(e.Sensitivity="Document did not pass sensitivity filtering",e.UnsupportedLanguage="Unsupported language",e.FailedProcessing="Failed to process file",e.ChecksumMismatch="Checksum mismatch",e.UnsupportedFileFormat="Unsupported file format",e.Other="Other error",e))(o||{});const i=class e extends Error{constructor(e,t){super(`[${e}] ${t}`),this.kind=e}static fromMessageError(t){return new e(e.getKind(t),t.title)}};i.getKind=e=>{const{kind:t}=e.errorType;switch(t){case"sensitivity":return"Document did not pass sensitivity filtering";case"unsupportedLanguage":return"Unsupported language";case"failedProcessing":return"Failed to process file";case"checksumMismatch":return"Checksum mismatch";case"unsupportedFileFormat":return"Unsupported file format";case"other":return"Other error";default:(0,r.vE)(t)}};let a=i},33794:(e,t,n)=>{n.d(t,{R:()=>r,k:()=>o});const r=8,o=1e3},47025:(e,t,n)=>{n.d(t,{O:()=>o,s:()=>r});var r=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(r||{}),o=(e=>(e.EditingView="agentPanel/paraphraser/editingView",e.ErrorView="agentPanel/paraphraser/errorView",e.LoadedView="agentPanel/paraphraser/loadedView",e.LoadingView="agentPanel/paraphraser/loadingView",e.SavingView="agentPanel/paraphraser/savingView",e.CustomVoiceButton="agentPanel/paraphraser/customVoiceButton",e.ModeButton="agentPanel/paraphraser/modeButton",e.ReloadButton="agentPanel/paraphraser/reloadButton",e.RemoveButton="agentPanel/paraphraser/removeButton",e.SaveButton="agentPanel/paraphraser/saveButton",e.NotificationPanel="agentPanel/paraphraser/notificationPanel",e.PushedContentReceived="agentPanel/paraphraser/pushedContentReceived",e.ModeCompleted="agentPanel/paraphraser/modeCompleted",e.OnboardingShow="agentPanel/paraphraser/onboardingShow",e.OnboardingClose="agentPanel/paraphraser/onboardingClose",e.OnboardingClickOnCTA="agentPanel/paraphraser/onboardingClickOnCTA",e))(o||{})},76755:(e,t,n)=>{n.d(t,{B:()=>i,f:()=>o});var r=n(5749);const o=(e,t)=>t.filter((t=>r.h.isWithRewrite(t)&&t.surface.sourceAction===e.sourceAction));function i(e){return r.z.isVBar(e)&&r.h.isWithRewrite(e)&&"paraphraser"===e.surface.sourceAgent}},24893:(e,t,n)=>{n.d(t,{j:()=>i});var r=n(64443);const o="Paraphraser";function i(e=""){return r.C8.Logging.getLogger(e?`${o}.${e}`:o)}},91791:(e,t,n)=>{n.d(t,{I:()=>r});const r="Paraphraser"},35140:(e,t,n)=>{n.d(t,{Z:()=>A,c:()=>ee});var r=n(88012),o=n(98705),i=n(18240),a=n(13391),d=n(90023),s=n(20232),c=n(67177),u=n(12518),l=n(24893),g=n(71483),p=n(58303),m=n(86399),h=n(21034),v=n(90572),b=n(63532),f=n(59179),k=n(24666),C=n(5588),S=n(84178),I=n(20161),M=n(29416),w=n(84308),O=n(64271),P=n(84714),y=n(93440),E=n(36344),U=n(46068),L=n(32103),B=n(33794),Z=n(47025),G=n(76755),K=Object.defineProperty,V=Object.defineProperties,x=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,F=(e,t,n)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function T(e){const{agenticService:t}=e,n=e,{agenticService:r}=n,o=((e,t)=>{var n={};for(var r in e)R.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&z)for(var r of z(e))t.indexOf(r)<0&&D.call(e,r)&&(n[r]=e[r]);return n})(n,["agenticService"]);return((e,t)=>V(e,x(t)))(((e,t)=>{for(var n in t||(t={}))R.call(t,n)&&F(e,n,t[n]);if(z)for(var n of z(t))D.call(t,n)&&F(e,n,t[n]);return e})({},o),{findFirstVBarForAction:e=>t.currentVBars.pipe((0,f.U)((t=>(0,G.f)(e,t))),(0,f.U)((e=>m.YM(e)))),getSelectedAction:e=>(0,d.zG)(e.selectedModeId,p.tS((t=>(0,d.zG)(e.modes,m.Ew((e=>e.id===t)))))),equals:(e,t)=>g.ZM.Mode.optionalEqById.equals(e,t)&&!(0,d.zG)(t,p.Gg(g.LY.isLoadingAfterReload)),filterAllowedStates:e=>e.kind===g.ZM.Kind.Loaded})}var A,Y=n(91791),j=Object.defineProperty,N=Object.defineProperties,W=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,X=(e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,H=(e,t)=>{for(var n in t||(t={}))$.call(t,n)&&X(e,n,t[n]);if(q)for(var n of q(t))_.call(t,n)&&X(e,n,t[n]);return e},Q=(e,t)=>N(e,W(t));function J(e){return(0,d.zG)(e.selectedModeId,p.tS((t=>te(t,e))))}function ee(e){return g.ZM.Loaded.is(e)?J(e):p.YP}function te(e,t){return(0,d.zG)(p.G(t),p.hX(g.ZM.Loaded.is),p.tS((t=>(0,d.zG)(t.modes,m.Ew((t=>t.id===e))))))}function ne(e,t,n){return(0,d.zG)(t,m.Ew((t=>t.label===e&&t.isCustom===n)),p.UI((e=>e)))}(A||(A={})).create=e=>{var t;const{agenticService:n,capiSessionStarted:m,capiConnectionEvents:L,editor:G,isPanelOpen:K,trackingServiceProvider:V,fileUploadService:x}=e,z=a.h.create(!1),R=new r.w.Keeper,D=(0,l.j)("ViewModel"),F=a.h.create(null!=(t=e.state)?t:{kind:g.ZM.Kind.Initial}),A=a.h.create(void 0),j=a.h.create(0),N="onboarding",W=new h.D2(g.Rn);let q=a.h.create(!1);if(e.isOnboardingExperimentEnabled){const e=null===W.getItem(N)||"true"===W.getItem(N);q=a.h.create(e)}const $=(0,h.XW)({fileUploadService:x,agentId:g.Rn}),_=()=>{(0,d.zG)(G.getContents().text,u.UI(U.iD),u.g_((()=>j.set(0)),(e=>j.set(e))))};_();const X=L.pipe((0,v.h)((e=>"connect"===e.kind)),(0,b.b)((()=>D.debug("[DEBUG]: WebSocket connected")))),oe=L.pipe((0,v.h)((e=>"disconnect"===e.kind)),(0,b.b)((()=>D.debug("[DEBUG]: WebSocket disconnected")))),ie=m.pipe((0,b.b)((()=>D.debug("[DEBUG]: Session started")))),ae=F.view(ee),de=V.getTrackingService(),se=re(de),ce=(0,w.a)([F,(0,O.T)(X.pipe((0,f.U)((()=>"connected"))),oe.pipe((0,f.U)((()=>"disconnected"))),(0,P.of)("unknown"))]).pipe((0,f.U)((([e,t])=>e.kind===g.ZM.Kind.Error||"disconnected"===t)),(0,k.x)(),(0,C.D)((e=>(0,y.H)(e?500:0))),(0,b.b)((e=>z.set(e)))),ue=e=>{D.debug("Loading evaluation");const t=F.get();return g.ZM.Loading.is(t)?()=>Promise.resolve(t):(F.set({kind:g.ZM.Kind.Loading}),(0,d.zG)(n.getModes(),s.UI(u.g_((e=>e instanceof o.u&&e.kind===o.g.Sensitivity?(D.debug("Sensitivity error detected in _loadModes, setting state to blocked",{error:e}),{kind:g.ZM.Kind.Blocked}):{kind:g.ZM.Kind.Error,title:"Something went wrong",description:"To chat with Grammarly, please close this sidebar, then reopen it."}),(r=>({kind:g.ZM.Kind.Loaded,evaluation:r.evaluation,selectedModeId:(0,d.zG)(e,p.hX((e=>r.modes.some((t=>t.id===e.id)))),p.UI((e=>e.id)),p.wp((()=>(0,d.zG)(t,p.DT(g.ZM.Saving.is),p.tS((e=>ne(e.voiceName,r.modes,!0))),p.UI((e=>e.id)))))),modes:r.modes.map((e=>Q(H({},e),{state:{kind:g.LY.Kind.Idle,vBarsCount:n.getCurrentVBarsForMode(e).length}})))}))))))},le=()=>(z.get()&&n.clearVBars(),(0,d.zG)(ue(p.YP),s.UI((e=>F.set(e))))()),ge=ie.pipe((0,S.q)(1),(0,I.w)((()=>K.pipe((0,I.w)((e=>{const t=F.get();return e&&t.kind!==g.ZM.Kind.Loading&&t.kind!==g.ZM.Kind.Loaded?fe()?(D.debug("Editor has not enough text, skipping loading modes"),F.set({kind:g.ZM.Kind.Empty}),E.E):le():E.E})))))),pe=F.pipe((0,v.h)(g.ZM.Empty.is),(0,I.w)((()=>G.changes.pipe((0,v.h)((()=>!0===K.get())),(0,M.b)(B.k),(0,v.h)((()=>!fe())),(0,S.q)(1),(0,v.h)((()=>g.ZM.Empty.is(F.get()))),(0,I.w)((()=>(D.debug("Editor has enough text in Empty state, try loading modes"),le()))))))),me=e.featureFlags.focusCard?(0,h.bH)(T({state:F,isPanelOpen:K,agenticService:n,decorationService:e.decorationService,agentId:g.Rn})):void 0,he=(0,O.T)(n.currentVBars,ae).pipe((0,v.h)((()=>!z.get())),(0,C.D)((()=>(0,y.H)(500))),(0,b.b)((()=>{(0,d.zG)(ae.get(),p.hX((e=>e.state.kind===g.LY.Kind.Idle)),p.UI((e=>F.modify((t=>{if(!g.ZM.Loaded.is(t))return t;const r=n.getCurrentVBarsForMode(e).length,o=e.state.kind===g.LY.Kind.Idle&&0===r&&!0!==fe();if(o){const t={agentId:g.Rn,capiSessionId:A.get(),textWordsCount:j.get(),modeName:e.label,trackingSourceAction:e.trackingSourceAction};D.debug("Track event",{component:Z.O.ModeCompleted,detail:t}),de.trackEvent(Z.s.ComponentImpression,{componentId:Z.O.ModeCompleted,detail:t})}return g.ZM.Loaded.updateMode(t,e.id,{state:o?{kind:g.LY.Kind.Completed}:{kind:g.LY.Kind.Idle,vBarsCount:r}})})))))})));R.push(ge.subscribe(),pe.subscribe(),ce.subscribe(),X.subscribe(),oe.subscribe(),he.subscribe(),ie.pipe((0,f.U)((e=>e.sessionId))).subscribe((e=>A.set(e))),G.changes.subscribe(_),x.on("removePersistentDataStarted",(e=>{const t=e.useCaseParameters;if("customTone"===(null==t?void 0:t.kind)&&t.name){const e=t.name;D.debug("Removing custom voice mode from state",{voiceName:e}),(0,d.zG)(F.get(),p.DT(g.ZM.Loaded.is),p.tS((t=>(0,d.zG)(ne(e,t.modes,!0),p.UI((e=>({loadedState:t,modeToRemove:e})))))),p.g_(d.Q1,(({loadedState:e,modeToRemove:t})=>{const n=(0,d.zG)(e.selectedModeId,p.tS((e=>e===t.id?p.YP:p.G(e))));F.set(Q(H({},e),{selectedModeId:n,modes:e.modes.filter((e=>e.id!==t.id))}))})))}})),x.on("uploadTextFinished",(e=>be()))),me&&R.push(me.subscribe());const ve=(e,t=!1)=>((e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{d(n.next(e))}catch(e){o(e)}},a=e=>{try{d(n.throw(e))}catch(e){o(e)}},d=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);d((n=n.apply(e,t)).next())})))(void 0,null,(function*(){if(fe())return D.debug("Editor has not enough text, skipping action execution"),void F.set({kind:g.ZM.Kind.Empty});const r=F.get(),i=z.get(),a=te(e,r);if(p.Wi(a))return void D.debug("Cannot execute mode that is not in the current state",{modeId:e,currentState:r});const u=a.value,l=r;return u.state.kind===g.LY.Kind.Loading?(D.debug("Mode is already loading, only update selected mode w/o execution",{modeId:e}),void F.set(Q(H({},l),{selectedModeId:p.G(u.id)}))):(D.debug("Executing mode",{modeId:e}),i&&n.clearVBars(),F.set(Q(H(H({},l),g.ZM.Loaded.updateMode(l,u.id,{state:{kind:g.LY.Kind.Loading,isAfterReload:t}})),{selectedModeId:p.G(u.id)})),(0,d.zG)(n.getRewrites(u),c.g_((e=>(e instanceof o.u&&e.kind===o.g.Sensitivity&&(D.debug("Sensitivity error detected, setting state to blocked",{error:e}),F.set({kind:g.ZM.Kind.Blocked})),s.of(void 0))),(()=>(F.modify((e=>{if(!g.ZM.Loaded.is(e))return e;const t=n.getCurrentVBarsForMode(u).length,r=g.ZM.Loaded.updateMode(e,u.id,{state:0===t?{kind:g.LY.Kind.IdleNoSuggestions}:{kind:g.LY.Kind.Idle,vBarsCount:t}}),o={agentId:g.Rn,capiSessionId:A.get(),textWordsCount:j.get(),modeName:u.label,trackingSourceAction:u.trackingSourceAction,suggestionsCount:t};return D.debug("Track event",{componentId:Z.O.PushedContentReceived,detail:o}),de.trackEvent(Z.s.ComponentImpression,{componentId:Z.O.PushedContentReceived,detail:o}),r})),s.of(void 0)))))())})),be=()=>{if(D.debug("Reloading agent"),fe())return D.debug("Editor has not enough text, skipping re-load"),void F.set({kind:g.ZM.Kind.Empty});const e=ae.get();return n.clearVBars(),void(0,d.zG)(ue(e),s.UI((e=>(F.set(e),g.ZM.Loaded.is(e)?(0,d.zG)(J(e),p.UI((e=>(D.debug("Loading vBars after agent reload",{mode:e}),ve(e.id,!0))))):d.Q1))))()};return{featureFlags:e.featureFlags,selectedMode:ae,title:Y.I,state:F,loadModes:()=>(0,d.zG)(ue(p.YP),s.UI((e=>F.set(e))))(),executeMode:ve,reloadAgent:be,editCustomVoice:()=>{D.debug("Editing custom voice");const e=F.get();F.set({kind:g.ZM.Kind.Editing,previousState:e})},saveCustomVoice:(e,t,n)=>(F.set({kind:g.ZM.Kind.Saving,voiceName:e,sampleLength:t.length}),void(0,d.zG)($.createCustomVoice({toneName:e,content:t,description:n}),s.UI(u.Vn((e=>{e instanceof i.D&&e.kind===i.k.Sensitivity?(D.debug("Sensitivity error detected in saveCustomVoice, setting state to blocked",{error:e}),F.set({kind:g.ZM.Kind.Blocked})):(D.error("Failed to create custom voice",e),F.set({kind:g.ZM.Kind.Error,title:e.name,description:`${e.message}. Press the "Reload" button to continue working.`}))}))))()),removeCustomVoice:e=>{(0,d.zG)($.removeCustomVoice({toneName:e}),s.UI(u.Vn((e=>{D.error("Failed to remove custom voice",e),F.set({kind:g.ZM.Kind.Error,title:e.name,description:`${e.message}. Press the "Reload" button to continue working.`})}))))()},context:{capiSessionId:A,tracking:de,textWordsCount:j,isPanelOpen:K},dispose:()=>{R.dispose()},goBack:e=>{F.set(e)},setShouldShowOnboarding:e=>{W.setItem(N,e.toString()),q.set(e)},shouldShowOnboarding:q,trackOnboardingEvent:se};function fe(){return(0,d.zG)(G.getContents().text,u.UI(U.iD),u.UI((e=>e<B.R)),u.fS((()=>!1)))}};const re=e=>t=>{switch(t){case Z.O.OnboardingClickOnCTA:e.trackEvent(Z.s.ComponentClicked,{componentId:Z.O.OnboardingClickOnCTA});break;case Z.O.OnboardingClose:e.trackEvent(Z.s.ComponentClicked,{componentId:Z.O.OnboardingClose});break;case Z.O.OnboardingShow:e.trackEvent(Z.s.ComponentImpression,{componentId:Z.O.OnboardingShow});break;default:(0,L.L0)(t)}}}}]);