(self.webpackChunk=self.webpackChunk||[]).push([[8729],{98746:(t,i,s)=>{s.d(i,{S:()=>c});var e=s(75588),n=new WeakMap,o=new WeakMap,a=new WeakMap;class c{constructor(t){(0,e.sv)(this,n,new DisposableStack),(0,e.sv)(this,o,new Map),(0,e.sv)(this,a,void 0),(0,e.SH)(a,this,t)}send(t){(0,e.y1)(a,this).send(t)}subscribe(t){const i=new DisposableStack;i.defer((()=>{const i=(0,e.y1)(o,this).get(t);null==i||i[Symbol.dispose](),(0,e.y1)(o,this).delete(t)}));const s=new DisposableStack;return(0,e.y1)(o,this).set(t,s),null!==(0,e.y1)(a,this)&&s.use((0,e.y1)(a,this).subscribe(t)),i}connectToServerPort(t){(0,e.SH)(a,this,t);for(const[t,i]of(0,e.y1)(o,this)){i[Symbol.dispose]();const s=(0,e.y1)(a,this).subscribe(t);(0,e.y1)(o,this).set(t,s)}}[Symbol.dispose](){(0,e.y1)(n,this).dispose()}}},8840:(t,i,s)=>{s.d(i,{C:()=>Q});var e=s(75588),n=s(59692),o=s(7167),a=s(38605),c=s(73375);function d(t,i){if(t===i)return!0;if("object"!=typeof t||null===t||"object"!=typeof i||null===i)return!1;if(Array.isArray(t)&&Array.isArray(i))return t.length===i.length&&t.every(((t,s)=>d(t,i[s])));if(Array.isArray(t)!==Array.isArray(i))return!1;const s=Object.keys(t),e=new Set(Object.keys(i));if(s.length!==e.size)return!1;for(const n of s)if(!e.has(n)||!d(t[n],i[n]))return!1;return!0}var l=s(48739),r=new WeakMap,h=new WeakMap,u=new WeakMap,p=new WeakMap,y=new WeakMap,v=new WeakMap,m=new WeakMap,b=new WeakMap,k=new WeakMap,f=new WeakMap,I=new WeakMap,w=new WeakSet;class S{constructor(t){var i,s;(0,e.Rh)(this,w),(0,e.sv)(this,r,new DisposableStack),(0,e.sv)(this,h,void 0),(0,e.sv)(this,u,void 0),(0,e.sv)(this,p,void 0),(0,e.sv)(this,y,void 0),(0,e.sv)(this,v,!1),(0,e.sv)(this,m,null),(0,e.sv)(this,b,(0,e.y1)(r,this).adopt(new Map,(t=>t.clear()))),(0,e.sv)(this,k,(0,e.y1)(r,this).adopt(new Map,(t=>t.clear()))),(0,e.sv)(this,f,(0,e.y1)(r,this).adopt(new Map,(t=>t.clear()))),(0,e.sv)(this,I,(0,e.y1)(r,this).adopt(new Map,(t=>t.clear()))),(0,e.SH)(h,this,t.serverPort),(0,e.SH)(u,this,null!==(i=t.tracingOptions)&&void 0!==i?i:{enabled:!1}),(0,e.SH)(p,this,t.retainedValueStorage),(0,e.SH)(y,this,"".concat((0,l.v)()).concat(void 0!==t.name?"(".concat(t.name,")"):"")),(0,e.y1)(r,this).use(null===(s=(0,e.y1)(h,this))||void 0===s?void 0:s.subscribe((t=>(0,e.mj)(w,this,j).call(this,t)))),(0,e.y1)(r,this).defer((()=>{var i;return null===(i=t.retainedValueStorage)||void 0===i?void 0:i.clear()})),void 0!==(0,e.y1)(h,this)&&this.connect()}isConnected(){return!(0,e.y1)(v,this)}waitConnected(){var t,i;return null!==(t=null===(i=(0,e.y1)(m,this))||void 0===i?void 0:i.promise)&&void 0!==t?t:Promise.resolve()}connect(){var t;if(!(0,e.y1)(h,this))return Promise.resolve();null===(t=(0,e.y1)(m,this))||void 0===t||t.reject(new Error("Connection attempt superseded by a newer one")),(0,e.SH)(v,this,!0),(0,e.y1)(I,this).forEach((t=>t.setBufferingEnabled(!0)));const i="".concat((0,e.y1)(y,this),"|").concat((0,l.v)()),s=(0,c.B)();return(0,e.SH)(m,this,{attempId:i,resolve:()=>{var t;(null===(t=(0,e.y1)(m,this))||void 0===t?void 0:t.attempId)===i&&((0,e.SH)(v,this,!1),(0,e.SH)(m,this,null),(0,e.y1)(I,this).forEach((t=>t.setBufferingEnabled(!1))),s.resolve())},reject:t=>{var n;(null===(n=(0,e.y1)(m,this))||void 0===n?void 0:n.attempId)===i&&((0,e.SH)(v,this,!1),(0,e.SH)(m,this,null),s.reject(t))},promise:s.promise}),(0,e.y1)(h,this).send({kind:"handshake",id:i,subscriptions:[...(0,e.y1)(b,this).values()].map((t=>({key:t.key,clientId:t.clientId,subscriptionId:t.portId,timestamp:t.timestamp}))),retainedValues:[...(0,e.y1)(f,this).entries()].map((t=>{let[i,s]=t;return{key:i,value:s.value,clientId:s.lastWriterClientId,timestamp:s.modifiedTimestamp}}))}),s.promise}createPort(t){const i=null==t?void 0:t.name,s="".concat((0,e.y1)(y,this),"|","".concat((0,l.v)()).concat(void 0!==i?"(".concat(i,")"):"")),n=(0,e.y1)(r,this).use(new J({send:t=>(0,e.mj)(w,this,C).call(this,s,t),notifyDispose:()=>(0,e.mj)(w,this,g).call(this,s),shouldBufferMessages:(0,e.y1)(v,this),tracingOptions:void 0!==(null==t?void 0:t.tracingOptions)?t.tracingOptions:(0,e.y1)(u,this),portId:s}));return(0,e.y1)(I,this).set(s,n),n}[Symbol.dispose](){(0,e.y1)(r,this).dispose()}}function g(t){const i=(0,e.y1)(I,this).get(t);if(void 0!==i){for(const[i,s]of(0,e.y1)(b,this).entries())s.portId===t&&(0,e.mj)(w,this,A).call(this,t,{kind:"unsubscribe",subscriptionId:i});i[Symbol.dispose](),(0,e.y1)(I,this).delete(t)}}function j(t){switch(t.kind){case"publish":(0,e.mj)(w,this,M).call(this,t);break;case"handshake-ack":(0,e.mj)(w,this,W).call(this,t)}}function W(t){var i;if((null===(i=(0,e.y1)(m,this))||void 0===i?void 0:i.attempId)===t.id){(0,e.y1)(m,this).resolve();for(const i of t.newerRetainedValues){var s;(0,e.y1)(f,this).set(i.key,{value:i.value,lastWriterClientId:i.clientId,modifiedTimestamp:i.timestamp}),null===(s=(0,e.y1)(p,this))||void 0===s||s.set(i.key,i.value),(0,e.mj)(w,this,O).call(this,{kind:"publish",key:i.key,value:i.value,timestamp:i.timestamp,clientId:i.clientId})}}}function M(t){var i;const s=(0,e.y1)(f,this).get(t.key);if(void 0!==s){var n;if(t.timestamp<=s.modifiedTimestamp)return;(0,e.y1)(f,this).set(t.key,{value:t.value,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null===(n=(0,e.y1)(p,this))||void 0===n||n.set(t.key,t.value)}if(null===(i=t.route)||void 0===i||!i.includes((0,e.y1)(y,this)))return void 0!==t.toSubscriptionId?(0,e.mj)(w,this,E).call(this,t):void 0!==t.toClientId?(0,e.mj)(w,this,D).call(this,t):(0,e.mj)(w,this,O).call(this,t)}function C(t,i){switch(i.kind){case"publish":(0,e.mj)(w,this,H).call(this,i);break;case"subscribe":(0,e.mj)(w,this,P).call(this,t,i);break;case"unsubscribe":(0,e.mj)(w,this,A).call(this,t,i);break;case"handshake":(0,e.mj)(w,this,T).call(this,t,i)}}function H(t){var i,s;const n=(0,e.y1)(f,this).get(t.key);var o;void 0!==n&&t.timestamp>n.modifiedTimestamp?((0,e.y1)(f,this).set(t.key,{value:t.value,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null===(o=(0,e.y1)(p,this))||void 0===o||o.set(t.key,t.value)):void 0!==n&&(0,e.mj)(w,this,D).call(this,{kind:"publish",key:t.key,value:n.value,timestamp:n.modifiedTimestamp,clientId:n.lastWriterClientId,route:[(0,e.y1)(y,this)],toClientId:t.clientId});const a={...t,route:[...null!==(i=t.route)&&void 0!==i?i:[],(0,e.y1)(y,this)]};void 0!==t.toClientId?(0,e.mj)(w,this,D).call(this,a):(0,e.mj)(w,this,O).call(this,a),null===(s=(0,e.y1)(h,this))||void 0===s||s.send(a)}function T(t,i){var s;const n=(0,e.y1)(I,this).get(t);if(void 0===n)return void(0,o.P)("No port for handshake message",t);for(const s of i.subscriptions)(0,e.mj)(w,this,V).call(this,{key:s.key,portId:t,timestamp:s.timestamp,clientId:s.clientId,subscriptionId:s.subscriptionId});const a=[],c=[];for(const t of i.retainedValues){var d;const i=(0,e.y1)(f,this).get(t.key);void 0!==i&&i.modifiedTimestamp>=t.timestamp?a.push({key:t.key,value:i.value,timestamp:i.modifiedTimestamp,clientId:i.lastWriterClientId}):((0,e.y1)(f,this).set(t.key,{value:t.value,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null===(d=(0,e.y1)(p,this))||void 0===d||d.set(t.key,t.value),c.push({key:t.key,value:t.value,timestamp:t.timestamp,clientId:t.clientId}))}n.outbound({kind:"handshake-ack",id:i.id,newerRetainedValues:a}),null===(s=(0,e.y1)(h,this))||void 0===s||s.send(i);for(const t of c)(0,e.mj)(w,this,O).call(this,{kind:"publish",key:t.key,value:t.value,timestamp:t.timestamp,clientId:t.clientId,route:[(0,e.y1)(y,this)],excludeSubscriptionIds:i.subscriptions.map((t=>t.subscriptionId))})}function P(t,i){var s;(0,e.y1)(b,this).has(i.subscriptionId)?(0,o.P)("Subscription with this id already exists",i.subscriptionId):((0,e.mj)(w,this,V).call(this,{portId:t,...i}),void 0!==i.retain&&(0,e.mj)(w,this,x).call(this,i,i.retain.value,t),null===(s=(0,e.y1)(h,this))||void 0===s||s.send(i))}function V(t){const i={key:t.key,portId:t.portId,timestamp:t.timestamp,clientId:t.clientId};(0,e.y1)(b,this).set(t.subscriptionId,i);let s=(0,e.y1)(k,this).get(t.key);void 0===s&&(s=new Set,(0,e.y1)(k,this).set(t.key,s)),s.add(t.subscriptionId)}function x(t,i,s){var n,o,a,c;if("write"===(null===(n=t.retain)||void 0===n?void 0:n.kind)&&t.timestamp>(null!==(o=null===(a=(0,e.y1)(f,this).get(t.key))||void 0===a?void 0:a.modifiedTimestamp)&&void 0!==o?o:Number.MIN_SAFE_INTEGER)&&!d(i,null===(c=(0,e.y1)(f,this).get(t.key))||void 0===c?void 0:c.value)){var l;(0,e.y1)(f,this).set(t.key,{value:i,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null===(l=(0,e.y1)(p,this))||void 0===l||l.set(t.key,i);void 0!==(0,e.y1)(I,this).get(s)&&(0,e.mj)(w,this,O).call(this,{kind:"publish",key:t.key,value:i,timestamp:t.timestamp,clientId:t.clientId,route:[(0,e.y1)(y,this)],excludeSubscriptionIds:[t.subscriptionId]})}else{const n=(0,e.y1)(f,this).get(t.key);if(void 0===n)return;void 0===(0,e.y1)(I,this).get(s)||d(i,n.value)||(0,e.mj)(w,this,E).call(this,{kind:"publish",key:t.key,value:n.value,timestamp:n.modifiedTimestamp,clientId:n.lastWriterClientId,route:[(0,e.y1)(y,this)],toSubscriptionId:t.subscriptionId})}}function A(t,i){var s;const n=(0,e.y1)(b,this).get(i.subscriptionId);if(void 0===n)return void(0,o.P)("No subscription with this id",i.subscriptionId);if(n.portId!==t)return void(0,o.P)("Subscription does not belong to this port",i.subscriptionId,t);(0,e.y1)(b,this).delete(i.subscriptionId);const a=(0,e.y1)(k,this).get(n.key);var c;void 0!==a&&(a.delete(i.subscriptionId),0===a.size&&((0,e.y1)(k,this).delete(n.key),(0,e.y1)(f,this).delete(n.key),null===(c=(0,e.y1)(p,this))||void 0===c||c.delete(n.key)));null===(s=(0,e.y1)(h,this))||void 0===s||s.send(i)}function E(t){const i=(0,e.y1)(b,this).get(t.toSubscriptionId);if(void 0===i)return void(0,o.P)("No subscription with this id",t.toSubscriptionId);const s=(0,e.y1)(I,this).get(i.portId);void 0!==s?s.outbound(t):(0,o.P)("No port for subscription with this id",t.toSubscriptionId)}function D(t){const i=(0,e.mj)(w,this,B).call(this,t.key,t.toClientId,void 0);for(const s of i)s.outbound(t)}function O(t){const i=(0,e.mj)(w,this,B).call(this,t.key,void 0,t.excludeSubscriptionIds);for(const s of i)s.outbound(t)}function B(t,i,s){const n=new Set,o=(0,e.y1)(k,this).get(t);for(const t of null!=o?o:[]){if(s&&s.includes(t))continue;const o=(0,e.y1)(b,this).get(t);if(void 0===o)continue;if(void 0!==i&&i!==o.clientId)continue;const a=(0,e.y1)(I,this).get(o.portId);void 0!==a&&n.add(a)}return n}var N=new WeakMap,R=new WeakMap,_=new WeakMap,z=new WeakMap,F=new WeakMap,G=new WeakMap,q=new WeakSet;class J{constructor(t){var i;(0,e.Rh)(this,q),(0,e.sv)(this,N,new DisposableStack),(0,e.sv)(this,R,void 0),(0,e._x)(this,"portId",void 0),(0,e.sv)(this,_,void 0),(0,e.sv)(this,z,(0,e.y1)(N,this).use(new a.x)),(0,e.sv)(this,F,[]),(0,e.sv)(this,G,void 0),(0,e.SH)(_,this,t.send),(0,e.SH)(G,this,t.shouldBufferMessages),(0,e.y1)(N,this).defer((()=>t.notifyDispose())),(0,e.SH)(R,this,null!==(i=t.tracingOptions)&&void 0!==i?i:{enabled:!1}),this.portId=t.portId}send(t){(0,e.mj)(q,this,L).call(this,"inbound",t),(0,e.y1)(G,this)&&"handshake"!==t.kind?(0,e.y1)(F,this).push(t):((0,e.mj)(q,this,K).call(this),(0,e.y1)(_,this).call(this,t))}subscribe(t){const i=new DisposableStack;return(0,e.y1)(N,this).defer((()=>i.dispose())),i.use((0,e.y1)(z,this).subscribe({next:t,complete:()=>i.dispose()})),i}[Symbol.dispose](){(0,e.y1)(N,this).dispose()}outbound(t){(0,e.mj)(q,this,L).call(this,"outbound",t),(0,e.y1)(z,this).next(t)}setBufferingEnabled(t){(0,e.SH)(G,this,t),t||(0,e.mj)(q,this,K).call(this)}}function K(){if((0,e.y1)(F,this).length>0){for(const t of(0,e.y1)(F,this))(0,e.y1)(_,this).call(this,t);(0,e.y1)(F,this).length=0}}function L(t,i){if((0,n.r)()&&(0,e.y1)(R,this).enabled){var s;const n="[37minbound[0m",o="[37moutbound[0m",[a,...c]=function(t){const i=t=>"[36m".concat(t,"[0m"),s=t=>"[37m".concat(t,"[0m");switch(t.kind){case"publish":return["".concat(s("publish")," ").concat(i(t.key)),t.value];case"subscribe":{const e="".concat(s("subscribe")," ").concat(i(t.key)," ").concat(s("subId")," ").concat(i(t.subscriptionId));return t.retain?[e,t.retain]:[e]}case"unsubscribe":return["".concat(s("unsubscribe")," ").concat(s("subId")," ").concat(i(t.subscriptionId))];case"handshake":return["".concat(s("handshake")," ").concat(i(t.id)),{subscriptions:t.subscriptions,retainedValues:t.retainedValues}];case"handshake-ack":return["".concat(s("handshake-ack")," ").concat(i(t.id)),{newerRetainedValues:t.newerRetainedValues}]}}(i);console.debug("%cMessageBusPort%c ".concat(function(t){const[i,s]=t.split("|");return s}(this.portId)," ").concat("inbound"===t?n:o,"%O\n\t").concat(a),"color: ".concat(null!==(s=(0,e.y1)(R,this).color)&&void 0!==s?s:"blue",";"),"color: initial;",i,...c)}}class Q extends S{constructor(t){super(t)}}}}]);