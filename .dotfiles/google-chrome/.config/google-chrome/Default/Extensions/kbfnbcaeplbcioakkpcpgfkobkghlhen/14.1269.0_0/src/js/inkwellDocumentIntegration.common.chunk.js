(self.webpackChunk=self.webpackChunk||[]).push([[5643],{86255:(e,t,i)=>{i.d(t,{v:()=>w});var n=i(18647),s=i(78767),r=i(40594),o=i(96379),c=i(90023),a=i(13391),l=i(32073),u=i(59179),d=i(20161),p=i(84714),g=i(81933),h=i(954),m=i(24666),v=i(2187),f=i(58303),x=i(93865);const b=i(20905).E0;class k{constructor(e){this._params=e,this._subscription=new l.w0,this._selection=a.h.create(null),this.selection=this._selection.view(),this._subscription.add(e.selectionOrCaretPosition.pipe(u.U((e=>f.WG(e))),d.w((e=>e?p.of(e):g.timer(b).pipe(u.U((()=>this._getCurrentSelection())),h.O(this._getCurrentSelection()),m.x())))).subscribe(v.wW(this._selection)))}_getCurrentSelection(){return(0,c.zG)(this._params.selectionService.getCurrentSelection(),x.Ey)}setSelection(e){this._params.selectionService.setSelection(e)}dispose(){this._subscription.unsubscribe()}}var y=i(39214),_=i(67612);class S{constructor(e){this._params=e,this.getDocumentText=()=>this._params.getCurrentTextMap().getRichText(),this.getDocumentGeometry=()=>{const e=_.i.getVisibleTextRange(this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryProvider,this._params.geometryLayout),t=_.i.getTextFieldBoundingBox(this._params.textField,this._params.textFieldLayout);return e?{visibleTextRange:e,documentFrame:t}:{documentFrame:t}},this.getBoundingBoxesForTextRanges=e=>_.i.getBoundingBoxesForTextRanges(e,this._params.textField,this._params.originalTextField,this._params.doc,this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryLayout,this._params.geometryProvider),this.setDocumentSelectedTextRange=e=>this._params.selectionService.setSelection(e),this.applyChangesToDocument=e=>{const t=(0,y.g)(e,!0);return this._params.replacementService.performBatchReplacements(t).then((t=>({changes:e,status:t})))}}}class w{constructor(e){var t;this._log=r.Y.create("ConnectorDependenciesImpl"),this._disposableList=[];const i=(0,n.Me)(e.textField);this.target={documentID:s.iy.create(),documentUrl:i.location.href,textField:e.textField,originalTextField:e.originalTextField},this.textRevisionManager=o.X.create(e.textObserver,e.createTextRevisionManager),this.selectionService=new k({selectionService:e.selectionService,selectionOrCaretPosition:e.selectionOrCaretPosition});const c=null!==(t=e.geometryLayout)&&void 0!==t?t:e.integrationLayout.createGeometryLayout();this.connectorHandler=new S({doc:i,replacementService:e.replacementService,textRevisionManager:this.textRevisionManager,geometryLayout:c,selectionService:this.selectionService,textField:e.textField,textFieldLayout:e.integrationLayout.textField,originalTextField:e.originalTextField,geometryProvider:e.geometryProvider,getCurrentTextMap:()=>e.textObserver.getCurrentTextMap()}),this._disposableList.push(this.selectionService)}dispose(){(0,s.jD)(this._disposableList,this._log)}}},67612:(e,t,i)=>{i.d(t,{i:()=>n});var n,s=i(90023),r=i(90646),o=i(63310),c=i(3944),a=i(78767),l=i(82485);!function(e){function t(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function i(e){const t=e.rect.getCurrent();return{left:t.client.left,top:t.client.top,width:t.size.width,height:t.size.height}}function n(e){const t=e.visibleRect.getCurrent(),i=e.rect.getCurrent(),n=e.scroll.getCurrent(),s=(0,r.jg)(t,i);return s?(0,r.Li)(s,i,n):null}function u(e,t,i,n,s){var r;const c=n.create(e,t);return c?Array.from(null!==(r=n.getClientRects(c))&&void 0!==r?r:[]).filter((e=>e.height>0&&e.width>0)).map((e=>o.UL.setPosition(s.clientToRelative(e),e))).filter((e=>o.UL.contains(e,i))):[]}function d(e,t,i){return[[e.left,e.top+e.height],[e.left+e.width,e.top+e.height]].map((([e,i])=>t.elementFromPoint(e,i))).every((e=>i.some((t=>e===t||t.contains(e)))))}function p(e){return Object.fromEntries(Object.keys(e).map((e=>[e,[]])))}e.getZoomedBoundingBox=function(e,t){return{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t}},e.getTextFieldBoundingBox=function(e,n){const s=i(n),r=(0,c.k6)(e);if(!r)return t(s);const a=o.UL.getIntersection(s,r);return t(a?{...a,top:s.top,height:s.height}:s)},e.getRelativeVisibleTextFieldRect=n,e.getVisibleRelativeRectsForTextRange=u,e.getVisibleTextRange=function(e,t,i,s){let r=null;const o=e.getPlainText(),c=n(t);if(!c||!o.length)return r;const a=s.getCurrentConversionContext();for(let t=0;t<o.length;t++){if(u({start:t,end:t+1},e,c,i,a).length>0)r={start:null===r?t:r.start,end:t+1};else if(r&&(0,l.qE)(o.substring(t,t+1)))break}return r},e.isRectElementOnDocumentTop=d,e.createEmptyBoundingBoxesForTextField=p,e.getBoundingBoxesForTextRanges=function(e,r,c,l,g,h,m,v){const f=n(h);if(!f)return p(e);const x=m.getCurrentConversionContext(),b=i(h),k=t(b),y=h.scroll.getCurrent(),_={left:b.left-y.left,top:b.top-y.top},S={left:k.x-y.left,top:k.y-y.top};return Object.fromEntries(Object.entries(e).map((([e,i])=>[e,u(i,g,f,v,x).filter((e=>d(o.UL.shift(e,_),l,[r,c].filter(a.fQ)))).map((e=>(0,s.zG)(o.UL.shift(e,S),t)))])))}}(n||(n={}))},96379:(e,t,i)=>{i.d(t,{X:()=>n});var n,s=i(90572),r=i(15213),o=i(40866);!function(e){e.create=function(e,t=r.n.create){const i=t({getTextSource:()=>e.getTextSource(),getCurrentTextMap:()=>e.getCurrentTextMap(),dispose:()=>e.dispose(),textMapChanged:e.textMapChanged,contentChanges:{async:e.contentChanges.async.pipe(s.h((e=>e.changes.length>0))),immediate:e.contentChanges.immediate.pipe(s.h((e=>e.changes.length>0)))}});return{revisionChanges:i.revisionChanges,getLatestVersionNumber:()=>o.Q.getRevisionNumber(i.getLatestRevision().id),dispose:()=>i.dispose()}}}(n||(n={}))},26215:(e,t,i)=>{i.r(t),i.d(t,{InkwellDocumentIntegrationImpl:()=>R});var n=i(92379),s=i(48546),r=i(32073),o=i(32734),c=i(20680),a=i(79256),l=i(50750),u=i(84308),d=i(90572),p=i(84178),g=i(20161),h=i(59179),m=i(24666),v=i(64271),f=i(84714),x=i(954),b=i(86255),k=i(25714);class y{constructor(e){this._shouldMeasure=e}rxMeasure(e,t){return this._shouldMeasure?k.d5.measure(this.callMeasure(e,t)):k.d5.doNothing}callMeasure(e,t){return i=>{if(this._shouldMeasure){const n=y._eventIndex++,s=performance.mark(`Ink_${e}${n}_start`);try{i()}finally{const i=performance.mark(`Ink_${e}${n}_end`),r=performance.measure(`Ink_${e}${n}_duration`,{start:s.name,end:i.name,detail:{devtools:{dataType:"track-entry",track:"Inkwell Extension",trackGroup:"Inkwell",color:"tertiary-dark",tooltipText:`Inkwell ${e}`}}});t&&t({eventName:e,start:s.startTime,end:i.startTime,duration:r.duration})}}else i()}}}y._eventIndex=0;var _=i(78767),S=i(67385),w=i(40866),C=i(40594),T=i(59706);class R{constructor(e){this._logger=C.Y.create(`Inkwell/${R.name}`),this._disposed=!1,this._subscriptions=new r.w0,this._disposables=[];const t=new y(e.measurePerformance),i=new b.v(e),n=e.inkwellPageDynamicService.getSingletonInstance(),g=this._getCAPIMessages(e.checkingService).pipe(o.B());let h=!0;const m=[];this._subscriptions.add(g.subscribe((e=>{h&&m.push(e)})));const v=c.z(a.P((()=>{const e=l.D([...m]);return h=!1,m.length=0,e})),g).pipe(t.rxMeasure("capiMessage")),f=u.a([(0,s.n)(e.checkingService.pipe(d.h(_.C_),p.q(1))),n]).pipe(t.rxMeasure("deps"));this._subscriptions.add(f.subscribe((([n,s])=>{this._disposables.push(s.connectDocument({connectorDependencies:i,capiMessages:v,checkingService:n,alertProcessor:e.alertProcessor,isFieldFocused:e.isFieldFocused,textFieldLayout:e.integrationLayout.textField,perf:t}))})))}getDecorationsUI(){return n.createElement("div",null)}dispose(e){this._disposed||(this._disposed=!0,(0,_.jD)(this._disposables,this._logger),this._subscriptions.unsubscribe())}_getCAPIMessages(e){return e.pipe(d.h(_.C_),g.w((e=>e.capiMessages.pipe(d.h((e=>"start"===e.action)),g.w((t=>{const i=t.sessionUuid,n=e.checkingRevisionInfo.pipe(h.U((e=>({kind:"capiTextRevision",sessionId:i,capiTextRevision:w.Q.getRevisionNumber(e.revision)}))),m.x(((e,t)=>e.capiTextRevision===t.capiTextRevision))),s=e.readyState.pipe(d.h((e=>e===S.kQ.disconnected)),h.U((()=>({kind:"capiDisconnected",sessionId:i}))));return v.T(c.z(f.of(t),e.capiMessages.pipe(d.h((e=>!T.j9.has(e.action))))).pipe(h.U((e=>({kind:"capiMessage",sessionId:i,message:e}))),x.O({kind:"capiConnected",sessionId:i})),n,s)}))))))}}},59706:(e,t,i)=>{i.d(t,{C2:()=>m,j9:()=>g,n7:()=>v,yU:()=>h});var n=i(32103),s=i(32073),r=i(50750),o=i(20161),c=i(8065),a=i(84714),l=i(59179),u=i(12518),d=i(40594),p=i(11686);const g=new Set(["sdui:add","sdui:update","sdui:remove"]);class h{constructor(e){this._params=e,this._log=d.Y.create(`Inkwell/${h.name}/dId[${this._params.documentID}]`),this._subs=new s.w0,this._subs.add(this._subscribeToCAPIMessages())}dispose(){this._subs.unsubscribe()}async sendCapiMessage(e){try{const t=await this._params.checkingService.sendMessage(e.message.action,e.message,!0)();if(u.nM(t))throw t.left}catch(e){this._log.error("Unexpected error calling checkingService.sendMessage",e)}}capiWebSocketOpened(e){return Promise.resolve()}capiWebSocketClosed(e){return Promise.resolve()}capiWebSocketMessage(e){return Promise.resolve()}capiWebSocketError(e){return Promise.resolve()}_subscribeToCAPIMessages(){return r.D(this._params.inkwellCapiAPI).pipe(o.w((e=>this._params.capiMessages.pipe(c.b((e=>"capiTextRevision"===e.kind?a.of(this._params.getTextRevision()).pipe(l.U((t=>({...e,documentTextRevision:t})))):a.of(e))),l.U((t=>({message:t,capiToInkwell:e}))))))).subscribe((({message:e,capiToInkwell:t})=>{switch(e.kind){case"capiConnected":this._logRejections((()=>t.capiConnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiConnected");break;case"capiDisconnected":this._logRejections((()=>t.capiDisconnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiDisconnected");break;case"capiTextRevision":this._logRejections((()=>t.capiTextRevision({sessionID:e.sessionId,documentRevision:e.documentTextRevision,capiRevision:e.capiTextRevision})),"Unexpected rejection from capiToInkwell.capiTextRevision");break;case"capiMessage":this._logRejections((()=>t.capiMessageReceived({sessionID:e.sessionId,message:e.message})),"Unexpected rejection from capiToInkwell.capiMessageReceived");break;default:(0,n.L0)(e)}}))}_logRejections(e,t){e().catch((e=>this._log.error(t,e)))}}function m(e,t){return{capiConnected:(0,p.i)(e,t.capiConnected),capiDisconnected:(0,p.i)(e,t.capiDisconnected),capiMessageReceived:(0,p.i)(e,t.capiMessageReceived),capiAlertRemoved:(0,p.i)(e,t.capiAlertRemoved),capiTextRevision:(0,p.i)(e,t.capiTextRevision),capiWebSocketCreate:(0,p.i)(e,t.capiWebSocketCreate),capiWebSocketClose:(0,p.i)(e,t.capiWebSocketClose),capiWebSocketConnect:(0,p.i)(e,t.capiWebSocketConnect),capiWebSocketSend:(0,p.i)(e,t.capiWebSocketSend)}}function v(e){return{sendCapiMessage:(0,p.O)((async t=>(await e(t)).sendCapiMessage)),capiWebSocketOpened:(0,p.O)((async t=>(await e(t)).capiWebSocketOpened)),capiWebSocketClosed:(0,p.O)((async t=>(await e(t)).capiWebSocketClosed)),capiWebSocketMessage:(0,p.O)((async t=>(await e(t)).capiWebSocketMessage)),capiWebSocketError:(0,p.O)((async t=>(await e(t)).capiWebSocketError))}}},11686:(e,t,i)=>{function n(e,t){return async i=>null===i?await t(null):await t({...i,documentID:e})}function s(e){return async t=>{const i=await e(t.documentID),n=await i(t);return{documentID:t.documentID,...n}}}i.d(t,{O:()=>s,i:()=>n})},25009:(e,t,i)=>{if(i.d(t,{Fb:()=>h,PF:()=>g,TY:()=>l,_V:()=>p,eg:()=>d,um:()=>a,yj:()=>u}),3075==i.j)var n=i(59179);if(3075==i.j)var s=i(24666);if(3075==i.j)var r=i(32103);if(3075==i.j)var o=i(49629);if(3075==i.j)var c=i(3944);var a,l,u;function d(e){if((0,c.uz)(e))return{mode:a.view};const t=(0,c.lW)(e);return t||((0,c.e$)(e)?{mode:a.noEditAccess}:{mode:a.edit})}!function(e){e.view="view",e.noEditAccess="noEditAccess",e.history="history",e.edit="edit"}(a||(a={})),function(e){e[e.ownDoc=0]="ownDoc",e[e.sharedDoc=1]="sharedDoc",e[e.noEditAccessDoc=2]="noEditAccessDoc"}(l||(l={})),function(e){e.read="read",e.write="write"}(u||(u={}));function p(e){return o.S.hz4.pipe((0,n.U)((()=>d(e))),(0,s.x)(((e,t)=>{return n=t,(i=e).mode===a.history&&n.mode===i.mode?i.subtype===n.subtype:i.mode===n.mode;var i,n})))}function g(e,t){return e?l.ownDoc:t?l.noEditAccessDoc:l.sharedDoc}function h(e,t,i,n){if(e.mode!==a.edit)return u.read;switch(t){case l.ownDoc:return u.write;case l.noEditAccessDoc:return u.read;case l.sharedDoc:return function(e,t,i){const n=!t&&!i;if(e.mode!==a.edit||n)return u.read;return u.write}(e,i,n);default:return(0,r.L0)(t)}}},3944:(e,t,i)=>{if(i.d(t,{LJ:()=>b,Nd:()=>u,Ov:()=>x,TW:()=>C,Ur:()=>d,Xs:()=>T,e$:()=>S,eg:()=>w,fN:()=>h,k6:()=>v,kh:()=>g,lW:()=>_,lz:()=>m,qg:()=>l,uj:()=>a,uz:()=>f}),3075==i.j)var n=i(90189);if(3075==i.j)var s=i(90595);if(3075==i.j)var r=i(36769);if(3075==i.j)var o=i(25009);var c=i(7833);function a(e){const t=(0,r.Cq)(e.querySelector(c.XG),"text buffer iframe");return(0,r.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function l(e){const t=u(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function u(e){return e.querySelector(c.Wp)}function d(e,t,i){return t?function(e,t){if(t&&p(t))return t;const i=e.querySelectorAll(c.Qy);for(const e of i)if(p(e))return e;return null}(e,i):e.querySelector(c.Qy)}const p=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function g(e){return e.querySelectorAll(c.gH)}function h(e){return e.querySelector(c.gH)}function m(e){return Boolean(e.querySelector(c.gH))}function v(e){let t=e.querySelector(c.os);return t||(t=document.querySelector(c.gH)),t?t.getBoundingClientRect():null}const f=e=>!!e.querySelector(c.Lq);function x(e){return e.querySelector(c.$x)}function b(e){return null==e?void 0:e.querySelector(c.y1)}var k;!function(e){e.legacy="legacy",e.modern="modern"}(k||(k={}));const y=e=>"versionHistorySidebarWizSelector"===e.id||e.getBoundingClientRect().top>0?k.modern:k.legacy;function _(e){let t=e.querySelector(c.f);const i=(0,n.OB)().experimentClient.isGateEnabled(s.K.GDocsVersionHistorySidebarSelector);!t&&i&&(t=e.querySelector(c.q6));return!!t&&t.offsetHeight>0&&t.offsetWidth>0&&t?{mode:o.um.history,subtype:y(t)}:null}function S(e){return!!e.querySelector(`${c.jW}, ${c.F8}`)}function w(){const e=document.querySelector(c.d0),t=(null==e?void 0:e.classList.contains(c.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(c._m))?"suggesting":void 0;return t||i||"other"}function C(e){return e.querySelector(c.QR)}function T(e){return e.querySelector(c.ij)}},7833:(e,t,i)=>{i.d(t,{$:()=>O,$x:()=>o,Cw:()=>$,F8:()=>x,Fh:()=>U,G$:()=>P,Go:()=>s,Jk:()=>B,Kt:()=>w,Lq:()=>p,Q:()=>L,Q6:()=>a,QO:()=>F,QR:()=>D,Qy:()=>k,Vk:()=>C,Wp:()=>n,XG:()=>r,_m:()=>m,d0:()=>g,f:()=>u,fD:()=>q,gH:()=>b,gL:()=>T,gv:()=>l,ij:()=>I,j5:()=>S,jW:()=>f,l$:()=>v,lO:()=>M,os:()=>_,q6:()=>d,qz:()=>j,rx:()=>R,tN:()=>W,uj:()=>h,wY:()=>A,y1:()=>c,yv:()=>E,yw:()=>y});const n=".kix-appview-editor",s=".docos-input",r=".docs-texteventtarget-iframe",o=".kix-cursor",c=".kix-cursor-caret",a="#docs-butterbar-container",l="docs-butterbar-container-compact",u="#docs-revisions-sidebar",d="#docs-wiz-sidebar-placeholder",p='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',g="#docs-toolbar-mode-switcher",h="edit-mode",m="suggest-mode",v="titlebar-mode-indicator-container",f="#titlebar-mode-indicator-container .titlebar-request-access-button",x="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",b="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",k=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",y=".kix-page-paginated",_=".kix-page-paginated.canvas-first-page",S=".docs-horizontal-ruler",w=".docs-vertical-ruler",C="#fontSizeSelect input",T=".docs-ruler-background",R=".docs-ruler-background-inner",M=".docs-ruler-indent-first-line",I=".modal-dialog.docs-dialog .fatal-error-message",D='#docs-titlebar-share-client-button div[role="button"]',F=".kix-ai-text-generator-preview-view-insert-button",j=".kix-ai-text-generator-preview-view",E=".kix-ai-text-generator-prompt-view",L="textarea.kix-ai-text-generator-prompt-view-input",W=".kix-ai-text-generator-preview-view-generated-text",q=".appsElementsSidekickFeedContainer",O=".appsElementsSidekickUserMessageBubbleContent",P=".appsElementsSidekickUserMessageRoot",U=".appsElementsSidekickAgentMessageBubbleContent",A=".appsElementsSidekickAgentMessageRoot",B="li.appsElementsGenerativeaiAstAnimated",$="span.appsElementsGenerativeaiAstAnimated:not(li span)"}}]);