(self.webpackChunk=self.webpackChunk||[]).push([[4143],{5644:(e,t,n)=>{var o,i,d,s;n.d(t,{C:()=>o,P:()=>s}),i=o||(o={}),(d=i.Kind||(i.Kind={})).markAsAddedButtonClick="markAsAddedButtonClick",d.dismissButtonClick="dismissButtonClick",d.generateCitationButtonClick="generateCitationButtonClick",d.cardShow="cardShow",i.markAsAddedButtonClick=function(e){return{kind:"markAsAddedButtonClick",pushedContentItemId:e}},i.dismissButtonClick=function(e){return{kind:"dismissButtonClick",pushedContentItemId:e}},i.generateCitationButtonClick=function(e){return{kind:"generateCitationButtonClick",pushedContentItemId:e}},i.cardShow=function(e){return{kind:"cardShow",pushedContentItemId:e}},(e=>{var t;(t=e.Kind||(e.Kind={})).openUphook="openUphook",t.trackUphook="trackUphook",t.textTooShortViewMounted="textTooShortViewMounted",t.scoresLoadingViewMounted="scoresLoadingViewMounted",t.scoresLoadedViewMounted="scoresLoadedViewMounted",t.loadingLockedViewMounted="loadingLockedViewMounted",t.lockedViewMounted="lockedViewMounted",e.openUphook=function(e){return{kind:"openUphook",paywallUphook:e}},e.trackUphook=function(e,t){return{kind:"trackUphook",paywallUphook:e,event:t}},e.textTooShortViewMounted=function(){return{kind:"textTooShortViewMounted"}},e.scoresLoadingViewMounted=function(){return{kind:"scoresLoadingViewMounted"}},e.scoresLoadedViewMounted=function(){return{kind:"scoresLoadedViewMounted"}},e.loadingLockedViewMounted=function(){return{kind:"loadingLockedViewMounted"}},e.lockedViewMounted=function(){return{kind:"lockedViewMounted"}}})(s||(s={}))},4143:(e,t,n)=>{n.r(t),n.d(t,{activate:()=>Y});var o,i,d,s,a,c,r,u,l=n(8867),p=n(90572),k=n(84178),h=n(59179),w=n(20161),C=n(84714),g=n(50750),S=n(66878),m=n(36344),v=n(63532),b=n(954),f=n(32073),V=n(98189),P=n(78129),M=n(18827),L=n(84308),I=n(29416),K=n(13391),A=n(79984),U=n(32103),y=n(42203),B=n(64443),D=n(6619),E=n(5644),x=n(90023),T=n(96333),O=n(67177),W=n(12518),G=n(55663),z=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),R=e=>{throw TypeError(e)},_=(e,t,n)=>t.has(e)||R("Cannot "+n),q=(e,t,n)=>(_(e,t,"read from private field"),n?n.call(e):t.get(e)),j=(e,t,n)=>t.has(e)?R("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),H=(e,t,n,o)=>(_(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);function Z(e){return new l.y((t=>(t.next(e),()=>e[Symbol.dispose]())))}class ${constructor(e){j(this,o),j(this,i),H(this,o,new DisposableStack),H(this,i,K.h.create(D.S.Locked.initial())),this.state=q(this,i).view(),q(this,o).adopt(K.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,p.h)(Boolean),(0,k.q)(1),(0,h.U)((()=>e.paywallConfig.get())),(0,w.w)((t=>(t?(0,C.of)(t):(0,g.D)(e.uphookHubClient.getUphookConfig("aiDetectorAgentPanelPaywall")).pipe((0,S.K)((t=>(e.logger.error("Error while fetching uphook config",t),m.E))),(0,p.h)(y.C_),(0,v.b)((t=>e.paywallConfig.set(t))))).pipe((0,h.U)((e=>D.S.Locked.uphookConfigResolved(e))),(0,b.O)((0,x.zG)(e.paywallConfig.get(),(e=>e?D.S.Locked.uphookConfigResolved(e):D.S.Locked.uphookConfigRequested()))))))).subscribe((e=>q(this,i).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){q(this,o).dispose()}}o=new WeakMap,i=new WeakMap;class F{constructor(e){j(this,d),j(this,s),H(this,d,new DisposableStack),H(this,s,K.h.create(D.S.Unlocked.Enabled.initial())),this.state=q(this,s).view();const t=q(this,d).adopt(new f.w0,(e=>e.unsubscribe())),n=e.capiConnectionStatus.view((e=>"connected"===e.kind?e.sessionId:null)).pipe((0,V.n)((e=>null===e)));t.add(n.pipe((0,w.w)((t=>null===t?m.E:K.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,b.O)(null),(0,P.G)(),(0,w.w)((([t,n])=>n?function(e,t){return new l.y((n=>{(0,x.zG)(e.request({commandId:"start",payload:"",agentId:D.A}),O.Vn((e=>(t.error("Error while starting checks",e),e))))().then((e=>{W.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):t?function(e,t){return new l.y((n=>{(0,x.zG)(e.request({commandId:"stop",payload:"",agentId:D.A}),O.Vn((e=>(t.error("Error while stopping checks",e),e))))().then((e=>{W.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):m.E)),(0,S.K)((()=>m.E)))))).subscribe());const o=K.h.create(new Set);t.add(e.cardActions.subscribe((e=>{if(e.kind===E.C.Kind.markAsAddedButtonClick)return o.modify((t=>new Set(t).add(e.pushedContentItemId)))})));const i=K.h.create(!1);t.add(e.capiConnectionStatus.view((e=>"disconnected"===e.kind)).pipe((0,p.h)(Boolean),(0,w.w)((()=>e.capiConnectionStatus.pipe((0,p.h)((e=>"connected"===e.kind)),(0,k.q)(1),(0,M.g)(500),(0,h.U)((()=>!1)),(0,b.O)(!0))))).subscribe((e=>i.set(e))));const a=K.h.combine(e.capiCheckingState.asyncScores.view("ai_detector").view((e=>(null==e?void 0:e.outcomeScores.ai_detector_score)??null)),i,((e,t)=>t?null:e)),c=K.h.combine(a,e.capiCheckingState.asyncCheckingState.view("ai_detector").view((e=>"idle"!==e)),e.pushedContentService.getCollection(G.i).view((e=>T.$.values(e).filter(G.i))),((e,t,n)=>null!==e?{aiDetectorScorePercent:e,checkingInProgress:t,pushedContentItemIds:new Set(n.map((e=>e.contentId)))}:null));t.add((0,L.a)([e.capiConnectionStatus,c,c.pipe((0,p.h)(y.C_)),o]).pipe((0,h.U)((([e,t,n,o])=>[e,t??n,o]))).subscribe((([t,{aiDetectorScorePercent:n,checkingInProgress:o,pushedContentItemIds:i},d])=>{e.onContentStateChanged({remainingSuggestionCount:i.size,citedSuggestionCount:d.size,aiDetectorScorePercent:n}),q(this,s).set(D.S.Unlocked.Enabled.scoresReceived(d,i,n,o||"connected"!==t.kind))})))}[Symbol.dispose](){q(this,d).dispose()}}d=new WeakMap,s=new WeakMap;class J{constructor(e){j(this,a),j(this,c),H(this,a,new DisposableStack),H(this,c,K.h.create(D.S.Unlocked.initial())),this.state=q(this,c).view();const t=Z(new F(e)).pipe((0,w.w)((e=>e.state)),(0,h.U)((e=>({kind:D.S.Unlocked.Kind.Enabled,enabledState:e}))));q(this,a).adopt(e.wordCount.pipe((0,p.h)(y.C_),(0,k.q)(1),(0,h.U)(D.i),(0,w.w)((n=>n?t:e.wordCount.pipe((0,p.h)(D.i),(0,k.q)(1),(0,w.w)((()=>t)),(0,b.O)(D.S.Unlocked.textTooShort())))),(0,b.O)(null===e.wordCount.get()||(0,D.i)(e.wordCount.get())?D.S.Unlocked.initial():D.S.Unlocked.textTooShort())).subscribe((e=>q(this,c).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){q(this,a).dispose()}}a=new WeakMap,c=new WeakMap;class N{constructor(e){j(this,r),j(this,u),H(this,r,new DisposableStack),H(this,u,K.h.create(D.S.initial())),this.state=q(this,u).view();const t=e.userService.user.view("free");q(this,r).adopt(t.pipe((0,w.w)((t=>t?Z(new $(e)).pipe((0,w.w)((e=>e.state)),(0,h.U)((e=>({kind:D.S.Kind.Locked,lockedState:e})))):Z(new J(e)).pipe((0,w.w)((e=>e.state)),(0,h.U)((e=>({kind:D.S.Kind.Unlocked,unlockedState:e}))))))).subscribe((e=>q(this,u).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){q(this,r).dispose()}}r=new WeakMap,u=new WeakMap;var Q=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(Q||{}),X=(e=>(e.TextTooShortView="agentPanel/aiDetector/textTooShortView",e.ScoresLoadingView="agentPanel/aiDetector/scoresLoadingView",e.ScoresLoadedView="agentPanel/aiDetector/scoresLoadedView",e.LoadingLockedView="agentPanel/aiDetector/loadingLockedView",e.LockedView="agentPanel/aiDetector/lockedView",e.PanelContentReceived="agentPanel/aiDetector/panelContentReceived",e.MarkAsAddedButton="agentPanel/aiDetector/markAsAddedButton",e.DismissButton="agentPanel/aiDetector/dismissButton",e.GenerateCitationButton="agentPanel/aiDetector/generateCitationButton",e.Card="agentCard/aiDetector",e))(X||{});const Y=async({bus:e,userService:t,document:n,pushedContentService:o,capiConnectionStatus:i,capiCheckingState:d,navigation:s,uphookHubClient:a,environment:c,agentGenericService:r,trackingServiceProvider:u})=>{var l=[];try{const g=((e,t,n)=>{var o;return null!=t?("object"!=typeof t&&"function"!=typeof t&&R("Object expected"),n&&(o=t[z("asyncDispose")]),void 0===o&&(o=t[z("dispose")]),"function"!=typeof o&&R("Object not disposable"),e.push([n,o,t])):n&&e.push([n]),t})(l,new DisposableStack),S=g.adopt(new f.w0,(e=>e.unsubscribe())),v=B.C8.Logging.getLogger("AiDetectorAgent"),b=g.use(e.state.panelState.create(n.id,D.S.initial())),V=g.use(e.state.paywallConfig.create(null)),P=u.getTrackingService(),M=K.h.create(null),x=g.use(new N({agentGenericService:r,uphookHubClient:a,userService:t,capiCheckingState:d,pushedContentService:o,capiConnectionStatus:i,isPanelOpen:s.isPanelOpen,isDocumentActive:n.isActive,paywallConfig:V,wordCount:d.textInfo.view((e=>(null==e?void 0:e.wordCount)??null)),cardActions:e.events.cardAction.view(n.id),onContentStateChanged:e=>M.set(e),logger:v}));g.adopt(x.state.subscribe((e=>b.set(e))),(e=>e.unsubscribe()));const T=()=>{var e;const t=i.get();return{agentId:D.A,capiSessionId:"connected"===t.kind?t.sessionId:void 0,documentWordCount:null==(e=d.textInfo.get())?void 0:e.wordCount}};return S.add((0,L.a)([M.pipe((0,I.b)(1e3)),s.isPanelOpen,n.isActive]).pipe((0,w.w)((([e,t,n])=>t&&n?(0,C.of)(e):m.E)),(0,p.h)(y.C_)).subscribe((e=>P.trackEvent(Q.ComponentImpression,{componentId:X.PanelContentReceived,detail:{...e,...T()}})))),S.add(e.events.panelAction.view(n.id).subscribe((e=>{const t=function(e,t,n){const o=t();switch(n.kind){case E.P.Kind.textTooShortViewMounted:case E.P.Kind.scoresLoadingViewMounted:case E.P.Kind.scoresLoadedViewMounted:case E.P.Kind.loadingLockedViewMounted:case E.P.Kind.lockedViewMounted:return{event:Q.ComponentImpression,detail:{componentId:{[E.P.Kind.textTooShortViewMounted]:X.TextTooShortView,[E.P.Kind.scoresLoadingViewMounted]:X.ScoresLoadingView,[E.P.Kind.scoresLoadedViewMounted]:X.ScoresLoadedView,[E.P.Kind.lockedViewMounted]:X.LockedView,[E.P.Kind.loadingLockedViewMounted]:X.LoadingLockedView}[n.kind],detail:n.kind===E.P.Kind.scoresLoadedViewMounted&&o.kind===D.S.Kind.Unlocked&&o.unlockedState.kind===D.S.Unlocked.Kind.Enabled&&o.unlockedState.enabledState.kind===D.S.Unlocked.Enabled.Kind.ScoresReceived?{...e(),remainingSuggestionCount:o.unlockedState.enabledState.pushedContentItemIds.size,citedSuggestionCount:o.unlockedState.enabledState.citedPushedContentItemsIds.size,aiDetectorScorePercent:o.unlockedState.enabledState.aiDetectorScorePercent}:e()}};case E.P.Kind.openUphook:case E.P.Kind.trackUphook:return null;default:(0,U.L0)(n)}}(T,(()=>b.get()),e);switch(t&&P.trackEvent(t.event,t.detail),e.kind){case E.P.Kind.openUphook:c.actions.openPopup(new A.Z(e.paywallUphook.content.ctaUrl));break;case E.P.Kind.trackUphook:a.trackUphookEvent(e.paywallUphook,e.event);break;case E.P.Kind.textTooShortViewMounted:case E.P.Kind.scoresLoadingViewMounted:case E.P.Kind.scoresLoadedViewMounted:case E.P.Kind.loadingLockedViewMounted:case E.P.Kind.lockedViewMounted:break;default:(0,U.L0)(e)}}))),S.add(e.events.cardAction.view(n.id).subscribe((e=>{const t=function(e,t){switch(t.kind){case E.C.Kind.markAsAddedButtonClick:case E.C.Kind.dismissButtonClick:case E.C.Kind.generateCitationButtonClick:return{event:Q.ComponentClicked,detail:{componentId:{[E.C.Kind.markAsAddedButtonClick]:X.MarkAsAddedButton,[E.C.Kind.dismissButtonClick]:X.DismissButton,[E.C.Kind.generateCitationButtonClick]:X.GenerateCitationButton}[t.kind],detail:e()}};case E.C.Kind.cardShow:return{event:Q.ComponentImpression,detail:{componentId:X.Card,detail:e()}};default:(0,U.L0)(t)}}(T,e);t&&P.trackEvent(t.event,t.detail)}))),g.move()}catch(e){var k=e,h=!0}finally{((e,t,n)=>{var o="function"==typeof SuppressedError?SuppressedError:function(e,t,n,o){return(o=Error(n)).name="SuppressedError",o.error=e,o.suppressed=t,o},i=e=>t=n?new o(e,t,"An error was suppressed during disposal"):(n=!0,e),d=o=>{for(;o=e.pop();)try{var s=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(s).then(d,(e=>(i(e),d())))}catch(e){i(e)}if(n)throw t};d()})(l,k,h)}}},55663:(e,t,n)=>{n.d(t,{i:()=>d});var o=n(5749),i=n(6619);const d=e=>o.z.isVBar(e)&&o.h.isWithComment(e)&&e.surface.sourceAgent===i.A}}]);