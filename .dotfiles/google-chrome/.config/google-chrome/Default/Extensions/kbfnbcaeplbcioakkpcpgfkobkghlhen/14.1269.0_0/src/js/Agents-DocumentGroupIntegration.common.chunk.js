(self.webpackChunk=self.webpackChunk||[]).push([[9153],{77784:(e,t,i)=>{function n(){return"agents/@impl"}function s(e){return`agents/${e}`}function r(e,...t){return o(e,...t)}function o(e,...t){return`agents/@impl/${e}${l(t)}`}function a(e,t,...i){return c(e,t,...i)}function c(e,t,...i){return`${s(e)}/${t}${l(i)}`}function u(e,...t){return`agents/${e}${l(t)}`}function l(e){const t=e.filter(Boolean).join("/");return t?`/${t}`:""}i.d(t,{EZ:()=>o,Lu:()=>s,Yx:()=>c,e7:()=>n,rL:()=>u,wS:()=>r,yp:()=>a})},89449:(e,t,i)=>{i.d(t,{w:()=>v});var n=i(90023),s=i(35547),r=i(20154),o=i(25077),a=i(90572),c=i(59179),u=i(31603),l=i(58303),d=i(67177),h=i(46189),g=i(68822),p=i(40594);class v{constructor(e){this._checkingService=e,this._handlers=[],this._log=p.Y.create("AgentsCapiClient"),this._subscription=this._checkingService.pipe(a.h(l.pC),c.U((e=>e.value.capiMessages)),u.J(),a.h((e=>(0,s.rE)(e)||(0,r.eJ)(e)||(0,o.Xl)(e)||(0,o.Dl)(e)||(0,o.oy)(e)||(0,o.ps)(e))),c.U((e=>e))).subscribe((e=>{this._handlers.forEach((t=>(this._log.debug("Handling CAPI Message",e),t(e),h._.Result.STOP_HANDLING)))}))}enqueueExternalCommand(e){this._log.debug("Enqueueing External Command",e);const t=(0,n.zG)(this._checkingService.get(),l.g_((()=>""),(e=>e.sessionUuid||""))),{action:i,...s}=e({sessionId:t,id:1,currentRevision:0,nextRevision:()=>1});return(0,n.zG)(this._checkingService.get(),d.Yo((()=>new g.YG("Checking service is not available"))),d.tS((e=>e.sendMessage(i,s,!0))))}registerExternalMessageHandler(e){this._handlers.includes(e)||this._handlers.push(e)}unregisterExternalMessageHandler(e){this._handlers=this._handlers.filter((t=>t!==e))}dispose(){this._subscription.unsubscribe(),this._handlers=[]}}},44361:(e,t,i)=>{i.d(t,{F:()=>s});var n=i(23162);class s{constructor(e){this._experimentClient=e}isAssigned(e,...t){if(e instanceof n.Cc)return this._experimentClient.isGateEnabled(e);const i=this._experimentClient.getTreatment(e);return null!==i&&i!==n.q4&&t.includes(i)}getTreatment(e){const t=this._experimentClient.getTreatment(e);return t===n.q4?null:t}peekExperiment(e,...t){const i=this._experimentClient.peekTreatment(e);return null!==i&&i!==n.q4&&t.includes(i)}}},97270:(e,t,i)=>{i.d(t,{Q:()=>a});var n=i(90023),s=i(12518),r=i(68822),o=i(40594);class a{constructor(e,t,i){this._telemetry=i;const a=o.Y.create("AgentsTrackingServiceProvider");this._trackingService={trackEvent:(i,o)=>{e.sendFeedback({eventName:i,eventData:JSON.stringify(o),agentId:t})().then((e=>(0,n.zG)(e,s.pF((e=>{throw e}))))).then((e=>{a.debug("Tracking event sent successfully",{event:i,detail:o,response:e})})).catch((e=>{e instanceof r.W5?a.debug("Didn't receive the success response for tracking request on time (it doesn't necessarily mean that the event was not tracked)",{event:i,detail:o,error:e}):(this._telemetry.warn("Tracking request failed",e,{event:i,detail:o,agentId:t}),a.warn("Tracking request failed",e,{event:i,detail:o}))}))}}}getTrackingService(){return this._trackingService}}},33863:(e,t,i)=>{i.d(t,{$:()=>o});var n=i(90023),s=i(12518),r=i(40594);class o{constructor(e,t){this._actions=e,this._telemetry=t,this._log=r.Y.create("AgentsUphookHubClient")}async getUphookConfig(e){try{const t=await this._actions.getConfiguration(e);return(0,n.zG)(t,s.g_((e=>{throw e}),(e=>e)))}catch(t){throw this._telemetry.error(`Failed to get uphook config for ${e}`,t),this._log.warn(`Failed to get uphook config for ${e}`,t),t}}async trackUphookEvent(e,t){try{const i=await this._actions.trackConfiguration(t,e);(0,n.zG)(i,s.g_((e=>{throw e}),(()=>{})))}catch(i){const n=`Failed to track uphook event for ${(null==e?void 0:e.upgradeHookSlot)||"unknown"} uphook with event kind ${t}`;throw this._telemetry.error(n,i),this._log.warn(n,i),i}}}},85933:(e,t,i)=>{i.d(t,{u:()=>o});var n=i(12518),s=i(77632),r=i(25466);function o(e){return new s.f(a(e),new c)}const a=e=>{const t=new Set;return"edge"!==e.browser&&"msie"!==e.browser&&t.add(r.L.Flag.supportsSVGDominantBaseline),{has:e=>t.has(e)}};class c{constructor(){this.openUrl=e=>(0,n.Y3)((()=>{document.location.href=e.toString()}),n.KC),this.openPopup=e=>(0,n.Y3)((()=>{const t=self.open(e.toString(),"_blank","noopener,noreferrer");t&&(t.opener=null)}),n.KC)}}},49722:(e,t,i)=>{i.r(t),i.d(t,{AgentsDocumentGroupIntegration:()=>D});var n=i(90572),s=i(12898),r=i(13391),o=i(15339),a=i(40594),c=i(77784),u=i(46271),l=i(15724),d=i(42849),h=i(307),g=i(97531);const p={[i(46924).f.id]:"ReaderReactions",[d.f.id]:"Humanizer",[h.f.id]:"Paraphraser",[l.f.id]:"ExpertReview",[u.f.id]:"AIDetector",[g.f.id]:"Plagiarism"};var v=i(44361),m=i(97270),_=i(33863),f=i(85933),b=i(28357),k=i(35482),S=i(58303),y=i(89449),A=i(20680),C=i(79256),x=i(84714),w=i(43789);function I(e){const t=new DisposableStack,i=function(e,t,i,n,s){const o=()=>w.RI.resFromText(t());return{id:e,isActive:r.h.combine(n,s,((e,t)=>e&&t)),getText:o,textChanges:(0,A.z)((0,C.P)((()=>(0,x.of)(o()))),i)}}(e.documentId,e.getPlainText,e.textChanges,e.isTextFieldFocused,e.isActiveTab),n=new y.w(e.checkingService.view(S.ij)),s=b.W.create(n),o=k.J.create(n);return{document:i,capiConnectionStatus:e.capiConnectionStatus,capiCheckingState:e.capiCheckingState,agentGenericService:s,fileUploadService:o,pushedContentService:e.pushedContentService,capiEvents:e.capiEvents,[Symbol.dispose]:()=>t.dispose()}}var F=i(24196),T=i(40795),$=i(63534);class D{constructor(e){this._disposables=new AsyncDisposableStack,this._logger=a.Y.create("Agents.DocumentGroupIntegration"),this._focusedTextField=r.h.create(null),this._platformInfo=o.W.detect(),this._environment=(0,f.u)(this._platformInfo),this._telemetry=e.telemetry,this._experimentClient=e.experimentClient,this._messageBusClient=e.messageBusClient,this._platformBus=this._messageBusClient.platformBus,this._agentDefinitions=(0,T.c)(e.experimentClient),this._experimentationService=new v.F(e.experimentClient),this._uphookHubClient=(0,F.sI)(e.experimentClient)?new _.$(e.actions,this._telemetry):{getUphookConfig:()=>Promise.resolve(void 0),trackUphookEvent:()=>Promise.resolve()},this._userService={user:e.user.view((e=>({id:e.id,firstName:e.firstName,email:e.email,free:!e.premium,anonymous:e.anonymous})))},this._activeDocumentForTab=this._disposables.use(this._platformBus.state.activeDocument.create(e.tabId,null)),this._agentsFeatureFlagsAtom=this._disposables.use(this._platformBus.state.agentsFeatureFlags.create(e.tabId,null)),this._activePanelAgentId=this._disposables.use(this._platformBus.state.activePanelAgentId.view(null)),this._isActiveTab=this._disposables.use(this._platformBus.state.activeTabId.view(null)).view((t=>t===e.tabId)),this._disposables.adopt(r.h.combine(this._isActiveTab,this._focusedTextField,((e,t)=>e?t:null)).subscribe((e=>this._activeDocumentForTab.set(e))),(e=>e.unsubscribe()))}runDocumentActivations(e){return this._runActivations("documentActivate",e.textFieldSupportsAgents,e.agentsFeatureFlags,(t=>{const i=t.use(I({...e,isActiveTab:this._isActiveTab}));return this._disposables.adopt(e.isTextFieldFocused.pipe((0,n.h)(Boolean)).subscribe((()=>this._focusedTextField.set({id:e.documentId,supportsAgents:e.textFieldSupportsAgents}))),(t=>{var i;(null===(i=this._focusedTextField.get())||void 0===i?void 0:i.id)===e.documentId&&this._focusedTextField.set(null),t.unsubscribe()})),{environment:this._environment,platformInfo:this._platformInfo,userService:this._userService,uphookHubClient:this._uphookHubClient,...i}}),((e,t)=>{var i,n;const s=new m.Q(t.agentGenericService,e.id,this._telemetry),r={...t,trackingServiceProvider:s};return null===(n=(i=e.integrations).documentActivate)||void 0===n?void 0:n.call(i,r).then((t=>({...t,...(0,$.T0)(null!=t?t:{}),agentId:e.id})))}),e.documentId)}runTextDecorationActivations(e){return this._runActivations("textDecorationsActivate",e.textFieldSupportsAgents,e.agentsFeatureFlags,(()=>({documentId:e.documentId})),((e,t)=>{var i,n;return null===(n=(i=e.integrations).textDecorationsActivate)||void 0===n?void 0:n.call(i,t).then((i=>({...i,...(0,$.T0)(i),agentId:e.id,isActive:t.navigation.isPanelOpen})))}),e.documentId)}runInlineCardActivations(e){return this._runActivations("inlineCardActivate",e.textFieldSupportsAgents,e.agentsFeatureFlags,(()=>({documentId:e.documentId})),((e,t)=>{var i,n;return null===(n=(i=e.integrations).inlineCardActivate)||void 0===n?void 0:n.call(i,t).then((t=>({...t,...(0,$.T0)(t),agentId:e.id})))}),e.documentId)}_runActivations(e,t,i,n,r,o){if(!(0,F.w4)(this._experimentClient))return{integrations:[],[Symbol.asyncDispose]:()=>Promise.resolve()};const a=new AsyncDisposableStack;this._disposables.defer((()=>a.disposeAsync()));const u=[],l={documentActivate:"doc",textDecorationsActivate:"text-decorations",inlineCardActivate:"inline-card"},d=n(a);if("documentActivate"===e&&this._agentsFeatureFlagsAtom.set(i),!t)return{integrations:u,[Symbol.asyncDispose]:()=>a.disposeAsync()};for(const t of this._agentDefinitions){if(!i[p[t.id]]){this._logger.debug(`Skipping ${l[e]} activation for ${t.id} - agent is not enabled in availability flags`);continue}this._logger.debug(`Running ${l[e]} activation for ${t.id} on document ${o}`);const n=this._messageBusClient.createPort({name:(0,c.yp)(t.id,l[e],o)});try{const i=r(t,{documentId:o,bus:a.use((0,s.kX)({port:n,clientId:(0,c.Yx)(t.id,l[e],o),keyPrefix:(0,c.Lu)(t.id),protocol:t.protocol})),navigation:{isPanelOpen:this._activePanelAgentId.view((e=>e===t.id))},experimentation:this._experimentationService,...d});null==i||i.then((i=>this._logger.debug(`Activation result for ${t.id}.${e} on document ${o}:`,i))).catch((i=>{this._logger.error(`Failed to get ${e} result for agent ${t.id} on document ${o}`,i),this._telemetry.error(`Failed to get ${e} result for agent`,i,{agentId:t.id})})),i&&(a.use((0,$.T0)(i.catch((()=>null)))),u.push(i))}catch(i){this._logger.error(`${e} error for agent ${t.id} on document ${o}`,i),this._telemetry.error(`${e} error for agent`,i,{agentId:t.id})}}return{integrations:u,[Symbol.asyncDispose]:()=>a.disposeAsync()}}[Symbol.asyncDispose](){return this._disposables.disposeAsync()}}},63534:(e,t,i)=>{function n(e){return{[Symbol.asyncDispose]:async()=>{if(!e)return;const t=await e;t&&(!function(e){return Symbol.dispose in e}(t)?function(e){return Symbol.asyncDispose in e}(t)&&await t[Symbol.asyncDispose]():t[Symbol.dispose]())}}}i.d(t,{T0:()=>n})}}]);