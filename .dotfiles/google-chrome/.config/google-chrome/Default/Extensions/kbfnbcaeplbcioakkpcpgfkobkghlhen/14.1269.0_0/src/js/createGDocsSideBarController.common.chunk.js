(self.webpackChunk=self.webpackChunk||[]).push([[7102],{44556:(e,t,i)=>{var s=i(18638),r="chrome-extension://__MSG_@@extension_id__/",n="moz-extension://__MSG_@@extension_id__/",a="safari-web-extension://__MSG_@@extension_id__/",o=self.GR_RESOURCE_ROOT||r,h=self.GR_RESOURCE_ROOT||n,l=self.GR_RESOURCE_ROOT||a;e.exports={__css:s.toString().replace(new RegExp(r,"g"),o).replace(new RegExp(n,"g"),h).replace(new RegExp(a,"g"),l),...s.locals}},68822:(e,t,i)=>{i.d(t,{EP:()=>o,PJ:()=>l,W5:()=>a,YG:()=>h});var s=i(12518),r=i(64443),n=i(32103);class a extends n.sH{constructor(e){super(Boolean(e)?e:"Timeout"),this.name="TimeoutError"}static isTimeoutError(e){return e instanceof a}}class o extends n.sH{constructor(e){super(Boolean(e)?e:"Dropped"),this.name="DroppedError"}static isDroppedError(e){return e instanceof o}}class h extends n.sH{constructor(e){super(Boolean(e)?e:"Not Connected to WS"),this.name="NotConnectedError"}static isNotConnectedError(e){return e instanceof h}}class l{constructor(e=5e3,t="",i=new a){this._timeout=e,this.name=t,this._timeoutError=i,this._requests=new Map,this._log=r.C8.Logging.getLogger("coreclients.valueRequester"+(t.length>0?"."+t:""))}watchRequest(e,t=this._timeout){return this._startRequestWatch(e,t)}hasRequest(e){return this._requests.has(e)}onValue(e,t){this._stopRequest(e,s.F2(t))}onError(e,t){this._log.trace(`onError:(${e})`),this._stopRequest(e,s.t$(t))}clear(e){this._log.trace("clearing request watches: "+e),this._requests.forEach(((t,i)=>{this.onError(i,new o(`command (${this.name}) can not be executed, reason: ${e}`))}))}_startRequestWatch(e,t){this._log.debug(`Starting request watch: ${e}`),(0,n.kG)(!this._requests.has(e),"must not start watch for same request twice, request already watched: "+e);const i={};return i.promise=new Promise((e=>{i.resolve=e})),i.timer=self.setTimeout((()=>this._stopRequest(e,s.t$(this._timeoutError))),t),this._requests.set(e,i),i.promise}_stopRequest(e,t){this._log.trace(`_stopRequest: stopping request watch: ${e}`,t);const i=this._requests.get(e);void 0===i?this._log.warn("Got result for unknown request or request has already expired.",{id:e,result:t}):(clearTimeout(i.timer),i.resolve(t),this._requests.delete(e))}}},8379:(e,t,i)=>{i.d(t,{Q:()=>l});var s=i(90023),r=i(68822),n=i(68291),a=i(64443);function o(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function h(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"_capiSDUIClient",void 0),h(this,"_log",void 0),this._capiSDUIClient=t,this._log=a.C8.Logging.getLogger("SDUIFeedbackServiceImpl")}var t,i,l;return t=e,(i=[{key:"sendUserAction",value:function(e,t){var i=this;this._log.debug("Sending user action",{componentId:e,userAction:t}),(0,s.zG)(this._capiSDUIClient.sendUserAction(e,t),n.Vi,(function(e){return e.catch((function(e){r.EP.isDroppedError(e)?i._log.debug("Stopped listening for sendUserAction message acknowledge",e):r.YG.isNotConnectedError(e)?i._log.warn("Failed to sendUserAction as CAPI was not connected",e):i._log.error("Failed to sendUserAction",e)}))}))}}])&&o(t.prototype,i),l&&o(t,l),e}()},47268:(e,t,i)=>{i.d(t,{t:()=>R});var s=i(90023),r=i(36807),n=i(19299),a=i(81793),o=i(91219),h=i(88012),l=i(81933),c=i(32103),d=i(12518),u=i(58303),g=i(59833),p=i(19659),_=i(43789),m=i(39214),v=i(26155),b=i(63310),S=i(89803),C=i(74822),y=i(90572),f=i(59179),w=i(954),x=i(68418),A=i(14128),E=i(40594);class k{constructor(){this._mapByHighlightId=new Map,this._mapByAlertId=new Map,this._highlightDataChanged=new C.x,this.highlightDataChanged=this._highlightDataChanged}getByHighlightId(e){return this._mapByHighlightId.get(e)}getByAlertId(e){const t=this._mapByAlertId.get(e)||new Set;return Array.from(t).map((e=>this._mapByHighlightId.get(e))).filter((e=>!!e))}get(e){return this._mapByHighlightId.get(e)}has(e){return this._mapByHighlightId.has(e)}set(e,t){this._mapByHighlightId.set(e,t);const i=this._mapByAlertId.get(t.alertId)||new Set;i.add(e),this._mapByAlertId.set(t.alertId,i),this._highlightDataChanged.next(e)}delete(e){const t=this._mapByHighlightId.get(e);if(t){const i=this._mapByAlertId.get(t.alertId);void 0!==i&&(i.delete(e),0===i.size&&this._mapByAlertId.delete(t.alertId)),this._mapByHighlightId.delete(e)}this._highlightDataChanged.next(e)}forEach(e){this._mapByHighlightId.forEach(e)}getHighlightDataObs(e){return this._highlightDataChanged.pipe(y.h((t=>t===e)),f.U((()=>this.getByHighlightId(e))),w.O(this.getByHighlightId(e)))}}class I{constructor(e,t,i,s,r=(()=>x.E9.zero),n=E.Y.create("DenaliHighlightsUpdater")){this._denaliHighlights=e,this._getFluidHighlights=t,this._getTextMap=i,this._getParentRect=s,this._getParentScroll=r,this._log=n}register(e,t,i,s){if(null!==e){if(this._denaliHighlights.has(e))return this.update(e,t,i,s);{const r=new S.Fd(e,t,this._getFluidHighlights(),this._getParentRect,this._getParentScroll),n={id:e,alertId:s.alertId,mark:r,visualization:i};this._denaliHighlights.set(e,n);const a=this._getTextMap().getPlainText();return this._getFluidHighlights().addHighlight(e,(0,A.rX)((0,A.mp)(r.range),a),s),n}}return null}remove(e){this._denaliHighlights.has(e)?(this._getFluidHighlights().removeHighlights([e]),this._denaliHighlights.delete(e)):this._log.warn(`can't remove mark #${e}, doesn't exist`)}update(e,t,i,s){const r=this._denaliHighlights.get(e);if(r){this._denaliHighlights.set(e,{...r,visualization:i});const n=this._getTextMap().getPlainText();return this._getFluidHighlights().updateHighlight(e,(0,A.rX)(t.meta.range(),n),s),r}return this._log.warn("cannot update not existing highlight",e),null}clearAll(){this._denaliHighlights.forEach((e=>{this._getFluidHighlights().removeHighlights([e.id])}))}}var T=i(67800),B=i(20905);class R{constructor(e,t,i,r,n,a,o=E.Y.create("DenaliViewAdapter"),c,g){this._highlights=e,this._textObserver=t,this._replacementService=i,this._layout=r,this._scroller=n,this._selectedHighlightsTracker=a,this._log=o,this._requestAwaitService=c,this._formattingService=g,this._subs=new h.w.Keeper,this._disposed=!1,this._highlightedAlertId=null,this._marks=new Map,this.markChangeApplied=new l.Subject,this._highlightsDataStore=new k,this._highlightUpdater=new I(this._highlightsDataStore,(()=>this._highlights),(()=>this._textObserver.getTextSource()),(()=>{const e=this._layout.textField.rect.getApproximate();return b.Pf.create({...e.client,...e.size})}),(()=>this._layout.textField.scroll.getApproximate())),this.highlightHoverProvider={getHoveredStateBehavior:e=>this._highlightsDataStore.getHighlightDataObs(e).pipe(l.map((e=>e&&e.visualization.type===S.sO.Change.VisualState.Type.highlighted?{[S.sO.Change.VisualState.Source.sidebar]:v.pc.hoveredNeedsAttention,[S.sO.Change.VisualState.Source.text]:v.pc.hovered,[S.sO.Change.VisualState.Source.api]:this._highlightedAlertId===e.alertId?v.pc.hovered:v.pc.none}[e.visualization.source]:v.pc.none)))},this._updateContentsBuffer=new l.Subject,this._flushUpdater=new l.Subject,this.getContents=(e,t)=>{if(this._log.trace(`getContents, ${String(e)}, ${String(t)}`),this._formattingService){const i=this._textObserver.getTextSource().getRichText();return _.RI.unsafeRes(void 0!==e?i.slice(e,void 0!==t?e+t:void 0):i)}{const i=void 0!==e?this.getText().slice(e,void 0!==t?e+t:void 0):this.getText();return _.RI.resFromText(i)}},this.changes=l.mergeStatic((0,s.zG)(_.RI.res(this.getContents().delta),d.g_((()=>l.EMPTY),(e=>l.of(e)))),this._textObserver.contentChanges.async.pipe(l.filter((e=>e.changes.length>0)),l.map((({deltaChange:e})=>e)))),this.activeMarks=new l.BehaviorSubject(u.YP),this.contentUpdated=new l.Subject,this.hoveredMarks=new l.BehaviorSubject(u.YP),this.textChangedAfterPaste=new l.Subject,this.activeWord=new l.BehaviorSubject(u.YP),this.clickedWord=new l.BehaviorSubject(u.YP),this.ongoingSelection=new l.BehaviorSubject(!1),this._log.info(`${R.name} created`),this._subs.push(this._subscribeToContentUpdates(),this._subscribeToSelectedHighlight(),this._trackFocusedAlert())}_trackFocusedAlert(){return this._highlightsDataStore.highlightDataChanged.pipe(l.map((e=>this._highlightsDataStore.getByHighlightId(e))),l.filter((e=>!!e))).subscribe((e=>{this._highlightedAlertId===e.alertId||e.visualization.type!==S.sO.Change.VisualState.Type.highlighted||e.visualization.source!==S.sO.Change.VisualState.Source.text&&e.visualization.source!==S.sO.Change.VisualState.Source.sidebar?e.alertId===this._highlightedAlertId&&e.visualization.type===S.sO.Change.VisualState.Type.visible&&(this._highlightedAlertId=null,this._log.trace(`Mark ${e.id} unfocused - alertId ${e.alertId}`)):(this._highlightedAlertId=e.alertId,this._log.trace(`Mark ${e.id} focused - alertId ${e.alertId}`))}))}pushChanges(e,t){this._log.trace("pushChanges",{change:e,source:t}),_.RI.isFlush(e)?this._flushUpdater.next(void 0):_.RI.isReset(e)?this._log.warn("Got unknown reset"):this._updateContents(e.delta,t)}getText(){return this._log.trace("getText"),this._formattingService?(0,T.l)(this._textObserver.getTextSource().getRichText(),""):this._textObserver.getTextSource().getPlainText()}getTextLength(){return this._log.trace("getTextLength"),this.getText().length}flushChanges(){this._log.trace("flushChanges")}getCursor(){return this._log.trace("getCursor"),n.Y1.empty}get contentRect(){throw this._log.trace("contentRect"),Error("not implemented")}setCursor(e,t,i){return this._log.trace("setCursor",{_index:e,_length:t,_source:i}),d.F2(void 0)}getLastPossibleCursorPosition(){return this._log.trace("getLastPossibleCursorPosition"),0}_doMarkAction(e){const t=v.y$.Id.createFromMark(e.id),i=e.meta.capiAlertId;switch(e.action){case a.v.Change.ActionType.create:{const s=this._highlightUpdater.register(t,e,e.meta.visualState,{alertId:i,highlightId:t,highlightColor:e.meta.highlightColor,highlightDisplayFormat:e.meta.highlightDisplayFormat,highlightDisappearOnHoverDelay:e.meta.highlightDisappearOnHoverDelay,highlightLiveliness:null}),r=(null==s?void 0:s.mark)||null;return r&&this._marks.set(r.id,r),r}case a.v.Change.ActionType.update:{const s=this._highlightUpdater.update(t,e,e.meta.visualState,{alertId:i,highlightId:t,highlightColor:e.meta.highlightColor,highlightDisplayFormat:e.meta.highlightDisplayFormat,highlightDisappearOnHoverDelay:e.meta.highlightDisappearOnHoverDelay,highlightLiveliness:null}),r=(null==s?void 0:s.mark)||null;return r&&this._marks.set(r.id,r),r}case a.v.Change.ActionType.remove:return this._highlightUpdater.remove(t),this._marks.delete(e.id),null;default:(0,c.vE)(e)}}changeMarks(e){return this._disposed?(this._log.debug("changeMarks called after disposed, returning empty result"),a.v.Change.Result.getEmpty()):(this._log.trace("changeMarks",{rawMarks:e}),e.reduce(((e,t)=>{switch(t.action){case a.v.Change.ActionType.create:e.created.set(t.id,d.ij(new Error("Cannot create mark"))(this._doMarkAction(t)));break;case a.v.Change.ActionType.update:e.updated.set(t.id,d.ij(new Error("Cannot update mark"))(this._doMarkAction(t)));break;case a.v.Change.ActionType.remove:this._doMarkAction(t),e.removed.set(t.id,d.F2(void 0))}return e}),a.v.Change.Result.getEmpty()))}scrollToMark(e,t){var i;const s=null!==(i=this._marks.get(e))&&void 0!==i?i:null;return this._log.trace("scrollToMark",{markId:e,mark:s,opts:t}),s?this._scroller.scrollToMark(s,t):(this._log.warn(`Tried to scroll to nonexistent mark with id: ${e}`),l.EMPTY)}_subscribeToContentUpdates(){return this._updateContentsBuffer.pipe(l.bufferWhen((()=>l.mergeStatic(l.timer((0,B.Xd)(20)),this._flushUpdater).pipe(l.first()))),l.filter((e=>e.length>0)),l.map((e=>e.reduce(((e,t)=>e.compose(t)),new r.i)))).subscribe((e=>{const t=this._replacementService.performBatchReplacements((0,m.g)(e)).then((()=>{const t=(0,m.B)(e);this._formattingService&&t.length&&(this._log.trace("Have formattings, applying",t),t.forEach((e=>{this._formattingService&&this._formattingService.apply(e.range,e.formatting)})))}),(()=>{this._log.warn("Failed to apply batch replacements")}));this._requestAwaitService&&this._requestAwaitService.addRequest(t)}))}_subscribeToSelectedHighlight(){return this._selectedHighlightsTracker.pipe(l.map((0,s.ls)(g.UI((e=>{var t;return(0,s.zG)(u.ij(null===(t=this._highlightsDataStore.get(e))||void 0===t?void 0:t.mark),u.hX((e=>(0,s.zG)(e.range(),d.g_(s.W8,(0,s.ff)(o.x.isEnclosingView))))))})),g.oA))).subscribe((e=>this.activeMarks.next(u.G(e))))}_updateContents(e,t){this._updateContentsBuffer.next((0,T.AQ)(e))}getSelectionRect(){throw this._log.trace("getSelectionRect"),Error("not implemented")}setContents(e){this._log.trace("setContents",{_value:e})}getHTML(){return this._log.trace("getHTML"),""}getPossibleCursorPosition(e,t){return this._log.trace("getPossibleCursorPosition",{_x:e,_y:t}),p.vM((()=>{throw new Error("Not implemented")}))}dispose(){this._highlightUpdater.clearAll(),this._subs.dispose(),this._log.info(`${R.name} disposed`),this._disposed=!0}}},57475:(e,t,i)=>{i.d(t,{r:()=>$});var s=i(18117),r=i(24332),n=i(90023),a=i(39953),o=i(94579),h=i(75708),l=i(85443),c=i(55812),d=i(62633),u=i(98902),g=i(71255),p=i(98162),_=i(78398),m=i(84146),v=i(7378),b=i(68020),S=i(88012),C=i(81933),y=i(2187),f=i(55709),w=i(86214),x=i(12518),A=i(19659),E=i(58303),k=i(10444),I=i(59833),T=i(43789),B=i(45676),R=i(8907),H=i(8379),U=i(42192),D=i(19328),G=i(13391),P=i(68291);var M=i(43389),O=i(38709),F=i(90595),q=i(40866),L=i(40594),z=i(50787);const $=(e,t,i,c,v,w,$,V,W,N,Y,X)=>{const K=L.Y.create("createEngine"),Q=new S.w.Keeper,J=function(e,t,i){const s=G.h.create(E.YP),r=G.h.create(E.YP);return{score:G.h.create(E.YP),scoreStatus:G.h.create(E.YP),title:G.h.create(void 0),textInfo:G.h.create(E.YP),checkingState:G.h.create(e.checkingState),asyncChecksState:G.h.create(e.asyncChecksState),context:i,contextCompleteness:i.view(D.j.calculateCompleteness),updateContext:e=>{const t=!f.R$.eq.equals(i.get(),e);return i.set(e),t},defaultContext:s,updateDefaultContext:e=>{const t=!(0,a.zG)((0,n.bc)([s.get(),e],k.vB(f.R$.eq.equals)));return s.set(e),t},documentText:t.getText(),documentLength:G.h.create({full:t.getTextLength(),trimmed:t.getTextLength()}),counters:G.h.create(D.dM.group.empty),calculateStats:()=>P.Vi(e.requestDocStats).then((e=>(r.set(E.G(e)),e))),recentDocumentStats:r}}(e,t,i),Z=t.changes.pipe(C.scan(((e,i)=>T.RI.isReset(i)?(0,a.zG)(i.text,x.g_((()=>t.getText()),n.yR)):T.RI.isDelta(i)?(0,a.zG)(T.RI.resFromText(e).compose(i),A.VS((e=>e.text)),x.g_((()=>t.getText()),n.yR)):e),""));Q.push(e.events.pipe(C.withLatestFrom(Z),C.tap((([e,t])=>{if("alert_received"===e.kind){const i=(0,O.IM)(e.alert,q.Q.fromString("fake"));M.$.isConsistentWithText(i,t)||(N.alerts.inconsistentAlertWithText("assistant",null==i?void 0:i._tag),(0,U.N)(K,i,t,"logging"))}}))).subscribe(),e.events.pipe(C.tap((t=>{J.checkingState.set(e.checkingState),B.hX.is("text_info")(t)?J.textInfo.set(E.G(t.data)):B.hX.is("finish")(t)?(J.score.set(t.score),J.scoreStatus.set(t.scoreStatus)):B.hX.is("feedback_ack")(t)?((0,a.zG)(t,E.DT(B.hX.isUserFeedbackWithGeneralScore),E.UI((e=>e.outcomeScores.GeneralScore)),E.UI((e=>Math.trunc(100*e))),k.bw((e=>J.score.modify((0,n.ls)(E.UI((t=>({...t,rank:e}))),k.vx(E.G({errorRateScore:0,rank:e}))))))),(0,a.zG)(t,E.DT(B.hX.isUserFeedbackWithScoreStatus),E.UI((e=>e.scoreStatus)),k.bw((e=>J.scoreStatus.set(E.G(e)))))):B.hX.is("session_started")(t)&&J.updateDefaultContext(t.defaultDocumentContext)}))).subscribe(),...Y.isGateEnabled(F.K.CheetahClearSDUIBufferOnReconnect)?[]:[(0,z.o)((()=>E.WG(V)),e.events)],v.contentChanges.async.pipe(C.debounceTime(300),C.map((e=>e.newText)),C.map((e=>({full:e.length-1,trimmed:e.trim().length}))),C.tap(y.wW(J.documentLength))).subscribe()),(0,a.zG)(w(),E.UI((e=>{J.updateDefaultContext(f.R$.parseDefault(e.defaultDocumentContext))})));const ee=new b.Xr,te=new u.Ek,ie=(0,r.g_)((0,r.Zm)())(I.oA([E.G((e=>(0,a.zG)($.get(),E.g_((()=>e),(t=>t.addSnippetsTriggerToAlert(e))))))])),se=new o.a,re=new d.SC(ee,te,(()=>t.getContents().delta),e.events,e,J.counters,ie,void 0,se),ne=h.e.create(re.state),ae=new l.k(ne,re._ops);Q.push(p.R.init(p.R.UserTextChangesSync.create(t),e.events,g.nR.ignoreTEResult(e),g.nR.ignoreResult(ee),te,g.Av.merge([re])).subscribe()),e.loadAlerts(c()),re.flushAlerts(),Y.isGateEnabled(F.K.DontSyncAlertApplicationsWithInlineMode)||Q.push(j(re.state,X));const oe=E.G(_.J.CategoriesModel.create(e.events,e,re.state,ae,R.JW.ScopeType.GLOBAL)),he=E.G(m.k.create(ne)),le=(0,a.zG)((0,s.gz)(E.Kw)(V,W),E.UI((([t,i])=>({sduiBufferService:t,sduiFeedbackService:new H.Q(e),sduiPopoverManager:i})))),ce={enablePlagiarismSearch:e.enablePlagiarismSearch,disablePlagiarismSearch:e.disablePlagiarismSearch,enablePlagiarismAndAiDetectorSearch:e.enablePlagiarismAndAiDetectorSearch,disablePlagiarismAndAiDetectorSearch:e.disablePlagiarismAndAiDetectorSearch},de={requestWritingExpert:e.requestWritingExpert,enableWritingExpert:e.enableWritingExpert,disableWritingExpert:e.disableWritingExpert};return{alertsList:re,alertsReader:ne,alertsService:ae,positionManager:ee,getByRawAlertId:se.getByRawAlertId.bind(se),sessionModel:J,mutedAlertsCategoriesModel:oe,mutingAlertsReader:he,shutdown:()=>{re.dispose(),Q.dispose()},sduiEngine:le,plagiarismClient:ce,writingExpertClient:de}},j=(e,t)=>e.pipe(C.startWith(v.p.empty),C.pairwise(),C.map((([e,t])=>v.p.diff(e,t))),C.map((e=>(0,a.zG)(e,w.vh.reduce([],((e,t)=>(0,a.zG)(t.alert,E.DT((e=>c.bZ.isApplied(e))),E.UI((e=>e.rawId)),E.fS((()=>E.YP)),E.g_((()=>e),(t=>[...e,t])))),n.yR,n.yR))))).subscribe((e=>{e.length&&t(e)}))},74746:(e,t,i)=>{i.d(t,{c:()=>r});var s=i(27080);class r{constructor(e){this._highlights=e}addHighlight(e,t,i){return this._highlights.addHighlight(e,t,i)}updateHighlight(e,t,i){return this._highlights.updateHighlight(e,t,i)}removeHighlights(e){return this._highlights.removeHighlights(e)}recalculateHighlight(e){return this._highlights.recalculateHighlight(e)}recalculateAllHighlights(){return this._highlights.recalculateAllHighlights()}maintainConsistency(e,t=(e=>e),i=!1){return this._highlights.maintainConsistency(e,t,i)}hasHighlight(e){return this._highlights.hasHighlight(e)}getSelectedHighlightsTracker(e){return(0,s.H)({...e,highlights:this._highlights})}getGeometryByHighlightId(e){return this._highlights.geometry.get().get(e)}}},50884:(e,t,i)=>{i.r(t),i.d(t,{createSideBarController:()=>De});var s,r=i(84308),n=i(74822),a=i(59179),o=i(42203),h=i(2187),l=i(58303),c=i(33442),d=i(92379),u=i(84714),g=i(63532),p=i(29479),_=i(38699),m=i(9542),v=i(29999),b=i(40594),S=i(75707),C=i(95295);!function(e){var t;e.div=(t="div",function({children:e,...i}){const s=d.useRef(null),[r,n]=d.useState(null);return d.useEffect((()=>{s.current&&("function"==typeof s.current.attachShadow?n(s.current.attachShadow({mode:"open"})):n(s.current))}),[s]),d.createElement(t,{ref:s,...i},r?(0,C.createPortal)(d.createElement(y.Provider,{value:r},e),r):null)})}(s||(s={}));const y=d.createContext(null);var f=i(28510),w=i(7913);function x(e,t,i,s){const r=(s-90)*Math.PI/180;return{x:e+i*Math.cos(r),y:t+i*Math.sin(r)}}function A(e,t,i,s,r){const n=x(e,t,i,r),a=x(e,t,i,s),o=r-s<=180?"0":"1";return["M",n.x,n.y,"A",i,i,0,o,0,a.x,a.y].join(" ")}var E=i(20785),k=i(33885);const I=({children:e,position:t,className:i})=>d.createElement(k.F.div,{className:i,style:t.view((e=>({position:"fixed",right:e.right,top:e.top,bottom:"0px",width:e.width,zIndex:e.zIndex,background:"white",display:"flex",flexDirection:"column",justifyContent:"space-between",height:e.height}))),"data-grammarly-part":"legacy-sidebar-container"},e);var T=i(44556),B=i.n(T);const R=({onClose:e,position:t})=>d.createElement(s.div,{"data-grammarly-part":"sidebar-splash"},d.createElement(f.b,null,B().__css),d.createElement(I,{className:B().sidebar,position:t},d.createElement("div",{className:B().header},d.createElement("div",{className:B().headerGroup},d.createElement(E.T,{type:"full",className:B().logoIcon})),d.createElement("div",{className:B().headerGroup},d.createElement("div",{className:B().closeButton,onClick:e,role:"button",tabIndex:0},d.createElement("svg",{width:"11",height:"11",viewBox:"0 0 12 13",fill:"none"},d.createElement("path",{d:"M0.5 1L6 6.5M11.5 12L6 6.5M6 6.5L11.5 1M6 6.5L0.5 12",strokeLinecap:"round",strokeWidth:"1.5"}))))),d.createElement("div",{className:B().splashContainer},d.createElement("svg",{viewBox:"0 0 100 100",className:B().splash},d.createElement("circle",{cx:"50",cy:"50",r:"50",stroke:"none",fill:w.Z.green50}))),d.createElement("div",{className:B().spinnerContainer},d.createElement("svg",{width:"64",height:"64",viewBox:"0 0 100 100",fill:"none",className:B().spinner},d.createElement("path",{d:A(50,50,45,0,240),stroke:w.Z.green50,strokeWidth:5})))));var H,U=i(36344),D=i(90572),G=i(21070),P=i(20161),M=i(66878),O=i(13391),F=i(73074),q=i(78767);class L{constructor(e,t,i,s,a,o,h,l,c,d,u,g,p,_=b.Y.create("GDocsSidebarBaseAssistantController")){this._doc=e,this._telemetry=t,this._gnar=i,this._actions=s,this._isGDocOwner=a,this._alertCounts=o,this._state=h,this._csActions=l,this._experimentClient=c,this._config=d,this._gnarTrackingEnabled=g,this._log=_,this._subscriptions=[],this._sidebarVisible=O.h.create(!1),this._commands=new n.x,this._iterableController=new F.k(F.k.shouldCreate(this._config.bundleInfo.browser,this._state.get().dynamicConfig,this._experimentClient),this._state,this._actions.iterableNextFetchSettings,this._csActions,this._experimentClient,this._doc.location.host,void 0,void 0,void 0),this.sidebarVisible=this._sidebarVisible,this.toggle=e=>{this._commands.next({action:S.$.Action.toggle,source:e})},this.show=(e,t)=>{this._commands.next({action:S.$.Action.show,source:e,alertId:t})},this.hide=e=>{this._commands.next({action:S.$.Action.hideAll,source:e})},this.dispose=()=>{let e;this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[],e=this._hideSidebar().subscribe((t=>{t&&(this._gnarTrackingEnabled&&this._gnar.gdocsSidebarGdocsSidebarClose(this._isGDocOwner,S.$.Source.api,this._alertCounts.expandedViewAlertsCount,this._alertCounts.wordsCount,this._alertCounts.inlineAlertCount,this._alertCounts.nonHiddenClarityAlertCount,this._alertCounts.nonInlineAlertCount),null==e||e.unsubscribe())}))},this._nativeSidebarController=u(this._doc,(()=>{this._commands.next({action:S.$.Action.hideGrammarlyOnly,source:S.$.Source.user})}),t,this._experimentClient,p),this._subscriptions=[this._nativeSidebarController.visibility.pipe((0,D.h)(q.X0)).subscribe((()=>this._commands.next({action:S.$.Action.hideGrammarlyOnly,source:S.$.Source.user}))),(0,r.a)([this._sidebarVisible,this._nativeSidebarController.visibility]).pipe((0,D.h)((([e,t])=>e&&t))).subscribe((()=>this._nativeSidebarController.focusEditor())),this._commands.pipe((0,G.z)((e=>this._nativeSidebarController.ready.pipe((0,P.w)((t=>this._executeCommand(e))))))).subscribe()]}get position(){return this._nativeSidebarController.position}_executeCommand(e){const t=this._sidebarVisible.get(),i=[S.$.Action.toggle,S.$.Action.hideAll,S.$.Action.hideGrammarlyOnly],s=[S.$.Action.toggle,S.$.Action.show];return i.includes(e.action)&&t?this._hideSidebar(e.action===S.$.Action.hideGrammarlyOnly).pipe((0,g.b)((()=>{this._actions.onHide(),this._gnarTrackingEnabled&&this._gnar.gdocsSidebarGdocsSidebarClose(this._isGDocOwner,e.source,this._alertCounts.expandedViewAlertsCount,this._alertCounts.wordsCount,this._alertCounts.inlineAlertCount,this._alertCounts.nonHiddenClarityAlertCount,this._alertCounts.nonInlineAlertCount)})),(0,M.K)((e=>(this._log.warn("Error injecting gdocs sidebar",e),this._telemetry.sidebarFail(e,"inject"),U.E)))):s.includes(e.action)&&!t?this._showSidebar(e.source===S.$.Source.yellowUnderline).pipe((0,g.b)((()=>{this._actions.onShow(e.alertId),this._gnarTrackingEnabled&&this._gnar.gdocsSidebarGdocsSidebarShow(this._isGDocOwner,e.source,this._alertCounts.expandedViewAlertsCount,this._alertCounts.wordsCount,this._alertCounts.inlineAlertCount,this._alertCounts.nonHiddenClarityAlertCount,this._alertCounts.nonInlineAlertCount)})),(0,M.K)((e=>(this._log.warn("Error restoring gdocs sidebar",e),this._telemetry.sidebarFail(e,"restore"),U.E)))):U.E}}class z extends L{constructor(e,t,i,s,r,n,a,o,h,l,c,u,g=b.Y.create("GDocsCheetahSidebarController")){super(e,t,i,s,r,n,a,o,h,l,c,!1,(e=>m.V.get({monitorAs:"gdocs-sidebar-splash"}).inject(v.EM.fromDocument(document),v.zs.appendChild(document.documentElement),(()=>d.createElement(R,{onClose:()=>{this.hide(S.$.Source.user),this._nativeSidebarController.hideSplashScreen()},position:e})))),g),this._subscriptions.push(u.subscribe((()=>{this._nativeSidebarController.hideSplashScreen()})))}_showSidebar(e){return this._nativeSidebarController.open().pipe((0,g.b)((e=>{this._nativeSidebarController.showCompanionAboutButton(!1),this._nativeSidebarController.unselectActiveSwitcherButton(),this._nativeSidebarController.showSplashScreen(),this._sidebarVisible.set(!0),this._iterableController.onTrigger(_.xz.GDocsSidebarInitialized)})))}_hideSidebar(e){return(!e?this._nativeSidebarController.close():(0,u.of)(!0)).pipe((0,p.h)(!0),(0,g.b)((()=>{this._nativeSidebarController.showCompanionAboutButton(!0),this._nativeSidebarController.removeSwitcherButtonOverlay(),this._sidebarVisible.set(!1)})))}}!function(e){e.create=function(e,t,i,s,r,n,a,o,h,l,c,d){return new z(e,t,i,s,r,n,a,o,h,l,c,d)}}(H||(H={}));var $=i(23650),j=i(47268),V=i(84034),W=i(40759),N=i(57475),Y=i(74746),X=i(77642),K=i(79985),Q=i(5388),J=i(10883),Z=i(63310);var ee=i(16381),te=i(91957);class ie{constructor(e,t,i,s,r,n,o,h,c,d,u,g,p,_,m,v,b,S,C,y,f,w,x,A=new j.t(new Y.c(i),n,X.L.create((()=>o.get()),n,(0,te.Cg)(),t,_,w,(0,ee.n_)(),C,f,new K.M,y).create(Q.P.sidebar),e,S,function(e,t){return e.offsetPosition.pipe((0,J.M)(t.geometry),(0,a.U)((([e,t])=>null==e?[]:Array.from(t.keys()).filter((i=>{const s=t.get(i);return s&&s.rects&&s.rects.some((t=>Z.UL.contains(e,t)))})))))}(s,i)),E=W.p.create(d.get(),u,b,h,c,x),k=(0,N.r)(E,A,v.settings.lens("context"),(()=>(0,V.q)(h)),n,(()=>u.value.lastStart),O.h.create(l.YP),l.YP,l.YP,_,C,(e=>e.forEach((e=>h.removeAlert(e,{_tag:$.i.alertAccepted})))))){this._hoverProvider=r,this.connectionState=g,this.gnar=p,this._felog=_,this.user=m,this.document=v,this.alertsTransformer=b,this.experimentClient=C,this.productMetricsCSClient=y,this.customEventsFilter=x,this.denaliViewAdapter=A,this.capiProxy=E,this.engine=k,r.setAssistantHover(A.highlightHoverProvider)}dispose(){this._hoverProvider.removeAssistantHover(),this.capiProxy.dispose(),this.denaliViewAdapter.dispose(),this.engine.shutdown()}}var se,re=i(38709),ne=i(19724),ae=i(36802);!function(e){e.Close="Close"}(se||(se={}));var oe=i(90023),he=i(84178),le=i(89408),ce=i(24666),de=i(954),ue=i(14969),ge=i(45523),pe=i(90595),_e=i(47557),me=i(3944),ve=i(7833),be=i(17440),Se=i(53785),Ce=i(46059),ye=i(85004);const fe=(e,t)=>(0,_e.Re)(e)?ge.x.observeAttribute(e,"class").pipe((0,de.O)(null),(0,a.U)((i=>!e.classList.contains(t))),(0,D.h)(q.fQ)):U.E,we=e=>(0,_e.Re)(e)?ye.N.observeSizeChanges([e]).pipe((0,de.O)(null),(0,a.U)((t=>"none"!==e.style.display&&"hidden"!==e.style.visibility)),(0,ce.x)()):U.E;class xe{constructor(e,t,i,s,r,n=_e.IG,o=fe,h=we){this._doc=e,this._onClick=t,this._telemetry=i,this._experimentClient=s,this._renderSplashScreen=r,this._resolveElements=n,this._observeClassRemoved=o,this._observeVisibility=h,this._position=O.h.create(Ce.xK.legacy),this.position=this._position.view(),this._activeSwitcherButton=null,this._switcherButtons=[],this._subscriptions=[],this._onRemoveSwitcherButtonOverlay=null,this._switcherButtonClick=e=>{if(null===e.target)return;const t=e.target.closest(Ce.H2.selector);t===this._activeSwitcherButton?this._activeSwitcherButton=null:(this._activeSwitcherButton=t,this._onClick())},this.dispose=()=>{this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[],this._switcherButtons.forEach((e=>e.removeEventListener("click",this._switcherButtonClick)))};const l=this._resolveElements(this._doc,{sidebar:()=>this._doc.querySelector(Ce.iB),switcherButtons:()=>(0,oe.zG)(Array.from(this._doc.querySelectorAll(Ce.H2.selector)),(e=>0===e.length?null:e))}).pipe((0,he.q)(1),(0,le.d)(1));this._ready=l.pipe((0,a.U)((({switcherButtons:e})=>e[0])),(0,P.w)((e=>this._observeClassRemoved(e,Ce.H2.disabledClass))),(0,he.q)(1),(0,le.d)(1)),this._visibility=l.pipe((0,ce.x)(),(0,P.w)((({sidebar:e})=>this._observeVisibility(e))),(0,le.d)(1));const c=this._experimentClient.isGateEnabled(pe.K.GDocsDetectSidebarTypeDynamically),d=l.pipe((0,P.w)((({sidebar:e})=>{const t=this._doc.querySelector(ve.Q6),i=()=>{const t=Ce.uT(e);return c?t:Se.X.legacy};return t?ge.x.create(t,{attributeFilter:["class"]}).pipe((0,de.O)(null),(0,a.U)((()=>i())),(0,ce.x)()):(0,u.of)(i())})));this._subscriptions=[l.subscribe((({switcherButtons:e})=>{this._switcherButtons=e,this._switcherButtons.forEach((e=>e.addEventListener("click",this._switcherButtonClick)))})),d.subscribe((e=>{this._telemetry.trackSidebarType({detectedSidebarType:e,displayedSidebarType:e}),this._position.set(Ce._X(e))}))]}get visibility(){return this._visibility}get ready(){return this._ready}_clickOnFirstSwitcherButton(){const e=this._doc.querySelector(Ce.H2.selector);if(!e)throw new Error("There is no button on native sidebar panel");(0,be.Nk)(e)}clickActiveSwitcherButton(){this._activeSwitcherButton&&((0,be.Nk)(this._activeSwitcherButton),this._activeSwitcherButton=null)}unselectActiveSwitcherButton(){this._activeSwitcherButton=this._doc.querySelector(Ce.H2.selectedSelector),this._activeSwitcherButton&&(0,_e.Re)(this._activeSwitcherButton)&&this._createSwitcherButtonOverlay(this._activeSwitcherButton)}open(){return this._visibility.pipe((0,g.b)((e=>!e&&this._clickOnFirstSwitcherButton())),(0,ue.P)(q.fQ))}close(){return this._visibility.pipe((0,g.b)((e=>e&&this.clickActiveSwitcherButton())),(0,ue.P)(q.X0))}showCompanionAboutButton(e=!0){const t=this._doc.querySelector(Ce.kl);t&&(0,_e.Re)(t)&&(t.style.display=e?"block":"none")}focusEditor(){const e=(0,me.Nd)(this._doc);e&&e.dispatchEvent(new MouseEvent("click"))}removeSwitcherButtonOverlay(){this._onRemoveSwitcherButtonOverlay&&(this._onRemoveSwitcherButtonOverlay(),this._onRemoveSwitcherButtonOverlay=null)}showSplashScreen(){var e;this._splashScreenInjection=null===(e=this._renderSplashScreen)||void 0===e?void 0:e.call(this,this.position)}hideSplashScreen(){var e;null===(e=this._splashScreenInjection)||void 0===e||e.dispose()}_createSwitcherButtonOverlay(e){const t=this._doc.createElement("div"),i=getComputedStyle(e);t.style.width=i.width,t.style.height=i.height,t.style.position=i.position,t.style.zIndex=i.zIndex,t.style.cursor="pointer",t.style.background="transparent",t.style.marginTop=`-${i.height}`;const s=()=>e.classList.add(Ce.H2.hoverClass),r=()=>{e.classList.remove(Ce.H2.hoverClass),e.classList.remove(Ce.H2.activeClass)},n=()=>e.classList.add(Ce.H2.activeClass),a=()=>e.classList.add(Ce.H2.selectedClass),o=()=>{this._onClick(),e.style.pointerEvents="unset"};this._onRemoveSwitcherButtonOverlay=()=>{t.removeEventListener("mouseenter",s),t.removeEventListener("mouseout",r),t.removeEventListener("mousedown",n),t.removeEventListener("mouseup",a),t.removeEventListener("click",o),t.remove()},t.addEventListener("mouseenter",s),t.addEventListener("mouseout",r),t.addEventListener("mousedown",n),t.addEventListener("mouseup",a),t.addEventListener("click",o),e.classList.remove(Ce.H2.selectedClass),e.style.pointerEvents="none",e.insertAdjacentElement("afterend",t)}}var Ae;!function(e){e.create=(e,t,i,s,r,n,a,o)=>new xe(e,t,i,s,r,n,a,o)}(Ae||(Ae={}));var Ee=i(81988),ke=i(39924),Ie=i(50750),Te=i(12518),Be=i(14128),Re=i(89803),He=i(49629),Ue=i(41806);function De(e){const{docId:t,docOwnedByCurrentUser:i}=e.initArgs,{_ctx:s,_unloadables:d,_observableState:u,_plagiarismClient:p,_subs:_,fieldContext:m,sidebarOpened:v,expandedViewAlertsAtom:b,inlineAlertAtom:C,nonInlineAlertAtom:y,nonHiddenClarityAlertAtom:f,wordsCount:w,lazyCheckingService:x,cheetahAssistantDidOpen:A,delayService:E,cheetahAssistantDidClose:k,hoverProviderSubject:I,alertProcessorSubject:T,textRevisionManagerSubject:B,highlightsGeometrySubject:R,layout:U,integrationName:G,cursorTracker:M,textObserver:O,lazyReplacementService:F,checkingServiceState:q,documentSettingsStorage:L,canvasTelemetry:z,textEventsTarget:$,sessionStatsManager:j}=e,V=(0,r.a)([I,B,T,R]).pipe((0,a.U)((([e,t,i,r])=>()=>new ie(U,G,r,M,e,O,F,i,t,x,q,u.view("connection"),m.gnar,m.felog,{isPremium:m.state.user.premium,isAnonymous:m.state.user.anonymous,isGrammarlyEmployee:ne.n.isGrammarlyEmployee(m.state.user),isTestUser:ne.n.isTestUser(m.state.user),isFreeTrial:ne.n.isFreeTrial(m.state.user)},L.document,re.F4,function({layout:e,textObserver:t,userInputShutOff:i,timeoutMs:s,telemetry:r}){const n=(0,Ue.z)(t,e.textField,i,s);return{scrollToMark(t,i){const s=Re.Fd.getMarkRect(t);if(Te.tO(s))return(0,Ie.D)([0]).pipe((0,g.b)((t=>{const i=e.textField.visibleRect.getApproximate();n.scrollToRect(s.right,i.client.top)})));const a=(0,Be.mp)(t.range);return n.scrollToRange(a.start).pipe((0,P.w)((i=>He.S.hz30.pipe((0,he.q)(9),(0,D.h)((i=>{const s=Re.Fd.getMarkRect(t);if(Te.tO(s)){const t=e.textField.visibleRect.getApproximate();return n.scrollToRect(s.right,t.client.top),!0}return!1})),(0,g.b)({complete:()=>{r.error("scroller","Mark has not been found after retries.")}}),(0,he.q)(1)))))},dispose(){n.dispose()}}}({layout:U,textObserver:O,telemetry:z,userInputShutOff:(0,Ee.I)($)}),s.experimentClient,m.productMetricsCSClient,m.state.dynamicConfig,j,(0,o.ff)(c.r4)))));V.pipe(a.U((e=>e())),a.U((e=>l.G({enablePlagiarismSearch:e.capiProxy.enablePlagiarismSearch,disablePlagiarismSearch:e.capiProxy.disablePlagiarismSearch})))).subscribe(h.wW(p));const W=new n.x,N=H.create(s.doc,m.felog.gdocs,m.gnar,{onShow:e=>{m.actions.gdocsSaveDocumentSetting({docIdHash:(0,ae.Of)(t),documentState:{sidebarVisible:!0}}),v.next({kind:"opened",alertId:e})},onHide:()=>{m.actions.gdocsSaveDocumentSetting({docIdHash:(0,ae.Of)(t),documentState:{sidebarVisible:!1}}),v.next({kind:"closed"})},iterableNextFetchSettings:e=>{m.actions.iterableNextFetchSettings(e)}},i,{expandedViewAlertsCount:b.get(),inlineAlertCount:C&&C.get(),nonInlineAlertCount:y&&y.get(),nonHiddenClarityAlertCount:f&&f.get(),wordsCount:w},u,m.actions,s.experimentClient,s.config,Ae.create,A);return d.push(function(e,t){const i=e.pipe((0,D.h)((e=>e.kind===se.Close))).subscribe((()=>t.hide(S.$.Source.user)));return{dispose(){i.unsubscribe()}}}(W,N)),_.push(N.sidebarVisible.subscribe((e=>{e?(E.showDelayMs.next(0),E.hideDelayMs.next(0)):(E.showDelayMs.reset(),E.hideDelayMs.reset())}))),_.push((0,ke.G_)(k).subscribe((()=>{N.hide(S.$.Source.user)}))),N}},18638:(e,t,i)=>{var s=i(29929),r=i(7278)(s);r.push([e.id,"._UUx2a-sidebar{align-items:center;justify-content:center;overflow:hidden;position:relative;}._UUx2a-sidebar ._rjT4p-header{position:absolute;top:0;right:0;width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-top:.25rem;height:32px;}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup{display:flex;flex-direction:row;align-items:center;}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup ._tAUEh-logoIcon{margin:0 .25rem 0 .8rem}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup ._A2vNJ-closeButton{margin-right:3.5px;width:25px;height:25px;display:flex;justify-content:center;align-items:center;border-radius:4px;stroke:#6d758d;}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup ._A2vNJ-closeButton:hover{background-color:#f0f2fc;cursor:pointer;stroke:#4a6ee0}._UUx2a-sidebar ._iAhBE-splashContainer{position:absolute;right:0;top:0;transform:translate(0,calc(50vh - 50%));}._UUx2a-sidebar ._iAhBE-splashContainer ._UCK9k-splash{width:100%;height:100%;animation:_mIR7B-splash-opacity 1s cubic-bezier(.08,.8,.67,1) 400ms 1 normal both,_WG_5I-splash-scale 1s cubic-bezier(.05,.69,.67,1) 400ms 1 normal both}._UUx2a-sidebar ._LQT5h-spinnerContainer{position:absolute;transform:translate(0,calc(50vh - 50%));animation:_WdqUz-spinner-scale 330ms cubic-bezier(.05,.62,.51,1.26) 333ms 1 normal backwards;}._UUx2a-sidebar ._LQT5h-spinnerContainer ._BC8p8-spinner{animation:_BC8p8-spinner 1.2s infinite linear}@keyframes _BC8p8-spinner{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _mIR7B-splash-opacity{0%{opacity:1}100%{opacity:0}}@keyframes _WG_5I-splash-scale{0%{transform:scale(0)}100%{transform:scale(2)}}@keyframes _WdqUz-spinner-scale{0%{transform:translate(0,calc(50vh - 50%)) scale(0)}100%{transform:translate(0,calc(50vh - 50%)) scale(1)}}",""]),r.locals={sidebar:"_UUx2a-sidebar",header:"_rjT4p-header",headerGroup:"_FnbRU-headerGroup",logoIcon:"_tAUEh-logoIcon",closeButton:"_A2vNJ-closeButton",splashContainer:"_iAhBE-splashContainer",splash:"_UCK9k-splash","splash-opacity":"_mIR7B-splash-opacity","splash-scale":"_WG_5I-splash-scale",spinnerContainer:"_LQT5h-spinnerContainer","spinner-scale":"_WdqUz-spinner-scale",spinner:"_BC8p8-spinner"},e.exports=r},7278:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",s=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),s&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),s&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,s,r,n){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(s)for(var o=0;o<this.length;o++){var h=this[o][0];null!=h&&(a[h]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);s&&a[c[0]]||(void 0!==n&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=n),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),t.push(c))}},t}},29929:e=>{e.exports=function(e){return e[1]}},68291:(e,t,i)=>{i.d(t,{Vi:()=>a});var s=i(67177),r=i(90023),n=i(19659);function a(e){return e().then(n.MH)}(0,r.MZ)(s.tS)}}]);