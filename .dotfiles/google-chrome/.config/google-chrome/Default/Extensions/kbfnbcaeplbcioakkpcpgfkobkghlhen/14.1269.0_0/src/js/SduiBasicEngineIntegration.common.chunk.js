(self.webpackChunk=self.webpackChunk||[]).push([[637],{972:(e,t,n)=>{n.d(t,{FS:()=>P,Ns:()=>_,jy:()=>E});var s=n(60213),i=n(12518),o=n(53186),r=n(90023),a=n(78767);const c=/\s/;function d(e,t){const n=e.split(c),[s,...i]=n;t(s);let o=s.length;for(const n of i){t(e[o]),o+=n.length+1,t(n)}}function p(e,t){const n=new s.diff_match_patch,[i,o,r]=function(e,t){const n=[],s=new Map,i=e=>t=>{if(""===t)return;const i=s.get(t)||String.fromCharCode(s.size);s.has(t)||(n.push(t),s.set(t,i)),e.push(i)},o=[];d(e,i(o));const r=[];return d(t,i(r)),[o.join(""),r.join(""),n]}(e,t),a=n.diff_main(i,o,!1);return n.diff_charsToLines_(a,r),n.diff_cleanupSemantic(a),a}const u=/([.!?] )/;function l(e){const t=e.split(u),n=[];for(let e=0;e<t.length;e++){const s=t[e],i=t[e+1];let o=s;u.test(s)||(u.test(i)?(o+=i[0],n.push(o),n.push(" ")):n.push(o))}return n}function h(e){const t=[];for(const n of e){const[e,s]=n;if(e===P.Operation.INSERT&&u.test(s)){const n=l(s);for(const s of n)t.push([e,s])}else t.push(n)}return t}const f=/(\p{Punctuation}|\s)+/mu,v=e=>e[0],g=e=>e[1],E=e=>{const t=function(e){let t=0,n=0;for(const s of e){const[e,i]=s;e===P.Operation.DELETE&&(t+=i.length),e!==P.Operation.DELETE&&e!==P.Operation.RETAIN||(n+=i.length)}return t/n}(e),n=[],s=e=>({groupID:e,diffs:[],showDeletions:t<.4});let i,o=-1,a=s(o);for(const t of e){const[e,r,c]=t;switch(e){case P.Operation.INSERT:!i||v(i)!==P.Operation.DELETE&&v(i)!==P.Operation.INSERT?(o+=1,n.push(a),a=s(o),a.diffs.push(t)):a.diffs.push(t);break;case P.Operation.DELETE:o+=1,a.diffs.length>0&&n.push(a),a=s(o),a.diffs.push(t);break;case P.Operation.RETAIN:c?(o+=1,n.push(a),a=s(o),a.diffs.push(t)):C(r).map((t=>[e,t,c])).forEach((e=>{o+=1,a.diffs.length>0&&n.push(a),a=s(o),a.diffs.push(e)}))}i=t}return a.diffs.length>0&&n.push(a),(0,r.zG)(n,A,I,w,T)};function A(e){return e.map((e=>{const t=e.diffs.every((([e])=>e===P.Operation.DELETE));return{...e,showDeletions:t||e.showDeletions}}))}function I(e){return e.map((e=>{const{diffs:t,showDeletions:n}=e;if(2!==t.length||!n)return e;const[s,i]=t,[o,r]=s,[a,c]=i,d=o===P.Operation.DELETE&&a===P.Operation.INSERT&&r.toLocaleUpperCase()===c;return{...e,showDeletions:!d&&n}}))}function w(e){return e.map((e=>{const{diffs:t,showDeletions:n}=e;if(2!==t.length||!n)return e;const[s,i]=t,[o,r]=s,[a,c]=i,d=o===P.Operation.DELETE&&a===P.Operation.INSERT&&r.length===c.length;return{...e,showDeletions:!d&&n}}))}function m(e){const{diffs:t}=e;if(1===t.length){const[e]=t,[n,s]=e;return(n===P.Operation.INSERT||n===P.Operation.DELETE)&&!f.test(s)}if(2===t.length){const[e,n]=t,[s,i]=e,[o,r]=n;return s===P.Operation.DELETE&&o===P.Operation.INSERT&&i.length===r.length&&!f.test(i)&&!f.test(r)}return!1}function S(e){const{diffs:t}=e;return function(e){const{diffs:t}=e;return 1===t.length&&v(t[0])===P.Operation.RETAIN}(e)&&!f.test(g(t[0]))}function C(e){const t=e.split(f);if(1===t.length)return[e];const n=[],s=t[0],i=t[t.length-1];let o=0;return s&&(n.push(s),o=s.length),i?(n.push(e.substring(o,e.length-i.length)),n.push(i)):n.push(e.substring(o)),n}function T(e){const t=[];let n,s=[],i=[],o=!1,r=0;const a=()=>{r>=2&&o?t.push(...i):t.push(...s),s=[],i=[],n=void 0,r=0,o=!1};for(const c of e)void 0===n?m(c)||S(c)?(s.push(c),n={groupID:c.groupID,diffs:[...c.diffs],showRetainsAsInserts:!0,showDeletions:!1},i.push(n)):t.push(c):m(c)?(s.push(c),r++,n.diffs.push(...c.diffs)):S(c)?(s.push(c),r>0&&(o=!0),n.diffs.push(...c.diffs)):(a(),t.push(c));return a(),t}const _=(e,t)=>{const n=new s.diff_match_patch,i=n.patch_make(e,t),[o]=n.patch_apply(i,e);return o};var P;!function(e){let t;e.getDiff=(t,n)=>(0,r.zG)(i.Y3((()=>{if(t===n)return""===t?[]:[[e.Operation.RETAIN,t]];return h(p(t,n))}),i.KC),i.tS((0,r.ls)(o.nI,i.Yo((()=>new Error("Diff is empty")))))),function(e){e[e.DELETE=-1]="DELETE",e[e.RETAIN=0]="RETAIN",e[e.INSERT=1]="INSERT"}(t=e.Operation||(e.Operation={})),e.matchOperation=function({onInsert:e,onDelete:n,onRetain:s}){return i=>{const o=v(i);switch(o){case t.INSERT:return e(g(i));case t.DELETE:return n(g(i));case t.RETAIN:return s(g(i));default:(0,a.vE)(o)}}}}(P||(P={}))},94978:(e,t,n)=>{n.d(t,{G:()=>r});var s=n(13391),i=n(58303),o=n(70155);class r extends o.J{constructor(){super(),this._popoverActionsHandler=s.h.create(i.YP)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(i.G(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}dispose(){this._popoverActionsHandler.set(i.YP)}}},34942:(e,t,n)=>{n.d(t,{z:()=>o});var s=n(13391),i=n(58303);class o{constructor(){this.activePopoverStack=s.h.create(i.YP),this.activePopoverView=s.h.create(i.YP),this._popoverActionsHandler=s.h.create(i.YP)}addPopover(e,t){}getInteractionActions(e,t,n){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}dispose(){}}},3119:(e,t,n)=>{n.r(t),n.d(t,{createSduiBasicEngine:()=>A,default:()=>I});var s=n(90023),i=n(88012),o=n(90572),r=n(59179),a=n(58303),c=n(45676),d=n(8907),p=n(58508),u=n(73503),l=n(30922),h=n(86305),f=n(8379),v=n(87945),g=n(94978),E=n(34942);const A=({sduiBufferService:e,alertState:t,getByRawAlertId:n,sendUserAction:A,environment:I,capiClient:w,onReplacement:m,sduiPopoversSupported:S=!1})=>{const C=new i.w.Keeper,T=(0,s.ls)((e=>e.toString()),n,a.ij,a.UI((e=>p.j.AlertId.from(e.id)))),_=e.capiEvents.pipe(o.h(c.hX.is("sdui_add","sdui_remove","sdui_update")),o.h(u.e.isSduiEvent),r.U(l.al.fromSource(l.i5.CAPI))),P=S?new g.G:new E.z,b=new h.G(_,T,P),D=new f.Q({sendUserAction:A}),U=new v.U(b,D,I,w,{openAssistant(e){throw new Error("Method is not implemented")},closePopover:t=>e.pushCapiSduiEvent({kind:"sdui_remove",sduiRootId:d.t_.Id.create(t)})},m);return P.setPopoverActionsHandler(U),C.push(t.subscribe((e=>b.notifyAlertsChanged())),e.capiEvents.pipe(o.h(c.hX.is("session_started")),o.h((e=>e.isNewSession))).subscribe((e=>b.onSessionStarted())),e.capiEvents.pipe(o.h(c.hX.is("finish")),o.h((e=>0===e.revision))).subscribe((e=>b.onFirstCheckingFinished())),b),{sduiBufferService:e,sduiManager:b,sduiFeedbackService:D,dispose:()=>{C.dispose()}}},I={createSduiBasicEngine:A}},87945:(e,t,n)=>{n.d(t,{U:()=>k});var s=n(53186),i=n(90023),o=n(27947),r=n(32103),a=n(13391),c=n(74822),d=n(88012),p=n(10883),u=n(59179),l=n(954),h=n(81933),f=n(45128),v=n(58303),g=n(10444),E=n(59833),A=n(21147),I=n(23685),w=n(27643),m=n(72008),S=n(972),C=n(36344),T=n(12518);class _{constructor(){this.feed=C.E,this.currentFeed=v.YP,this.onFeedRemove=C.E,this.onFeedEmpty=C.E,this.header=C.E,this.footer=C.E,this.pushFeed=()=>T.F2(null),this.popFeed=i.Q1,this.focusCard=()=>T.F2(null),this.notifyCardFocused=i.Q1,this.dispose=i.Q1}}var P,b=n(37873),D=n(64181),U=n(65877),R=n(60431),O=n(87410),y=n(57420);class k{constructor(e,t,n,s,r,f){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=n,this.capiClient=s,this.integrationModel=r,this.onReplacement=f,this._focusedItem=a.h.create(v.YP),this._focusedItemUndoDiff=a.h.create(v.YP),this._sduiInlineCardActions=new c.x,this._subs=new d.w.Keeper,this.focusCard=e=>{this._focusedItem.set(v.G(e)),this.clearUndoDiff()},this.handleSduiCardAction=(e,t,n)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:n})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e),(0,i.zG)(k.getSduiFeedActions(e.actions),v.UI((t=>this.integrationModel.openAssistant({type:y.WT.sdui,action:{...e,actions:t,type:o.lY.Type.sduiCardAction}}))))},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new I.x(t,e,new _,s,this._focusedItem.view(v.UI((e=>e.id))));const g=this._sduiViewModel.sduiActionEvents.pipe(p.M(this._sduiInlineCardActions.pipe(u.U(v.G),l.O(v.YP)))).subscribe((([e,t])=>this._nativeHandling(e,(0,i.zG)(t,v.UI((e=>e.match))),(0,i.zG)(t,v.UI((e=>e.cardModel)))))),E=this._sduiInlineCardActions.pipe(h.skipBy(P.eq)).subscribe((({cardAction:e})=>this._sduiViewModel.sduiActionEvents.next(e)));this._subs.push(g,E,this._sduiViewModel)}setUndoDiff(e){this._focusedItemUndoDiff.set(e)}getUndoDiff(){return this._focusedItemUndoDiff.get()}clearUndoDiff(){this._focusedItemUndoDiff.set(v.YP)}_nativeHandling({actions:e,cardId:t,sourceId:n,scope:s},o,a){(0,i.zG)(k.getSduiFeedActions(e),v.UI((e=>{(0,i.zG)(a,v.UI((i=>{i.onOpenExpandedViewBySduiAction(b.Oe.create(e,t,n,s))})))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"openPerformanceScore":case"nativeOpenUserSatisfactionFeedback":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"enableWritingExpertCheck":case"disableWritingExpertCheck":case"enableAudienceAdaptCheck":case"disableAudienceAdaptCheck":case"enableAiStudioCheck":case"disableAiStudioCheck":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":case"stopApplyingAlerts":return;case"closePopover":return void this.integrationModel.closePopover(e.rootPopoverId);case"openLink":return void this.environment.actions.openPopup(new f.Z(e.url));case"copyToClipboard":return void(0,O.v)(e.text);case"upgradeToPremium":return(0,i.zG)(a,v.UI((t=>t.openPlanComparisonPage({utmCampaign:D.L.Place.assistantCardList,overrideUrl:e.url})))),void(0,i.zG)(o,v.UI((e=>e.hide())));case"applyAlerts":return void(0,i.zG)(o,v.UI((n=>{var s;if(null==n.alert)return;const{alert:o}=n,r=this.getUndoDiff();if(v.pC(r)){const i=(0,S.Ns)(n.alert.text,r.value);return n.replace(i,!0,e.alternativeIndex),null===(s=this.onReplacement)||void 0===s||s.call(this,t,o.group,o.category),this.clearUndoDiff(),void n.hide()}(0,i.zG)((0,U.UQ)(o,n.plainText),(t=>new R.U_(t,(t=>n.replace(null!=t?t:"",!1,e.alternativeIndex)))),(n=>(0,i.zG)(v.ij(n.replacements[e.alternativeIndex]),v.UI((e=>n.getOnReplace(e)())),g.bw((()=>{var e;null===(e=this.onReplacement)||void 0===e||e.call(this,t,o.group,o.category)}))))),n.hide()})));case"closeCard":case"removeRoot":return void(0,i.zG)(o,v.UI((e=>e.hide())));case"removeAlerts":return void(0,i.zG)(o,v.UI((e=>{e.ignore(),e.hide()})));case"openGrammarlyGo":return void(0,i.zG)(v.RD([a,o]),v.UI((([e,t])=>{var n,s;const i=(t,n)=>{e.onOpenGrammarlyGo({assistantMode:"genAI",genAIParams:t,source:n})};if(t.alert&&(0,m.t)(t.alert.patternName)){const e=(0,U.UQ)(t.alert,t.plainText);if(e.length>0&&e[0].newText){const n=e[0].newText;i({genAISessionMode:"pushRewrite",writingExpertContext:{alertId:t.alert.id,alertPname:t.alert.patternName,originalText:t.alert.text,replacementText:n},transformRange:t.alert.transformRange},{kind:"inlinePushRewriteSource"})}else i({genAISessionMode:"ideation"},{kind:"inlinePushRewriteSource"})}else i({genAISessionMode:"ideation"},{kind:"inlineCardSource",alertId:null!==(s=null===(n=t.alert)||void 0===n?void 0:n.id)&&void 0!==s?s:null})})));default:(0,r.L0)(e)}}))}}k.getSduiFeedActions=(0,i.ls)(E.hX((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type)),s.nI),function(e){e.eq=A.MW({cardAction:w.t.eq})}(P||(P={}))},87410:(e,t,n)=>{n.d(t,{S:()=>o,v:()=>i});var s=n(12518);async function i(e,t=self){var n,s,i,o;if("string"==typeof e){if(null===(s=null===(n=t.navigator)||void 0===n?void 0:n.clipboard)||void 0===s?void 0:s.writeText)return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported (writeText)")}if(null===(o=null===(i=t.navigator)||void 0===i?void 0:i.clipboard)||void 0===o?void 0:o.write)return t.navigator.clipboard.write(Array.from(e));throw new Error("Clipboard API not supported (write)")}function o(e,t=self){return i(e,t).then((()=>s.F2(void 0))).catch((e=>s.t$(e instanceof Error?e:new Error(String(e)))))}}}]);