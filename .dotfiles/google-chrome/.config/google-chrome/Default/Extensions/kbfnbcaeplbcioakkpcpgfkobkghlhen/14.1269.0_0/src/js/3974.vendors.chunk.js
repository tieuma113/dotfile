(self.webpackChunk=self.webpackChunk||[]).push([[3974],{68885:(e,t,i)=>{i.d(t,{b:()=>s});var a=i(651),n=i(64995),r=i(39010);const s=({size:e})=>(0,a.jsx)(n.J,{accessibilityLabel:"Reader Reactions Agent",size:e,icon:r.Q})},75752:(e,t,i)=>{i.d(t,{n:()=>we});var a=i(651);const n="_root_16op0_1",r="_agentRadioGroup_16op0_11",s="_agentTextareaContainer_16op0_25";var c=i(92379),d=i(21034),o=i(46155),l=i(83689),u=i(27195),m=i(32103),g=i(33885),p=i(68885);const h=(0,c.createContext)(void 0);var v=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(v||{}),x=(e=>(e.LoadingView="agentPanel/readerReactions/loadingView",e.LoadingStreamingView="agentPanel/readerReactions/loadingStreamingView",e.LoadedView="agentPanel/readerReactions/loadedView",e.ReloadButton="agentPanel/readerReactions/reloadButton",e.AudienceSelectionButton="agentPanel/readerReactions/audienceSelectionButton",e.AudienceSelectionView="agentPanel/readerReactions/audienceSelectionView",e.RecheckButton="agentPanel/readerReactions/recheckButton",e.ErrorView="agentPanel/readerReactions/errorView",e.EmptyView="agentPanel/readerReactions/emptyView",e.AddAudienceButton="agentPanel/readerReactions/addAudienceButton",e.AudienceEditView="agentPanel/readerReactions/audienceEditView",e.SaveAudienceButton="agentPanel/readerReactions/saveAudienceButton",e.NewAudienceView="agentPanel/readerReactions/newAudienceView",e.UseNewAudienceButton="agentPanel/readerReactions/useNewAudienceButton",e.RemoveAudienceButton="agentPanel/readerReactions/removeAudienceButton",e))(x||{}),b=i(87179),k=i(63661),w=i(24089),j=i(63829);var y=Object.defineProperty,S=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,I=(e,t,i)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;const z=(0,j.j)("Tracking"),C=(e,t,i={trackImpressionOnce:!1})=>{const[a,n]=(0,c.useState)(!1),r=(()=>{var e;return null==(e=(0,c.useContext)(h))?void 0:e.tracking})(),s=(0,c.useContext)(h),d=((e,t)=>{for(var i in t||(t={}))f.call(t,i)&&I(e,i,t[i]);if(S)for(var i of S(t))A.call(t,i)&&I(e,i,t[i]);return e})({agentId:w.Qi.Id,capiSessionId:null==s?void 0:s.capiSessionId.get(),textWordsCount:null==s?void 0:s.textWordsCount.get()},t),o=(0,c.useCallback)(((e,t,s)=>{const c={componentId:e,detail:s};switch(t){case b.Jn.Impression:if(i.trackImpressionOnce&&a)return;return null==r||r.trackEvent(v.ComponentImpression,c),z.debug("Track event impression",c),void(i.trackImpressionOnce&&n(!0));case b.Jn.Clicked:return null==r||r.trackEvent(v.ComponentClicked,c),void z.debug("Track event clicked",c);default:return(0,m.vE)(t)}}),[r,i.trackImpressionOnce,a]);return(0,k.B)({componentId:e,detail:d,trackEvent:o,autoTrackedInteractions:b.IX.Impression})};var R=i(25494),_=i(2581),O=i(56765),E=i(64995),P=i(9773),B=i(31127);const T=()=>{const e="Not enough content to review",{trackingRef:t}=C(x.EmptyView,{message:e});return(0,a.jsx)(_.x,{borderRadius:2,bgColor:"background-base-subdued",padding:3,width:"100%",ref:t,children:(0,a.jsxs)(O.k,{gap:2,children:[(0,a.jsx)(E.J,{icon:P.q,size:"large",accessibilityLabel:"Writing pen icon"}),(0,a.jsxs)(O.k,{direction:"column",children:[(0,a.jsx)(B.x,{as:"p",variant:"text-xsmall",weight:"semibold",align:"start",children:e}),(0,a.jsxs)(B.x,{as:"p",variant:"text-xsmall",align:"start",children:["Text must be a minimum of ",R.x.MIN_WORDS_TEXT_SIZE," words to receive feedback."]})]})]})})};var V=i(4947),L=i(12065);const M=e=>{const{title:t,description:i}=e.state,{trackingRef:n}=C(x.ErrorView,{message:t});return(0,a.jsxs)(O.k,{direction:"column",align:"center",justify:"center",height:"100%",ref:n,children:[(0,a.jsx)(E.J,{icon:V.F,size:"xlarge",accessibilityLabel:"Warning icon"}),(0,a.jsx)(L.X,{as:"h3",variant:"heading-xsmall",color:"base-default",align:"center",children:t}),(0,a.jsx)(B.x,{as:"p",variant:"text-small",color:"base-subdued",align:"center",children:i})]})};var F=i(24590),K=i(15843),N=i(14278),U=i(32687),G=i(37445);const D=({bgColor:e,color:t,marker:i,lineHeight:n})=>(0,a.jsx)(_.x,{width:24,height:24,borderRadius:3,bgColor:e,style:{flex:"none"},children:(0,a.jsx)(O.k,{align:"center",justify:"space-evenly",children:(0,a.jsx)(B.x,{as:"span",variant:"text-small",weight:"semibold",style:{lineHeight:n},children:(0,a.jsx)("span",{style:{color:t,verticalAlign:"middle"},children:i})})})}),X=({itemMarker:e,itemText:t})=>(0,a.jsxs)(O.k,{gap:3,children:[(0,a.jsx)(D,{bgColor:"green-20",color:G.jN,marker:e,lineHeight:"22px"}),(0,a.jsx)(B.x,{as:"p",variant:"text-small",color:"base-default",align:"start",children:t})]}),$=({category:e,question:t})=>(0,a.jsxs)(O.k,{gap:3,children:[(0,a.jsx)(D,{bgColor:"gold-20",color:G.kE,marker:"?",lineHeight:"22px"}),(0,a.jsxs)(B.x,{as:"p",color:"base-default",align:"start",children:[(0,a.jsx)(B.x,{as:"span",variant:"text-small",weight:"bold",children:e}),(0,a.jsx)(B.x,{as:"span",variant:"text-small",children:" · "}),(0,a.jsx)(B.x,{as:"span",variant:"text-small",children:t})]})]});var H=i(97408),q=Object.defineProperty,Z=Object.defineProperties,W=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,ee=(e,t,i)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,te=(e,t)=>{for(var i in t||(t={}))Q.call(t,i)&&ee(e,i,t[i]);if(J)for(var i of J(t))Y.call(t,i)&&ee(e,i,t[i]);return e};const ie=e=>{const t=e,{iconStart:i,iconEnd:n,text:r,style:s}=t,c=((e,t)=>{var i={};for(var a in e)Q.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&J)for(var a of J(e))t.indexOf(a)<0&&Y.call(e,a)&&(i[a]=e[a]);return i})(t,["iconStart","iconEnd","text","style"]),d=te({borderRadius:"var(--space-3)",padding:"var(--space-3)",justifyContent:"start",height:"auto"},s);return(0,a.jsx)(H.z,((e,t)=>Z(e,W(t)))(te({variant:"secondary",width:"full",style:d},c),{children:e.children||(0,a.jsxs)(O.k,{gap:3,align:"center",width:"100%",children:[i&&(0,a.jsx)(E.J,{icon:i,size:"large",accessibilityLabel:""}),(0,a.jsx)(B.x,{as:"span",color:"base-subdued",variant:"text-small",style:{flexGrow:1},children:r}),n&&(0,a.jsx)(E.J,{icon:n,size:"small",accessibilityLabel:""})]})}))},ae=()=>(0,a.jsxs)(O.k,{direction:"row",gap:3,children:[(0,a.jsx)(F.g.Icon,{}),(0,a.jsxs)(O.k,{direction:"column",width:"90%",children:[(0,a.jsx)(F.g.Text,{variant:"text-small"}),(0,a.jsx)(F.g.Text,{variant:"text-small"}),(0,a.jsx)(F.g.Text,{variant:"text-small"})]})]}),ne=({state:e})=>{var t,i,n,r,s,c,d,o,l,u,m,g,p,h,v;const{trackingRef:b}=C(null!=e&&e.payload?x.LoadingStreamingView:x.LoadingView,{}),k=({items:e,renderItem:t,renderLoader:i,keepLastLoader:n})=>{const r=Math.max(n?1:0,3-(null!=e?e:[]).length);return(0,a.jsxs)(a.Fragment,{children:[(null!=e?e:[]).map(t),[...Array(r).keys()].map(i)]})},w=(null==(t=null==e?void 0:e.payload)?void 0:t.analysis)&&U.O.getSummary(null==(i=null==e?void 0:e.payload)?void 0:i.analysis),j=null==(n=null==e?void 0:e.payload)?void 0:n.audience_description,y=null==(s=null!=(r=null==j?void 0:j.selected_recipient)?r:null==j?void 0:j.most_probable_recipient)?void 0:s.probable_recipient;return(0,a.jsxs)(O.k,{direction:"column",gap:6,ref:b,children:[(0,a.jsxs)(O.k,{direction:"column",gap:2,children:[y?(0,a.jsx)(ie,{isDisabled:!0,children:(0,a.jsxs)(O.k,{gap:3,align:"center",width:"100%",children:[(0,a.jsx)(E.J,{icon:K.E,size:"large",accessibilityLabel:""}),(0,a.jsx)(B.x,{as:"span",color:"base-subdued",variant:"text-small",style:{flexGrow:1},children:y}),(0,a.jsx)(E.J,{icon:N.M,size:"small",accessibilityLabel:""})]})}):(0,a.jsx)(F.g.Text,{variant:"text-small"}),w?(0,a.jsx)(B.x,{as:"p",variant:"text-small",color:"base-default",align:"start",children:w}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F.g.Text,{variant:"text-small"}),(0,a.jsx)(F.g.Text,{variant:"text-small"}),(0,a.jsx)(F.g.Text,{variant:"text-small"})]})]}),(0,a.jsxs)(O.k,{direction:"column",gap:4,children:[(0,a.jsx)(L.X,{as:"h3",variant:"heading-xsmall",align:"start",children:null!=(o=null==(d=null==(c=null==e?void 0:e.payload)?void 0:c.analysis)?void 0:d.keyTakeawaysHeader)?o:"Reader will remember"}),(0,a.jsx)(O.k,{direction:"column",gap:3,children:k({items:null==(u=null==(l=null==e?void 0:e.payload)?void 0:l.analysis)?void 0:u.keyTakeaways,renderItem:(e,t)=>(0,a.jsx)(X,{itemMarker:t+1,itemText:e},`item_${t}`),renderLoader:e=>(0,a.jsx)(ae,{},`loader_${e}`),keepLastLoader:!1})})]}),(0,a.jsxs)(O.k,{direction:"column",gap:4,children:[(0,a.jsx)(L.X,{as:"h3",variant:"heading-xsmall",align:"start",children:null!=(p=null==(g=null==(m=null==e?void 0:e.payload)?void 0:m.analysis)?void 0:g.openQuestionsHeader)?p:"Reader will ask"}),(0,a.jsx)(O.k,{direction:"column",gap:3,children:k({items:null==(v=null==(h=null==e?void 0:e.payload)?void 0:h.analysis)?void 0:v.openQuestions,renderItem:(e,t)=>(0,a.jsx)($,{category:e.questionHeader,question:e.question},`item_${t}`),renderLoader:e=>(0,a.jsx)(ae,{},`loader_${e}`),keepLastLoader:!0})})]})]})},re=e=>{const{audience:t,loadingTimeMs:i,onSelectAudience:n}=e,{trackingRef:r}=C(x.LoadedView,{loadingTimeMs:i},{trackImpressionOnce:!0}),{trackClicked:s}=C(x.AudienceSelectionButton,{}),{result:c}=e.state;return(0,a.jsxs)(O.k,{direction:"column",gap:6,paddingBottom:4,ref:r,children:[(0,a.jsxs)(O.k,{direction:"column",gap:2,children:[(0,a.jsx)(ie,{onClick:()=>{s(),n()},iconStart:K.E,iconEnd:N.M,text:null==t?void 0:t.probable_recipient,accessibilityLabel:`Current audience: ${null==t?void 0:t.probable_recipient}. Click to select another.`}),(0,a.jsx)(B.x,{as:"p",variant:"text-small",color:"base-default",align:"start",children:U.O.getSummary(c)})]}),(0,a.jsxs)(O.k,{direction:"column",gap:4,children:[(0,a.jsx)(L.X,{as:"h3",variant:"heading-xsmall",align:"start",children:c.keyTakeawaysHeader}),(0,a.jsx)(O.k,{direction:"column",gap:3,children:c.keyTakeaways.map(((e,t)=>(0,a.jsx)(X,{itemMarker:t+1,itemText:e},`item_${t}`)))})]}),(0,a.jsxs)(O.k,{direction:"column",gap:4,children:[(0,a.jsx)(L.X,{as:"h3",variant:"heading-xsmall",align:"start",children:c.openQuestionsHeader}),(0,a.jsx)(O.k,{direction:"column",gap:3,children:c.openQuestions.map(((e,t)=>(0,a.jsx)($,{category:e.questionHeader,question:e.question},`item_${t}`)))})]})]})};var se=i(84175),ce=i(21379),de=i(1298),oe=i(72905),le=i(4464);const ue=({audience:e,canBeRemoved:t,onRemove:i})=>{const{trackClicked:n}=C(x.RemoveAudienceButton,{audienceName:e.probable_recipient});return(0,a.jsx)(se.E,{value:e.id,children:(0,a.jsxs)(O.k,{justify:"space-between",align:"center",width:"100%",height:24,children:[(0,a.jsx)(B.x,{as:"p",color:"base-subdued",variant:"text-small",children:e.probable_recipient}),t&&(0,a.jsx)(ce.v,{activator:"more-horizontal",children:(0,a.jsx)(ce.v.Item,{icon:de.o,onClick:()=>{n(),i(e)},children:"Remove"},"Remove")})]})})},me=({state:e,onSetAudience:t,onEditAudience:i,onRemoveAudience:n})=>{var s;const{audiences:d,selectedAudience:o,allowCustomAudience:l,allowRemoveAudience:u}=e,[m,g]=(0,c.useState)(o),{trackingRef:p}=C(x.AudienceSelectionView,{audiences:d.map((e=>e.probable_recipient))},{trackImpressionOnce:!0}),{trackClicked:h}=C(x.RecheckButton,{audienceName:null!=(s=null==m?void 0:m.probable_recipient)?s:""}),{trackClicked:v}=C(x.AddAudienceButton,{});return(0,a.jsxs)(O.k,{direction:"column",justify:"space-between",height:"100%",gap:2,ref:p,children:[(0,a.jsxs)(O.k,{direction:"column",gap:2,children:[(0,a.jsxs)(O.k,{direction:"column",gap:1,children:[(0,a.jsx)(L.X,{as:"h2",variant:"heading-small",align:"start",children:"Audience"}),(0,a.jsx)(B.x,{as:"p",variant:"text-small",color:"base-default",align:"start",children:"Tailor the feedback to who you're writing for"})]}),(0,a.jsxs)(se.F,{legend:"Audiences",legendDisplay:"hidden",defaultValue:null==o?void 0:o.id,className:r,onChange:e=>{const t=d.find((t=>t.id===e));t&&g(t)},children:[(0,a.jsx)(O.k,{direction:"column",gap:2,children:d.map(((e,t)=>(0,a.jsx)(ue,{audience:e,onRemove:n,canBeRemoved:!!u&&t>=le.t6},e.id)))}),l&&(0,a.jsx)(ie,{onClick:()=>{v(),i()},iconStart:oe.m,text:"Create audience"})]})]}),(0,a.jsx)(H.z,{variant:"primary",width:"full",size:"large",text:"Save and recheck",isDisabled:!m,onClick:()=>{h(),m&&t(m)}})]})};var ge=i(20466),pe=i(46068);const he=({state:e,onSaveAudience:t})=>{const{text:i}=e,[n,r]=(0,c.useState)(i),[d,o]=(0,c.useState)(!1),{trackingRef:l}=C(x.AudienceEditView,{}),{trackClicked:u}=C(x.SaveAudienceButton,{sampleLength:n.length});return(0,a.jsxs)(O.k,{direction:"column",justify:"space-between",height:"100%",gap:6,ref:l,children:[(0,a.jsxs)(O.k,{direction:"column",height:"100%",gap:4,className:s,children:[(0,a.jsx)(L.X,{as:"h2",variant:"heading-small",align:"start",children:"Create an audience"}),(0,a.jsx)(B.x,{as:"p",variant:"text-small",color:"base-default",align:"start",children:"Describe a reader to give you feedback. Be detailed and specific about who they are and what they care about."}),(0,a.jsx)(ge.g,{placeholder:"Describe your reader",defaultValue:n,onChange:r,label:"Describe your reader",labelDisplay:"hidden",resizable:"off"})]}),(0,a.jsx)(H.z,{variant:"primary",width:"full",size:"large",text:"Create audience",isLoading:d,isDisabled:!(e=>{const t=(0,pe.iD)(e);return 3<=t&&t<=1600})(n),onClick:()=>{o(!0),u(),t(n)}})]})},ve=({state:e,onUseAudience:t})=>{const{audience:i}=e,{trackingRef:n}=C(x.NewAudienceView,{audienceName:i.probable_recipient}),{trackClicked:r}=C(x.UseNewAudienceButton,{audienceName:i.probable_recipient});return(0,a.jsxs)(O.k,{direction:"column",justify:"space-between",height:"100%",ref:n,children:[(0,a.jsxs)(O.k,{direction:"column",gap:4,children:[(0,a.jsxs)(O.k,{direction:"column",gap:2,children:[(0,a.jsx)(L.X,{as:"h2",variant:"heading-small",align:"start",children:"Review your audience"}),(0,a.jsx)(B.x,{as:"p",variant:"text-small",color:"base-default",align:"start",children:"Does this sound right? You can go back to make changes."})]}),(0,a.jsx)(_.x,{bgColor:"background-success-subdued",borderRadius:3,padding:4,children:(0,a.jsxs)(O.k,{direction:"column",gap:1,children:[(0,a.jsxs)(O.k,{gap:1,color:"brand-default",children:[(0,a.jsx)(E.J,{icon:K.E,variant:"inherit",size:"small",accessibilityLabel:"Audience icon"}),(0,a.jsx)(B.x,{as:"p",variant:"text-xsmall",weight:"semibold",children:"Audience"})]}),(0,a.jsx)(B.x,{as:"p",variant:"text-medium",weight:"semibold",children:i.probable_recipient}),(0,a.jsx)(B.x,{as:"p",variant:"text-small",children:i.overall_recipient_description})]})})]}),(0,a.jsx)(H.z,{variant:"primary",width:"full",size:"large",text:"Use this audience",onClick:()=>{r(),t(i)}})]})};var xe=i(3664),be=i(44155);const ke=({onBack:e,title:t})=>(0,a.jsxs)(O.k,{height:48,justify:"space-between",align:"center",paddingLeft:4,paddingRight:4,children:[(0,a.jsx)(xe.h,{variant:"tertiary",icon:be.n,accessibilityLabel:"Back",size:"medium",onClick:e}),(0,a.jsxs)(O.k,{gap:2,align:"center",children:[(0,a.jsx)(p.b,{size:"small"}),(0,a.jsx)(L.X,{as:"h3",variant:"heading-xxsmall",color:"base-default",children:t})]}),(0,a.jsx)("div",{style:{width:"var(--space-6)"}})]}),we=({viewModel:e,onClosePanel:t})=>{const i=(0,c.useRef)(),[r,s]=(0,c.useState)(0);(0,c.useEffect)((()=>{switch(e.state.get().kind){case R.x.State.Kind.Initial:case R.x.State.Kind.Loading:i.current||(i.current=performance.now());break;case R.x.State.Kind.Loaded:s(i.current?performance.now()-i.current:0),i.current=void 0;break;default:i.current=void 0}}),[e.state]);const{trackClicked:v}=C(x.ReloadButton,{}),b=(0,d.PK)(e.hasTextChanges);return(0,a.jsx)(h.Provider,{value:e.context,children:(0,a.jsx)(o.Py,{renderHeader:()=>(0,a.jsx)(g.F.div,{children:e.state.view((i=>{const n=i.kind===R.x.State.Kind.Initial||i.kind===R.x.State.Kind.Loading?{}:{left:t&&[{icon:l.V,label:"Close",onClick:t}],right:[{icon:u.a,label:"Reload",onClick:()=>{v(),e.loadReactions()},popover:b}]};return i.kind===R.x.State.Kind.AudienceSelection||i.kind===R.x.State.Kind.AudienceEditing||i.kind===R.x.State.Kind.AudienceSummary?(0,a.jsx)(ke,{onBack:e.goBack,title:e.title}):(0,a.jsx)(o.i7,{title:e.title,renderIcon:({size:e})=>(0,a.jsx)(p.b,{size:e}),state:"expanded",controls:n})}))}),renderBody:()=>(0,a.jsx)(g.F.div,{className:n,children:e.state.view((t=>{const i=t.kind;switch(i){case R.x.State.Kind.Initial:return(0,a.jsx)(ne,{});case R.x.State.Kind.Loading:return(0,a.jsx)(ne,{state:t});case R.x.State.Kind.Empty:return(0,a.jsx)(T,{});case R.x.State.Kind.Error:return(0,a.jsx)(M,{state:t});case R.x.State.Kind.Loaded:return(0,a.jsx)(re,{state:t,loadingTimeMs:r,audience:e.audience.get(),onSelectAudience:e.selectAudience});case R.x.State.Kind.AudienceSelection:return(0,a.jsx)(me,{state:t,onSetAudience:e.setAudience,onEditAudience:e.editAudience,onRemoveAudience:e.removeAudience});case R.x.State.Kind.AudienceEditing:return(0,a.jsx)(he,{state:t,onSaveAudience:e.saveAudience});case R.x.State.Kind.AudienceSummary:return(0,a.jsx)(ve,{state:t,onUseAudience:e.setAudience});default:(0,m.L0)(i)}}))})})})}},24089:(e,t,i)=>{i.d(t,{Qi:()=>F});var a=i(5749),n=i(81600),r=i(704),s=i(2099),c=i(57899),d=i(74170),o=i(39010),l=i(13391),u=i(84308),m=i(84714),g=i(90572),p=i(88012),h=i(59179),v=i(29416),x=i(63532),b=i(20161),k=i(32073),w=i(84178),j=i(2187),y=i(45676),S=i(21034),f=i(58303),A=i(86399),I=i(90023),z=i(4464),C=i(723),R=i(63829),_=i(25494),O=i(21007),E=(i(75752),i(68885),Object.defineProperty),P=Object.defineProperties,B=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,M=(e,t,i)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;d.AIEditorReaderReactionsInternal,d.AIEditorReaderReactionsExternal;var F,K;(K=F||(F={})).Id=z.oJ,K.getVBarTitle=e=>{var t;return a.h.isWithRewriteOrComment(e)?null!=(t=e.surface.explanation)?t:e.surface.title:void 0},K.getAgentMetadataSource=e=>(0,C.h)(e)&&a.h.isWithRewriteOrComment(e)?{sourceAction:e.surface.sourceAction}:void 0,K.pushedContentItemsFilter=e=>e.view((e=>t=>(0,C.h)(t)&&(e.kind!==_.x.State.Kind.Loading||!a.h.isWithRewrite(t)))),K.create=e=>{const t=e.decorationService.createDecorationFactory(K.Id),i=e.experimentationBridge.isAssigned(d.AIEditorParaphraserAllUnderlines),a=e.initNavigation(K.Id,i?s.r.Regular:s.r.SingleThread),E=l.h.create(void 0),F=O.z.create({agentId:K.Id,agentGenericService:e.agentGenericService,pushedContentService:e.pushedContentService,fileUploadService:e.fileUploadService}),N=e.sessionChecksState.textInfo.view((0,I.ls)(f.UI((e=>({wordsCount:e.wordsCount,charsCount:e.charsCount}))),f.fS((()=>({wordsCount:0,charsCount:0}))))),U=e.experimentationBridge.isAssigned(d.ExtensionReaderReactionsTextChangedNotification)?u.a([e.editor.changes,a.isPanelOpen],((e,t)=>t&&("flush"===e.kind||"reset"===e.kind||Math.abs(e.length)>z.tK))):m.of(!1),G={customAudiences:e.experimentationBridge.isAssigned(d.AIEditorReaderReactionsCustomAudience),removeCustomAudiences:e.experimentationBridge.isAssigned(d.AIEditorReaderReactionsRemoveCustomAudience)},D=_.x.create({trackingServiceProvider:e.trackingServiceProvider,capiSessionId:E,agenticService:F,featureFlags:G,textChanged:U,textInfo:N,title:(0,C.Z)(e.experimentationBridge)}),X=n.pS.create({agentId:K.Id,decorationsFactory:t,isActive:a.isPanelOpen,pushedContentService:e.pushedContentService,vbarFeedbackService:e.vbarFeedbackService,trackingServiceProvider:e.trackingServiceProvider,decorationService:e.decorationService,uphookHubClient:e.uphookHubClient,getDecorationFactory:r.p,experimentationBridge:e.experimentationBridge,userService:e.userService,agentMetadataSource:K.getAgentMetadataSource,itemsFilter:(0,K.pushedContentItemsFilter)(D.state),trustedRewrite:I.jv,vbarRenderOverrides:{getCardIcon:()=>({icon:o.Q}),getCardTitle:K.getVBarTitle,getVBarProps:(e,t)=>((e,t)=>P(e,B(t)))(((e,t)=>{for(var i in t||(t={}))V.call(t,i)&&M(e,i,t[i]);if(T)for(var i of T(t))L.call(t,i)&&M(e,i,t[i]);return e})({},e),{primaryText:(0,K.getVBarTitle)(t)})}}),$=e.capiSession.events.pipe(g.h(y.hX.is("session_started"))),H=new p.w.Keeper;e.experimentationBridge.isAssigned(d.AIEditorReaderReactionsRebase)&&H.push(e.pushedContentService.rebaseItems(C.h).subscribe()),H.push((0,S.bH)({agentId:K.Id,decorationService:e.decorationService,isPanelOpen:a.isPanelOpen,state:D.state,logger:(0,R.j)(),findFirstVBarForAction:e=>F.currentVBars.pipe(h.U(A.YM)),filterAllowedStates:e=>e.kind===_.x.State.Kind.Loaded,getSelectedAction:e=>f.G({}),equals:I.jv}).subscribe()),H.push($.subscribe((e=>E.set(e.sessionUuid))),u.a([N,D.state,a.isPanelOpen],((e,t,i)=>i&&t.kind===_.x.State.Kind.Empty&&e.wordsCount>_.x.MIN_WORDS_TEXT_SIZE)).pipe(g.h(I.yR),v.b(100),g.h((()=>D.state.get().kind===_.x.State.Kind.Empty)),x.b((()=>D.loadReactions()))).subscribe(),u.a([$,e.sessionChecksState.checkingState.pipe(g.h((e=>"idle"===e)))]).pipe(b.w((e=>u.a([D.state,a.isPanelOpen],((e,t)=>t&&e.kind===_.x.State.Kind.Initial)).pipe(g.h(I.yR),v.b(100),x.b((()=>D.loadReactions())))))).subscribe());const q=l.h.create(!1),Z=new k.w0;return Z.add(e.capiSession.events.pipe(g.h(y.hX.is("session_started")),w.q(1),h.U((e=>e.allowedFeatures.includes("READER_REACTIONS")))).subscribe(j.wW(q))),{agent:{id:K.Id,decorations:c.dX.Collection.create(K.Id,{pushedContent:X}),viewModel:D,dispose:()=>{H.dispose(),D.dispose(),Z.unsubscribe()}},isAvailable:q}}},32687:(e,t,i)=>{i.d(t,{E:()=>n,O:()=>a});var a,n,r,s=i(11633),c=i(43351),d=i(90023),o=i(12518),l=i(59833);(e=>{const t=s.OT(s.dt({questionHeader:s.Z_,question:s.Z_}));e.ReactionsIO=s.OT(s.jV([s.dt({probableAudience:s.Z_,keyTakeawaysHeader:s.Z_,keyTakeaways:s.IX(s.Z_),openQuestionsHeader:s.Z_,openQuestions:s.IX(t)}),s.r$({strengthSummary:s.Z_,summary:s.Z_})])),e.AudienceIO=s.OT(s.dt({id:s.Z_,probable_recipient:s.Z_,overall_recipient_description:s.Z_}));const i=s.OT(s.jV([s.dt({most_probable_recipient:e.AudienceIO,other_probable_recipients:s.IX(e.AudienceIO)}),s.r$({selected_recipient:e.AudienceIO})]));e.PayloadIO=s.OT(s.dt({analysis:e.ReactionsIO,audience_description:i})),e.isPartial=e=>"rawPayload"in e,e.getSummary=e=>{var t;return null!=(t=e.summary?e.summary:e.strengthSummary)?t:""},e.decode=t=>(0,d.zG)(o.Y3((()=>JSON.parse(t)),l.of),o.tS(e.PayloadIO.decode),o.Vn(c.Rn),o.Vn((e=>new Error(`Failed to parse reactions:\n${e.join("\n")}`)))),e.decodeAudience=t=>(0,d.zG)(o.Y3((()=>JSON.parse(t)),l.of),o.tS(e.AudienceIO.decode),o.Vn(c.Rn),o.Vn((e=>new Error(`Failed to parse audience:\n${e.join("\n")}`))))})(a||(a={})),(r=n||(n={})).PartialPayloadIO=s.OT(s.r$(a.PayloadIO.type.props)),r.decode=e=>(0,d.zG)(o.Y3((()=>JSON.parse(e)),l.of),o.tS(r.PartialPayloadIO.decode),o.Vn(c.Rn),o.Vn((e=>new Error(`Failed to parse partial reactions:\n${e.join("\n")}`))),(t=>({rawPayload:e,parsedPayload:t}))),r.encodeAudience=(e,t)=>JSON.stringify(r.PartialPayloadIO.encode({audience_description:{most_probable_recipient:t[0],selected_recipient:e,other_probable_recipients:t.slice(1)}}))},21007:(e,t,i)=>{i.d(t,{z:()=>a});var a,n=i(9119),r=i(96333),s=i(63532),c=i(59179),d=i(84714),o=i(20232),l=i(12518),u=i(67177),m=i(90023),g=i(723),p=i(63829),h=i(32687);(a||(a={})).create=e=>{const{agentGenericService:t,pushedContentService:i,fileUploadService:a,agentId:v}=e,x=(0,p.j)("AgentService"),b=e=>(0,m.zG)(e,u.SA((e=>(x.error("Error requesting reactions",e),e)),(e=>e.pipe(s.b((e=>x.debug("Received reactions",e))),c.U(l.VS((e=>"partial"===e.kind?l.F2(h.E.decode(e.payload)):(0,m.zG)(h.O.decode(e.payload),l.Vn((e=>(x.error("Error decoding reactions",e),e))),l.UI((e=>(x.debug("Decoded reactions"),e)))))))))),u.fS((e=>o.of(d.of(l.t$(e))))));return{getReactions:()=>(0,m.zG)(t.requestWithStreaming({commandId:"start",payload:"",agentId:v}),b),setAudience:(e,i)=>(i.find((t=>t.id===e.id))||(i=[...i,e]),(0,m.zG)(t.requestWithStreaming({commandId:"audienceSelection",payload:h.E.encodeAudience(e,i),agentId:v}),b)),createAudience:e=>(0,m.zG)(a.uploadFile({file:new File([e],"custom_audience",{type:"text/plain"}),useCase:n._.CustomAudience,useCaseParameters:{kind:"customAudience",name:"Custom audience"},agentId:v}),u.Vn((e=>new Error(e.message))),u.tS((e=>u.Uo(h.O.decodeAudience(e.fileContent))))),removeAudience:e=>(0,m.zG)(a.removePersistentData({useCase:n._.CustomAudience,useCaseParameters:{kind:"customAudience",name:e.probable_recipient},agentId:v}),u.Vn((e=>new Error(e.message))),u.UI((t=>{var i,a;return null!=(a=null==(i=t.useCaseParameters)?void 0:i.name)?a:e.probable_recipient}))),currentVBars:i.getCollection(g.h).view((e=>r.$.values(e))),clearVBars:()=>{x.debug("Clearing vBars"),i.clear(g.h)}}}},723:(e,t,i)=>{i.d(t,{Z:()=>c,h:()=>s});var a=i(5749),n=i(1254),r=i(4464);const s=e=>a.z.isVBar(e)&&a.h.isWithRewriteOrComment(e)&&"readerReactions"===e.surface.sourceAgent,c=e=>{var t;switch(null!=(t=e.getTreatment(n.eZ))?t:"control"){case"control":default:return r.K_;case"insights":return"Insights";case"audience_insight":return"Audience Insight";case"feedback_predictor":return"Feedback Predictor"}}},63829:(e,t,i)=>{i.d(t,{j:()=>r});var a=i(64443);const n="ReaderReactions";function r(e=""){return a.C8.Logging.getLogger(e?`${n}.${e}`:n)}},25494:(e,t,i)=>{i.d(t,{x:()=>a});var a,n,r,s,c=i(88012),d=i(13391),o=i(90023),l=i(59179),u=i(20232),m=i(12518),g=i(32687),p=i(63829);n=a||(a={}),r=n.State||(n.State={}),(s=r.Kind||(r.Kind={})).Initial="initial",s.Loading="loading",s.Loaded="loaded",s.Empty="empty",s.Error="error",s.AudienceSelection="audienceSelection",s.AudienceEditing="audienceEditing",s.AudienceSummary="audienceSummary",n.MIN_WORDS_TEXT_SIZE=100,n.create=e=>{var t;const{title:i,agenticService:a,capiSessionId:r,featureFlags:s,textChanged:h,textInfo:v,trackingServiceProvider:x}=e,b=new c.w.Keeper,k=(0,p.j)("AgentViewModel"),w=d.h.create(null!=(t=e.state)?t:{kind:"initial"}),j=d.h.create([]),y=d.h.create(void 0),S={capiSessionId:r,textWordsCount:v.view((e=>e.wordsCount)),tracking:x.getTrackingService()},f=[],A=d.h.create(!1);b.push(h.subscribe((e=>A.set(e))));const I=e=>(0,o.zG)(e,u.UI(l.U((e=>(0,o.zG)(e,m.bw((e=>(g.O.isPartial(e)&&m.nM(e.parsedPayload)&&a.clearVBars(),m.F2(e)))),m.UI((e=>{var t;let i;return g.O.isPartial(e)?m.tO(e.parsedPayload)&&(i=e.parsedPayload.right.audience_description):i=e.audience_description,i&&(j.set([i.most_probable_recipient,...i.other_probable_recipients]),y.set(null!=(t=i.selected_recipient)?t:i.most_probable_recipient)),e})),m.g_((()=>({kind:"error",title:"Something went wrong",description:"To chat with Grammarly, please close this sidebar, then reopen it."})),(e=>g.O.isPartial(e)?m.tO(e.parsedPayload)?{kind:"loading",payload:e.parsedPayload.right}:w.get():(A.set(!1),{kind:"loaded",result:e.analysis}))))))),u.UI((e=>e.subscribe((e=>w.set(e))))),u.UI((e=>b.push(e))));return{title:i,state:w,audience:y,context:S,featureFlags:s,hasTextChanges:A,loadReactions:()=>(k.debug("Loading evaluation"),"loading"===w.get().kind?Promise.resolve():v.view((e=>e.wordsCount)).get()<n.MIN_WORDS_TEXT_SIZE?(w.set({kind:"empty"}),Promise.resolve()):(w.set({kind:"loading"}),a.clearVBars(),(0,o.zG)(a.getReactions(),I)())),selectAudience:()=>{f.push(w.get()),w.set({kind:"audienceSelection",audiences:j.get(),selectedAudience:y.get(),allowCustomAudience:s.customAudiences,allowRemoveAudience:s.removeCustomAudiences})},editAudience:()=>{f.push(w.get()),w.set({kind:"audienceEditing",text:""})},saveAudience:e=>(k.debug("Saving audience"),f.push({kind:"audienceEditing",text:e}),(0,o.zG)(a.createAudience(e),u.UI((0,o.zG)(m.g_((e=>({kind:"error",title:e.name,description:e.message})),(e=>({kind:"audienceSummary",audience:e}))))),u.UI((e=>w.set(e))))()),removeAudience:e=>(k.debug(`Removing audience ${e.probable_recipient}`),(0,o.zG)(a.removeAudience(e),u.UI((t=>(0,o.zG)(t,m.bw((t=>(j.modify((t=>t.filter((t=>t.id!==e.id)))),m.F2(t)))),m.g_((e=>({kind:"error",title:e.name,description:`${e.message}. Press the "Reload" button to continue working.`})),(e=>({kind:"audienceSelection",audiences:j.get(),selectedAudience:y.get(),allowCustomAudience:s.customAudiences,allowRemoveAudience:s.removeCustomAudiences})))))),u.UI((e=>w.set(e))))()),setAudience:e=>(k.debug(`Setting new audience: ${e}`),"loading"===w.get().kind?Promise.resolve():(f.length=0,w.set({kind:"loading"}),a.clearVBars(),(0,o.zG)(a.setAudience(e,j.get()),I)())),goBack:()=>{const e=f.pop();e&&w.set(e)},dispose:()=>{b.dispose()}}}},44155:(e,t,i)=>{i.d(t,{n:()=>s});var a=i(92379),n=i(21886),r=i(45981);const s=(0,n.I)("color",(({title:e,titleId:t,desc:i,descId:n,resourcePrefix:s=(0,r.O)(),...c})=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceLeft",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...c},i?a.createElement("desc",{id:n},i):null,e?a.createElement("title",{id:t},e):null,a.createElement("path",{stroke:"#646B81",strokeLinecap:"round",d:"M11 2 5 8l6 6"}))))},15843:(e,t,i)=>{i.d(t,{E:()=>s});var a=i(92379),n=i(21886),r=i(45981);const s=(0,n.I)("color",(({title:e,titleId:t,desc:i,descId:n,resourcePrefix:s=(0,r.O)(),...c})=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceNewTeam",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...c},i?a.createElement("desc",{id:n},i):null,e?a.createElement("title",{id:t},e):null,a.createElement("path",{fill:"#6D758D",d:"M4.629 10.999a.5.5 0 1 0 0-1zm-2.13-.5H2a.5.5 0 0 0 .5.5zm3.21-3.75a.5.5 0 1 0-1 0zm2.585 2.43a.5.5 0 1 0 .412-.912zm-1.036-2.43a.5.5 0 0 0-1 0zm.578 1.673.207-.455zm-3.682.049.228.445zm-.6.306-.227-.446zm7.817 3.722a.5.5 0 0 0 0 1zm2.13.5v.5a.5.5 0 0 0 .5-.5zm-2.21-3.75a.5.5 0 0 0-1 0zm.554 1.722-.227.445zm.6.306.228-.445zm-.816 2.222a.5.5 0 1 0 0-1zm-5.13-.5H6a.5.5 0 0 0 .5.5zm3.21-3.75a.5.5 0 0 0-1 0zm-1.555 1.722-.227-.445zm-.6.306.227.445zM4.63 9.999h-2.13v1h2.13zm-.848-.777.6-.306-.454-.89-.6.305zm4.925-.955-.663-.3-.413.91.664.301zm-3.77-2.899v-.79h-1v.79zm2.096-.79v.79h1v-.79zm0 .79c0 .605-.478 1.079-1.048 1.079v1c1.14 0 2.048-.94 2.048-2.079zM5.984 3.5c.57 0 1.048.474 1.048 1.079h1c0-1.14-.908-2.079-2.048-2.079zM4.935 4.579c0-.605.479-1.079 1.049-1.079v-1c-1.14 0-2.049.94-2.049 2.079zm-1 .789c0 1.139.908 2.079 2.049 2.079v-1c-.57 0-1.049-.474-1.049-1.079zm4.108 2.599a1.34 1.34 0 0 1-.785-1.218h-1c0 .918.536 1.75 1.372 2.128zm-3.661.95a2.43 2.43 0 0 0 1.327-2.168h-1c0 .539-.302 1.032-.782 1.277zM3 10.498c0-.539.302-1.032.781-1.277l-.454-.89A2.43 2.43 0 0 0 2 10.498zm8.371 3h2.13v-1h-2.13zm1.302-2.668-.6-.305-.455.89.6.306zm-.608-2.963v-.79h-1v.79zm-4.097-.79v.79h1v-.79zm0 .79c0 1.139.908 2.079 2.048 2.079v-1c-.57 0-1.048-.474-1.048-1.079zM10.016 5c-1.14 0-2.048.94-2.048 2.079h1c0-.605.478-1.079 1.048-1.079zm2.049 2.079c0-1.14-.908-2.079-2.049-2.079v1c.57 0 1.049.474 1.049 1.079zm-1 .789c0 .605-.479 1.079-1.049 1.079v1c1.14 0 2.049-.94 2.049-2.079zm1.008 2.658a1.43 1.43 0 0 1-.782-1.277h-1c0 .915.513 1.752 1.327 2.167zM14 12.999c0-.915-.513-1.752-1.328-2.168l-.454.891c.48.245.782.738.782 1.277zm-2.372-.5h-5.13v1h5.13zm-3.848-.777.6-.306-.454-.89-.6.306zm1.154-3.854v-.79h-1v.79zm2.097-.79v.79h1v-.79zm0 .79c0 .605-.478 1.079-1.048 1.079v1c1.14 0 2.048-.94 2.048-2.079zM9.984 6c.57 0 1.048.474 1.048 1.079h1c0-1.14-.908-2.079-2.048-2.079zM8.935 7.079C8.935 6.474 9.414 6 9.984 6V5c-1.14 0-2.049.94-2.049 2.079zm-1 .789c0 1.139.908 2.079 2.049 2.079v-1c-.57 0-1.049-.474-1.049-1.079zm.447 3.548A2.43 2.43 0 0 0 9.709 9.25h-1c0 .539-.302 1.032-.782 1.277zM7 13c0-.539.302-1.032.781-1.277l-.454-.89A2.43 2.43 0 0 0 6 12.999z"}))))},27195:(e,t,i)=>{i.d(t,{a:()=>s});var a=i(92379),n=i(21886),r=i(45981);const s=(0,n.I)("color",(({title:e,titleId:t,desc:i,descId:n,resourcePrefix:s=(0,r.O)(),...c})=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceReload",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...c},i?a.createElement("desc",{id:n},i):null,e?a.createElement("title",{id:t},e):null,a.createElement("path",{stroke:"#646B81",d:"M5.818 2.429A5.92 5.92 0 0 0 2 8a6 6 0 0 0 3.857 5.606m4.286-11.177C12.398 3.29 14 5.44 14 8a5.97 5.97 0 0 1-3.824 5.606M2.546 2h3.272v3.273M13.455 14h-3.273v-3.273"}))))},9773:(e,t,i)=>{i.d(t,{q:()=>s});var a=i(92379),n=i(21886),r=i(45981);const s=(0,n.I)("color",(({title:e,titleId:t,desc:i,descId:n,resourcePrefix:s=(0,r.O)(),...c})=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"none",viewBox:"0 0 20 20","aria-hidden":"true","data-icon":"InterfaceWriting",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...c},i?a.createElement("desc",{id:n},i):null,e?a.createElement("title",{id:t},e):null,a.createElement("path",{fill:"#646B81",d:"M1.504 17.437a.5.5 0 0 0 .992.126zm3.529-1.333-.218.45zm1.502 1.316.088-.492zm2.798-1.219-.166-.471zm2.976.409-.18.466zm1.856.46.042-.499zm4.005-.337a.5.5 0 0 0-.34-.94zM15.246 4.542l.39.314a.5.5 0 0 0-.095-.718zM12.46 2.5l.295-.403a.5.5 0 0 0-.716.132zM6.706 7.53l-.18-.467a.5.5 0 0 0-.315.396zm-1.031 7.307-.496-.07a.5.5 0 0 0 .716.519zm6.583-3.236.22.449a.5.5 0 0 0 .28-.421zm-6.976 2.942a.5.5 0 1 0 .81.585zm5.106-5.373a.5.5 0 0 0-.811-.585zm.489-4.532a.5.5 0 0 0-.559.83zm2.368 2.798a.5.5 0 1 0 .558-.83zM2.496 17.563c.003-.023.043-.135.236-.31.177-.161.427-.324.711-.458s.58-.229.84-.269c.273-.041.447-.014.532.028l.436-.9c-.348-.168-.756-.171-1.118-.116a4.1 4.1 0 0 0-1.116.353c-.353.166-.692.38-.958.622-.25.228-.507.544-.555.924zm2.32-1.01c.18.088.26.23.483.555.209.304.519.691 1.147.805l.177-.985c-.228-.04-.339-.152-.5-.387-.149-.216-.393-.656-.872-.888zm1.63 1.36c.753.135 1.357-.179 1.826-.484.118-.077.234-.158.343-.234q.164-.116.317-.219c.208-.137.39-.24.567-.303l-.332-.943c-.293.103-.556.26-.787.413q-.176.117-.339.233c-.11.076-.212.148-.315.215-.417.271-.742.402-1.103.337zm3.053-1.24c.842-.296 1.629.016 2.63.403l.36-.932c-.91-.352-2.068-.855-3.322-.414zm2.63.403c.63.244 1.271.43 1.994.492l.084-.997c-.597-.05-1.142-.205-1.718-.427zm1.994.492c1.541.13 2.802-.384 4.047-.835l-.34-.94c-1.302.47-2.343.886-3.623.778zM12.459 2.5l-.42-.271-.002.001-.004.007-.018.028-.078.113a17.281 17.281 0 0 1-1.467 1.81C9.473 5.26 8.096 6.455 6.526 7.063l.362.932c1.774-.687 3.274-2.007 4.315-3.126a18 18 0 0 0 1.558-1.922l.119-.176zM6.21 7.46l-1.032 7.307.99.14 1.032-7.308zm-.316 7.826 6.583-3.236-.44-.897-6.584 3.235zm6.862-3.657c.094-1.695.8-3.382 1.508-4.669a17 17 0 0 1 1.26-1.962l.083-.109.021-.026.005-.006.001-.001-.778-.628h-.001l-.002.003-.033.042-.094.123a18.319 18.319 0 0 0-1.338 2.083c-.738 1.341-1.525 3.183-1.63 5.095zm-6.664 3.499 4.295-5.958-.811-.585-4.295 5.958zm4.226-9.66 2.926 1.968.558-.83-2.927-1.968zm5.222-1.33-2.787-2.041-.591.806 2.788 2.042z"}))))}}]);