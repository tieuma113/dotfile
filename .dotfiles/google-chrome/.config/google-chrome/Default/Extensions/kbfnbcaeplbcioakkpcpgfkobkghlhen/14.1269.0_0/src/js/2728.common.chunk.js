(self.webpackChunk=self.webpackChunk||[]).push([[2728],{82728:(e,r,t)=>{t.r(r),t.d(r,{activate:()=>X});var i=t(32073),n=t(90572),o=t(59179),s=t(84714),a=t(58303),c=t(90023),d=t(32103),u=t(74170),p=t(96333),v=t(67177),l=t(12518),g=t(71483),b=t(2099),h=t(57899),S=t(35140),m=t(704),f=t(5749),C=t(81600),k=t(76755),A=t(1254),y=t(24893),w=t(13391),I=t(82188),P=t(45676),x=t(42203),E=t(84178),B=t(2187),O=Object.defineProperty,V=Object.defineProperties,F=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,G=(e,r,t)=>r in e?O(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var R,D,q;(D=R||(R={})).Id=g.Rn,D.create=e=>{const r=(0,y.j)(),t=e.decorationService.createDecorationFactory(D.Id),s=e.experimentationBridge.isAssigned(u.AIEditorParaphraserAllUnderlines);r.debug("Checking if underlines should be kept",{shouldKeepUnderlines:s});const d=e.initNavigation(D.Id,s?b.r.Regular:b.r.SingleThread),p=S.Z.create({capiSessionStarted:e.capiSession.events.pipe((0,n.h)(P.hX.is("session_started")),(0,o.U)((e=>({sessionId:e.sessionUuid})))),capiConnectionEvents:e.capiSession.events.pipe((0,n.h)((0,x.Kg)(P.hX.is("connect"),P.hX.is("disconnect")))),agenticService:q.create({agentGenericService:e.agentGenericService,pushedContentService:e.pushedContentService}),isPanelOpen:d.isPanelOpen,featureFlags:{customVoice:e.experimentationBridge.isAssigned(u.AIEditorParaphraserMyVoice),focusCard:e.experimentationBridge.isAssigned(u.AIEditorParaphraserFocusCard),aiChat:e.experimentationBridge.isAssigned(u.ParaphraserAgentAIChat)},editor:e.editor,trackingServiceProvider:e.trackingServiceProvider,decorationService:e.decorationService,fileUploadService:e.fileUploadService,isOnboardingExperimentEnabled:e.experimentationBridge.isAssigned(A.Uk,"test")}),v=e=>{var r;return f.h.isWithRewrite(e)?null!=(r=e.surface.explanation)?r:e.surface.title:void 0},l=C.pS.create({agentId:D.Id,pushedContentService:e.pushedContentService,vbarFeedbackService:e.vbarFeedbackService,trackingServiceProvider:e.trackingServiceProvider,decorationsFactory:t,decorationService:e.decorationService,uphookHubClient:e.uphookHubClient,isActive:d.isPanelOpen,getDecorationFactory:m.p,experimentationBridge:e.experimentationBridge,userService:e.userService,itemsFilter:p.selectedMode.view((e=>r=>(0,k.B)(r)&&(0,c.zG)(e,a.Gg((e=>r.surface.sourceAction===e.sourceAction))))),agentMetadataSource:e=>(0,k.B)(e)?{sourceAction:e.surface.sourceAction}:void 0,vbarRenderOverrides:{getCardTitle:v,getVBarProps:(e,r)=>((e,r)=>V(e,F(r)))(((e,r)=>{for(var t in r||(r={}))M.call(r,t)&&G(e,t,r[t]);if(U)for(var t of U(r))j.call(r,t)&&G(e,t,r[t]);return e})({},e),{primaryText:v(r)}),getCardIcon:()=>({icon:I.y,size:"medium"})},trustedRewrite:c.jv}),g=w.h.create(!1),O=new i.w0;return O.add(e.capiSession.events.pipe(n.h(P.hX.is("session_started")),E.q(1),o.U((e=>e.allowedFeatures.includes("PARAPHRASER")))).subscribe(B.wW(g))),{agent:{id:D.Id,decorations:h.dX.Collection.create(D.Id,{pushedContent:l}),viewModel:p,dispose:()=>{p.dispose(),O.unsubscribe()}},isAvailable:g}},(q||(q={})).create=e=>{const{agentGenericService:r,pushedContentService:t}=e,i=(0,y.j)("AgenticService"),n=t.getCollection(k.B),o=()=>p.$.values(n.get()),s=e=>(0,k.f)(e,o()),a=n.view((()=>o()));return{getModes:()=>(0,c.zG)(r.request({commandId:"start",payload:"",agentId:R.Id}),v.Vn((e=>(i.error("Error requesting evaluation",e),e))),v.tS((e=>(i.debug("Received evaluation response",e),(0,c.zG)(v.Uo(g.OB.decode(e.payload)),v.Vn((e=>(i.error("Error decoding evaluation",e),e))),v.UI((e=>(i.debug("Decoded evaluation response",e),e)))))))),getRewrites:(e,t=!1)=>{const n=s(e);return!t&&n.length>0?(i.debug("Skipping request - VBars already exist for mode and force is false"),v.F2(void 0)):v.Y3((()=>r.requestWithStreaming({commandId:"triggerMode",payload:JSON.stringify({modeId:e.id}),agentId:R.Id})().then((e=>(0,c.zG)(e,l.pF((e=>{throw e}))))).then((e=>new Promise(((r,t)=>{e.subscribe((e=>{(0,c.zG)(e,l.g_((e=>{i.error("Error requesting pushed content:",e),t(e)}),(e=>{i.debug("Received pushed content response",e),"final"===e.kind&&r(void 0)})))}))}))))),l.KC)},clearVBars:()=>{i.debug("Clearing the Paraphraser VBars"),t.clear(k.B)},getCurrentVBars:o,getCurrentVBarsForMode:s,currentVBars:a}};var z=(e,r)=>(r=Symbol[e])?r:Symbol.for("Symbol."+e),T=e=>{throw TypeError(e)};const X=e=>{return r=void 0,t=[e],p=function*({bus:e,navigation:r,capiConnectionStatus:t,agentGenericService:p,pushedContentService:v,experimentation:l,document:b,fileUploadService:h,trackingServiceProvider:m}){var f=[];try{const A=((e,r,t)=>{var i;return null!=r?("object"!=typeof r&&"function"!=typeof r&&T("Object expected"),t&&(i=r[z("asyncDispose")]),void 0===i&&(i=r[z("dispose")]),"function"!=typeof i&&T("Object not disposable"),e.push([t,i,r])):t&&e.push([t]),r})(f,new DisposableStack),y=A.adopt(new i.w0,(e=>e.unsubscribe())),w=A.use(e.state.agentState.create(b.id,{kind:g.ZM.Kind.Initial})),I=A.use(e.state.capiSessionId.create(b.id,null)),P=A.use(e.state.wordCount.create(b.id,0)),E=A.adopt(S.Z.create({capiSessionStarted:t.pipe(n.h((e=>"connected"===e.kind)),o.U((e=>({sessionId:e.sessionId})))),capiConnectionEvents:t.view((e=>"connected"===e.kind?{kind:"connect"}:"disconnected"===e.kind?{kind:"disconnect"}:null)).pipe(n.h(x.C_)),agenticService:q.create({agentGenericService:p,pushedContentService:v}),isPanelOpen:r.isPanelOpen,featureFlags:{customVoice:l.isAssigned(u.AIEditorParaphraserMyVoice),focusCard:l.isAssigned(u.AIEditorParaphraserFocusCard),aiChat:l.isAssigned(u.ParaphraserAgentAIChat)},editor:{changes:b.textChanges,getContents:()=>b.getText()},trackingServiceProvider:m,decorationService:{setFocusMode:c.Q1,focusModeDecorationType:s.of(a.YP),removeAgentDecorations:c.Q1},fileUploadService:h,isOnboardingExperimentEnabled:!1}),(e=>e.dispose()));return y.add(E.state.subscribe((e=>w.set(e)))),y.add(t.pipe(n.h((e=>"connected"===e.kind))).subscribe((e=>I.set(e.sessionId)))),y.add(E.context.textWordsCount.subscribe((e=>P.set(e)))),y.add(e.events.trackingEvent.view(b.id).subscribe((e=>E.context.tracking.trackEvent(e.event,e.detail)))),y.add(e.events.panelUIAction.view(b.id).subscribe((e=>{switch(e.kind){case"executeModeAction":E.executeMode(e.modeId);break;case"editCustomVoiceAction":E.editCustomVoice();break;case"saveCustomVoiceAction":E.saveCustomVoice(e.voiceName,e.content,e.description);break;case"removeCustomVoiceAction":E.removeCustomVoice(e.voiceName);break;case"reloadAgentAction":E.reloadAgent();break;case"goBackAction":E.goBack(e.previousState);break;default:(0,d.L0)(e)}}))),A.move()}catch(e){var C=e,k=!0}finally{((e,r,t)=>{var i="function"==typeof SuppressedError?SuppressedError:function(e,r,t,i){return(i=Error(t)).name="SuppressedError",i.error=e,i.suppressed=r,i},n=e=>r=t?new i(e,r,"An error was suppressed during disposal"):(t=!0,e),o=i=>{for(;i=e.pop();)try{var s=i[1]&&i[1].call(i[2]);if(i[0])return Promise.resolve(s).then(o,(e=>(n(e),o())))}catch(e){n(e)}if(t)throw r};o()})(f,C,k)}},new Promise(((e,i)=>{var n=e=>{try{s(p.next(e))}catch(e){i(e)}},o=e=>{try{s(p.throw(e))}catch(e){i(e)}},s=r=>r.done?e(r.value):Promise.resolve(r.value).then(n,o);s((p=p.apply(r,t)).next())}));var r,t,p}}}]);